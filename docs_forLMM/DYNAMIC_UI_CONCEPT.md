# Концепция: Динамический "Квантовый" UI для ecKasse

## 1. Цель

Перейти от статичной сетки к интеллектуальной, контекстно-зависимой компоновке кнопок, которая адаптируется к задачам пользователя в реальном времени. Это позволит максимально эффективно использовать экранное пространство, показывая только релевантные действия и избегая перегруженности интерфейса.

## 2. Основная идея: "Квантовая" модель интерфейса

В основе концепции лежит аналогия с квантовой механикой. Вместо жестко закрепленных позиций, каждая кнопка (действие) имеет "вероятность" появления в определенных ячейках сетки.

* **Суперпозиция:** В любой момент времени ячейка сетки потенциально может содержать несколько действий с разной вероятностью.
* **Коллапс волновой функции:** Контекст пользователя (например, переход в подменю или начало оплаты) действует как "наблюдатель". Он "коллапсирует" состояние сетки, и в ячейках материализуются кнопки с наивысшей вероятностью (приоритетом) для данного контекста.
* **Принцип неопределенности:** Если высокоприоритетное действие (например, отображение списка товаров) занимает основное место системной кнопки (например, "Оплата"), то кнопка "Оплата" либо исчезает, либо "появляется" в другом, менее вероятном, но свободном месте.
* **Принцип исключения:** Одна и та же кнопка (действие) не может появиться в нескольких местах одновременно. После "коллапса" в одной ячейке, ее вероятность в других падает до нуля.

## 3. Технические принципы реализации

Эта модель будет реализована через продвинутый **менеджер состояний и приоритетов UI**.

### 3.1. Менеджер состояний UI (UI State Machine)
Интерфейс будет иметь четко определенные состояния, например:
* `TOP_LEVEL_SELECTION` (выбор основных категорий)
* `DEEP_NAVIGATION` (навигация по подкатегориям, например, "Еда" -> "Супы")
* `ORDER_ACTIVE` (в чеке есть товары)
* `PAYMENT_MODE` (активирован процесс оплаты)

### 3.2. Приоритеты действий (Action Priorities)
Каждому возможному действию (показать товар, оплатить, отменить, назад, и т.д.) будет присвоен числовой приоритет, который **динамически меняется** в зависимости от текущего состояния UI.

* **Пример:**
    * В состоянии `TOP_LEVEL_SELECTION`: Приоритет "Оплатить" = `80`, "Показать категорию" = `70`.
    * В состоянии `DEEP_NAVIGATION` (меню супов): Приоритет "Показать суп" = `100`, "Назад" = `90`, "Оплатить" = `10`.

### 3.3. Контекстный движок компоновки (Contextual Layout Engine)
Перед каждой перерисовкой сетки будет работать специальная функция-планировщик:
1.  Она получает текущее состояние UI и список данных для отображения (например, 12 супов).
2.  Она получает список всех системных действий с их текущими приоритетами.
3.  Она "заполняет" сетку, начиная с действий с самым высоким приоритетом, размещая их в ячейках с наивысшей "вероятностью".
4.  Действия с низким приоритетом размещаются в оставшиеся свободные ячейки или не отображаются вовсе, если места не хватило.

### 3.4. Разделение кнопок
* **Полукнопки (Half-buttons):** Будут зарезервированы для почти статичных, глобальных действий (например, `Переключение вида`, `Время`, `Назад`), так как они важны в большинстве контекстов.
* **Полные кнопки (Full-buttons):** Становятся полностью динамической областью, где и происходит основное "квантовое" размещение.

## 4. Пример работы: Меню супов вытесняет кнопки оплаты

1.  **Состояние:** `TOP_LEVEL_SELECTION`. Пользователь видит категории "Еда", "Напитки". Внизу, в последнем ряду, видны кнопки "Bar", "Karte", так как у них высокий приоритет (`80`).
2.  **Действие:** Пользователь нажимает "Еда", затем "Супы".
3.  **Смена состояния:** Состояние UI меняется на `DEEP_NAVIGATION`.
4.  **Коллапс:** Движок компоновки пересчитывает приоритеты:
    * Приоритет действия "Показать товар (суп)" становится `100`.
    * Приоритет действия "Назад" становится `90`.
    * Приоритет действий "Bar", "Karte" падает до `10`.
5.  **Результат:**
    * Движок размещает все 12 кнопок с супами, занимая почти всю сетку, включая ячейки, где раньше были кнопки оплаты.
    * Кнопка "Назад" (полукнопка) остается на своем месте с высоким приоритетом.
    * Кнопки "Bar" и "Karte" не находят для себя свободных ячеек с достаточным приоритетом и временно исчезают, так как в контексте выбора супа они не нужны.

## 5. Преимущества подхода

* **Контекстуальность:** Пользователь видит только те инструменты, которые ему нужны в данный момент.
* **Эффективность:** Максимальное использование пространства для отображения данных (товаров, категорий).
* **Чистота интерфейса:** Отсутствие лишних кнопок снижает когнитивную нагрузку.
* **Гибкость:** Легкое добавление новых состояний и правил без изменения всей логики UI.