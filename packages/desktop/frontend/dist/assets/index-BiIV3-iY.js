(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();const ps=!1;var Sr=Array.isArray,gi=Array.prototype.indexOf,ha=Array.from,Lr=Object.defineProperty,Qt=Object.getOwnPropertyDescriptor,gs=Object.getOwnPropertyDescriptors,mi=Object.prototype,hi=Array.prototype,ya=Object.getPrototypeOf,Va=Object.isExtensible;function dr(e){return typeof e=="function"}const dn=()=>{};function yi(e){return e()}function Fr(e){for(var n=0;n<e.length;n++)e[n]()}function _i(){var e,n,r=new Promise((a,s)=>{e=a,n=s});return{promise:r,resolve:e,reject:n}}const It=2,_a=4,Hr=8,kr=16,nn=32,Cn=64,ms=128,$t=256,Ur=512,it=1024,Rt=2048,rn=4096,Dt=8192,Tn=16384,ba=32768,Wr=65536,Ga=1<<17,bi=1<<18,wa=1<<19,xa=1<<20,da=1<<21,Sa=1<<22,_n=1<<23,qt=Symbol("$state"),hs=Symbol("legacy props"),ka=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function wi(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function Jr(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function xi(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Si(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function ki(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Ci(e){throw new Error("https://svelte.dev/e/effect_orphan")}function Ti(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ei(e){throw new Error("https://svelte.dev/e/lifecycle_legacy_only")}function Ii(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Mi(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Ai(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function $i(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const Kr=1,Yr=2,ys=4,Ri=8,Pi=16,Oi=2,Ni=4,Di=8,Bi=1,Li=2,at=Symbol(),Fi="http://www.w3.org/1999/xhtml";function Ui(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let ji=!1;function _s(e){return e===this.v}function bs(e,n){return e!=e?n==n:e!==n||e!==null&&typeof e=="object"||typeof e=="function"}function ws(e){return!bs(e,this.v)}let er=!1,qi=!1;function zi(){er=!0}let Le=null;function jr(e){Le=e}function _t(e,n=!1,r){Le={p:Le,c:null,e:null,s:e,x:null,l:er&&!n?{s:null,u:null,$:[]}:null}}function bt(e){var n=Le,r=n.e;if(r!==null){n.e=null;for(var a of r)Ps(a)}return e!==void 0&&(n.x=e),Le=n.p,e??{}}function tr(){return!er||Le!==null&&Le.l===null}const Vi=new WeakMap;function Gi(e){var n=Te;if(n===null)return Me.f|=_n,e;if((n.f&ba)===0){if((n.f&ms)===0)throw!n.parent&&e instanceof Error&&xs(e),e;n.b.error(e)}else Ca(e,n)}function Ca(e,n){for(;n!==null;){if((n.f&ms)!==0)try{n.b.error(e);return}catch(r){e=r}n=n.parent}throw e instanceof Error&&xs(e),e}function xs(e){const n=Vi.get(e);n&&(Lr(e,"message",{value:n.message}),Lr(e,"stack",{value:n.stack}))}let qr=[];function Hi(){var e=qr;qr=[],Fr(e)}function Ta(e){qr.length===0&&queueMicrotask(Hi),qr.push(e)}function Wi(){for(var e=Te.b;e!==null&&!e.has_pending_snippet();)e=e.parent;return e===null&&wi(),e}function Ea(e){var n=It|Rt,r=Me!==null&&(Me.f&It)!==0?Me:null;return Te===null||r!==null&&(r.f&$t)!==0?n|=$t:Te.f|=wa,{ctx:Le,deps:null,effects:null,equals:_s,f:n,fn:e,reactions:null,rv:0,v:at,wv:0,parent:r??Te,ac:null}}function Ji(e,n){let r=Te;r===null&&xi();var a=r.b,s=void 0,i=yr(at),l=null,c=!Me;return oo(()=>{try{var o=e()}catch(m){o=Promise.reject(m)}var u=()=>o;s=l?.then(u,u)??Promise.resolve(o),l=s;var y=Ne,g=a.pending;c&&(a.update_pending_count(1),g||y.increment());const T=(m,x=void 0)=>{l=null,g||y.activate(),x?x!==ka&&(i.f|=_n,Yn(i,x)):((i.f&_n)!==0&&(i.f^=_n),Yn(i,m)),c&&(a.update_pending_count(-1),g||y.decrement()),Cs()};if(s.then(T,m=>T(null,m||"unknown")),y)return()=>{queueMicrotask(()=>y.neuter())}}),new Promise(o=>{function u(y){function g(){y===s?o(i):u(s)}y.then(g,g)}u(s)})}function et(e){const n=Ea(e);return n.equals=ws,n}function Ss(e){var n=e.effects;if(n!==null){e.effects=null;for(var r=0;r<n.length;r+=1)en(n[r])}}function Ki(e){for(var n=e.parent;n!==null;){if((n.f&It)===0)return n;n=n.parent}return null}function Ia(e){var n,r=Te;vn(Ki(e));try{Ss(e),n=Vs(e)}finally{vn(r)}return n}function ks(e){var n=Ia(e);if(e.equals(n)||(e.v=n,e.wv=qs()),!In)if(Jn!==null)Jn.set(e,e.v);else{var r=(un||(e.f&$t)!==0)&&e.deps!==null?rn:it;pt(e,r)}}function Yi(e,n,r){const a=tr()?Ea:et;if(n.length===0){r(e.map(a));return}var s=Ne,i=Te,l=Xi(),c=Wi();Promise.all(n.map(o=>Ji(o))).then(o=>{s?.activate(),l();try{r([...e.map(a),...o])}catch(u){(i.f&Tn)===0&&Ca(u,i)}s?.deactivate(),Cs()}).catch(o=>{c.error(o)})}function Xi(){var e=Te,n=Me,r=Le;return function(){vn(e),Vt(n),jr(r)}}function Cs(){vn(null),Vt(null),jr(null)}const fr=new Set;let Ne=null,Br=null,Jn=null,Ha=new Set,zr=[];function Ts(){const e=zr.shift();zr.length>0&&queueMicrotask(Ts),e()}let hr=[],Ma=null,fa=!1;class Kn{current=new Map;#e=new Map;#n=new Set;#t=0;#a=null;#u=!1;#s=[];#o=[];#i=[];#r=[];#l=[];#d=[];#f=[];skipped_effects=new Set;process(n){hr=[],Br=null;var r=null;if(fr.size>1){r=new Map,Jn=new Map;for(const[i,l]of this.current)r.set(i,{v:i.v,wv:i.wv}),i.v=l;for(const i of fr)if(i!==this)for(const[l,c]of i.#e)r.has(l)||(r.set(l,{v:l.v,wv:l.wv}),l.v=c)}for(const i of n)this.#p(i);if(this.#s.length===0&&this.#t===0){this.#v();var a=this.#i,s=this.#r;this.#i=[],this.#r=[],this.#l=[],Br=Ne,Ne=null,Wa(a),Wa(s),Ne===null?Ne=this:fr.delete(this),this.#a?.resolve()}else this.#c(this.#i),this.#c(this.#r),this.#c(this.#l);if(r){for(const[i,{v:l,wv:c}]of r)i.wv<=c&&(i.v=l);Jn=null}for(const i of this.#s)Hn(i);for(const i of this.#o)Hn(i);this.#s=[],this.#o=[]}#p(n){n.f^=it;for(var r=n.first;r!==null;){var a=r.f,s=(a&(nn|Cn))!==0,i=s&&(a&it)!==0,l=i||(a&Dt)!==0||this.skipped_effects.has(r);if(!l&&r.fn!==null){if(s)r.f^=it;else if((a&it)===0)if((a&_a)!==0)this.#r.push(r);else if((a&Sa)!==0){var c=r.b?.pending?this.#o:this.#s;c.push(r)}else Cr(r)&&((r.f&kr)!==0&&this.#l.push(r),Hn(r));var o=r.first;if(o!==null){r=o;continue}}var u=r.parent;for(r=r.next;r===null&&u!==null;)r=u.next,u=u.parent}}#c(n){for(const r of n)((r.f&Rt)!==0?this.#d:this.#f).push(r),pt(r,it);n.length=0}capture(n,r){this.#e.has(n)||this.#e.set(n,r),this.current.set(n,n.v)}activate(){Ne=this}deactivate(){Ne=null,Br=null;for(const n of Ha)if(Ha.delete(n),n(),Ne!==null)break}neuter(){this.#u=!0}flush(){hr.length>0?Qi():this.#v(),Ne===this&&(this.#t===0&&fr.delete(this),this.deactivate())}#v(){if(!this.#u)for(const n of this.#n)n();this.#n.clear()}increment(){this.#t+=1}decrement(){if(this.#t-=1,this.#t===0){for(const n of this.#d)pt(n,Rt),xn(n);for(const n of this.#f)pt(n,rn),xn(n);this.#i=[],this.#r=[],this.flush()}else this.deactivate()}add_callback(n){this.#n.add(n)}settled(){return(this.#a??=_i()).promise}static ensure(){if(Ne===null){const n=Ne=new Kn;fr.add(Ne),Kn.enqueue(()=>{Ne===n&&n.flush()})}return Ne}static enqueue(n){zr.length===0&&queueMicrotask(Ts),zr.unshift(n)}}function Qi(){var e=Gn;fa=!0;try{var n=0;for(Ya(!0);hr.length>0;){var r=Kn.ensure();if(n++>1e3){var a,s;Zi()}r.process(hr),bn.clear()}}finally{fa=!1,Ya(e),Ma=null}}function Zi(){try{Ti()}catch(e){Ca(e,Ma)}}function Wa(e){var n=e.length;if(n!==0){for(var r=0;r<n;){var a=e[r++];if((a.f&(Tn|Dt))===0&&Cr(a)){var s=Ne?Ne.current.size:0;if(Hn(a),a.deps===null&&a.first===null&&a.nodes_start===null&&(a.teardown===null&&a.ac===null?Bs(a):a.fn=null),Ne!==null&&Ne.current.size>s&&(a.f&xa)!==0)break}}for(;r<n;)xn(e[r++])}}function xn(e){for(var n=Ma=e;n.parent!==null;){n=n.parent;var r=n.f;if(fa&&n===Te&&(r&kr)!==0)return;if((r&(Cn|nn))!==0){if((r&it)===0)return;n.f^=it}}hr.push(n)}const bn=new Map;function yr(e,n){var r={f:0,v:e,reactions:null,equals:_s,rv:0,wv:0};return r}function ln(e,n){const r=yr(e);return uo(r),r}function V(e,n=!1,r=!0){const a=yr(e);return n||(a.equals=ws),er&&r&&Le!==null&&Le.l!==null&&(Le.l.s??=[]).push(a),a}function qe(e,n){return h(e,S(()=>t(e))),n}function h(e,n,r=!1){Me!==null&&(!Ut||(Me.f&Ga)!==0)&&tr()&&(Me.f&(It|kr|Sa|Ga))!==0&&!Zt?.includes(e)&&$i();let a=r?Vn(n):n;return Yn(e,a)}function Yn(e,n){if(!e.equals(n)){var r=e.v;In?bn.set(e,n):bn.set(e,r),e.v=n;var a=Kn.ensure();a.capture(e,r),(e.f&It)!==0&&((e.f&Rt)!==0&&Ia(e),pt(e,(e.f&$t)===0?it:rn)),e.wv=qs(),Es(e,Rt),tr()&&Te!==null&&(Te.f&it)!==0&&(Te.f&(nn|Cn))===0&&(At===null?fo([e]):At.push(e))}return n}function ia(e){h(e,e.v+1)}function Es(e,n){var r=e.reactions;if(r!==null)for(var a=tr(),s=r.length,i=0;i<s;i++){var l=r[i],c=l.f;if(!(!a&&l===Te)){var o=(c&Rt)===0;o&&pt(l,n),(c&It)!==0?Es(l,rn):o&&xn(l)}}}function Vn(e){if(typeof e!="object"||e===null||qt in e)return e;const n=ya(e);if(n!==mi&&n!==hi)return e;var r=new Map,a=Sr(e),s=ln(0),i=wn,l=c=>{if(wn===i)return c();var o=Me,u=wn;Vt(null),Qa(i);var y=c();return Vt(o),Qa(u),y};return a&&r.set("length",ln(e.length)),new Proxy(e,{defineProperty(c,o,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&Mi();var y=r.get(o);return y===void 0?y=l(()=>{var g=ln(u.value);return r.set(o,g),g}):h(y,u.value,!0),!0},deleteProperty(c,o){var u=r.get(o);if(u===void 0){if(o in c){const y=l(()=>ln(at));r.set(o,y),ia(s)}}else h(u,at),ia(s);return!0},get(c,o,u){if(o===qt)return e;var y=r.get(o),g=o in c;if(y===void 0&&(!g||Qt(c,o)?.writable)&&(y=l(()=>{var m=Vn(g?c[o]:at),x=ln(m);return x}),r.set(o,y)),y!==void 0){var T=t(y);return T===at?void 0:T}return Reflect.get(c,o,u)},getOwnPropertyDescriptor(c,o){var u=Reflect.getOwnPropertyDescriptor(c,o);if(u&&"value"in u){var y=r.get(o);y&&(u.value=t(y))}else if(u===void 0){var g=r.get(o),T=g?.v;if(g!==void 0&&T!==at)return{enumerable:!0,configurable:!0,value:T,writable:!0}}return u},has(c,o){if(o===qt)return!0;var u=r.get(o),y=u!==void 0&&u.v!==at||Reflect.has(c,o);if(u!==void 0||Te!==null&&(!y||Qt(c,o)?.writable)){u===void 0&&(u=l(()=>{var T=y?Vn(c[o]):at,m=ln(T);return m}),r.set(o,u));var g=t(u);if(g===at)return!1}return y},set(c,o,u,y){var g=r.get(o),T=o in c;if(a&&o==="length")for(var m=u;m<g.v;m+=1){var x=r.get(m+"");x!==void 0?h(x,at):m in c&&(x=l(()=>ln(at)),r.set(m+"",x))}if(g===void 0)(!T||Qt(c,o)?.writable)&&(g=l(()=>ln(void 0)),h(g,Vn(u)),r.set(o,g));else{T=g.v!==at;var I=l(()=>Vn(u));h(g,I)}var N=Reflect.getOwnPropertyDescriptor(c,o);if(N?.set&&N.set.call(y,u),!T){if(a&&typeof o=="string"){var L=r.get("length"),q=Number(o);Number.isInteger(q)&&q>=L.v&&h(L,q+1)}ia(s)}return!0},ownKeys(c){t(s);var o=Reflect.ownKeys(c).filter(g=>{var T=r.get(g);return T===void 0||T.v!==at});for(var[u,y]of r)y.v!==at&&!(u in c)&&o.push(u);return o},setPrototypeOf(){Ai()}})}function Ja(e){try{if(e!==null&&typeof e=="object"&&qt in e)return e[qt]}catch{}return e}function eo(e,n){return Object.is(Ja(e),Ja(n))}var _r,Is,Ms,As;function to(){if(_r===void 0){_r=window,Is=/Firefox/.test(navigator.userAgent);var e=Element.prototype,n=Node.prototype,r=Text.prototype;Ms=Qt(n,"firstChild").get,As=Qt(n,"nextSibling").get,Va(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),Va(r)&&(r.__t=void 0)}}function En(e=""){return document.createTextNode(e)}function jt(e){return Ms.call(e)}function Xr(e){return As.call(e)}function f(e,n){return jt(e)}function xe(e,n){{var r=jt(e);return r instanceof Comment&&r.data===""?Xr(r):r}}function w(e,n=1,r=!1){let a=e;for(;n--;)a=Xr(a);return a}function no(e){e.textContent=""}function Aa(){return!1}let Ka=!1;function ro(){Ka||(Ka=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{if(!e.defaultPrevented)for(const n of e.target.elements)n.__on_r?.()})},{capture:!0}))}function Qr(e){var n=Me,r=Te;Vt(null),vn(null);try{return e()}finally{Vt(n),vn(r)}}function $s(e,n,r,a=r){e.addEventListener(n,()=>Qr(r));const s=e.__on_r;s?e.__on_r=()=>{s(),a(!0)}:e.__on_r=()=>a(!0),ro()}function Rs(e){Te===null&&Me===null&&Ci(),Me!==null&&(Me.f&$t)!==0&&Te===null&&ki(),In&&Si()}function ao(e,n){var r=n.last;r===null?n.last=n.first=e:(r.next=e,e.prev=r,n.last=e)}function Gt(e,n,r,a=!0){var s=Te;s!==null&&(s.f&Dt)!==0&&(e|=Dt);var i={ctx:Le,deps:null,nodes_start:null,nodes_end:null,f:e|Rt,first:null,fn:n,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(r)try{Hn(i),i.f|=ba}catch(o){throw en(i),o}else n!==null&&xn(i);var l=r&&i.deps===null&&i.first===null&&i.nodes_start===null&&i.teardown===null&&(i.f&wa)===0;if(!l&&a&&(s!==null&&ao(i,s),Me!==null&&(Me.f&It)!==0&&(e&Cn)===0)){var c=Me;(c.effects??=[]).push(i)}return i}function Zr(e){const n=Gt(Hr,null,!1);return pt(n,it),n.teardown=e,n}function va(e){Rs();var n=Te.f,r=!Me&&(n&nn)!==0&&(n&ba)===0;if(r){var a=Le;(a.e??=[]).push(e)}else return Ps(e)}function Ps(e){return Gt(_a|xa,e,!1)}function so(e){return Rs(),Gt(Hr|xa,e,!0)}function io(e){Kn.ensure();const n=Gt(Cn,e,!0);return(r={})=>new Promise(a=>{r.outro?ta(n,()=>{en(n),a(void 0)}):(en(n),a(void 0))})}function $a(e){return Gt(_a,e,!1)}function Be(e,n){var r=Le,a={effect:null,ran:!1,deps:e};r.l.$.push(a),a.effect=ea(()=>{e(),!a.ran&&(a.ran=!0,S(n))})}function pn(){var e=Le;ea(()=>{for(var n of e.l.$){n.deps();var r=n.effect;(r.f&it)!==0&&pt(r,rn),Cr(r)&&Hn(r),n.ran=!1}})}function oo(e){return Gt(Sa|wa,e,!0)}function ea(e,n=0){return Gt(Hr|n,e,!0)}function le(e,n=[],r=[]){Yi(n,r,a=>{Gt(Hr,()=>e(...a.map(t)),!0)})}function Ra(e,n=0){var r=Gt(kr|n,e,!0);return r}function Xn(e,n=!0){return Gt(nn,e,!0,n)}function Os(e){var n=e.teardown;if(n!==null){const r=In,a=Me;Xa(!0),Vt(null);try{n.call(null)}finally{Xa(r),Vt(a)}}}function Ns(e,n=!1){var r=e.first;for(e.first=e.last=null;r!==null;){const s=r.ac;s!==null&&Qr(()=>{s.abort(ka)});var a=r.next;(r.f&Cn)!==0?r.parent=null:en(r,n),r=a}}function lo(e){for(var n=e.first;n!==null;){var r=n.next;(n.f&nn)===0&&en(n),n=r}}function en(e,n=!0){var r=!1;(n||(e.f&bi)!==0)&&e.nodes_start!==null&&e.nodes_end!==null&&(Ds(e.nodes_start,e.nodes_end),r=!0),Ns(e,n&&!r),Vr(e,0),pt(e,Tn);var a=e.transitions;if(a!==null)for(const i of a)i.stop();Os(e);var s=e.parent;s!==null&&s.first!==null&&Bs(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=e.ac=null}function Ds(e,n){for(;e!==null;){var r=e===n?null:Xr(e);e.remove(),e=r}}function Bs(e){var n=e.parent,r=e.prev,a=e.next;r!==null&&(r.next=a),a!==null&&(a.prev=r),n!==null&&(n.first===e&&(n.first=a),n.last===e&&(n.last=r))}function ta(e,n){var r=[];Pa(e,r,!0),Ls(r,()=>{en(e),n&&n()})}function Ls(e,n){var r=e.length;if(r>0){var a=()=>--r||n();for(var s of e)s.out(a)}else n()}function Pa(e,n,r){if((e.f&Dt)===0){if(e.f^=Dt,e.transitions!==null)for(const l of e.transitions)(l.is_global||r)&&n.push(l);for(var a=e.first;a!==null;){var s=a.next,i=(a.f&Wr)!==0||(a.f&nn)!==0;Pa(a,n,i?r:!1),a=s}}}function Oa(e){Fs(e,!0)}function Fs(e,n){if((e.f&Dt)!==0){e.f^=Dt,(e.f&it)===0&&(pt(e,Rt),xn(e));for(var r=e.first;r!==null;){var a=r.next,s=(r.f&Wr)!==0||(r.f&nn)!==0;Fs(r,s?n:!1),r=a}if(e.transitions!==null)for(const i of e.transitions)(i.is_global||n)&&i.in()}}let zn=null;function co(e){var n=zn;try{if(zn=new Set,S(e),n!==null)for(var r of zn)n.add(r);return zn}finally{zn=n}}function Us(e){for(var n of co(e))Yn(n,n.v)}let Gn=!1;function Ya(e){Gn=e}let In=!1;function Xa(e){In=e}let Me=null,Ut=!1;function Vt(e){Me=e}let Te=null;function vn(e){Te=e}let Zt=null;function uo(e){Me!==null&&(Zt===null?Zt=[e]:Zt.push(e))}let vt=null,Ct=0,At=null;function fo(e){At=e}let js=1,br=0,wn=br;function Qa(e){wn=e}let un=!1;function qs(){return++js}function Cr(e){var n=e.f;if((n&Rt)!==0)return!0;if((n&rn)!==0){var r=e.deps,a=(n&$t)!==0;if(r!==null){var s,i,l=(n&Ur)!==0,c=a&&Te!==null&&!un,o=r.length;if((l||c)&&(Te===null||(Te.f&Tn)===0)){var u=e,y=u.parent;for(s=0;s<o;s++)i=r[s],(l||!i?.reactions?.includes(u))&&(i.reactions??=[]).push(u);l&&(u.f^=Ur),c&&y!==null&&(y.f&$t)===0&&(u.f^=$t)}for(s=0;s<o;s++)if(i=r[s],Cr(i)&&ks(i),i.wv>e.wv)return!0}(!a||Te!==null&&!un)&&pt(e,it)}return!1}function zs(e,n,r=!0){var a=e.reactions;if(a!==null&&!Zt?.includes(e))for(var s=0;s<a.length;s++){var i=a[s];(i.f&It)!==0?zs(i,n,!1):n===i&&(r?pt(i,Rt):(i.f&it)!==0&&pt(i,rn),xn(i))}}function Vs(e){var n=vt,r=Ct,a=At,s=Me,i=un,l=Zt,c=Le,o=Ut,u=wn,y=e.f;vt=null,Ct=0,At=null,un=(y&$t)!==0&&(Ut||!Gn||Me===null),Me=(y&(nn|Cn))===0?e:null,Zt=null,jr(e.ctx),Ut=!1,wn=++br,e.ac!==null&&(Qr(()=>{e.ac.abort(ka)}),e.ac=null);try{e.f|=da;var g=e.fn,T=g(),m=e.deps;if(vt!==null){var x;if(Vr(e,Ct),m!==null&&Ct>0)for(m.length=Ct+vt.length,x=0;x<vt.length;x++)m[Ct+x]=vt[x];else e.deps=m=vt;if(!un||(y&It)!==0&&e.reactions!==null)for(x=Ct;x<m.length;x++)(m[x].reactions??=[]).push(e)}else m!==null&&Ct<m.length&&(Vr(e,Ct),m.length=Ct);if(tr()&&At!==null&&!Ut&&m!==null&&(e.f&(It|rn|Rt))===0)for(x=0;x<At.length;x++)zs(At[x],e);return s!==null&&s!==e&&(br++,At!==null&&(a===null?a=At:a.push(...At))),(e.f&_n)!==0&&(e.f^=_n),T}catch(I){return Gi(I)}finally{e.f^=da,vt=n,Ct=r,At=a,Me=s,un=i,Zt=l,jr(c),Ut=o,wn=u}}function vo(e,n){let r=n.reactions;if(r!==null){var a=gi.call(r,e);if(a!==-1){var s=r.length-1;s===0?r=n.reactions=null:(r[a]=r[s],r.pop())}}r===null&&(n.f&It)!==0&&(vt===null||!vt.includes(n))&&(pt(n,rn),(n.f&($t|Ur))===0&&(n.f^=Ur),Ss(n),Vr(n,0))}function Vr(e,n){var r=e.deps;if(r!==null)for(var a=n;a<r.length;a++)vo(e,r[a])}function Hn(e){var n=e.f;if((n&Tn)===0){pt(e,it);var r=Te,a=Gn;Te=e,Gn=!0;try{(n&kr)!==0?lo(e):Ns(e),Os(e);var s=Vs(e);e.teardown=typeof s=="function"?s:null,e.wv=js;var i;ps&&qi&&(e.f&Rt)!==0&&e.deps}finally{Gn=a,Te=r}}}function t(e){var n=e.f,r=(n&It)!==0;if(zn?.add(e),Me!==null&&!Ut){var a=Te!==null&&(Te.f&Tn)!==0;if(!a&&!Zt?.includes(e)){var s=Me.deps;if((Me.f&da)!==0)e.rv<br&&(e.rv=br,vt===null&&s!==null&&s[Ct]===e?Ct++:vt===null?vt=[e]:(!un||!vt.includes(e))&&vt.push(e));else{(Me.deps??=[]).push(e);var i=e.reactions;i===null?e.reactions=[Me]:i.includes(Me)||i.push(Me)}}}else if(r&&e.deps===null&&e.effects===null){var l=e,c=l.parent;c!==null&&(c.f&$t)===0&&(l.f^=$t)}if(In){if(bn.has(e))return bn.get(e);if(r){l=e;var o=l.v;return((l.f&it)===0&&l.reactions!==null||Gs(l))&&(o=Ia(l)),bn.set(l,o),o}}else if(r){if(l=e,Jn?.has(l))return Jn.get(l);Cr(l)&&ks(l)}if((e.f&_n)!==0)throw e.v;return e.v}function Gs(e){if(e.v===at)return!0;if(e.deps===null)return!1;for(const n of e.deps)if(bn.has(n)||(n.f&It)!==0&&Gs(n))return!0;return!1}function S(e){var n=Ut;try{return Ut=!0,e()}finally{Ut=n}}const po=-7169;function pt(e,n){e.f=e.f&po|n}function H(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(qt in e)pa(e);else if(!Array.isArray(e))for(let n in e){const r=e[n];typeof r=="object"&&r&&qt in r&&pa(r)}}}function pa(e,n=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!n.has(e)){n.add(e),e instanceof Date&&e.getTime();for(let a in e)try{pa(e[a],n)}catch{}const r=ya(e);if(r!==Object.prototype&&r!==Array.prototype&&r!==Map.prototype&&r!==Set.prototype&&r!==Date.prototype){const a=gs(r);for(let s in a){const i=a[s].get;if(i)try{i.call(e)}catch{}}}}}const go=["touchstart","touchmove"];function mo(e){return go.includes(e)}const ho=new Set,Za=new Set;function yo(e,n,r,a={}){function s(i){if(a.capture||vr.call(n,i),!i.cancelBubble)return Qr(()=>r?.call(this,i))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Ta(()=>{n.addEventListener(e,s,a)}):n.addEventListener(e,s,a),s}function ae(e,n,r,a,s){var i={capture:a,passive:s},l=yo(e,n,r,i);(n===document.body||n===window||n===document||n instanceof HTMLMediaElement)&&Zr(()=>{n.removeEventListener(e,l,i)})}let es=null;function vr(e){var n=this,r=n.ownerDocument,a=e.type,s=e.composedPath?.()||[],i=s[0]||e.target;es=e;var l=0,c=es===e&&e.__root;if(c){var o=s.indexOf(c);if(o!==-1&&(n===document||n===window)){e.__root=n;return}var u=s.indexOf(n);if(u===-1)return;o<=u&&(l=o)}if(i=s[l]||e.target,i!==n){Lr(e,"currentTarget",{configurable:!0,get(){return i||r}});var y=Me,g=Te;Vt(null),vn(null);try{for(var T,m=[];i!==null;){var x=i.assignedSlot||i.parentNode||i.host||null;try{var I=i["__"+a];if(I!=null&&(!i.disabled||e.target===i))if(Sr(I)){var[N,...L]=I;N.apply(i,[e,...L])}else I.call(i,e)}catch(q){T?m.push(q):T=q}if(e.cancelBubble||x===n||x===null)break;i=x}if(T){for(let q of m)queueMicrotask(()=>{throw q});throw T}}finally{e.__root=n,delete e.currentTarget,Vt(y),vn(g)}}}function Na(e){var n=document.createElement("template");return n.innerHTML=e.replaceAll("<!>","<!---->"),n.content}function Qn(e,n){var r=Te;r.nodes_start===null&&(r.nodes_start=e,r.nodes_end=n)}function j(e,n){var r=(n&Bi)!==0,a=(n&Li)!==0,s,i=!e.startsWith("<!>");return()=>{s===void 0&&(s=Na(i?e:"<!>"+e),r||(s=jt(s)));var l=a||Is?document.importNode(s,!0):s.cloneNode(!0);if(r){var c=jt(l),o=l.lastChild;Qn(c,o)}else Qn(l,l);return l}}function _o(e,n,r="svg"){var a=!e.startsWith("<!>"),s=`<${r}>${a?e:"<!>"+e}</${r}>`,i;return()=>{if(!i){var l=Na(s),c=jt(l);i=jt(c)}var o=i.cloneNode(!0);return Qn(o,o),o}}function Da(e,n){return _o(e,n,"svg")}function zt(e=""){{var n=En(e+"");return Qn(n,n),n}}function Ie(){var e=document.createDocumentFragment(),n=document.createComment(""),r=En();return e.append(n,r),Qn(n,r),e}function k(e,n){e!==null&&e.before(n)}function se(e,n){var r=n==null?"":typeof n=="object"?n+"":n;r!==(e.__t??=e.nodeValue)&&(e.__t=r,e.nodeValue=r+"")}function bo(e,n){return wo(e,n)}const Un=new Map;function wo(e,{target:n,anchor:r,props:a={},events:s,context:i,intro:l=!0}){to();var c=new Set,o=g=>{for(var T=0;T<g.length;T++){var m=g[T];if(!c.has(m)){c.add(m);var x=mo(m);n.addEventListener(m,vr,{passive:x});var I=Un.get(m);I===void 0?(document.addEventListener(m,vr,{passive:x}),Un.set(m,1)):Un.set(m,I+1)}}};o(ha(ho)),Za.add(o);var u=void 0,y=io(()=>{var g=r??n.appendChild(En());return Xn(()=>{if(i){_t({});var T=Le;T.c=i}s&&(a.$$events=s),u=e(g,a)||{},i&&bt()}),()=>{for(var T of c){n.removeEventListener(T,vr);var m=Un.get(T);--m===0?(document.removeEventListener(T,vr),Un.delete(T)):Un.set(T,m)}Za.delete(o),g!==r&&g.parentNode?.removeChild(g)}});return xo.set(u,y),u}let xo=new WeakMap;function W(e,n,r=!1){var a=e,s=null,i=null,l=at,c=r?Wr:0,o=!1;const u=(m,x=!0)=>{o=!0,T(x,m)};var y=null;function g(){y!==null&&(y.lastChild.remove(),a.before(y),y=null);var m=l?s:i,x=l?i:s;m&&Oa(m),x&&ta(x,()=>{l?i=null:s=null})}const T=(m,x)=>{if(l!==(l=m)){var I=Aa(),N=a;if(I&&(y=document.createDocumentFragment(),y.append(N=En())),l?s??=x&&Xn(()=>x(N)):i??=x&&Xn(()=>x(N)),I){var L=Ne,q=l?s:i,p=l?i:s;q&&L.skipped_effects.delete(q),p&&L.skipped_effects.add(p),L.add_callback(g)}else g()}};Ra(()=>{o=!1,n(u),o||T(null,null)},c)}function wr(e,n){return n}function So(e,n,r){for(var a=e.items,s=[],i=n.length,l=0;l<i;l++)Pa(n[l].e,s,!0);var c=i>0&&s.length===0&&r!==null;if(c){var o=r.parentNode;no(o),o.append(r),a.clear(),Ft(e,n[0].prev,n[i-1].next)}Ls(s,()=>{for(var u=0;u<i;u++){var y=n[u];c||(a.delete(y.k),Ft(e,y.prev,y.next)),en(y.e,!c)}})}function Et(e,n,r,a,s,i=null){var l=e,c={flags:n,items:new Map,first:null},o=(n&ys)!==0;if(o){var u=e;l=u.appendChild(En())}var y=null,g=!1,T=new Map,m=et(()=>{var L=r();return Sr(L)?L:L==null?[]:ha(L)}),x,I;function N(){ko(I,x,c,T,l,s,n,a,r),i!==null&&(x.length===0?y?Oa(y):y=Xn(()=>i(l)):y!==null&&ta(y,()=>{y=null}))}Ra(()=>{I??=Te,x=t(m);var L=x.length;if(!(g&&L===0)){g=L===0;var q,p,D,C;if(Aa()){var _=new Set,v=Ne;for(p=0;p<L;p+=1){D=x[p],C=a(D,p);var M=c.items.get(C)??T.get(C);M?(n&(Kr|Yr))!==0&&Hs(M,D,p,n):(q=Ws(null,c,null,null,D,C,p,s,n,r,!0),T.set(C,q)),_.add(C)}for(const[X,B]of c.items)_.has(X)||v.skipped_effects.add(B.e);v.add_callback(N)}else N();t(m)}})}function ko(e,n,r,a,s,i,l,c,o){var u=(l&Ri)!==0,y=(l&(Kr|Yr))!==0,g=n.length,T=r.items,m=r.first,x=m,I,N=null,L,q=[],p=[],D,C,_,v;if(u)for(v=0;v<g;v+=1)D=n[v],C=c(D,v),_=T.get(C),_!==void 0&&(_.a?.measure(),(L??=new Set).add(_));for(v=0;v<g;v+=1){if(D=n[v],C=c(D,v),_=T.get(C),_===void 0){var M=a.get(C);if(M!==void 0){a.delete(C),T.set(C,M);var X=N?N.next:x;Ft(r,N,M),Ft(r,M,X),oa(M,X,s),N=M}else{var B=x?x.e.nodes_start:s;N=Ws(B,r,N,N===null?r.first:N.next,D,C,v,i,l,o)}T.set(C,N),q=[],p=[],x=N.next;continue}if(y&&Hs(_,D,v,l),(_.e.f&Dt)!==0&&(Oa(_.e),u&&(_.a?.unfix(),(L??=new Set).delete(_))),_!==x){if(I!==void 0&&I.has(_)){if(q.length<p.length){var Q=p[0],F;N=Q.prev;var A=q[0],Y=q[q.length-1];for(F=0;F<q.length;F+=1)oa(q[F],Q,s);for(F=0;F<p.length;F+=1)I.delete(p[F]);Ft(r,A.prev,Y.next),Ft(r,N,A),Ft(r,Y,Q),x=Q,N=Y,v-=1,q=[],p=[]}else I.delete(_),oa(_,x,s),Ft(r,_.prev,_.next),Ft(r,_,N===null?r.first:N.next),Ft(r,N,_),N=_;continue}for(q=[],p=[];x!==null&&x.k!==C;)(x.e.f&Dt)===0&&(I??=new Set).add(x),p.push(x),x=x.next;if(x===null)continue;_=x}q.push(_),N=_,x=_.next}if(x!==null||I!==void 0){for(var G=I===void 0?[]:ha(I);x!==null;)(x.e.f&Dt)===0&&G.push(x),x=x.next;var U=G.length;if(U>0){var ke=(l&ys)!==0&&g===0?s:null;if(u){for(v=0;v<U;v+=1)G[v].a?.measure();for(v=0;v<U;v+=1)G[v].a?.fix()}So(r,G,ke)}}u&&Ta(()=>{if(L!==void 0)for(_ of L)_.a?.apply()}),e.first=r.first&&r.first.e,e.last=N&&N.e;for(var Ee of a.values())en(Ee.e);a.clear()}function Hs(e,n,r,a){(a&Kr)!==0&&Yn(e.v,n),(a&Yr)!==0?Yn(e.i,r):e.i=r}function Ws(e,n,r,a,s,i,l,c,o,u,y){var g=(o&Kr)!==0,T=(o&Pi)===0,m=g?T?V(s,!1,!1):yr(s):s,x=(o&Yr)===0?l:yr(l),I={i:x,v:m,k:i,a:null,e:null,prev:r,next:a};try{if(e===null){var N=document.createDocumentFragment();N.append(e=En())}return I.e=Xn(()=>c(e,m,x,u),ji),I.e.prev=r&&r.e,I.e.next=a&&a.e,r===null?y||(n.first=I):(r.next=I,r.e.next=I.e),a!==null&&(a.prev=I,a.e.prev=I.e),I}finally{}}function oa(e,n,r){for(var a=e.next?e.next.e.nodes_start:r,s=n?n.e.nodes_start:r,i=e.e.nodes_start;i!==null&&i!==a;){var l=Xr(i);s.before(i),i=l}}function Ft(e,n,r){n===null?e.first=r:(n.next=r,n.e.next=r&&r.e),r!==null&&(r.prev=n,r.e.prev=n&&n.e)}function ts(e,n,r=!1,a=!1,s=!1){var i=e,l="";le(()=>{var c=Te;if(l!==(l=n()??"")&&(c.nodes_start!==null&&(Ds(c.nodes_start,c.nodes_end),c.nodes_start=c.nodes_end=null),l!=="")){var o=l+"";r?o=`<svg>${o}</svg>`:a&&(o=`<math>${o}</math>`);var u=Na(o);if((r||a)&&(u=jt(u)),Qn(jt(u),u.lastChild),r||a)for(;jt(u);)i.before(jt(u));else i.before(u)}})}function Co(e,n,r,a,s){var i=n.$$slots?.[r],l=!1;i===!0&&(i=n.children,l=!0),i===void 0||i(e,l?()=>a:a)}function To(e){const n={};e.children&&(n.default=!0);for(const r in e.$$slots)n[r]=!0;return n}function Js(e,n,r){var a=e,s,i,l=null,c=null;function o(){i&&(ta(i),i=null),l&&(l.lastChild.remove(),a.before(l),l=null),i=c,c=null}Ra(()=>{if(s!==(s=n())){var u=Aa();if(s){var y=a;u&&(l=document.createDocumentFragment(),l.append(y=En()),i&&Ne.skipped_effects.add(i)),c=Xn(()=>r(y,s))}u?Ne.add_callback(o):o()}},Wr)}const ns=[...` 	
\r\f \v\uFEFF`];function Eo(e,n,r){var a=e==null?"":""+e;if(n&&(a=a?a+" "+n:n),r){for(var s in r)if(r[s])a=a?a+" "+s:s;else if(a.length)for(var i=s.length,l=0;(l=a.indexOf(s,l))>=0;){var c=l+i;(l===0||ns.includes(a[l-1]))&&(c===a.length||ns.includes(a[c]))?a=(l===0?"":a.substring(0,l))+a.substring(c+1):l=c}}return a===""?null:a}function Io(e,n){return e==null?null:String(e)}function Ze(e,n,r,a,s,i){var l=e.__className;if(l!==r||l===void 0){var c=Eo(r,a,i);c==null?e.removeAttribute("class"):e.className=c,e.__className=r}else if(i&&s!==i)for(var o in i){var u=!!i[o];(s==null||u!==!!s[o])&&e.classList.toggle(o,u)}return i}function Sn(e,n,r,a){var s=e.__style;if(s!==n){var i=Io(n);i==null?e.removeAttribute("style"):e.style.cssText=i,e.__style=n}return a}function Ks(e,n,r=!1){if(e.multiple){if(n==null)return;if(!Sr(n))return Ui();for(var a of e.options)a.selected=n.includes(mr(a));return}for(a of e.options){var s=mr(a);if(eo(s,n)){a.selected=!0;return}}(!r||n!==void 0)&&(e.selectedIndex=-1)}function Mo(e){var n=new MutationObserver(()=>{Ks(e,e.__value)});n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Zr(()=>{n.disconnect()})}function Ys(e,n,r=n){var a=!0;$s(e,"change",s=>{var i=s?"[selected]":":checked",l;if(e.multiple)l=[].map.call(e.querySelectorAll(i),mr);else{var c=e.querySelector(i)??e.querySelector("option:not([disabled])");l=c&&mr(c)}r(l)}),$a(()=>{var s=n();if(Ks(e,s,a),a&&s===void 0){var i=e.querySelector(":checked");i!==null&&(s=mr(i),r(s))}e.__value=s,a=!1}),Mo(e)}function mr(e){return"__value"in e?e.__value:e.value}const Ao=Symbol("is custom element"),$o=Symbol("is html");function rs(e,n){var r=Xs(e);r.checked!==(r.checked=n??void 0)&&(e.checked=n)}function Ro(e,n,r,a){var s=Xs(e);s[n]!==(s[n]=r)&&(r==null?e.removeAttribute(n):typeof r!="string"&&Po(e).includes(n)?e[n]=r:e.setAttribute(n,r))}function Xs(e){return e.__attributes??={[Ao]:e.nodeName.includes("-"),[$o]:e.namespaceURI===Fi}}var as=new Map;function Po(e){var n=as.get(e.nodeName);if(n)return n;as.set(e.nodeName,n=[]);for(var r,a=e,s=Element.prototype;s!==a;){r=gs(a);for(var i in r)r[i].set&&n.push(i);a=ya(a)}return n}function Xt(e,n,r=n){var a=tr(),s=new WeakSet;$s(e,"input",i=>{var l=i?e.defaultValue:e.value;if(l=la(e)?ca(l):l,r(l),Ne!==null&&s.add(Ne),a&&l!==(l=n())){var c=e.selectionStart,o=e.selectionEnd;e.value=l??"",o!==null&&(e.selectionStart=c,e.selectionEnd=Math.min(o,e.value.length))}}),S(n)==null&&e.value&&(r(la(e)?ca(e.value):e.value),Ne!==null&&s.add(Ne)),ea(()=>{var i=n();if(e===document.activeElement){var l=Br??Ne;if(s.has(l))return}la(e)&&i===ca(e.value)||e.type==="date"&&!i&&!e.value||i!==e.value&&(e.value=i??"")})}function la(e){var n=e.type;return n==="number"||n==="range"}function ca(e){return e===""?null:+e}function Or(e,n,r){var a=Qt(e,n);a&&a.set&&(e[n]=r,Zr(()=>{e[n]=null}))}class Ba{#e=new WeakMap;#n;#t;static entries=new WeakMap;constructor(n){this.#t=n}observe(n,r){var a=this.#e.get(n)||new Set;return a.add(r),this.#e.set(n,a),this.#a().observe(n,this.#t),()=>{var s=this.#e.get(n);s.delete(r),s.size===0&&(this.#e.delete(n),this.#n.unobserve(n))}}#a(){return this.#n??(this.#n=new ResizeObserver(n=>{for(var r of n){Ba.entries.set(r.target,r);for(var a of this.#e.get(r.target)||[])a(r)}}))}}var Oo=new Ba({box:"border-box"});function ss(e,n,r){var a=Oo.observe(e,()=>r(e[n]));$a(()=>(S(()=>r(e[n])),a))}function is(e,n){return e===n||e?.[qt]===n}function fn(e={},n,r,a){return $a(()=>{var s,i;return ea(()=>{s=i,i=[],S(()=>{e!==r(...i)&&(n(e,...i),s&&is(r(...s),e)&&n(null,...s))})}),()=>{Ta(()=>{i&&is(r(...i),e)&&n(null,...i)})}}),e}function No(e){return function(...n){var r=n[0];r.target===this&&e?.apply(this,n)}}function Qs(e){return function(...n){var r=n[0];return r.preventDefault(),e?.apply(this,n)}}function Mt(e=!1){const n=Le,r=n.l.u;if(!r)return;let a=()=>H(n.s);if(e){let s=0,i={};const l=Ea(()=>{let c=!1;const o=n.s;for(const u in o)o[u]!==i[u]&&(i[u]=o[u],c=!0);return c&&s++,s});a=()=>t(l)}r.b.length&&so(()=>{os(n,a),Fr(r.b)}),va(()=>{const s=S(()=>r.m.map(yi));return()=>{for(const i of s)typeof i=="function"&&i()}}),r.a.length&&va(()=>{os(n,a),Fr(r.a)})}function os(e,n){if(e.l.s)for(const r of e.l.s)t(r);n()}function La(e,n,r){if(e==null)return n(void 0),r&&r(void 0),dn;const a=S(()=>e.subscribe(n,r));return a.unsubscribe?()=>a.unsubscribe():a}const jn=[];function Zs(e,n){return{subscribe:wt(e,n).subscribe}}function wt(e,n=dn){let r=null;const a=new Set;function s(c){if(bs(e,c)&&(e=c,r)){const o=!jn.length;for(const u of a)u[1](),jn.push(u,e);if(o){for(let u=0;u<jn.length;u+=2)jn[u][0](jn[u+1]);jn.length=0}}}function i(c){s(c(e))}function l(c,o=dn){const u=[c,o];return a.add(u),a.size===1&&(r=n(s,i)||dn),c(e),()=>{a.delete(u),a.size===0&&r&&(r(),r=null)}}return{set:s,update:i,subscribe:l}}function Fa(e,n,r){const a=!Array.isArray(e),s=a?[e]:e;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const i=n.length<2;return Zs(r,(l,c)=>{let o=!1;const u=[];let y=0,g=dn;const T=()=>{if(y)return;g();const x=n(a?u[0]:u,l,c);i?l(x):g=typeof x=="function"?x:dn},m=s.map((x,I)=>La(x,N=>{u[I]=N,y&=~(1<<I),o&&T()},()=>{y|=1<<I}));return o=!0,T(),function(){Fr(m),g(),o=!1}})}function nr(e){let n;return La(e,r=>n=r)(),n}let Nr=!1,ga=Symbol();function st(e,n,r){const a=r[n]??={store:null,source:V(void 0),unsubscribe:dn};if(a.store!==e&&!(ga in r))if(a.unsubscribe(),a.store=e??null,e==null)a.source.v=void 0,a.unsubscribe=dn;else{var s=!0;a.unsubscribe=La(e,i=>{s?a.source.v=i:h(a.source,i)}),s=!1}return e&&ga in r?nr(e):t(a.source)}function Do(e,n){return e.set(n),n}function Tr(){const e={};function n(){Zr(()=>{for(var r in e)e[r].unsubscribe();Lr(e,ga,{enumerable:!1,value:!0})})}return[e,n]}function Bo(e){var n=Nr;try{return Nr=!1,[e(),Nr]}finally{Nr=n}}const Lo={get(e,n){let r=e.props.length;for(;r--;){let a=e.props[r];if(dr(a)&&(a=a()),typeof a=="object"&&a!==null&&n in a)return a[n]}},set(e,n,r){let a=e.props.length;for(;a--;){let s=e.props[a];dr(s)&&(s=s());const i=Qt(s,n);if(i&&i.set)return i.set(r),!0}return!1},getOwnPropertyDescriptor(e,n){let r=e.props.length;for(;r--;){let a=e.props[r];if(dr(a)&&(a=a()),typeof a=="object"&&a!==null&&n in a){const s=Qt(a,n);return s&&!s.configurable&&(s.configurable=!0),s}}},has(e,n){if(n===qt||n===hs)return!1;for(let r of e.props)if(dr(r)&&(r=r()),r!=null&&n in r)return!0;return!1},ownKeys(e){const n=[];for(let r of e.props)if(dr(r)&&(r=r()),!!r){for(const a in r)n.includes(a)||n.push(a);for(const a of Object.getOwnPropertySymbols(r))n.includes(a)||n.push(a)}return n}};function Yt(...e){return new Proxy({props:e},Lo)}function Oe(e,n,r,a){var s=!er||(r&Oi)!==0,i=(r&Di)!==0,l=a,c=!0,o=()=>(c&&(c=!1,l=a),l),u;{var y=qt in e||hs in e;u=Qt(e,n)?.set??(y&&n in e?q=>e[n]=q:void 0)}var g,T=!1;[g,T]=Bo(()=>e[n]),g===void 0&&a!==void 0&&(g=o(),u&&(s&&Ii(),u(g)));var m;if(s?m=()=>{var q=e[n];return q===void 0?o():(c=!0,q)}:m=()=>{var q=e[n];return q!==void 0&&(l=void 0),q===void 0?l:q},s&&(r&Ni)===0)return m;if(u){var x=e.$$legacy;return(function(q,p){return arguments.length>0?((!s||!p||x||T)&&u(p?m():q),q):m()})}var I=!1,N=et(()=>(I=!1,m()));t(N);var L=Te;return(function(q,p){if(arguments.length>0){const D=p?t(N):s&&i?Vn(q):q;return h(N,D),I=!0,l!==void 0&&(l=D),q}return In&&I||(L.f&Tn)!==0?N.v:t(N)})}function tn(e){Le===null&&Jr(),er&&Le.l!==null?ei(Le).m.push(e):va(()=>{const n=S(e);if(typeof n=="function")return n})}function Ua(e){Le===null&&Jr(),tn(()=>()=>S(e))}function Fo(e,n,{bubbles:r=!1,cancelable:a=!1}={}){return new CustomEvent(e,{detail:n,bubbles:r,cancelable:a})}function Mn(){const e=Le;return e===null&&Jr(),(n,r,a)=>{const s=e.s.$$events?.[n];if(s){const i=Sr(s)?s.slice():[s],l=Fo(n,r,a);for(const c of i)c.call(e.x,l);return!l.defaultPrevented}return!0}}function Uo(e){Le===null&&Jr(),Le.l===null&&Ei(),ei(Le).a.push(e)}function ei(e){var n=e.l;return n.u??={a:[],b:[],m:[]}}const jo="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(jo);zi();const qo="modulepreload",zo=function(e){return"/"+e},ls={},cn=function(n,r,a){let s=Promise.resolve();if(r&&r.length>0){let u=function(y){return Promise.all(y.map(g=>Promise.resolve(g).then(T=>({status:"fulfilled",value:T}),T=>({status:"rejected",reason:T}))))};var l=u;document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),o=c?.nonce||c?.getAttribute("nonce");s=u(r.map(y=>{if(y=zo(y),y in ls)return;ls[y]=!0;const g=y.endsWith(".css"),T=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${T}`))return;const m=document.createElement("link");if(m.rel=g?"stylesheet":qo,g||(m.as="script"),m.crossOrigin="",m.href=y,o&&m.setAttribute("nonce",o),document.head.appendChild(m),g)return new Promise((x,I)=>{m.addEventListener("load",x),m.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${y}`)))})}))}function i(c){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=c,window.dispatchEvent(o),!o.defaultPrevented)throw c}return s.then(c=>{for(const o of c||[])o.status==="rejected"&&i(o.reason);return n().catch(i)})};class Vo{constructor(){this.store=wt({serverTime:null,clientTime:null,timeOffset:0,lastSync:null}),this.subscribe=this.store.subscribe,this.update=this.store.update,this.set=this.store.set}updateServerTime(n){const r=new Date(n),a=new Date,s=r.getTime()-a.getTime();this.update(i=>({...i,serverTime:r,clientTime:a,timeOffset:s,lastSync:a}))}getServerTime(){let n;if(this.subscribe(a=>n=a)(),!n.lastSync)return new Date;const r=new Date;return new Date(r.getTime()+n.timeOffset)}formatTimeElapsed(n){const r=new Date,a=new Date(n),s=r.getTime()-a.getTime(),i=Math.floor(s/(1e3*60));return i>0?i:0}resetTimeOffset(){this.update(n=>({...n,timeOffset:0,lastSync:null}))}}const xr=new Vo,ma=Fa(xr,(e,n)=>{const r=()=>{const s=xr.getServerTime();n(s)};r();const a=setInterval(r,1e3);return()=>clearInterval(a)},new Date),Go=Fa(ma,(e,n)=>{let r=null;return ma.subscribe(a=>{const s=a.getMinutes();r!==s&&(r=s,n({time:a,minute:s}))})},{time:new Date,minute:new Date().getMinutes()});function Ho(){const{subscribe:e,set:n,update:r}=wt({connected:!1,isConnected:!1,lastMessage:null,error:null,sessionId:null,currentServer:null,serverIndex:0,connectionAttempts:0}),a=()=>{const _=window.location.hostname;return window.location.protocol==="https:"?[_]:[`${_}:3030`]};let s=null,i=null,l=0,c=0,o=null;const u=new Map,y=10,g=new Map;function T(){a().forEach(v=>{g.has(v)||g.set(v,{successfulConnections:0,failedConnections:0,averageResponseTime:0,lastConnectionTime:null,reliability:1})})}function m(_){const v=_.successfulConnections+_.failedConnections;if(v===0)return 1;const M=_.successfulConnections/v,X=_.averageResponseTime<1e3?.1:0;return Math.min(M+X,1)}function x(){const _=a();if(_.length===1)return 0;const v=_.map(B=>{const Q=g.get(B);return Q?Q.reliability:1}),M=v.reduce((B,Q)=>B+Q,0);let X=Math.random()*M;for(let B=0;B<v.length;B++)if(X-=v[B],X<=0)return B;return Math.floor(Math.random()*_.length)}function I(){T(),l=x();const _=a();console.log(`Initialized with smart-selected server index: ${l} (${_[l]})`),console.log("Server reliability scores:",Array.from(g.entries()).map(([v,M])=>`${v}: ${(M.reliability*100).toFixed(1)}%`).join(", "))}function N(){const _=localStorage.getItem("ecKasse-session-id");_?i=_:(i=D(),localStorage.setItem("ecKasse-session-id",i)),r(v=>({...v,sessionId:i})),console.log("Session ID initialized:",i)}function L(){const _=a(),v=_[l];return l=(l+1)%_.length,v}function q(_=0){if(o&&(clearTimeout(o),o=null),_>=y){console.error("Max reconnection attempts reached. Stopping reconnection."),r(v=>({...v,connected:!1,isConnected:!1,error:"Failed to connect to any server after maximum attempts",connectionAttempts:_}));return}try{const v=L(),X=`${window.location.protocol==="https:"?"wss:":"ws:"}//${v}`;console.log(`Attempting WebSocket connection to ${X} (attempt ${_+1}/${y})`),r(F=>({...F,currentServer:v,serverIndex:l,connectionAttempts:_+1,error:null})),s=new WebSocket(X);const B=Date.now();s.onopen=()=>{const F=Date.now()-B;if(console.log(`WebSocket connected to ${v} (${F}ms)`),g.has(v)){const A=g.get(v);A.successfulConnections++,A.lastConnectionTime=F,A.averageResponseTime=A.averageResponseTime===0?F:(A.averageResponseTime+F)/2,A.reliability=m(A),g.set(v,A)}c=0,r(A=>({...A,connected:!0,isConnected:!0,error:null,connectionAttempts:0}))},s.onmessage=F=>{try{const A=JSON.parse(F.data);if(console.log("WebSocket message received:",A),A.serverTime&&xr.updateServerTime(A.serverTime),r(Y=>({...Y,lastMessage:A})),A.command==="ui-refresh-request"){console.log("UI refresh request received, reloading page..."),window.location.reload();return}if(A.command==="displayAgentMessage"){console.log("🌐 [WebSocket] Received displayAgentMessage:",{timestamp:A.payload?.timestamp,type:A.payload?.type,message:A.payload?.message?.substring(0,100)+(A.payload?.message?.length>100?"...":""),style:A.payload?.style,hasStyle:!!A.payload?.style,fullPayload:A.payload}),cn(async()=>{const{agentStore:Y}=await Promise.resolve().then(()=>gr);return{agentStore:Y}},void 0).then(({agentStore:Y})=>{console.log("🌐 [WebSocket] Calling agentStore.addMessage with payload"),Y.addMessage(A.payload)});return}if(A.operationId&&u.has(A.operationId)){const Y=u.get(A.operationId);u.delete(A.operationId),Y(A)}}catch(A){console.error("Error parsing WebSocket message:",A)}},s.onclose=F=>{if(console.log(`WebSocket disconnected from ${v} (code: ${F.code}, reason: ${F.reason})`),F.code!==1e3&&g.has(v)){const Y=g.get(v);Y.failedConnections++,Y.reliability=m(Y),g.set(v,Y),console.log(`Updated reliability for ${v}: ${(Y.reliability*100).toFixed(1)}%`)}r(Y=>({...Y,connected:!1,isConnected:!1}));const A=Math.min(1e3*Math.pow(2,Math.floor(_/3)),3e4);console.log(`Reconnecting in ${A}ms to next server...`),o=setTimeout(()=>{q(_+1)},A)},s.onerror=F=>{if(console.error(`WebSocket error on ${v}:`,F),g.has(v)){const A=g.get(v);A.failedConnections++,A.reliability=m(A),g.set(v,A)}r(A=>({...A,error:`Connection error: ${v}`}))};const Q=setTimeout(()=>{s&&s.readyState===WebSocket.CONNECTING&&(console.log(`Connection timeout for ${v}, trying next server...`),s.close())},1e4);s.onopen=(F=>function(...A){return clearTimeout(Q),F.apply(this,A)})(s.onopen)}catch(v){console.error("Failed to create WebSocket connection:",v),r(M=>({...M,error:v.message})),o=setTimeout(()=>{q(_+1)},2e3)}}function p(_){if(console.log("[wsStore] send() called with:",_),console.log("[wsStore] WebSocket state:",{exists:!!s,readyState:s?s.readyState:"N/A",readyStateText:s?s.readyState===0?"CONNECTING":s.readyState===1?"OPEN":s.readyState===2?"CLOSING":"CLOSED":"N/A",sessionId:i}),s&&s.readyState===WebSocket.OPEN){const v={operationId:D(),..._,payload:{..._.payload,sessionId:i}};return _.command==="getCategories"&&(console.log("🔍 [wsStore] SENDING getCategories command:",v),console.log("🔍 [wsStore] WebSocket ready state confirmed OPEN for getCategories")),console.log("Sending WebSocket message:",v),s.send(JSON.stringify(v)),new Promise(M=>{u.set(v.operationId,M),setTimeout(()=>{u.has(v.operationId)&&(u.delete(v.operationId),_.command==="getCategories"&&console.error("❌ [wsStore] getCategories TIMEOUT after 10 seconds"),M({error:"Timeout waiting for response"}))},1e4),_.command==="getCategories"&&console.log("🔍 [wsStore] getCategories promise created, waiting for response...")})}else{const v="WebSocket not connected";return console.log(`❌ [wsStore] ${v}:`,{command:_.command,wsExists:!!s,readyState:s?s.readyState:"N/A"}),_.command==="getCategories"&&console.error("❌ [wsStore] getCategories FAILED - WebSocket not connected!"),Promise.resolve({error:v})}}function D(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(_){const v=Math.random()*16|0;return(_==="x"?v:v&3|8).toString(16)})}return I(),N(),q(),{subscribe:e,send:p,connect:q,getSessionId:()=>i,getCurrentServer:()=>C({subscribe:e}).currentServer,getConnectionStats:()=>{const _=C({subscribe:e});return{currentServer:_.currentServer,serverIndex:_.serverIndex,connectionAttempts:_.connectionAttempts,availableServers:a(),serverStats:Array.from(g.entries()).map(([v,M])=>({server:v,reliability:Math.round(M.reliability*100),successfulConnections:M.successfulConnections,failedConnections:M.failedConnections,averageResponseTime:Math.round(M.averageResponseTime),lastConnectionTime:M.lastConnectionTime}))}},forceReconnect:()=>{s&&s.close(),l=0,c=0,q()},switchToBestServer:()=>{s&&s.close(),l=x(),c=0,console.log("Switching to best performing server..."),q()},resetServerStats:()=>{g.clear(),T(),console.log("Server statistics reset")}};function C(_){let v;return _.subscribe(M=>v=M)(),v}}const ge=Ho(),Wo=Object.freeze(Object.defineProperty({__proto__:null,wsStore:ge},Symbol.toStringTag,{value:"Module"})),Jo=wt([]);function Ko(e){if(!e||typeof e!="object")return{};const n={};for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)){const a=e[r];["string","number","boolean"].includes(typeof a)?n[r]=a:a instanceof Error?n[r]={message:a.message,stack:a.stack}:n[r]=JSON.stringify(a,null,2)}return n}function K(e,n,r={}){const a=new Date().toISOString().slice(0,19).replace("T"," ");Jo.update(i=>[...i.slice(-100),{timestamp:a,level:e,message:n,context:r}]);let s;ge.subscribe(i=>s=i)(),ge&&s&&s.connected&&ge.send({command:"logClientEvent",payload:{level:e,message:n,context:Ko(r)}})}const Dr={isAuthenticated:!1,currentUser:null,sessionId:null,users:[],selectedUser:null,loginState:"user_selection",error:null,isLoading:!1};function Yo(){const{subscribe:e,set:n,update:r}=wt(Dr);return{subscribe:e,async fetchUsers(){try{r(s=>({...s,isLoading:!0,error:null}));const a=await ge.send({command:"getLoginUsers",payload:{}});if(a.status==="success")r(s=>({...s,users:a.payload||[],isLoading:!1})),K("INFO",`Fetched ${a.payload?.length||0} users for login`);else throw new Error(a.payload?.error||"Failed to fetch users")}catch(a){K("ERROR",`Failed to fetch users: ${a.message}`),r(s=>({...s,error:a.message,isLoading:!1}))}},selectUser(a){r(s=>({...s,selectedUser:a,loginState:"pin_entry",error:null})),K("INFO",`Selected user: ${a.username}`)},backToUserSelection(){r(a=>({...a,selectedUser:null,loginState:"user_selection",error:null}))},async login(a,s){try{r(l=>({...l,isLoading:!0,loginState:"authenticating",error:null}));const i=await ge.send({command:"login",payload:{username:a,password:s,ipAddress:"localhost",userAgent:navigator.userAgent}});if(i.status==="success"&&i.payload.success){const{user:l,session:c}=i.payload;try{await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:a,password:s})})}catch(u){K("WARN",`HTTP session establishment failed: ${u.message}`)}const o={...l,permissions:["all","order.change_price","order.reduce_quantity"]};return r(u=>({...u,isAuthenticated:!0,currentUser:o,sessionId:c.sessionId,loginState:"authenticated",isLoading:!1,error:null,selectedUser:null})),K("SUCCESS",`User ${a} authenticated successfully`),{success:!0}}else{const l=i.payload?.error||"Authentication failed";throw new Error(l)}}catch(i){return K("ERROR",`Authentication failed: ${i.message}`),r(l=>({...l,error:i.message,loginState:"pin_entry",isLoading:!1})),{success:!1,error:i.message}}},async logout(){try{const a={...Dr};let s=null;if(r(i=>(s=i.sessionId,a)),s)try{await ge.send({command:"logout",payload:{sessionId:s}}),K("INFO","User logged out successfully")}catch(i){K("WARN",`Logout request failed: ${i.message}`)}try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(i){K("WARN",`HTTP logout failed: ${i.message}`)}return n(a),{success:!0}}catch(a){return K("ERROR",`Logout failed: ${a.message}`),n(Dr),{success:!1,error:a.message}}},async getCurrentUser(){try{let a=null;if(r(i=>(a=i.sessionId,i)),!a)throw new Error("No active session");const s=await ge.send({command:"getCurrentUser",payload:{sessionId:a}});if(s.status==="success"&&s.payload.success)return r(i=>({...i,currentUser:s.payload.user})),{success:!0,user:s.payload.user};throw new Error(s.payload?.error||"Failed to get current user")}catch(a){return K("ERROR",`Failed to get current user: ${a.message}`),{success:!1,error:a.message}}},clearError(){r(a=>({...a,error:null}))},reset(){n(Dr)},async checkSession(){try{r(s=>({...s,isLoading:!0}));const a=await fetch("/api/session/status",{credentials:"include"});if(a.ok){const s=await a.json();if(s.authenticated&&s.user){const i={...s.user,permissions:["all","order.change_price","order.reduce_quantity"]};return r(l=>({...l,isAuthenticated:!0,currentUser:i,sessionId:null,loginState:"authenticated",isLoading:!1,error:null,selectedUser:null})),K("SUCCESS",`Session restored for user: ${s.user.username}`),{success:!0,user:s.user}}}return r(s=>({...s,isLoading:!1})),{success:!1,error:"No valid session"}}catch(a){return K("ERROR",`Failed to check session: ${a.message}`),r(s=>({...s,isLoading:!1,error:a.message})),{success:!1,error:a.message}}},establishSession(a){try{const{user:s,session:i}=a,l={...s,permissions:["all","order.change_price","order.reduce_quantity"]};return r(c=>({...c,isAuthenticated:!0,currentUser:l,sessionId:i.sessionId,loginState:"authenticated",isLoading:!1,error:null,selectedUser:null})),K("SUCCESS",`Demo mode: Auto-authenticated as ${s.username}`),{success:!0}}catch(s){return K("ERROR",`Failed to establish demo session: ${s.message}`),{success:!1,error:s.message}}}}}const kn=Yo(),cs=Object.freeze(Object.defineProperty({__proto__:null,authStore:kn},Symbol.toStringTag,{value:"Module"})),yt=wt("agent");Fa(yt,e=>{const n=["order","receipts","agent"],r=n.indexOf(e);return[...n.slice(r),...n.slice(0,r)]});function Xo(){const{subscribe:e,set:n,update:r}=wt({transactionId:null,uuid:null,items:[],total:0,tax:0,status:"idle",paymentType:null,paymentAmount:null,metadata:{},activeTransactionItemId:null});let a=null,s=[];function i(){n({transactionId:null,uuid:null,items:[],total:0,tax:0,status:"idle",paymentType:null,paymentAmount:null,metadata:{},activeTransactionItemId:null}),a=null,s=[],K("INFO","Order reset and ready for new transaction.")}ge.subscribe(p=>{let D;if(e(C=>D=C)(),p.lastMessage?.command==="orderUpdated"&&p.lastMessage.status==="success"&&p.lastMessage.payload){const C=p.lastMessage.payload,_=(C.items||[]).map(B=>{const Q=D.items.find(F=>F.id===B.id);return{...B,isEdited:Q?.isEdited||!1}}),v=B=>{const Q=[];return B.created_at&&Q.push(new Date(B.created_at)),B.updated_at&&Q.push(new Date(B.updated_at)),Q.length>0?Math.max(...Q):0};let M=null;_.length>0&&(M=[..._].sort((Q,F)=>{const A=v(Q),Y=v(F);return A!==Y?Y-A:F.id-Q.id})[0].id);const X=[..._].sort((B,Q)=>{const F=v(B),A=v(Q);return F!==A?F-A:B.id-Q.id});if(r(B=>({...B,transactionId:C.id,uuid:C.uuid,items:X,total:parseFloat(C.total_amount),tax:parseFloat(C.tax_amount),status:"active",metadata:C.metadata?typeof C.metadata=="string"?JSON.parse(C.metadata):C.metadata:{},activeTransactionItemId:M})),K("INFO",`Order ${C.id} updated.`),D.status==="initializing"&&s.length>0){const B=[...s];s=[],B.forEach(({itemId:Q,quantity:F,userId:A})=>{K("INFO",`Adding queued item ${Q} to transaction ${C.id}`),ge.send({command:"addItemToTransaction",payload:{transactionId:C.id,itemId:Q,quantity:F,userId:A}})})}}else if(p.lastMessage?.command==="transactionFinished"&&p.lastMessage.status==="success"){const C=p.lastMessage.payload;C.printStatus&&(C.printStatus.status==="failed"?K("ERROR",`Receipt print failed: ${C.printStatus.error}`):C.printStatus.status==="success"&&K("SUCCESS","Receipt printed successfully")),C.transaction?(r(_=>({..._,transactionId:C.transaction.id,uuid:C.transaction.uuid,items:C.transaction.items||[],total:parseFloat(C.transaction.total_amount),tax:parseFloat(C.transaction.tax_amount),status:"finished",paymentType:C.transaction.payment_type,paymentAmount:parseFloat(C.transaction.payment_amount),metadata:C.transaction.metadata?typeof C.transaction.metadata=="string"?JSON.parse(C.transaction.metadata):C.transaction.metadata:{},activeTransactionItemId:null})),K("SUCCESS",`Transaction ${C.transaction.id} finished successfully.`)):(K("SUCCESS",`Transaction ${D.transactionId} finished successfully.`),r(_=>({..._,status:"finished"}))),setTimeout(()=>{K("INFO","Auto-resetting order for next transaction."),i()},2e3)}});function l(){const p=nr(kn)?.currentUser;if(!p?.id)throw new Error("User must be authenticated to perform this action");return p.id}async function c(p={}){if(a)return a;const D=l();return r(C=>({...C,status:"initializing"})),K("INFO","Initializing new order..."),a=new Promise((C,_)=>{let v;v=ge.subscribe(M=>{M.lastMessage?.command==="orderUpdated"&&M.lastMessage.status==="success"?(v&&v(),C(M.lastMessage.payload)):M.lastMessage?.command==="orderUpdated"&&M.lastMessage.status==="error"&&(v&&v(),r(X=>({...X,status:"error"})),_(new Error(M.lastMessage.payload?.message||"Failed to initialize order")))})}),ge.send({command:"findOrCreateActiveTransaction",payload:{criteria:{metadata:p},userId:D}}),a}async function o(p,D=1){yt.set("order");const C=l();let _;if(e(v=>_=v)(),_.status==="idle"){K("INFO",`First item click detected. Initializing order and queuing item ${p}...`),s.push({itemId:p,quantity:D,userId:C});try{await c(C)}catch(v){K("ERROR",`Failed to initialize order: ${v.message}`),s=[];return}return}if(_.status==="initializing"){K("INFO",`Order initializing. Queuing item ${p}...`),s.push({itemId:p,quantity:D,userId:C});return}if(_.status==="active"&&_.transactionId){const v=_.items.find(M=>M.item_id===p&&!M.notes?.includes("Custom price:")&&!M.isEdited);if(v){const M=parseFloat(v.quantity)+D;K("INFO",`Item ${p} already exists and not edited, updating quantity to ${M}`),N(v.id,M,!1);return}K("INFO",`Adding new item ${p} to transaction ${_.transactionId}`),ge.send({command:"addItemToTransaction",payload:{transactionId:_.transactionId,itemId:p,quantity:D,userId:C}});return}K("ERROR","Cannot add item: invalid order state.")}async function u(p){const D=l();let C;if(e(_=>C=_)(),!C.transactionId||C.status!=="active"){K("ERROR","No active order to finish.");return}K("INFO",`Finishing transaction ${C.transactionId}...`),ge.send({command:"finishTransaction",payload:{transactionId:C.transactionId,paymentData:p,userId:D}})}async function y(p,D=!0){const C=l();let _;if(e(v=>_=v)(),!_.transactionId||_.status!=="active"){K("ERROR","No active order to park.");return}return K("INFO",`Parking transaction ${_.transactionId} to table ${p} (updateTime: ${D})...`),new Promise(async(v,M)=>{const X=ge.subscribe(async B=>{B.lastMessage?.command==="parkTransactionResponse"&&B.lastMessage.status==="success"?(X(),i(),K("SUCCESS",`Order parked to table ${p}`),v(B.lastMessage.payload)):B.lastMessage?.command==="parkTransactionResponse"&&B.lastMessage.status==="error"&&(X(),K("ERROR",`Failed to park order: ${B.lastMessage.payload?.message||"Unknown error"}`),M(new Error(B.lastMessage.payload?.message||"Failed to park order")))});ge.send({command:"parkTransaction",payload:{transactionId:_.transactionId,tableIdentifier:p,userId:C,updateTimestamp:D}})})}function g(p){yt.set("order"),K("INFO",`Loading order ${p.id}...`),r(D=>({...D,transactionId:p.id,uuid:p.uuid,items:p.items||[],total:parseFloat(p.total_amount),tax:parseFloat(p.tax_amount),status:"active",metadata:p.metadata?typeof p.metadata=="string"?JSON.parse(p.metadata):p.metadata:{},activeTransactionItemId:null})),K("SUCCESS",`Order ${p.id} loaded successfully`)}async function T(p){const D=l();let C;if(e(_=>C=_)(),!C.transactionId||C.status!=="active")throw K("ERROR","No active order to assign table number to."),new Error("No active order to assign table number to.");K("INFO",`Checking availability and assigning table ${p} to transaction ${C.transactionId}...`);try{const _=Math.random().toString(36).substring(2,15),v=await new Promise((X,B)=>{const Q=setTimeout(()=>{F&&F(),B(new Error("Table availability check timeout"))},5e3);let F;F=ge.subscribe(A=>{A.lastMessage?.command==="checkTableAvailabilityResponse"&&A.lastMessage?.operationId===_&&(clearTimeout(Q),F&&F(),X(A.lastMessage))}),ge.send({operationId:_,command:"checkTableAvailability",payload:{tableNumber:p,excludeTransactionId:C.transactionId}})});if(console.log("Table availability check result:",v),v.status==="success"&&v.payload.isInUse)return K("ERROR",`Table ${p} is already in use by another order`),{tableInUse:!0};r(X=>({...X,metadata:{...X.metadata,table:p}}));const M=Math.random().toString(36).substring(2,15);await new Promise((X,B)=>{const Q=setTimeout(()=>{F&&F(),B(new Error("Metadata update timeout"))},5e3);let F;F=ge.subscribe(A=>{A.lastMessage?.command==="updateTransactionMetadataResponse"&&A.lastMessage?.operationId===M&&(clearTimeout(Q),F&&F(),A.lastMessage.status==="success"?X(A.lastMessage):B(new Error(A.lastMessage.payload?.message||"Failed to update metadata")))}),ge.send({operationId:M,command:"updateTransactionMetadata",payload:{transactionId:C.transactionId,metadata:{...C.metadata,table:p},userId:D}})}),K("SUCCESS",`Table ${p} assigned to order`)}catch(_){throw K("ERROR",`Failed to assign table ${p}: ${_.message}`),_}}async function m(){K("INFO","Clearing active order view"),i()}function x(p,D){const C=l();let _;if(e(v=>_=v)(),_.status!=="active"||!_.transactionId){K("ERROR","Cannot update quantity: no active transaction");return}K("INFO",`Updating item quantity for item ${p} to ${D}`),ge.send({command:"updateItemQuantity",payload:{transactionId:_.transactionId,transactionItemId:p,newQuantity:D,userId:C}})}function I(p,D,C=1){const _=l();let v;if(e(M=>v=M)(),v.status!=="active"||!v.transactionId){K("ERROR","Cannot add custom price item: no active transaction");return}K("INFO",`Adding custom price item ${p} with price ${D} and quantity ${C}`),ge.send({command:"addCustomPriceItem",payload:{transactionId:v.transactionId,itemId:p,customPrice:D,quantity:C,userId:_}})}async function N(p,D,C=!0){const _=l();let v;if(e(M=>v=M)(),v.status!=="active"||!v.transactionId){K("ERROR","Cannot update quantity: no active transaction");return}C&&r(M=>({...M,items:M.items.map(X=>X.id===p?{...X,isEdited:!0}:X)})),K("INFO",`Updating item quantity for item ${p} to ${D}${C?" (marked as edited)":""}`),ge.send({command:"updateItemQuantity",payload:{transactionId:v.transactionId,transactionItemId:p,newQuantity:D,userId:_}})}async function L(p,D,C=!1){const _=l();let v;if(e(M=>v=M)(),v.status!=="active"||!v.transactionId){K("ERROR","Cannot update price: no active transaction");return}r(M=>({...M,items:M.items.map(X=>X.id===p?{...X,isEdited:!0}:X)})),K("INFO",`Updating item price for item ${p} to ${D} (marked as edited)`),ge.send({command:"updateItemPrice",payload:{transactionId:v.transactionId,transactionItemId:p,newPrice:D,isTotalPrice:C,userId:_}})}function q(){r(p=>({...p,activeTransactionItemId:null})),K("INFO","Item deselected from order view")}return{subscribe:e,set:n,update:r,initializeOrder:c,addItem:o,updateQuantity:x,updateItemQuantity:N,updateItemPrice:L,addWithCustomPrice:I,finishOrder:u,resetOrder:i,parkCurrentOrder:y,assignTableNumber:T,loadOrder:g,clearActiveOrderView:m,deselectItem:q}}const tt=Xo();function Qo(e){if(typeof e=="object"&&e!==null)return e;if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}function Zo(){const{subscribe:e,set:n,update:r}=wt({receipts:[],loading:!1,error:null,lastUpdated:null});ge.subscribe(i=>{if(i.lastMessage?.command==="getRecentReceiptsResponse")if(i.lastMessage.status==="success"){const l=i.lastMessage.payload;if(l.success&&l.transactions){const c=l.transactions.map(o=>({...o,metadata:o.metadata?Qo(o.metadata):{}}));r(o=>({...o,receipts:c,loading:!1,error:null,lastUpdated:new Date})),K("INFO",`Loaded ${l.transactions.length} recent receipts.`)}else r(c=>({...c,loading:!1,error:l.message||"Failed to load receipts"})),K("ERROR",`Failed to load receipts: ${l.message||"Unknown error"}`)}else r(l=>({...l,loading:!1,error:i.lastMessage.payload?.message||"Failed to load receipts"})),K("ERROR",`Failed to load receipts: ${i.lastMessage.payload?.message||"Unknown error"}`)});function a(i=20){r(c=>({...c,loading:!0,error:null})),K("INFO",`Loading recent receipts (limit: ${i})...`);let l;ge.subscribe(c=>l=c)(),l&&l.connected?ge.send({command:"getRecentReceipts",payload:{limit:i}}):(K("WARNING","WebSocket not connected, skipping receipt load"),r(c=>({...c,loading:!1,error:"WebSocket connection not available"})))}function s(){K("INFO","Refreshing receipts..."),a()}return{subscribe:e,loadReceipts:a,refresh:s}}const Gr=Zo();class el{constructor(){this.store=wt([]),this.subscribe=this.store.subscribe,this.set=this.store.set,this.update=this.store.update}async refreshParkedOrders(){try{K("DEBUG","Requesting parked transactions...");const n=this.generateUUID();K("DEBUG",`Generated operationId: ${n}`);const r=await this.sendRequestWithFallback(n,"getParkedTransactions",{});K("DEBUG",`Parked transactions response: ${JSON.stringify(r)}`),r.status==="success"?(K("DEBUG",`Setting parked orders: ${JSON.stringify(r.payload)}`),this.set(r.payload||[])):(K("ERROR",`Failed to fetch parked orders: ${JSON.stringify(r)}`),this.set([]))}catch(n){K("ERROR",`Error fetching parked orders: ${n.message}`),this.set([])}}async sendRequestWithFallback(n,r,a){try{return await this.sendWebSocketRequest(n,r,a)}catch(s){K("WARNING",`WebSocket request failed, trying HTTP fallback: ${s.message}`);try{return await this.sendHttpRequest(n,r,a)}catch(i){throw K("ERROR",`Both WebSocket and HTTP requests failed: ${i.message}`),i}}}sendWebSocketRequest(n,r,a){return new Promise((s,i)=>{let l;if(ge.subscribe(u=>l=u)(),!l||!l.connected){i(new Error("WebSocket is not connected"));return}const c=setTimeout(()=>{o(),i(new Error("WebSocket request timeout"))},3e3),o=ge.subscribe(u=>{u.lastMessage&&u.lastMessage.operationId===n&&(clearTimeout(c),o(),s(u.lastMessage))});ge.send({operationId:n,command:r,payload:a})})}async sendHttpRequest(n,r,a){const s=await fetch("/api/websocket-fallback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({operationId:n,command:r,payload:a})});if(!s.ok)throw new Error(`HTTP request failed: ${s.status}`);return await s.json()}refresh(){return this.refreshParkedOrders()}async activateOrder(n,r=!1){try{const a=this.generateUUID(),s=await this.sendRequestWithFallback(a,"activateTransaction",{transactionId:n,userId:1,updateTimestamp:r});if(s.status==="success")return r&&await this.refreshParkedOrders(),s.payload;throw new Error(s.payload?.message||"Failed to activate order")}catch(a){throw K("ERROR",`Error activating order: ${a.message}`),a}}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const r=Math.random()*16|0;return(n==="x"?r:r&3|8).toString(16)})}}const pr=new el,qn={DE:[["q","w","e","r","t","z","u","i","o","p","ü","ß"],["a","s","d","f","g","h","j","k","l","ö","ä"],["y","x","c","v","b","n","m"]],EN:[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l"],["z","x","c","v","b","n","m"]],RU:[["й","ц","у","к","е","н","г","ш","щ","з","х","ъ"],["ф","ы","в","а","п","р","о","л","д","ж","э"],["я","ч","с","м","и","т","ь","б","ю"]]};function tl(){const{subscribe:e,set:n,update:r}=wt({isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:qn});return{subscribe:e,activate(a,s,i,l="numeric"){n({isActive:!0,mode:a,layout:l,liveValue:l==="alpha"?{text:"",cursor:0}:"",confirmCallback:s,cancelCallback:i,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:qn})},deactivate(){n({isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:qn})},append(a,s=null){r(i=>{if(!i.isActive)return i;if(i.layout==="alpha"){const l=i.liveValue.text,c=i.liveValue.cursor,o=l.slice(0,c)+a+l.slice(c),u={text:o,cursor:c+1};return i.mode==="agent"&&s&&s.updateDraftMessage(o),{...i,liveValue:u,errorMessage:null}}else return{...i,liveValue:i.liveValue+a,errorMessage:null}})},backspace(a=null){r(s=>{if(!s.isActive)return s;if(s.layout==="alpha"){const i=s.liveValue.text,l=s.liveValue.cursor;if(l>0){const c=i.slice(0,l-1)+i.slice(l),o={text:c,cursor:l-1};return s.mode==="agent"&&a&&a.updateDraftMessage(c),{...s,liveValue:o,errorMessage:null}}return{...s,errorMessage:null}}else return{...s,liveValue:s.liveValue.slice(0,-1),errorMessage:null}})},clear(a=null){r(s=>s.isActive?(s.mode==="agent"&&a&&a.updateDraftMessage(""),{...s,liveValue:s.layout==="alpha"?{text:"",cursor:0}:"",errorMessage:null}):s)},async confirm(){let a,s;if(r(c=>(a=c,c)),!a.isActive)return;s=a.layout==="alpha"?a.liveValue.text:a.liveValue;let i;if(tt.subscribe(c=>i=c)(),i.activeTransactionItemId&&a.layout==="numeric"&&a.mode!=="agent"&&a.mode!=="table"){const c=s.trim();if(!c){this.deactivate();return}const o=i.items.find(u=>u.id===i.activeTransactionItemId);if(o){const{authStore:u}=await cn(async()=>{const{authStore:T}=await Promise.resolve().then(()=>cs);return{authStore:T}},void 0);let y;u.subscribe(T=>y=T)();const g=y.currentUser?.permissions||[];if(c.includes(".")||c.includes(",")){const T=parseFloat(c.replace(",","."));if(!isNaN(T)&&T>0){const m=parseFloat(o.unit_price);let x=null;if(T<m&&(x="order.change_price"),g.includes("all")||(x?g.includes(x):!0)){const L=parseFloat(o.quantity)>1;tt.updateItemPrice(o.id,T,L),tt.deselectItem()}else{r(N=>({...N,errorMessage:"Permission denied to change price."}));return}}}else{const T=parseInt(c);if(!isNaN(T)&&T>0){const m=parseFloat(o.quantity);let x=null;if(T<m&&(x="order.reduce_quantity"),g.includes("all")||(x?g.includes(x):!0))tt.updateItemQuantity(o.id,T),tt.deselectItem();else{r(N=>({...N,errorMessage:"Permission denied to reduce quantity."}));return}}}}r(u=>({...u,liveValue:u.layout==="alpha"?{text:"",cursor:0}:"",errorMessage:null})),this.deactivate();return}if(a.mode==="agent"){if(a.layout==="numeric"&&/^\d{4,6}$/.test(s)){const{authStore:o}=await cn(async()=>{const{authStore:u}=await Promise.resolve().then(()=>cs);return{authStore:u}},void 0);try{if((await o.login(null,s)).success){const{agentStore:y}=await cn(async()=>{const{agentStore:m}=await Promise.resolve().then(()=>gr);return{agentStore:m}},void 0);let g;o.subscribe(m=>g=m)();const T=`✅ Erfolgreich angemeldet als ${g.currentUser.full_name}!

⏰ Überprüfe Systemzeit...
🔍 Prüfe ausstehende Transaktionen...

Bitte warten Sie einen Moment...`;y.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:T}),y.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`🤖 KI-Assistent bereit!

Verfügbare Tools:
• findProduct - Produkte suchen und finden
• createProduct - Neue Produkte erstellen
• updateProduct - Produktdaten aktualisieren
• getSalesReport - Verkaufsberichte abrufen
• generateDsfinvkExport - DSFinV-K konforme Datenexporte erstellen

Ich wähle automatisch das richtige Tool für Ihre Anfrage aus. Stellen Sie einfach Ihre Frage!`}),setTimeout(async()=>{await this.checkSystemStatus(g.currentUser,y)},1e3),r(m=>({...m,liveValue:m.layout==="alpha"?{text:"",cursor:0}:"",errorMessage:null})),this.deactivate();return}else{const{agentStore:y}=await cn(async()=>{const{agentStore:g}=await Promise.resolve().then(()=>gr);return{agentStore:g}},void 0);y.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`❌ Ungültige PIN-Eingabe!

Bitte überprüfen Sie Ihre PIN und versuchen Sie es erneut. Sie können eine 4-6 stellige PIN über das Tastenfeld eingeben.`}),r(g=>({...g,liveValue:g.layout==="alpha"?{text:"",cursor:0}:"",errorMessage:null}));return}}catch{console.log("Direct login failed, falling back to agent message")}}const{agentStore:c}=await cn(async()=>{const{agentStore:o}=await Promise.resolve().then(()=>gr);return{agentStore:o}},void 0);try{await c.sendMessage(s),r(o=>({...o,liveValue:o.layout==="alpha"?{text:"",cursor:0}:""}))}catch(o){console.error("Agent message send failed:",o),r(u=>({...u,liveValue:u.layout==="alpha"?{text:"",cursor:0}:""}))}return}if(!a.confirmCallback)return;const l=a.confirmCallback;try{await l(s),r(()=>({isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:qn}))}catch(c){console.error("Pinpad confirm callback failed:",c),r(()=>({isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:qn}))}},cancel(a=null){r(s=>{const i=Date.now();if(i-s.lastRedClickTime<300){const c=s.cancelCallback;s.mode==="agent"&&cn(async()=>{const{agentStore:u}=await Promise.resolve().then(()=>gr);return{agentStore:u}},void 0).then(({agentStore:u})=>{u.cancelDraftMessage()});const o={isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:qn};return c&&setTimeout(()=>c(),0),o}else return s.mode==="agent"&&a&&a.updateDraftMessage(""),{...s,liveValue:s.layout==="alpha"?{text:"",cursor:0}:"",lastRedClickTime:i,errorMessage:null}})},activateTableEntry(){yt.set("order"),this.activate("table",async a=>{if(a&&a.trim())try{const s=await tt.assignTableNumber(a.trim());if(s&&s.tableInUse){r(i=>({...i,liveValue:i.layout==="alpha"?{text:"",cursor:0}:""}));return}return s}catch(s){throw s}},()=>{})},activateTableEntryWithAutoCollapse(){yt.set("order"),this.activate("table",async a=>{if(a&&a.trim())try{const s=await tt.assignTableNumber(a.trim());if(s&&s.tableInUse){r(o=>({...o,liveValue:o.layout==="alpha"?{text:"",cursor:0}:""}));return}let i;tt.subscribe(o=>i=o)();const l=i.items&&i.items.length>0,c=i.metadata&&i.metadata.table;return l&&c?(await tt.parkCurrentOrder(c,1,!1),await pr.refresh(),tt.resetOrder(),window.dispatchEvent(new CustomEvent("autoCollapseComplete")),{autoCollapsed:!0}):s}catch(s){throw s}},()=>{})},activateAlphaInput(a,s,i=null){i&&i.startDraftMessage(),this.activate("agent",a,s,"alpha")},moveCursorLeft(){r(a=>{if(!a.isActive||a.layout!=="alpha")return a;const s=Math.max(0,a.liveValue.cursor-1);return{...a,liveValue:{...a.liveValue,cursor:s}}})},moveCursorRight(){r(a=>{if(!a.isActive||a.layout!=="alpha")return a;const s=Math.min(a.liveValue.text.length,a.liveValue.cursor+1);return{...a,liveValue:{...a.liveValue,cursor:s}}})},switchLanguage(a=null){r(s=>{const i=Object.keys(s.layouts);if(a&&i.includes(a))return{...s,currentLanguage:a};if(!s.isActive||s.layout!=="alpha"){const u=(i.indexOf(s.currentLanguage)+1)%i.length;return{...s,currentLanguage:i[u]}}const c=(i.indexOf(s.currentLanguage)+1)%i.length;return{...s,currentLanguage:i[c]}})},async checkSystemStatus(a,s){try{const{wsStore:i}=await cn(async()=>{const{wsStore:u}=await Promise.resolve().then(()=>Wo);return{wsStore:u}},void 0);let l=0,c=!0;try{const u=await i.send({command:"systemTimeCheck",payload:{clientTime:new Date().toISOString()}});u.status==="success"?(l=u.payload.timeDifferenceSeconds,c=Math.abs(l)<=30):c=!1}catch{c=!1}if(c){s.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`✅ Erfolgreich angemeldet als ${a.full_name}!`});return}let o=`🎉 Willkommen zurück, ${a.full_name}!

`;if(c||(l!==0?o+=`⚠️ Zeitabweichung erkannt: ${Math.abs(l)} Sekunden ${l>0?"voraus":"zurück"}
`:o+=`⚠️ Zeitprüfung fehlgeschlagen
`),a.permissions.includes("all")||a.permissions.includes("manage_transactions"))try{const u=await i.send({command:"getPendingTransactions",payload:{}});u.status==="success"&&u.payload.length>0?(o+=`
🔄 ${u.payload.length} ausstehende Transaktionen gefunden!

`,o+=`Als ${a.role} können Sie diese Transaktionen verwalten:
`,o+=`• Fiskalisieren (abschließen)
`,o+=`• Stornieren (rückgängig machen)
`,o+=`• Verschieben (später bearbeiten)

`,o+="Möchten Sie diese jetzt bearbeiten? Verwenden Sie die entsprechenden Schaltflächen oder fragen Sie mich nach Hilfe."):o+=`
✅ Keine ausstehenden Transaktionen
`}catch{o+=`
⚠️ Konnte ausstehende Transaktionen nicht überprüfen
`}else o+=`
📋 Ihre Rolle: ${a.role}
`,o+=`Sie haben Zugriff auf grundlegende Kassenfunktionen.
`;o+=`
🚀 System ist bereit! Sie können mit der Arbeit beginnen.`,s.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:o})}catch(i){s.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`❌ Systemprüfung fehlgeschlagen: ${i.message}

Sie können trotzdem mit der Arbeit beginnen, aber einige Funktionen sind möglicherweise eingeschränkt.`})}}}}const Qe=tl();function nl(){const e=parseInt(void 0)||160;return Zs({MIN_BUTTON_WIDTH:e})}const ti=nl(),ua={hasNotification:!1,style:null};function rl(){const{subscribe:e,set:n,update:r}=wt(ua);return{subscribe:e,setNotification:a=>{console.log("🟡 [NotificationStore] setNotification called with style:",a),r(s=>{console.log("🟡 [NotificationStore] Previous state:",s);const i={hasNotification:!0,style:a};return console.log("🟡 [NotificationStore] New state:",i),i})},clearNotification:()=>{console.log("🟠 [NotificationStore] clearNotification called"),console.log("🟠 [NotificationStore] Clearing notification, setting to initial state:",ua),n(ua)}}}const Wn=rl();function al(){const{subscribe:e,set:n,update:r}=wt({history:[],messages:[{timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Willkommen bei ecKasse!

Eine Kasse, die hilft – nicht kostet.

👥 Verfügbare Benutzer:
• Admin (Vollzugriff)
• Kassier (Kassenfunktionen)
• Aushilfe (Grundfunktionen)

⏰ Überprüfe Systemzeit und ausstehende Transaktionen...

💡 Geben Sie einfach Ihre 4-6 stellige PIN ein - das System erkennt Sie automatisch. Bei neuer oder Testkasse: Admin-PIN ist 1234`}],draftMessage:null,shouldActivatePinpad:!0});return ge.subscribe(a=>{if(a.lastMessage&&a.lastMessage.command==="firstRunAdminCreated"){const s=a.lastMessage.payload;r(i=>({...i,messages:[{timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:s.message||`Willkommen! Admin-Benutzer '${s.username}' wurde erstellt mit PIN: ${s.password}`}]}))}if(a.lastMessage&&a.lastMessage.command==="getEntityJsonResponse"){const s=a.lastMessage.payload;if(s.success&&s.entity){const i=JSON.stringify(s.entity,null,2);r(l=>({...l,messages:[...l.messages,{timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"system",message:`JSON for viewing ${s.entityType} ID ${s.entityId}. For editing, use AI commands like 'update price to 29.99' or 'change name to Super Widget Pro':
\`\`\`json
${i}
\`\`\``}]}))}}}),{subscribe:e,addMessage:a=>{console.log("🔔 [AgentStore] addMessage called:",{timestamp:a.timestamp,type:a.type,message:a.message?.substring(0,100)+(a.message?.length>100?"...":""),style:a.style,hasStyle:!!a.style}),r(s=>({...s,messages:[...s.messages,a]})),a.style?(console.log("🟢 [AgentStore] Message has style, triggering notification:",a.style),Wn.setNotification(a.style)):console.log("🔴 [AgentStore] Message has NO style, no notification triggered")},setHistory:a=>{r(s=>({...s,history:a}))},getHistory:()=>{let a;return e(s=>a=s.history)(),a},clearMessages:()=>{r(a=>({...a,messages:[]}))},startDraftMessage:()=>{r(a=>({...a,draftMessage:{id:"draft-"+Date.now(),timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"user",message:"",isDraft:!0}}))},updateDraftMessage:a=>{r(s=>({...s,draftMessage:s.draftMessage?{...s.draftMessage,message:a}:null}))},finalizeDraftMessage:()=>{r(a=>{if(!a.draftMessage)return a;const s={...a.draftMessage,isDraft:!1};return{...a,messages:[...a.messages,s],draftMessage:null}})},cancelDraftMessage:()=>{r(a=>({...a,draftMessage:null}))},sendMessage:async a=>{if(!(!a||!a.trim()))try{const i=nr(kn).sessionId,l={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"user",message:a};let c;e(g=>c=g)(),r(g=>({...g,messages:[...g.messages,l],draftMessage:null}));const o=await fetch("/api/llm/ping-gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:a,history:c.history,sessionId:i})});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const u=await o.json(),y={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:u.gemini_response_text};r(g=>({...g,messages:[...g.messages,y],history:u.history}))}catch(s){console.error("Failed to send message to AI:",s);const i={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"Sorry, I encountered an error. Please try again."};r(l=>({...l,messages:[...l.messages,i]}))}},shouldActivatePinpadOnLoad(){let a=!1;return r(s=>(a=s.shouldActivatePinpad,{...s,shouldActivatePinpad:!1})),a}}}const we=al(),gr=Object.freeze(Object.defineProperty({__proto__:null,agentStore:we},Symbol.toStringTag,{value:"Module"})),sl=()=>typeof localStorage<"u"&&localStorage.getItem("app-locale")||"de-DE",Zn=wt(sl());Zn.subscribe(e=>{typeof localStorage<"u"&&localStorage.setItem("app-locale",e)});const il=e=>{Zn.set(e)},Tt=(e,n="EUR")=>{const r=nr(Zn);return e==null||isNaN(e)?new Intl.NumberFormat(r,{style:"currency",currency:n}).format(0):new Intl.NumberFormat(r,{style:"currency",currency:n}).format(e)},ol=(e,n={})=>{const r=nr(Zn);if(!e)return"";const a=typeof e=="string"?new Date(e):e;if(isNaN(a.getTime()))return"";const s={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",...n};return new Intl.DateTimeFormat(r,s).format(a)};var ll=j('<div class="loading svelte-1dtcyze">Loading receipts...</div>'),cl=j('<div class="error svelte-1dtcyze"> </div>'),ul=j('<div class="empty svelte-1dtcyze">No receipts found.</div>'),dl=j('<span class="receipt-table-large svelte-1dtcyze"> </span>'),fl=j('<div><span class="item-qty svelte-1dtcyze"> </span> <span> </span> <span> </span></div>'),vl=j('<div class="receipt-details svelte-1dtcyze"><div class="items-list svelte-1dtcyze"></div> <div class="receipt-totals svelte-1dtcyze"><div class="total-row svelte-1dtcyze"><span>Tax:</span> <span class="price svelte-1dtcyze"> </span></div> <div class="total-row total svelte-1dtcyze"><span>Total:</span> <span class="price svelte-1dtcyze"> </span></div></div> <div class="receipt-actions svelte-1dtcyze"><button class="action-button svelte-1dtcyze">🖨️ Reprint</button></div></div>'),pl=j('<div><button class="receipt-summary svelte-1dtcyze"><div class="receipt-left svelte-1dtcyze"><div class="receipt-main-line svelte-1dtcyze"><span class="receipt-id-large svelte-1dtcyze"> </span> <!></div> <div class="receipt-date svelte-1dtcyze"> </div> <div class="receipt-payment svelte-1dtcyze"> </div></div> <div class="receipt-right svelte-1dtcyze"><div class="receipt-price svelte-1dtcyze"><span class="price svelte-1dtcyze"> </span></div> <div class="receipt-meta svelte-1dtcyze"><div class="receipt-items-count svelte-1dtcyze"> </div></div></div> <div class="expand-icon svelte-1dtcyze"> </div></button> <!></div>'),gl=j('<div class="receipt-list svelte-1dtcyze"></div>'),ml=j('<div class="receipt-feed svelte-1dtcyze"><!></div>');function hl(e,n){_t(n,!1);const[r,a]=Tr(),s=()=>st(Gr,"$receiptsStore",r);let i=Oe(n,"autoExpandLatest",8,!1),l=V(null),c=V(!1),o=V();tn(()=>{Gr.loadReceipts()});function u(p){h(c,!0),h(l,t(l)===p?null:p)}function y(p){return ol(p)}function g(p){return p.notes==="STORNO"&&p.display_names&&p.display_names.menu&&p.display_names.menu.de?`STORNO: ${p.display_names.menu.de}`:p.notes==="DISCOUNT"?"DISCOUNT":p.notes==="SURCHARGE"?"SURCHARGE":p.display_names&&p.display_names.menu&&p.display_names.menu.de?p.display_names.menu.de:"Unnamed Item"}function T(p){return p.notes==="STORNO"||p.notes==="DISCOUNT"||p.notes==="SURCHARGE"}function m(p){if(p.notes==="DISCOUNT"||p.notes==="SURCHARGE")return"";const D=parseFloat(p.quantity);return D===1?"":D+"x"}async function x(p){K("INFO",`Reprint requested for receipt №${p.id}`),we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Reprint initiated for receipt №${p.id}`,style:"info"}),ge.send("reprintReceipt",{transactionId:p.id})}Be(()=>H(i()),()=>{i()&&h(c,!1)}),Be(()=>(H(i()),t(c),s(),t(l)),()=>{if(i()&&!t(c)&&s().receipts.length>0){const D=s().receipts.sort((C,_)=>new Date(_.fiscal_timestamp||_.updated_at)-new Date(C.fiscal_timestamp||C.updated_at))[0]?.id;D&&t(l)!==D&&h(l,D)}}),pn(),Mt();var I=ml(),N=f(I);{var L=p=>{var D=ll();k(p,D)},q=p=>{var D=Ie(),C=xe(D);{var _=M=>{var X=cl(),B=f(X);le(()=>se(B,`Error: ${s(),S(()=>s().error)??""}`)),k(M,X)},v=M=>{var X=Ie(),B=xe(X);{var Q=A=>{var Y=ul();k(A,Y)},F=A=>{var Y=gl();Et(Y,5,()=>(s(),S(()=>s().receipts.sort((G,U)=>new Date(G.fiscal_timestamp||G.updated_at)-new Date(U.fiscal_timestamp||U.updated_at)))),G=>G.id,(G,U)=>{var ke=pl();let Ee;var Ae=f(ke),oe=f(Ae),O=f(oe),E=f(O),z=f(E),ee=w(E,2);{var J=P=>{var R=dl(),ue=f(R);le(()=>se(ue,`#${t(U),S(()=>t(U).metadata.table)??""}`)),k(P,R)};W(ee,P=>{t(U),S(()=>t(U).metadata?.table)&&P(J)})}var te=w(O,2),ce=f(te),de=w(te,2),fe=f(de),me=w(oe,2),ve=f(me),_e=f(ve),pe=f(_e),Se=w(ve,2),Pe=f(Se),$e=f(Pe),Re=w(me,2),he=f(Re),Ce=w(Ae,2);{var ye=P=>{var R=vl(),ue=f(R);Et(ue,5,()=>(t(U),S(()=>t(U).items)),Ke=>Ke.id,(Ke,De)=>{var je=fl();let We;var lt=f(je),ft=f(lt),an=w(lt,2);let Fe;var Ye=f(an),ht=w(an,2);let nt;var Ve=f(ht);le((Ht,Bt,sn,Pt,Ot,Wt)=>{We=Ze(je,1,"item-row svelte-1dtcyze",null,We,Ht),se(ft,Bt),Fe=Ze(an,1,"item-name svelte-1dtcyze",null,Fe,sn),se(Ye,Pt),nt=Ze(ht,1,"item-price svelte-1dtcyze",null,nt,Ot),se(Ve,Wt)},[()=>({"modification-item":T(t(De))}),()=>(t(De),S(()=>m(t(De)))),()=>({"modification-name":T(t(De))}),()=>(t(De),S(()=>g(t(De)))),()=>({"negative-price":parseFloat(t(De).total_price)<0}),()=>(H(Tt),t(De),S(()=>Tt(t(De).total_price)))]),k(Ke,je)});var be=w(ue,2),ze=f(be),xt=w(f(ze),2),gt=f(xt),St=w(ze,2),He=w(f(St),2),ot=f(He),dt=w(be,2),mt=f(dt);le((Ke,De)=>{se(gt,Ke),se(ot,De)},[()=>(H(Tt),t(U),S(()=>Tt(t(U).tax_amount))),()=>(H(Tt),t(U),S(()=>Tt(t(U).total_amount)))]),ae("click",mt,()=>x(t(U))),k(P,R)};W(Ce,P=>{t(l),t(U),S(()=>t(l)===t(U).id)&&P(ye)})}le((P,R,ue)=>{Ee=Ze(ke,1,"receipt-item svelte-1dtcyze",null,Ee,P),se(z,`№${t(U),S(()=>t(U).id)??""}`),se(ce,R),se(fe,(t(U),S(()=>t(U).payment_type||"Unknown"))),se(pe,ue),se($e,`${t(U),S(()=>t(U).items?.length||0)??""} items`),se(he,(t(l),t(U),S(()=>t(l)===t(U).id?"▼":"▶")))},[()=>({expanded:t(l)===t(U).id}),()=>(t(U),S(()=>y(t(U).fiscal_timestamp||t(U).updated_at))),()=>(H(Tt),t(U),S(()=>Tt(t(U).total_amount)))]),ae("click",Ae,()=>u(t(U).id)),k(G,ke)}),fn(Y,G=>h(o,G),()=>t(o)),k(A,Y)};W(B,A=>{s(),S(()=>s().receipts.length===0)?A(Q):A(F,!1)},!0)}k(M,X)};W(C,M=>{s(),S(()=>s().error)?M(_):M(v,!1)},!0)}k(p,D)};W(N,p=>{s(),S(()=>s().loading)?p(L):p(q,!1)})}k(e,I),bt(),a()}var yl=j('<button class="order-item svelte-1gswy6n"><div class="table-number svelte-1gswy6n"> </div> <div class="order-stats svelte-1gswy6n"><div class="stat-price svelte-1gswy6n"> </div> <div class="stat-open svelte-1gswy6n"> </div> <div class="stat-activity svelte-1gswy6n"> </div></div></button>'),_l=j('<div class="parked-orders-container svelte-1gswy6n"><div class="orders-list svelte-1gswy6n"></div></div>');function bl(e,n){_t(n,!1);let r=V([]),a,s,i=!1;tn(async()=>{a=pr.subscribe(m=>{h(r,m)}),s=ge.subscribe(async m=>{m.connected&&!i&&(i=!0,await pr.refreshParkedOrders())})}),Ua(()=>{a&&a(),s&&s()});async function l(m){try{let x;if(tt.subscribe(N=>x=N)(),x.transactionId&&x.status==="active"){const N=x.items&&x.items.length>0,L=x.metadata&&x.metadata.table;if(N&&L)await tt.parkCurrentOrder(L,1,!1),await pr.refreshParkedOrders();else if(N&&!L){yt.set("order"),Qe.activateTableEntry();return}else tt.resetOrder()}const I=await pr.activateOrder(m.id,!1);tt.loadOrder(I)}catch(x){console.error("Failed to switch to order:",x)}}function c(m){const I=(m.metadata||{}).table||m.id.toString();return I.length>3?`#${I.substring(0,3)}`:`#${I}`}function o(m){return xr.formatTimeElapsed(m)}function u(m){const x=o(m.created_at),I=o(m.updated_at);return{price:Tt(m.total_amount),openMinutes:x,activityMinutes:I}}Mt();var y=Ie(),g=xe(y);{var T=m=>{var x=_l(),I=f(x);Et(I,5,()=>t(r),N=>N.id,(N,L)=>{var q=yl(),p=f(q),D=f(p),C=w(p,2),_=f(C),v=f(_),M=w(_,2),X=f(M),B=w(M,2),Q=f(B);le((F,A,Y,G)=>{se(D,F),se(v,A),se(X,`${Y??""}min`),se(Q,`${G??""}min`)},[()=>c(t(L)),()=>u(t(L)).price,()=>u(t(L)).openMinutes,()=>u(t(L)).activityMinutes]),ae("click",q,()=>l(t(L))),k(N,q)}),k(m,x)};W(g,m=>{t(r).length>0&&m(T)})}k(e,y),bt()}var wl=Da(`<svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%;"><defs><filter height="150%" id="sh0" width="150%" x="-0.25" y="-0.25"><feConvolveMatrix id="3_|_y" in="SourceAlpha" result="19y" order="1,17" divisor="6632" bias="0" preserveAlpha="false" kernelMatrix=" 10 30 77 169 320 527 752 931 1000 931 752 527 320 169 77 30 10"></feConvolveMatrix><feConvolveMatrix id="3_|_x" result="19x" order="17,1" divisor="6632" bias="0" preserveAlpha="false" kernelMatrix=" 10 30 77 169 320 527 752 931 1000 931 752 527 320 169 77 30 10"></feConvolveMatrix><feConvolveMatrix id="9_|_y" in="SourceAlpha" result="49y" order="1,47" divisor="19856" bias="0" preserveAlpha="false" kernelMatrix=" 15 21 30 42 57 77 101 132 169 212 263 320 384 453 527 603 678 752 820 881 931 968 992 1000 992 968 931 881 820 752 678 603 527 453 384 320 263 212 169 132 101 77 57 42 30 21 15"></feConvolveMatrix><feConvolveMatrix id="9_|_x" result="49x" order="47,1" divisor="19856" bias="0" preserveAlpha="false" kernelMatrix=" 15 21 30 42 57 77 101 132 169 212 263 320 384 453 527 603 678 752 820 881 931 968 992 1000 992 968 931 881 820 752 678 603 527 453 384 320 263 212 169 132 101 77 57 42 30 21 15"></feConvolveMatrix><feTurbulence class="seed" result="noise" type="fractalNoise" stitchTiles="stitch" seed="43" baseFrequency="0.06 0.08 " numOctaves="3"></feTurbulence><feMorphology operator="erode" radius="1.2"></feMorphology><feComposite in="noise" operator="arithmetic" k1="0" k2="8" k3="0" k4="-3"></feComposite><feComposite in="49x" result="49noise" operator="arithmetic" k1="0" k2="2" k3="-0.2" k4="-1"></feComposite><feComposite in="49noise" in2="19x" operator="arithmetic" k1="0" k2="0.5" k3="1.5" k4="-1"></feComposite><feDiffuseLighting surfaceScale="2" lighting-color="#fff"><feDistantLight azimuth="240" elevation="20"></feDistantLight></feDiffuseLighting><feComposite in2="SourceGraphic" operator="arithmetic" k1="1" k2="0" k3="0" k4="0"></feComposite></filter><filter height="170%" id="sh2" width="170%" x="-0.2" y="-0.2"><feOffset dx="0" dy="0" in="SourceAlpha"></feOffset><feGaussianBlur stdDeviation="1.2"></feGaussianBlur><feColorMatrix result="out" type="matrix" values=" 
               0 0 0 0 0.4         
               0 0 0 0 0.4                    
               0 0 0 0 0.4                
               0 0 0 10 0 "></feColorMatrix><feMerge><feMergeNode in="out"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter><filter height="130%" id="sh1" width="130%" x="-0.2" y="-0.2"><feOffset dx="3" dy="4" in="SourceAlpha"></feOffset><feGaussianBlur stdDeviation="3"></feGaussianBlur><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.8 0"></feColorMatrix><feBlend in="SourceGraphic"></feBlend></filter><linearGradient id="svg_66" x1="0" x2="1" y1="0" y2="0"><stop offset="0" stop-color="hsl(40, 23%, 35%)"></stop><stop offset="0.4" stop-color="hsl(40, 23%, 60%)"></stop><stop offset="0.65" stop-color="hsl(40, 23%, 70%)"></stop><stop offset="0.75" stop-color="hsl(40, 23%, 60%)"></stop><stop offset="1" stop-color="hsl(40, 23%, 35%)"></stop></linearGradient><circle id="bell" fill="#070" stroke="#030" r="5.5" filter="url(#sh0)"></circle><g id="cap" filter="url(#sh2)"><path id="capPath" fill="#070" filter="url(#sh0)" stroke="#030" d="M72,89 C78.6,68 67.2,30.7 89,68 C86.9,37.6 66.91,32 62,61 C58,44.1 67.5,38.8 52,10 C53.6,47 46.91,36.2 45,61 C39.3,43.4 22,46.6 13,43 C32.9,55.8 35.7,66.62 32,89 C35,97.9 68.6,99 72,89 Z"></path><use id="bell1" x="13" y="43" href="#bell"></use><use id="bell2" x="52" y="10" href="#bell"></use><use id="bell3" x="89" y="68" href="#bell"></use><ellipse cx="52.19" cy="90.01" fill="url(#svg_66)" rx="14.76" ry="3.56"></ellipse><path d="M34,86.5C36,82,53.5,81,60,83C54,81,34,81.5,34,86.5Z" fill="none" stroke="hsl(40, 23%, 60%)"></path></g></defs><use href="#cap"></use></svg>`);function xl(e){var n=wl();k(e,n)}var Sl=j('<div class="slot-container svelte-12whdgj"><!></div>'),kl=j('<div class="button-icon-wrapper svelte-12whdgj"><div class="button-icon svelte-12whdgj"><!></div></div>'),Cl=j('<div class="button-icon-wrapper svelte-12whdgj"><span class="button-icon svelte-12whdgj"><!></span></div>'),Tl=j("<div></div>"),El=j("<!> <!>",1),Il=j('<span class="button-text svelte-12whdgj"><!></span>'),Ml=j('<button><div class="button-shape svelte-12whdgj"><!></div></button>');function Lt(e,n){const r=To(n);_t(n,!1);const a=V(),s=V(),i=V();let l=Oe(n,"label",8,""),c=Oe(n,"icon",8,""),o=Oe(n,"component",8,null),u=Oe(n,"color",8,"#666666"),y=Oe(n,"textColor",8,""),g=Oe(n,"backgroundStyle",8,""),T=Oe(n,"customStyle",8,""),m=Oe(n,"disabled",8,!1),x=Oe(n,"data",8,null),I=Oe(n,"width",8,120),N=Oe(n,"height",8,80),L=Oe(n,"shape",8,"rect"),q=Oe(n,"side",8,""),p=Oe(n,"active",8,!1),D=Oe(n,"showShape",8,""),C=Oe(n,"notificationStyle",8,null);const _=Mn();let v,M=!1;function X(){!m()&&!M&&_("click",{data:x(),label:l()})}function B(oe){m()||(oe.preventDefault(),_("secondaryaction",{data:x(),label:l(),mouseX:oe.clientX,mouseY:oe.clientY,originalEvent:oe}))}function Q(oe){!m()&&oe.button===0&&(M=!1,v=setTimeout(()=>{M=!0,_("secondaryaction",{data:x(),label:l(),mouseX:oe.clientX,mouseY:oe.clientY,originalEvent:oe})},500))}function F(){clearTimeout(v),setTimeout(()=>{M=!1},10)}function A(){clearTimeout(v),M=!1}Be(()=>H(q()),()=>{h(a,q()==="left"||q()==="right")}),Be(()=>H(l()),()=>{h(s,l())}),Be(()=>(H(L()),t(a),H(q())),()=>{h(i,L()==="hex"&&t(a)?q()==="left"?"polygon(0% 0%, 100% 25%, 100% 75%, 0% 100%)":"polygon(0% 25%, 100% 0%, 100% 100%, 0% 75%)":L()==="hex"?"polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%)":"none")}),pn(),Mt();var Y=Ml();let G;var U=f(Y),ke=f(U);{var Ee=oe=>{var O=Sl(),E=f(O);Co(E,n,"default",{}),k(oe,O)},Ae=oe=>{var O=Ie(),E=xe(O);{var z=J=>{var te=El(),ce=xe(te);{var de=_e=>{var pe=kl(),Se=f(pe),Pe=f(Se);Js(Pe,o,($e,Re)=>{Re($e,{})}),k(_e,pe)},fe=_e=>{var pe=Ie(),Se=xe(pe);{var Pe=$e=>{var Re=Cl(),he=f(Re),Ce=f(he);ts(Ce,c),k($e,Re)};W(Se,$e=>{c()&&$e(Pe)},!0)}k(_e,pe)};W(ce,_e=>{o()?_e(de):_e(fe,!1)})}var me=w(ce,2);{var ve=_e=>{var pe=Tl();le(()=>Ze(pe,1,`shape-overlay ${D()??""}`,"svelte-12whdgj")),k(_e,pe)};W(me,_e=>{D()&&_e(ve)})}k(J,te)},ee=J=>{var te=Ie(),ce=xe(te);{var de=fe=>{var me=Il(),ve=f(me);ts(ve,()=>t(s)),le(()=>Sn(me,T())),k(fe,me)};W(ce,fe=>{l()&&fe(de)},!0)}k(J,te)};W(E,J=>{o()||c()||D()?J(z):J(ee,!1)},!0)}k(oe,O)};W(ke,oe=>{S(()=>r.default)?oe(Ee):oe(Ae,!1)})}le(oe=>{G=Ze(Y,1,`universal-button ${L()??""}`,"svelte-12whdgj",G,oe),Sn(Y,`
    --button-width: ${I()??""}px; 
    --button-height: ${N()??""}px; 
    --button-color: ${u()??""};
    ${y()?`--button-text-color: ${y()};`:""}
    ${g()?`--button-background-style: ${g()};`:""}
    --clip-path: ${t(i)??""};
  `)},[()=>({disabled:m(),half:t(a),left:q()==="left",right:q()==="right",active:p(),notification:!!C(),error:C()==="error",warning:C()==="warning",success:C()==="success",print:C()?.startsWith("print")})]),ae("click",Y,X),ae("contextmenu",Y,B),ae("mousedown",Y,Q),ae("mouseup",Y,F),ae("mouseleave",Y,A),k(e,Y),bt()}var Al=j('<span class="table-number svelte-x88uh0"> </span>'),$l=j('<div class="pinpad-error-message svelte-x88uh0"> </div>'),Rl=j('<span class="qty svelte-x88uh0"> </span>'),Pl=j('<span class="input-overlay svelte-x88uh0"> </span>'),Ol=j('<li><!> <div class="name-container svelte-x88uh0"><span> </span> <!></div> <span class="price svelte-x88uh0"> </span></li>'),Nl=j('<div class="view-content order-view svelte-x88uh0"><div class="orders-stack svelte-x88uh0"><div class="parked-orders-section svelte-x88uh0"><!></div> <div class="active-order-section svelte-x88uh0"><div class="order-content svelte-x88uh0"><h2 class="svelte-x88uh0"><span class="order-number svelte-x88uh0"> </span><!></h2> <!> <div class="scrollable-items-content svelte-x88uh0"><ul class="item-list svelte-x88uh0"></ul></div> <div class="spacer svelte-x88uh0"></div> <div class="total svelte-x88uh0"><span class="svelte-x88uh0">Total:</span> <span class="price svelte-x88uh0"> </span></div></div></div></div></div>'),Dl=j('<div class="view-content receipts-view svelte-x88uh0"><div class="receipts-stack svelte-x88uh0"><!></div></div>'),Bl=j('<div class="agent-header-icon svelte-x88uh0"><!></div>'),Ll=j('<div class="message-actions svelte-x88uh0"></div>'),Fl=j('<div><div class="message-header svelte-x88uh0"><span class="message-timestamp svelte-x88uh0"> </span> <span class="message-type svelte-x88uh0"> </span></div> <div class="message-content svelte-x88uh0"> </div> <!></div>'),Ul=j(' <span class="cursor svelte-x88uh0">|</span>',1),jl=j(' <span class="cursor svelte-x88uh0">|</span>',1),ql=j('<span class="cursor svelte-x88uh0">|</span>'),zl=j('<div class="agent-message user draft svelte-x88uh0"><div class="message-header svelte-x88uh0"><span class="message-timestamp svelte-x88uh0"> </span> <span class="message-type svelte-x88uh0">User</span></div> <div class="message-content svelte-x88uh0"><!></div></div>'),Vl=j('<div class="view-content agent-view svelte-x88uh0"><!> <div class="scroll-content svelte-x88uh0"><div class="agent-messages svelte-x88uh0"><!> <!></div></div></div>'),Gl=j('<div class="console-view svelte-x88uh0"><div class="content-area svelte-x88uh0"><!></div></div>');function Hl(e,n){_t(n,!1);const[r,a]=Tr(),s=()=>st(tt,"$orderStore",r),i=()=>st(yt,"$currentView",r),l=()=>st(Gr,"$receiptsStore",r),c=()=>st(we,"$agentStore",r),o=()=>st(Qe,"$pinpadStore",r),u=()=>st(ti,"$uiConstantsStore",r),y=Mn();let g=V(),T=V(),m=V(),x=!1,I=V(!1),N=!1,L=V(!1),q=V("order"),p=V(!1),D=V(s().status),C=V(s().items.length),_=V(s().transactionId),v=V(s().metadata?.table),M=V(i());tn(()=>{setTimeout(()=>{if(N||(A(),F(),N=!0),i()==="agent"&&we.shouldActivatePinpadOnLoad()&&Qe.activate("agent",()=>{},()=>{},"numeric"),t(g)){const E=new ResizeObserver(()=>{t(g)&&h(L,t(g).scrollHeight>t(g).clientHeight)});return E.observe(t(g)),h(L,t(g).scrollHeight>t(g).clientHeight),()=>{E.disconnect()}}},200)}),Uo(()=>{if(!t(I)){let E=null;i()==="order"?E=t(T):i()==="agent"?E=t(g):i()==="receipts"&&(E=t(m)),E&&setTimeout(()=>{if(E&&!t(I)){if(F(),i()==="agent"&&t(g)){const z=t(g).scrollHeight>t(g).clientHeight;z!==t(L)&&h(L,z)}x||(h(I,!0),E.scrollTop=E.scrollHeight,setTimeout(()=>{h(I,!1),F()},100))}},50)}});function X(E){if(typeof E=="object"&&E!==null)return E;if(typeof E=="string")try{return JSON.parse(E)}catch{return E}return E}function B(){const z={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"Select language / Sprache auswählen / Выберите язык:",actions:[{id:"lang-de",label:"DE",action:"selectLanguage",param:"DE"},{id:"lang-en",label:"EN",action:"selectLanguage",param:"EN"},{id:"lang-ru",label:"RU",action:"selectLanguage",param:"RU"}]};we.addMessage(z),setTimeout(()=>{t(g)&&(qe(g,t(g).scrollTop=t(g).scrollHeight),F())},100)}function Q(E,z){if(E==="selectLanguage"){Qe.switchLanguage(z);const ee=c().messages.filter(ce=>!ce.actions);we.clearMessages(),ee.forEach(ce=>we.addMessage(ce));const te={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Language changed to ${z}`};we.addMessage(te),setTimeout(()=>{t(g)&&(qe(g,t(g).scrollTop=t(g).scrollHeight),F())},100)}}function F(){if(!t(I)){let E=null;if(i()==="order"?E=t(T):i()==="agent"?E=t(g):i()==="receipts"&&(E=t(m)),E){const ee=E.scrollTop,J=E.clientHeight,te=E.scrollHeight;x=ee+J>=te-1}else x=!0;y("scrollstate",x)}}function A(){let E=null;i()==="order"?E=t(T):i()==="agent"?E=t(g):i()==="receipts"&&(E=t(m)),E&&(E.scrollTop=E.scrollHeight,x=!0)}function Y(){if(nr(Wn).hasNotification){yt.set("agent");return}let z;switch(t(q)){case"order":z=["order","receipts","agent"];break;case"receipts":z=["receipts","order","agent"];break;case"agent":z=["agent","order","receipts"];break;default:z=["order","receipts","agent"]}const J=(z.indexOf(i())+1)%z.length,te=z[J];i()==="receipts"&&te!=="receipts"&&h(p,!1),yt.set(te)}function G(){return x}tn(()=>{const E=ge.subscribe(z=>{if(z.lastMessage?.command==="menu-import-progress"){const ee=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});we.addMessage({timestamp:ee,type:"agent",message:z.lastMessage.payload.message}),setTimeout(()=>{t(g)&&i()==="agent"&&(qe(g,t(g).scrollTop=t(g).scrollHeight),F())},100)}});return()=>{E()}}),typeof window<"u"&&window.electronAPI&&window.electronAPI.onImportComplete&&window.electronAPI.onImportComplete((E,z)=>{const ee=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});we.addMessage({timestamp:ee,type:"agent",message:z}),E&&(K("INFO","Refreshing categories after successful menu import"),ge.send({command:"getCategories"}),setTimeout(()=>{const J=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});we.addMessage({timestamp:J,type:"agent",message:"Menu import completed successfully! Your new menu structure is now ready for use. You can navigate back to the selection area to explore the imported categories and products."}),setTimeout(()=>{t(g)&&i()==="agent"&&(qe(g,t(g).scrollTop=t(g).scrollHeight),F())},100)},1e3)),setTimeout(()=>{t(g)&&i()==="agent"&&(qe(g,t(g).scrollTop=t(g).scrollHeight),F())},100)}),Be(()=>(i(),t(M),Wn),()=>{i()==="agent"&&t(M)!=="agent"?(console.log("🔵 [ConsoleView] User switched TO agent view, will clear notification in 100ms"),console.log("🔵 [ConsoleView] Previous view:",t(M),"Current view:",i()),setTimeout(()=>{console.log("🔵 [ConsoleView] Clearing notification now"),Wn.clearNotification()},100)):i()==="agent"&&t(M)==="agent"?console.log("🔵 [ConsoleView] Already in agent view, NOT clearing notification"):i()!=="agent"&&console.log("🔵 [ConsoleView] Not in agent view, NOT clearing notification. Current view:",i()),h(M,i())}),Be(()=>(t(D),s(),t(m)),()=>{t(D)==="finished"&&s().status==="idle"&&(h(q,"receipts"),h(p,!0),yt.set("receipts"),Gr.refresh(),setTimeout(()=>{t(m)&&(qe(m,t(m).scrollTop=t(m).scrollHeight),F())},300)),h(D,s().status)}),Be(()=>(l(),t(m),i()),()=>{l().receipts&&t(m)&&i()==="receipts"&&setTimeout(()=>{F()},100)}),Be(()=>(c(),t(g),i(),t(L)),()=>{c().messages&&t(g)&&i()==="agent"&&setTimeout(()=>{if(t(g)){const E=t(g).scrollHeight>t(g).clientHeight;E!==t(L)&&h(L,E)}},100)}),Be(()=>(i(),t(T),s(),t(C),t(_),t(v)),()=>{if(i()==="order"&&t(T)){const E=s().items.length,z=s().transactionId,ee=s().metadata?.table;(E!==t(C)||z!==t(_)||ee!==t(v))&&setTimeout(()=>{t(T)&&qe(T,t(T).scrollTop=t(T).scrollHeight)},100),h(C,E),h(_,z),h(v,ee)}}),pn(),Mt();var U=Gl(),ke=f(U),Ee=f(ke);{var Ae=E=>{var z=Nl(),ee=f(z),J=f(ee),te=f(J);bl(te,{});var ce=w(J,2),de=f(ce),fe=f(de),me=f(fe),ve=f(me),_e=w(me);{var pe=P=>{var R=Al(),ue=f(R);le(()=>se(ue,`#${o(),s(),S(()=>o().isActive&&o().mode==="table"?o().liveValue:s().metadata?.table)??""}`)),k(P,R)};W(_e,P=>{s(),o(),S(()=>s().metadata?.table||o().isActive&&o().mode==="table")&&P(pe)})}var Se=w(fe,2);{var Pe=P=>{var R=$l(),ue=f(R);le(()=>se(ue,(o(),S(()=>o().errorMessage)))),k(P,R)};W(Se,P=>{o(),S(()=>o().errorMessage)&&P(Pe)})}var $e=w(Se,2),Re=f($e);Et(Re,5,()=>(s(),S(()=>s().items)),P=>P.id,(P,R)=>{var ue=Ol();let be;var ze=f(ue);{var xt=je=>{var We=Rl(),lt=f(We);le(ft=>se(lt,`${ft??""}x`),[()=>(t(R),S(()=>parseFloat(t(R).quantity)))]),k(je,We)};W(ze,je=>{t(R),S(()=>parseFloat(t(R).quantity)>1)&&je(xt)})}var gt=w(ze,2),St=f(gt);let He;var ot=f(St),dt=w(St,2);{var mt=je=>{var We=Pl(),lt=f(We);le(()=>se(lt,(o(),S(()=>o().liveValue)))),k(je,We)};W(dt,je=>{s(),t(R),o(),S(()=>s().activeTransactionItemId===t(R).id&&o().isActive&&o().mode!=="agent"&&o().liveValue)&&je(mt)})}var Ke=w(gt,2),De=f(Ke);le((je,We,lt,ft)=>{be=Ze(ue,1,"svelte-x88uh0",null,be,je),He=Ze(St,1,"name svelte-x88uh0",null,He,We),se(ot,lt),se(De,ft)},[()=>({active:s().activeTransactionItemId===t(R).id}),()=>({"input-mode":s().activeTransactionItemId===t(R).id&&o().isActive&&o().mode!=="agent"&&o().liveValue}),()=>(t(R),S(()=>t(R).display_names?X(t(R).display_names).menu.de||"N/A":"Loading...")),()=>(H(Tt),t(R),S(()=>Tt(parseFloat(t(R).total_price))))]),k(P,ue)});var he=w($e,4),Ce=w(f(he),2),ye=f(Ce);fn(ee,P=>h(T,P),()=>t(T)),le(P=>{se(ve,`Order №${s(),S(()=>s().transactionId||"...")??""}`),se(ye,P)},[()=>(H(Tt),s(),S(()=>Tt(s().total)))]),ae("scroll",ee,()=>!t(I)&&F()),k(E,z)},oe=E=>{var z=Ie(),ee=xe(z);{var J=ce=>{var de=Dl(),fe=f(de),me=f(fe);hl(me,{get autoExpandLatest(){return t(p)}}),fn(fe,ve=>h(m,ve),()=>t(m)),ae("scroll",fe,()=>!t(I)&&F()),k(ce,de)},te=ce=>{var de=Ie(),fe=xe(de);{var me=ve=>{var _e=Vl(),pe=f(_e);{var Se=ye=>{var P=Bl(),R=f(P);xl(R),k(ye,P)};W(pe,ye=>{t(L)||ye(Se)})}var Pe=w(pe,2),$e=f(Pe),Re=f($e);Et(Re,1,()=>(c(),S(()=>c().messages)),wr,(ye,P)=>{var R=Fl();let ue;var be=f(R),ze=f(be),xt=f(ze),gt=w(ze,2),St=f(gt),He=w(be,2),ot=f(He),dt=w(He,2);{var mt=Ke=>{var De=Ll();Et(De,5,()=>(t(P),S(()=>t(P).actions)),wr,(je,We)=>{{let lt=et(()=>(t(We),S(()=>({display:t(We).label,action:()=>Q(t(We).action,t(We).param)})))),ft=et(()=>(u(),S(()=>({width:u().MIN_BUTTON_WIDTH,height:Math.round(u().MIN_BUTTON_WIDTH*.4)}))));Lt(je,{get content(){return t(lt)},get size(){return t(ft)},style:"rectangular"})}}),k(Ke,De)};W(dt,Ke=>{t(P),S(()=>t(P).actions)&&Ke(mt)})}le(Ke=>{ue=Ze(R,1,"agent-message svelte-x88uh0",null,ue,Ke),se(xt,(t(P),S(()=>t(P).timestamp))),se(St,(t(P),S(()=>t(P).type==="user"?"User":"Agent"))),se(ot,(t(P),S(()=>t(P).message)))},[()=>({user:t(P).type==="user",agent:t(P).type==="agent",error:t(P).style==="error",success:t(P).style==="success",warning:t(P).style==="warning",print:t(P).style?.startsWith("print")})]),k(ye,R)});var he=w(Re,2);{var Ce=ye=>{var P=zl(),R=f(P),ue=f(R),be=f(ue),ze=w(R,2),xt=f(ze);{var gt=He=>{var ot=Ul(),dt=xe(ot);le(mt=>se(dt,mt),[()=>(o(),S(()=>"*".repeat(o().liveValue.length)))]),k(He,ot)},St=He=>{var ot=Ie(),dt=xe(ot);{var mt=De=>{var je=jl(),We=xe(je);le(()=>se(We,(c(),S(()=>c().draftMessage.message)))),k(De,je)},Ke=De=>{var je=ql();k(De,je)};W(dt,De=>{o(),c(),S(()=>o().layout==="alpha"&&c().draftMessage)?De(mt):De(Ke,!1)},!0)}k(He,ot)};W(xt,He=>{o(),S(()=>o().layout==="numeric")?He(gt):He(St,!1)})}le(He=>se(be,He),[()=>S(()=>new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}))]),k(ye,P)};W(he,ye=>{o(),S(()=>o().isActive&&o().mode==="agent")&&ye(Ce)})}fn(Pe,ye=>h(g,ye),()=>t(g)),ae("scroll",Pe,()=>!t(I)&&F()),k(ve,_e)};W(fe,ve=>{i()==="agent"&&ve(me)},!0)}k(ce,de)};W(ee,ce=>{i()==="receipts"?ce(J):ce(te,!1)},!0)}k(E,z)};W(Ee,E=>{i()==="order"?E(Ae):E(oe,!1)})}k(e,U),Or(n,"scrollToBottom",A),Or(n,"cycleViews",Y),Or(n,"getIsAtBottom",G),Or(n,"displayLanguageSelector",B);var O=bt({scrollToBottom:A,cycleViews:Y,getIsAtBottom:G,displayLanguageSelector:B});return a(),O}const ja=wt(!1);function Wl(){ja.update(e=>!e)}function Jl(){ja.set(!1)}var Kl=j('<div class="pinpad-grid numeric svelte-l3qs12"><button class="numpad-key svelte-l3qs12">1</button> <button class="numpad-key svelte-l3qs12">2</button> <button class="numpad-key svelte-l3qs12">3</button> <button class="function-key key-cancel svelte-l3qs12" aria-label="Cancel">X</button> <button class="numpad-key svelte-l3qs12">4</button> <button class="numpad-key svelte-l3qs12">5</button> <button class="numpad-key svelte-l3qs12">6</button> <button class="function-key key-correct svelte-l3qs12" aria-label="Correct">←</button> <button class="numpad-key svelte-l3qs12">7</button> <button class="numpad-key svelte-l3qs12">8</button> <button class="numpad-key svelte-l3qs12">9</button> <button class="function-key key-enter svelte-l3qs12" aria-label="Enter">↵</button> <button class="numpad-key function-key key-plus svelte-l3qs12">.99</button> <button class="numpad-key svelte-l3qs12">0</button> <button class="numpad-key function-key key-minus svelte-l3qs12">.</button></div>'),Yl=j('<button class="alpha-key letter-key svelte-l3qs12"> </button>'),Xl=j('<div class="alpha-row svelte-l3qs12"></div>'),Ql=j('<div class="pinpad-grid alpha svelte-l3qs12"><!> <div class="alpha-bottom-row svelte-l3qs12"><button class="alpha-key space-key svelte-l3qs12" aria-label="Space">space</button> <button class="function-key cursor-key svelte-l3qs12" aria-label="Move cursor left">←</button> <button class="function-key cursor-key svelte-l3qs12" aria-label="Move cursor right">→</button> <button class="function-key language-key svelte-l3qs12" aria-label="Switch language"> </button> <button class="function-key key-cancel svelte-l3qs12" aria-label="Cancel">X</button> <button class="function-key key-correct svelte-l3qs12" aria-label="Backspace">⌫</button> <button class="function-key key-enter key-enter-large svelte-l3qs12" aria-label="Enter">↵</button></div></div>'),Zl=j('<div class="pinpad-wrapper svelte-l3qs12"><!></div>');function ec(e,n){_t(n,!1);const[r,a]=Tr(),s=()=>st(Qe,"$pinpadStore",r);let i=Oe(n,"onClose",8,()=>{}),l=Oe(n,"minButtonSize",8,160),c=V(0),o=V(0),u=V(80),y=V(107),g=V(50),T=V(50),m=null,x=null;const I=6;let N=V(0),L=V(null),q=V(null),p=V(null),D=V(null);function C(oe){Qe.append(oe,we)}function _(){Qe.backspace(we)}function v(){Qe.confirm()}function M(){Qe.cancel(we)}function X(){i()()}function B(oe){x=oe,m=setTimeout(()=>{x===oe&&(Qe.append(oe.toUpperCase(),we),x=null)},500)}function Q(){m&&(clearTimeout(m),m=null),x&&(Qe.append(x.toLowerCase(),we),x=null)}function F(){m&&(clearTimeout(m),m=null),x=null}function A(){Qe.moveCursorLeft()}function Y(){Qe.moveCursorRight()}function G(){Qe.switchLanguage()}Be(()=>(t(o),t(N),t(L)),()=>{t(o)>0&&Math.abs(t(o)-t(N))>5&&(t(L)&&clearTimeout(t(L)),h(L,setTimeout(()=>{h(N,t(o))},50)))}),Be(()=>(s(),t(N),t(q),t(p),t(D),H(l()),t(g),t(y)),()=>{const oe=s().layout,O=s().currentLanguage;if(t(N)>0&&(t(q)!==oe||t(p)!==O||t(D)!==l()||t(q)===null&&t(p)===null)){if(oe==="alpha"&&s().layouts&&O){const E=s().layouts[O],z=Math.max(...E.map(ce=>ce.length)),ee=t(N)-I*(z-1);let J=Math.floor(ee/z);const te=l();J>te&&(J=te),h(g,J),h(T,Math.floor(t(g)*(3/4)))}else if(oe==="numeric"){const z=t(N)-I*3;let ee=Math.floor(z/4);const J=l();ee>J&&(ee=J),h(y,ee),h(u,Math.floor(t(y)*(3/4)))}h(q,oe),h(p,O),h(D,l())}}),pn(),Mt();var U=Zl(),ke=f(U);{var Ee=oe=>{var O=Kl(),E=f(O),z=w(E,2),ee=w(z,2),J=w(ee,2),te=w(J,2),ce=w(te,2),de=w(ce,2),fe=w(de,2),me=w(fe,2),ve=w(me,2),_e=w(ve,2),pe=w(_e,2),Se=w(pe,2),Pe=w(Se,2),$e=w(Pe,2);le(()=>Sn(O,`--button-height: ${t(u)??""}px; --button-width: ${t(y)??""}px;`)),ae("click",E,()=>C("1")),ae("click",z,()=>C("2")),ae("click",ee,()=>C("3")),ae("click",J,M),ae("dblclick",J,X),ae("click",te,()=>C("4")),ae("click",ce,()=>C("5")),ae("click",de,()=>C("6")),ae("click",fe,_),ae("click",me,()=>C("7")),ae("click",ve,()=>C("8")),ae("click",_e,()=>C("9")),ae("click",pe,v),ae("click",Se,()=>C(".99")),ae("click",Pe,()=>C("0")),ae("click",$e,()=>C(".")),k(oe,O)},Ae=oe=>{var O=Ie(),E=xe(O);{var z=ee=>{var J=Ql(),te=f(J);Et(te,1,()=>(s(),S(()=>s().layouts[s().currentLanguage])),wr,($e,Re)=>{var he=Xl();Et(he,5,()=>t(Re),wr,(Ce,ye)=>{var P=Yl(),R=f(P);le(()=>{Ro(P,"aria-label",`Letter ${t(ye)??""}`),se(R,t(ye))}),ae("mousedown",P,()=>B(t(ye))),ae("mouseup",P,Q),ae("mouseleave",P,F),k(Ce,P)}),k($e,he)});var ce=w(te,2),de=f(ce),fe=w(de,2),me=w(fe,2),ve=w(me,2),_e=f(ve),pe=w(ve,2),Se=w(pe,2),Pe=w(Se,2);le(()=>{Sn(J,`--alpha-button-width: ${t(g)??""}px; --alpha-button-height: ${t(T)??""}px;`),se(_e,(s(),S(()=>s().currentLanguage)))}),ae("click",de,()=>C(" ")),ae("click",fe,A),ae("click",me,Y),ae("click",ve,G),ae("click",pe,M),ae("dblclick",pe,X),ae("click",Se,_),ae("click",Pe,v),k(ee,J)};W(E,ee=>{s(),S(()=>s().layout==="alpha")&&ee(z)},!0)}k(oe,O)};W(ke,oe=>{s(),S(()=>s().layout==="numeric")?oe(Ee):oe(Ae,!1)})}ss(U,"clientHeight",oe=>h(c,oe)),ss(U,"clientWidth",oe=>h(o,oe)),k(e,U),bt(),a()}var tc=j('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Description:</span> <span class="value svelte-yjty9j"> </span></div>'),nc=j('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Allergens:</span> <span class="value svelte-yjty9j"> </span></div>'),rc=j('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Dietary:</span> <span class="value svelte-yjty9j"> </span></div>'),ac=j('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Category:</span> <span class="value svelte-yjty9j"> </span></div>'),sc=j('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Status:</span> <span class="value svelte-yjty9j"> </span></div>'),ic=j('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Last Modified:</span> <span class="value svelte-yjty9j"> </span></div>'),oc=j('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Product ID:</span> <span class="value svelte-yjty9j"> </span></div>'),lc=j('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Price:</span> <span class="value svelte-yjty9j"> </span></div> <!> <!> <!> <!> <!> <!> <!>',1),cc=j('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Type:</span> <span class="value svelte-yjty9j"> </span></div>'),uc=j('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Category ID:</span> <span class="value svelte-yjty9j"> </span></div>'),dc=j('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Parent Category:</span> <span class="value svelte-yjty9j"> </span></div>'),fc=j('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Main Group:</span> <span class="value svelte-yjty9j"> </span></div>'),vc=j('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Source ID:</span> <span class="value svelte-yjty9j"> </span></div>'),pc=j("<!> <!> <!> <!> <!>",1),gc=j('<div class="context-menu svelte-yjty9j"><div class="menu-header svelte-yjty9j"><h3 class="svelte-yjty9j"><!></h3></div> <div class="menu-content svelte-yjty9j"><!></div> <div class="menu-footer svelte-yjty9j"><button class="edit-button svelte-yjty9j">Edit</button> <button class="advanced-edit-button svelte-yjty9j">View</button> <button class="close-button svelte-yjty9j">Close</button></div></div>');function mc(e,n){_t(n,!1);const r=V(),a=V(),s=V();let i=Oe(n,"item",8,null),l=Oe(n,"x",8,0),c=Oe(n,"y",8,0),o=Oe(n,"visible",8,!1);const u=Mn();let y=V(),g=V(0),T=V(0);tn(()=>{function v(X){t(y)&&!t(y).contains(X.target)&&u("close")}function M(X){X.key==="Escape"&&u("close")}return o()&&(document.addEventListener("click",v),document.addEventListener("keydown",M)),()=>{document.removeEventListener("click",v),document.removeEventListener("keydown",M)}});function m(v){return typeof v=="number"?`€${v.toFixed(2)}`:i()&&i().item_price_value&&typeof i().item_price_value=="number"?`€${i().item_price_value.toFixed(2)}`:v||"N/A"}function x(v){try{const M=JSON.parse(v);return M.menu?.de||M.button?.de||M.de||"Unnamed"}catch{return v||"Unnamed"}}function I(v){try{return JSON.parse(v).de||"Unnamed Category"}catch{return v||"Unnamed Category"}}function N(v){try{return JSON.parse(v)}catch{return{}}}function L(){if(!t(y))return;const v=t(y).getBoundingClientRect(),M=window.innerWidth,X=window.innerHeight;if(v.width===0||v.height===0){setTimeout(()=>L(),10);return}const B=10,Q=10,F=v.width>M-B*2,A=v.height>X-B*2;let Y,G;F&&A?(Y=B,G=B):F?(Y=B,G=c()+Q,G+v.height>X-B&&(G=c()-v.height-Q),G<B&&(G=B)):A?(G=B,Y=l()+Q,Y+v.width>M-B&&(Y=l()-v.width-Q),Y<B&&(Y=B)):(Y=l()+Q,G=c()+Q,Y+v.width>M-B&&(Y=l()-v.width-Q),G+v.height>X-B&&(G=c()-v.height-Q),Y<B&&(Y=B),G<B&&(G=B)),h(g,Y),h(T,G)}function q(){u("edit",{item:i()}),u("close")}function p(){u("advanced-edit",{item:i()}),u("close")}Be(()=>H(i()),()=>{h(r,i()&&i().category_names)}),Be(()=>H(i()),()=>{h(a,i()&&i().display_names)}),Be(()=>(t(a),H(i())),()=>{h(s,t(a)&&i().additional_item_attributes?N(i().additional_item_attributes):{})}),Be(()=>(H(o()),t(y)),()=>{o()&&t(y)&&requestAnimationFrame(()=>L())}),pn(),Mt();var D=Ie(),C=xe(D);{var _=v=>{var M=gc(),X=f(M),B=f(X),Q=f(B);{var F=E=>{var z=zt();le(ee=>se(z,ee),[()=>(H(i()),S(()=>I(i().category_names)))]),k(E,z)},A=E=>{var z=Ie(),ee=xe(z);{var J=ce=>{var de=zt();le(fe=>se(de,fe),[()=>(H(i()),S(()=>x(i().display_names)))]),k(ce,de)},te=ce=>{var de=zt("Item Details");k(ce,de)};W(ee,ce=>{t(a)?ce(J):ce(te,!1)},!0)}k(E,z)};W(Q,E=>{t(r)?E(F):E(A,!1)})}var Y=w(X,2),G=f(Y);{var U=E=>{var z=lc(),ee=xe(z),J=w(f(ee),2),te=f(J),ce=w(ee,2);{var de=P=>{var R=tc(),ue=w(f(R),2),be=f(ue);le(()=>se(be,(t(s),S(()=>t(s).description)))),k(P,R)};W(ce,P=>{t(s),S(()=>t(s).description)&&P(de)})}var fe=w(ce,2);{var me=P=>{var R=nc(),ue=w(f(R),2),be=f(ue);le(ze=>se(be,ze),[()=>(t(s),S(()=>t(s).allergens.join(", ")))]),k(P,R)};W(fe,P=>{t(s),S(()=>t(s).allergens&&t(s).allergens.length>0)&&P(me)})}var ve=w(fe,2);{var _e=P=>{var R=rc(),ue=w(f(R),2),be=f(ue);le(ze=>se(be,ze),[()=>(t(s),S(()=>t(s).dietary_info.join(", ")))]),k(P,R)};W(ve,P=>{t(s),S(()=>t(s).dietary_info&&t(s).dietary_info.length>0)&&P(_e)})}var pe=w(ve,2);{var Se=P=>{var R=ac(),ue=w(f(R),2),be=f(ue);le(()=>se(be,(H(i()),S(()=>i().associated_category_unique_identifier)))),k(P,R)};W(pe,P=>{H(i()),S(()=>i().associated_category_unique_identifier)&&P(Se)})}var Pe=w(pe,2);{var $e=P=>{var R=sc(),ue=w(f(R),2),be=f(ue);le(()=>se(be,(H(i()),S(()=>i().item_flags.is_sellable?"Available":"Not Available")))),k(P,R)};W(Pe,P=>{H(i()),S(()=>i().item_flags&&i().item_flags.is_sellable!==void 0)&&P($e)})}var Re=w(Pe,2);{var he=P=>{var R=ic(),ue=w(f(R),2),be=f(ue);le(ze=>se(be,ze),[()=>(H(i()),S(()=>new Date(i().audit_trail.updated_at||i().audit_trail.created_at).toLocaleDateString()))]),k(P,R)};W(Re,P=>{H(i()),S(()=>i().audit_trail)&&P(he)})}var Ce=w(Re,2);{var ye=P=>{var R=oc(),ue=w(f(R),2),be=f(ue);le(()=>se(be,(H(i()),S(()=>i().id)))),k(P,R)};W(Ce,P=>{H(i()),S(()=>i().id)&&P(ye)})}le(P=>se(te,P),[()=>(H(i()),S(()=>m(i().item_price_value)))]),k(E,z)},ke=E=>{var z=Ie(),ee=xe(z);{var J=te=>{var ce=pc(),de=xe(ce);{var fe=he=>{var Ce=cc(),ye=w(f(Ce),2),P=f(ye);le(()=>se(P,(H(i()),S(()=>i().category_type)))),k(he,Ce)};W(de,he=>{H(i()),S(()=>i().category_type)&&he(fe)})}var me=w(de,2);{var ve=he=>{var Ce=uc(),ye=w(f(Ce),2),P=f(ye);le(()=>se(P,(H(i()),S(()=>i().id)))),k(he,Ce)};W(me,he=>{H(i()),S(()=>i().id)&&he(ve)})}var _e=w(me,2);{var pe=he=>{var Ce=dc(),ye=w(f(Ce),2),P=f(ye);le(()=>se(P,(H(i()),S(()=>i().parent_category_unique_identifier)))),k(he,Ce)};W(_e,he=>{H(i()),S(()=>i().parent_category_unique_identifier)&&he(pe)})}var Se=w(_e,2);{var Pe=he=>{var Ce=fc(),ye=w(f(Ce),2),P=f(ye);le(()=>se(P,(H(i()),S(()=>i().default_linked_main_group_unique_identifier)))),k(he,Ce)};W(Se,he=>{H(i()),S(()=>i().default_linked_main_group_unique_identifier)&&he(Pe)})}var $e=w(Se,2);{var Re=he=>{var Ce=vc(),ye=w(f(Ce),2),P=f(ye);le(()=>se(P,(H(i()),S(()=>i().source_unique_identifier)))),k(he,Ce)};W($e,he=>{H(i()),S(()=>i().source_unique_identifier)&&he(Re)})}k(te,ce)};W(ee,te=>{t(r)&&te(J)},!0)}k(E,z)};W(G,E=>{t(a)?E(U):E(ke,!1)})}var Ee=w(Y,2),Ae=f(Ee),oe=w(Ae,2),O=w(oe,2);fn(M,E=>h(y,E),()=>t(y)),le(()=>Sn(M,`left: ${(t(g)||l())??""}px; top: ${(t(T)||c())??""}px;`)),ae("click",Ae,()=>q()),ae("click",oe,()=>p()),ae("click",O,()=>u("close")),k(v,M)};W(C,v=>{o()&&i()&&v(_)})}k(e,D),bt()}var hc=j('<span class="error-message svelte-eqo6fo"> </span>'),yc=j('<span class="error-message svelte-eqo6fo"> </span>'),_c=j('<span class="error-message svelte-eqo6fo"> </span>'),bc=j('<span class="error-message svelte-eqo6fo"> </span>'),wc=j('<span class="error-message svelte-eqo6fo"> </span>'),xc=j('<div class="modal-overlay svelte-eqo6fo" role="dialog" tabindex="-1"><div class="modal-content svelte-eqo6fo"><div class="modal-header svelte-eqo6fo"><h2 class="svelte-eqo6fo">Edit Product</h2> <button class="close-button svelte-eqo6fo" aria-label="Close">×</button></div> <form class="product-form svelte-eqo6fo"><div class="form-group svelte-eqo6fo"><label for="product-name-menu" class="svelte-eqo6fo">Name (Menu)</label> <input id="product-name-menu" type="text" placeholder="Enter menu name"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-name-button" class="svelte-eqo6fo">Name (Button)</label> <input id="product-name-button" type="text" placeholder="Enter button name"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-name-receipt" class="svelte-eqo6fo">Name (Receipt)</label> <input id="product-name-receipt" type="text" placeholder="Enter receipt name"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-price" class="svelte-eqo6fo">Price (€)</label> <input id="product-price" type="number" step="0.01" min="0" placeholder="0.00"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-category" class="svelte-eqo6fo">Category</label> <input id="product-category" type="text" placeholder="Enter category name"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-description" class="svelte-eqo6fo">Description</label> <textarea id="product-description" placeholder="Enter product description (optional)" rows="3" class="svelte-eqo6fo"></textarea></div> <div class="form-actions svelte-eqo6fo"><button type="button" class="btn-cancel svelte-eqo6fo">Cancel</button> <button type="submit" class="btn-save svelte-eqo6fo"><!></button></div></form></div></div>');function Sc(e,n){_t(n,!1);const r=Mn();let a=Oe(n,"visible",8,!1),s=Oe(n,"product",8,null),i=V({name_menu:"",name_button:"",name_receipt:"",price:"",categoryName:"",description:""}),l=V({}),c=V(!1),o=V(!1),u=V({});function y(p){if(typeof p=="object"&&p!==null)return p;if(typeof p=="string")try{return JSON.parse(p)}catch{return p}return p}function g(){if(h(u,{}),t(i).name_menu.trim()||qe(u,t(u).name_menu="Menu name is required"),t(i).name_button.trim()||qe(u,t(u).name_button="Button name is required"),t(i).name_receipt.trim()||qe(u,t(u).name_receipt="Receipt name is required"),!t(i).price.trim())qe(u,t(u).price="Price is required");else{const p=parseFloat(t(i).price);(isNaN(p)||p<0)&&qe(u,t(u).price="Price must be a valid positive number")}return t(i).categoryName.trim()||qe(u,t(u).categoryName="Category is required"),Object.keys(t(u)).length===0}async function T(){if(g()){h(o,!0);try{const p={};t(i).name_menu!==t(l).name_menu&&(p.name_menu=t(i).name_menu.trim()),t(i).name_button!==t(l).name_button&&(p.name_button=t(i).name_button.trim()),t(i).name_receipt!==t(l).name_receipt&&(p.name_receipt=t(i).name_receipt.trim()),t(i).price!==t(l).price&&(p.price=parseFloat(t(i).price)),t(i).categoryName!==t(l).categoryName&&(p.categoryName=t(i).categoryName.trim()),t(i).description!==t(l).description&&(p.description=t(i).description.trim()),Object.keys(p).length>0&&r("save",{productId:s().id,updates:p}),m()}catch(p){console.error("Error saving product:",p)}finally{h(o,!1)}}}function m(){r("close")}function x(p){p.target===p.currentTarget&&m()}function I(p){p.key==="Escape"&&m()}Be(()=>(H(s()),H(a()),t(i)),()=>{if(s()&&a()){const p=s().display_names?y(s().display_names):{},D=p.menu?.de||s().name||"",C=p.button?.de||p.menu?.de||s().name||"",_=p.receipt?.de||p.menu?.de||s().name||"";let v="Unknown Category";s().category_name?v=s().category_name:s().categoryName?v=s().categoryName:v=`Category ID: ${s().associated_category_unique_identifier||"N/A"}`,h(i,{name_menu:D,name_button:C,name_receipt:_,price:(s().item_price_value||s().price||0).toString(),categoryName:v,description:s().description||D}),h(l,{...t(i)}),h(c,!1),h(u,{})}}),Be(()=>(H(a()),t(i),t(l)),()=>{h(c,a()&&(t(i).name_menu!==t(l).name_menu||t(i).name_button!==t(l).name_button||t(i).name_receipt!==t(l).name_receipt||t(i).price!==t(l).price||t(i).categoryName!==t(l).categoryName||t(i).description!==t(l).description))}),pn(),Mt();var N=Ie();ae("keydown",_r,I);var L=xe(N);{var q=p=>{var D=xc(),C=f(D),_=f(C),v=w(f(_),2),M=w(_,2),X=f(M),B=w(f(X),2);let Q;var F=w(B,2);{var A=R=>{var ue=hc(),be=f(ue);le(()=>se(be,(t(u),S(()=>t(u).name_menu)))),k(R,ue)};W(F,R=>{t(u),S(()=>t(u).name_menu)&&R(A)})}var Y=w(X,2),G=w(f(Y),2);let U;var ke=w(G,2);{var Ee=R=>{var ue=yc(),be=f(ue);le(()=>se(be,(t(u),S(()=>t(u).name_button)))),k(R,ue)};W(ke,R=>{t(u),S(()=>t(u).name_button)&&R(Ee)})}var Ae=w(Y,2),oe=w(f(Ae),2);let O;var E=w(oe,2);{var z=R=>{var ue=_c(),be=f(ue);le(()=>se(be,(t(u),S(()=>t(u).name_receipt)))),k(R,ue)};W(E,R=>{t(u),S(()=>t(u).name_receipt)&&R(z)})}var ee=w(Ae,2),J=w(f(ee),2);let te;var ce=w(J,2);{var de=R=>{var ue=bc(),be=f(ue);le(()=>se(be,(t(u),S(()=>t(u).price)))),k(R,ue)};W(ce,R=>{t(u),S(()=>t(u).price)&&R(de)})}var fe=w(ee,2),me=w(f(fe),2);let ve;var _e=w(me,2);{var pe=R=>{var ue=wc(),be=f(ue);le(()=>se(be,(t(u),S(()=>t(u).categoryName)))),k(R,ue)};W(_e,R=>{t(u),S(()=>t(u).categoryName)&&R(pe)})}var Se=w(fe,2),Pe=w(f(Se),2),$e=w(Se,2),Re=f($e),he=w(Re,2),Ce=f(he);{var ye=R=>{var ue=zt("Saving...");k(R,ue)},P=R=>{var ue=zt("Save Changes");k(R,ue)};W(Ce,R=>{t(o)?R(ye):R(P,!1)})}le((R,ue,be,ze,xt,gt)=>{B.disabled=t(o),Q=Ze(B,1,"svelte-eqo6fo",null,Q,R),G.disabled=t(o),U=Ze(G,1,"svelte-eqo6fo",null,U,ue),oe.disabled=t(o),O=Ze(oe,1,"svelte-eqo6fo",null,O,be),J.disabled=t(o),te=Ze(J,1,"svelte-eqo6fo",null,te,ze),me.disabled=t(o),ve=Ze(me,1,"svelte-eqo6fo",null,ve,xt),Pe.disabled=t(o),Re.disabled=t(o),he.disabled=gt},[()=>({error:t(u).name_menu}),()=>({error:t(u).name_button}),()=>({error:t(u).name_receipt}),()=>({error:t(u).price}),()=>({error:t(u).categoryName}),()=>(t(c),t(o),t(u),S(()=>!t(c)||t(o)||Object.keys(t(u)).length>0))]),ae("click",v,m),Xt(B,()=>t(i).name_menu,R=>qe(i,t(i).name_menu=R)),Xt(G,()=>t(i).name_button,R=>qe(i,t(i).name_button=R)),Xt(oe,()=>t(i).name_receipt,R=>qe(i,t(i).name_receipt=R)),Xt(J,()=>t(i).price,R=>qe(i,t(i).price=R)),Xt(me,()=>t(i).categoryName,R=>qe(i,t(i).categoryName=R)),Xt(Pe,()=>t(i).description,R=>qe(i,t(i).description=R)),ae("click",Re,m),ae("submit",M,Qs(T)),ae("click",D,x),ae("keydown",D,I),k(p,D)};W(L,p=>{a()&&s()&&p(q)})}k(e,N),bt()}var kc=j('<div class="modal-overlay svelte-3d9wpg"><div class="modal-content svelte-3d9wpg"><div class="modal-header svelte-3d9wpg"><h2 class="svelte-3d9wpg">Edit Category</h2> <button class="close-button svelte-3d9wpg">×</button></div> <form class="product-form svelte-3d9wpg"><div class="form-group svelte-3d9wpg"><label for="category-name" class="svelte-3d9wpg">Category Name</label> <input id="category-name" type="text" class="svelte-3d9wpg"/></div> <div class="form-group svelte-3d9wpg"><label for="category-type" class="svelte-3d9wpg">Category Type</label> <select id="category-type" class="svelte-3d9wpg"><option>Food</option><option>Drink</option><option>Other</option></select></div> <div class="form-actions svelte-3d9wpg"><button type="button" class="btn-cancel svelte-3d9wpg">Cancel</button> <button type="submit" class="btn-save svelte-3d9wpg"> </button></div></form></div></div>');function Cc(e,n){_t(n,!1);let r=Oe(n,"visible",8,!1),a=Oe(n,"category",8,null);const s=Mn();let i=V({name:"",type:"food"}),l=V({}),c=V(!1);async function o(){if(!t(i).name.trim()){alert("Category name is required.");return}h(c,!0);const I={};t(i).name!==t(l).name&&(I.name=t(i).name.trim()),t(i).type!==t(l).type&&(I.type=t(i).type),Object.keys(I).length>0&&s("save",{categoryId:a().id,updates:I}),u()}function u(){h(c,!1),s("close")}function y(I){I.target===I.currentTarget&&u()}function g(I){I.key==="Escape"&&u()}Be(()=>(H(a()),H(r()),t(i)),()=>{if(a()&&r()){const I=JSON.parse(a().category_names||"{}");h(i,{name:I.de||"",type:a().category_type||"food"}),h(l,{...t(i)})}}),pn(),Mt();var T=Ie();ae("keydown",_r,g);var m=xe(T);{var x=I=>{var N=kc(),L=f(N),q=f(L),p=w(f(q),2),D=w(q,2),C=f(D),_=w(f(C),2),v=w(C,2),M=w(f(v),2);le(()=>{t(i),Us(()=>{t(c)})});var X=f(M);X.value=X.__value="food";var B=w(X);B.value=B.__value="drink";var Q=w(B);Q.value=Q.__value="other";var F=w(v,2),A=f(F),Y=w(A,2),G=f(Y);le(()=>{_.disabled=t(c),M.disabled=t(c),A.disabled=t(c),Y.disabled=t(c),se(G,t(c)?"Saving...":"Save Changes")}),ae("click",p,u),Xt(_,()=>t(i).name,U=>qe(i,t(i).name=U)),Ys(M,()=>t(i).type,U=>qe(i,t(i).type=U)),ae("click",A,u),ae("submit",D,Qs(o)),ae("click",N,y),k(I,N)};W(m,I=>{r()&&a()&&I(x)})}k(e,T),bt()}var Tc=Da(`<svg viewBox="-10 -10 120 120" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%;"><defs><filter height="170%" id="sh2" width="170%" x="-0.2" y="-0.2"><feOffset dx="0" dy="0" in="SourceAlpha"></feOffset><feGaussianBlur stdDeviation="1.2"></feGaussianBlur><feColorMatrix result="out" type="matrix" values=" 
               0 0 0 0 0.2         
               0 0 0 0 0.2                    
               0 0 0 0 0.2                
               0 0 0 10 0 "></feColorMatrix><feMerge><feMergeNode in="out"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter></defs><g filter="url(#sh2)"><path fill="#2c2c2e" stroke="#666" stroke-width="1.5" d="M72,89 C78.6,68 67.2,30.7 89,68 C86.9,37.6 66.91,32 62,61 C58,44.1 67.5,38.8 52,10 C53.6,47 46.91,36.2 45,61 C39.3,43.4 22,46.6 13,43 C32.9,55.8 35.7,66.62 32,89 C35,97.9 68.6,99 72,89 Z"></path><circle fill="#2c2c2e" stroke="#666" stroke-width="1.5" cx="13" cy="43" r="5.5"></circle><circle fill="#2c2c2e" stroke="#666" stroke-width="1.5" cx="52" cy="10" r="5.5"></circle><circle fill="#2c2c2e" stroke="#666" stroke-width="1.5" cx="89" cy="68" r="5.5"></circle></g></svg>`);function us(e){var n=Tc();k(e,n)}var Ec=Da('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 96" fill="none" class="svelte-1cmb9l6"><rect x="0" y="0" width="128" height="96" rx="8" ry="8" fill="#2A2A2A" stroke="none"></rect><g><rect x="7" y="6" width="34" height="24" rx="3" fill="#3A3A3A" stroke="#555555" stroke-width="0.5"></rect><text x="24" y="19" font-family="Arial, sans-serif" font-size="14" font-weight="600" text-anchor="middle" dominant-baseline="middle" fill="#BBBBBB">1</text><rect x="47" y="6" width="34" height="24" rx="3" fill="#3A3A3A" stroke="#555555" stroke-width="0.5"></rect><text x="64" y="19" font-family="Arial, sans-serif" font-size="14" font-weight="600" text-anchor="middle" dominant-baseline="middle" fill="#BBBBBB">2</text><rect x="87" y="6" width="34" height="24" rx="3" fill="#883333" stroke="#555555" stroke-width="0.5"></rect><text x="104" y="19" font-family="Arial, sans-serif" font-size="14" font-weight="600" text-anchor="middle" dominant-baseline="middle" fill="#BBBBBB">3</text><rect x="7" y="36" width="34" height="24" rx="3" fill="#3A3A3A" stroke="#555555" stroke-width="0.5"></rect><text x="24" y="49" font-family="Arial, sans-serif" font-size="14" font-weight="600" text-anchor="middle" dominant-baseline="middle" fill="#BBBBBB">4</text><rect x="47" y="36" width="34" height="24" rx="3" fill="#3A3A3A" stroke="#555555" stroke-width="0.5"></rect><text x="64" y="49" font-family="Arial, sans-serif" font-size="14" font-weight="600" text-anchor="middle" dominant-baseline="middle" fill="#BBBBBB">5</text><rect x="87" y="36" width="34" height="24" rx="3" fill="#885533" stroke="#555555" stroke-width="0.5"></rect><text x="104" y="49" font-family="Arial, sans-serif" font-size="14" font-weight="600" text-anchor="middle" dominant-baseline="middle" fill="#BBBBBB">6</text><rect x="7" y="66" width="34" height="24" rx="3" fill="#3A3A3A" stroke="#555555" stroke-width="0.5"></rect><text x="24" y="79" font-family="Arial, sans-serif" font-size="14" font-weight="600" text-anchor="middle" dominant-baseline="middle" fill="#BBBBBB">7</text><rect x="47" y="66" width="34" height="24" rx="3" fill="#3A3A3A" stroke="#555555" stroke-width="0.5"></rect><text x="64" y="79" font-family="Arial, sans-serif" font-size="14" font-weight="600" text-anchor="middle" dominant-baseline="middle" fill="#BBBBBB">8</text><rect x="87" y="66" width="34" height="24" rx="3" fill="#385b4a" stroke="#555555" stroke-width="0.5"></rect><text x="104" y="79" font-family="Arial, sans-serif" font-size="14" font-weight="600" text-anchor="middle" dominant-baseline="middle" fill="#BBBBBB">9</text></g></svg>');function ds(e){var n=Ec();k(e,n)}class Ic{constructor(n,r,a=!0){this.row=n,this.col=r,this.content=null,this.isEmpty=!0,this.isUsable=a,this.priority=0,this.id=`slot-${n}-${r}`}setContent(n,r=1){this.content=n,this.isEmpty=!1,this.priority=r}clearContent(){this.content=null,this.isEmpty=!0,this.priority=0}}class Mc{constructor(n,r){this.rows=n,this.cols=r,this.slots=[],this.contentSlots=[],this.initializeGrid()}initializeGrid(){for(let n=0;n<this.rows;n++){const r=[];for(let a=0;a<this.cols;a++){const s=n%2!==a%2,i=new Ic(n,a,s);r.push(i),this.contentSlots.push(i)}this.slots.push(r)}}getSlot(n,r){return n>=0&&n<this.rows&&r>=0&&r<this.cols?this.slots[n][r]:null}getAllSlots(){return this.contentSlots}getUsableEmptySlots(){return this.contentSlots.filter(n=>n.isUsable&&n.isEmpty)}getUsableFilledSlots(){return this.contentSlots.filter(n=>n.isUsable&&!n.isEmpty)}getUsableSlots(){return this.contentSlots.filter(n=>n.isUsable)}placeContentAt(n,r,a,s){const i=this.getSlot(n,r);return i&&i.isUsable&&(i.isEmpty||s>i.priority)?(i.setContent(a,s),!0):!1}clearAllContent(){this.contentSlots.forEach(n=>{n.clearContent()})}getPrioritizedSlots(){return this.contentSlots.filter(n=>n.isUsable).sort((n,r)=>r.priority-n.priority)}}function Ac(e,n,r){const{cellWidth:a=120,cellHeight:s=80,buttonGap:i=6,hexOffset:l=.5,shape:c="hex"}=r;return c==="hex"?$c(e,n,a,s,i):Rc(e,n,a,s,i)}function $c(e,n,r,a,s,i){const l=n%2===1,c=Math.floor(n/2),o=c*(r+s)+(l?(r+s)/2:0),u=a*.75,y=e*(u+s);return console.log(`🔮 [hexPositioning] row=${e}, col=${n}, isOddCol=${l}, visualCol=${c}, x=${o}, y=${y}, gap=${s}`),{x:o,y}}function Rc(e,n,r,a,s){const i=n*(r+s),l=e*(a+s);return console.log(`🔮 [rectPositioning] row=${e}, col=${n}, x=${i}, y=${l}, gap=${s}`),{x:i,y:l}}function Pc(e){return e?`transform: translate(${e.x}px, ${e.y}px)`:"transform: translate(0px, 0px)"}class Oc{constructor(n,r,a){this.id=n,this.type=r,this.logicalPosition=a,this.content=null,this.cssPosition=null,this.cssTransform=null,this.geometryMetadata={}}setContent(n){this.content=n}calculatePhysicalPosition(n){return this.cssPosition=Ac(this.logicalPosition.row,this.logicalPosition.col,n),this.cssTransform=Pc(this.cssPosition),this.cssPosition}}class Nc{constructor(n={}){this.options={shape:"hex",cellWidth:n.cellWidth||120,cellHeight:n.cellHeight||80,buttonGap:n.buttonGap||6,...n}}renderContentGrid(n){const r=[],a=n.getUsableFilledSlots();for(const s of a){const i=new Oc(`full-slot-${s.row}-${s.col}`,"full",{row:s.row,col:s.col});i.setContent(s.content),i.geometryMetadata.priority=s.priority,i.calculatePhysicalPosition(this.options),r.push(i)}return r}}function fs(e={}){return new Nc(e)}const vs={MAX_CONTENT:100,PAYMENT_BUTTON:90,TABLE_BUTTON:85,PINPAD_BUTTON:80,CATEGORY_NAVIGATION:70,DEFAULT:50,MIN:1};class Dc{constructor(n={}){this.config={dimensions:{rows:4,cols:12},rendering:{shape:"hex",cellWidth:120,cellHeight:80},...n},this.contentGrid=new Mc(this.config.dimensions.rows,this.config.dimensions.cols),this.geometryRenderer=fs(this.config.rendering),this.renderCache=null,this.isDirty=!0,console.log("🎯 [GridManager] Initialized ContentGrid",this.config.dimensions)}clearAndReset(){this.contentGrid.clearAllContent(),this.markDirty()}placeItems(n,r=vs.DEFAULT,a=1/0){if(!n||n.length===0)return[];const s=this.contentGrid.getUsableEmptySlots();let i=0;const l=[];n.sort((c,o)=>(c.order_index||0)-(o.order_index||0));for(const c of n){if(i>=a)break;const o=s[i];o&&(o.setContent(c,r),i++,l.push({item:c,placed:!0,slot:o}))}return this.markDirty(),l}placeSystemElements(n){const r=[];for(const a of n){const s=this.contentGrid.placeContentAt(a.row,a.col,a.content,a.priority);r.push({element:a,placed:s})}return this.markDirty(),r}getRenderStructure(){return this.renderCache&&!this.isDirty?this.renderCache:(this.contentGrid.getUsableFilledSlots(),this.renderCache=this.geometryRenderer.renderContentGrid(this.contentGrid),this.isDirty=!1,this.renderCache)}getSvelteCompatibleCells(n){return this.geometryRenderer=fs(n),this.getRenderStructure().map(a=>({...a,cssTransform:a.cssTransform,data:a.content.data||a.content,label:a.content.label||a.content.category_names?.de||a.content.display_names?.button?.de}))}getDebugInfo(){return this.contentGrid.getDebugInfo()}getUsableSlotCount(){return this.contentGrid.getUsableSlots().length}markDirty(){this.isDirty=!0}getPriorities(){return vs}}var Bc=j("<div><div><!></div></div>"),Lc=j('<p class="status-message svelte-lb1vpy"> </p>'),Fc=j('<div class="empty-category-info svelte-lb1vpy"><p class="empty-message svelte-lb1vpy">Diese Kategorie enthält noch keine Produkte.</p> <p class="empty-hint svelte-lb1vpy">Verwenden Sie das Menü-Import Tool oder fügen Sie Produkte manuell hinzu.</p></div>'),Uc=j("<div></div>"),jc=j('<div class="quantum-button svelte-lb1vpy"><!></div>'),qc=j("<div><!> <!> <!></div>"),zc=j('<div class="selection-area svelte-lb1vpy"><!> <!> <!> <!> <div class="grid-container svelte-lb1vpy"><!></div></div>');function Vc(e,n){_t(n,!1);const[r,a]=Tr(),s=()=>st(kn,"$authStore",r),i=()=>st(Wn,"$notificationStore",r),l=()=>st(ti,"$uiConstantsStore",r),c=()=>st(tt,"$orderStore",r),o=()=>st(Qe,"$pinpadStore",r),u=()=>st(Go,"$currentMinuteTime",r),y=V();let g=V([]),T=V([]),m=V("Connecting to backend..."),x=!1,I=V("categories"),N=null,L=V("6-6-6"),q=V(!1),p=V(null),D=V(0),C=V(0),_=V(!1),v=V(null),M=V(!1),X=V(null),B=V(0);Oe(n,"isAtBottom",8,!1),Oe(n,"consoleViewComponent",8,null);let Q=V(0),F=V([]),A=V(null),Y=V([]),G=Oe(n,"handleSmartAction",8,()=>{}),U=V(null),ke=V(null);const Ee=6,Ae=6,oe=6,O=6;let E=V(t(y)),z=V(t(y)*.866),ee=V(t(y)),J=V(t(y)),te=1,ce=V(1),de="symmetrical",fe=V(),me,ve,_e=!1,pe;function Se(d){if(!d)return{};if(typeof d=="string")try{return JSON.parse(d)}catch{return{}}return d}function Pe(d){if(!d)return"Login";const b=d.split(" ");let ie;if(b.length===1)ie=b[0].length>12?b[0].substring(0,12)+"...":b[0];else if(b.length===2){const Z=b[0].length>8?b[0].substring(0,8)+".":b[0],ne=b[1].length>8?b[1].substring(0,8)+".":b[1];ie=`${Z} ${ne}`}else{const Z=b[0].length>6?b[0].substring(0,6)+".":b[0],ne=b[b.length-1].length>6?b[b.length-1].substring(0,6)+".":b[b.length-1];ie=`${Z} ${ne}`}return`Angemeldet als
${ie}`}function $e(){pe&&clearInterval(pe),pe=setInterval(()=>{const d=new Date;new Date(d.getFullYear(),d.getMonth(),d.getDate(),d.getHours(),d.getMinutes()+1,0,0),xr.update(b=>({...b,time:d})),ye()},6e4),ye()}Ua(()=>{pe&&clearInterval(pe)});function Re(d,b,ie,Z,ne,re,Nt=!1){const Xe=d,Ge=b-2*re;function Jt($){const ut=(Xe-($+1)*ne)/$;if(ut<ie)return null;let yn=ut*Z*.75+ne,Ue=Math.floor(Ge/yn),Rn=(Ge-(Ue-1)*ne)/(1+(Ue-1)*.75);const Kt=ut*(Z*.7);let Je;Rn>=Kt&&Ue>0?Je=Ue:Je=Math.max(1,Ue-1);let kt;return Nt?Je>0?kt=(Ge-(Je-1)*ne)/(1+(Je-1)*.75):kt=Math.max(Ge,Kt):Je>0?kt=(Ge-(Je-1)*ne)/Je:kt=Math.max(Ge,Kt),{columns:$,rows:Je,buttonWidth:ut,buttonHeight:kt,layout:"symmetrical"}}function $n($){const ut=(Xe-($+1)*ne)/($+.5);if(ut<ie)return null;let yn=ut*Z*.75+ne,Ue=Math.floor(Ge/yn),Rn=(Ge-(Ue-1)*ne)/(1+(Ue-1)*.75);const Kt=ut*(Z*.7);let Je;Rn>=Kt&&Ue>0?Je=Ue:Je=Math.max(1,Ue-1);let kt;return Nt?Je>0?kt=(Ge-(Je-1)*ne)/(1+(Je-1)*.75):kt=Math.max(Ge,Kt):Je>0?kt=(Ge-(Je-1)*ne)/Je:kt=Math.max(Ge,Kt),{columns:$,rows:Je,buttonWidth:ut,buttonHeight:kt,layout:"asymmetrical"}}let rt=null,ct=Math.floor((Xe-ne)/ie);for(let $=1;$<=ct;$++){const ut=Jt($),or=$n($),yn=[ut,or].filter(Ue=>Ue!==null);for(const Ue of yn)rt?(Ue.columns>rt.columns||Ue.columns===rt.columns&&(Ue.layout==="asymmetrical"&&rt.layout==="symmetrical"||Ue.buttonWidth>rt.buttonWidth))&&(rt=Ue):rt=Ue}return rt||{columns:1,rows:1,buttonWidth:Math.max(ie,Xe-2*ne),buttonHeight:Math.max(ie,Ge),layout:"symmetrical"}}function he(){if(!(t(B)<=0||t(Q)<=0)){if(t(L)==="6-6-6"){const d=Re(t(B),t(Q),t(y),.75,Ee,oe,!0);te=d.columns,h(ce,d.rows),h(E,d.buttonWidth),h(z,d.buttonHeight),de=d.layout,te>0&&t(ce)>0&&(h(F,be()),Ce())}else if(t(L)==="4-4-4"){const d=Re(t(B),t(Q),t(y),.75,Ae,O,!1);rectItemsPerRow=d.columns,rectTotalRows=d.rows,h(ee,d.buttonWidth),h(J,d.buttonHeight),de=d.layout,rectItemsPerRow>0&&rectTotalRows>0&&(h(F,be()),Ce())}t(F).length>0&&ye()}}function Ce(){const d=t(L)==="6-6-6"?te:rectItemsPerRow,b=t(L)==="6-6-6"?t(ce):rectTotalRows,ie=t(L)==="6-6-6"?t(E):t(ee),Z=t(L)==="6-6-6"?t(z):t(J),ne=d-1;h(A,new Dc({dimensions:{rows:b,cols:ne},rendering:{shape:t(L)==="6-6-6"?"hex":"rect",cellWidth:ie,cellHeight:Z}})),R()}function ye(){P(),R()}function P(){if(t(F).length!==0){if(t(F).forEach(d=>{d.type.includes("half")&&(d.content=null)}),ue(t(F)),t(I)==="products"){const d=t(F).filter(b=>(b.type==="left-half"||b.type==="left-half-rect")&&!b.content);if(d.length>0){d.sort((ie,Z)=>ie.rowIndex-Z.rowIndex);const b=d[0];b.content={isBackButton:!0,icon:"←"}}}h(F,[...t(F)])}}function R(){if(!t(A))return;t(A).clearAndReset();const d=t(A).getPriorities();if(c()&&c().items&&c().items.length>0){const ie=[{row:t(ce)-1,col:0,content:{type:"bar",label:"Bar",onClick:()=>lt("cash")},priority:d.PAYMENT_BUTTON},{row:t(ce)-1,col:1,content:{type:"karte",label:"Karte",onClick:()=>lt("card")},priority:d.PAYMENT_BUTTON}];t(A).placeSystemElements(ie)}const b=[{row:t(ce)-1,col:Math.floor((t(L)==="6-6-6"?te:rectItemsPerRow)/2),content:{type:"pinpad",label:"Pinpad"},priority:d.PINPAD_BUTTON}];t(A).placeSystemElements(b),t(I)==="categories"?t(A).placeItems(t(g),d.CATEGORY_NAVIGATION):t(I)==="products"&&t(A).placeItems(t(T),d.MAX_CONTENT),h(Y,t(A).getSvelteCompatibleCells(t(A).config.rendering))}function ue(d){const b=d.filter(Z=>Z.type==="left-half"||Z.type==="left-half-rect");if(b.length>0){if(b.sort((ne,re)=>ne.rowIndex-re.rowIndex),b.length>1){const ne=b[1];ne.content={isUserButton:!0}}b.sort((ne,re)=>re.rowIndex-ne.rowIndex);const Z=b[0];Z.content={isSmartNavigation:!0}}const ie=d.filter(Z=>Z.type==="right-half"||Z.type==="right-half-rect");if(ie.length>0){if(ie.sort((Z,ne)=>Z.rowIndex-ne.rowIndex),ie[0]){const Z=o().currentLanguage,re=(t(L)==="6-6-6"?"rect":"hex")==="rect"?`<svg width="50" height="50" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
            <rect x="2" y="5" width="46" height="40" rx="2" stroke="#666" stroke-width="1.5" fill="none"/>
            <text x="25" y="25" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" dominant-baseline="middle" fill="#666">${Z}</text>
          </svg>`:`<svg width="50" height="50" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
            <polygon points="25,2 47.99,12.5 47.99,37.5 25,48 2.01,37.5 2.01,12.5" stroke="#666" stroke-width="1.5" fill="none"/>
            <text x="25" y="25" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" dominant-baseline="middle" fill="#666">${Z}</text>
          </svg>`;ie[0].content={isLayoutToggle:!0,icon:re,showShape:""}}ie[1]&&(ie[1].content={isBetrugerCap:!0}),ie[2]&&(ie[2].content={isKeyboardToggle:!0,icon:`<svg width="72" height="72" viewBox="0 0 24 24" fill="#404040">
            <path d="M20 5H4c-1.1 0-1.99.9-1.99 2L2 17c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm-9 3h2v2h-2V8zm0 3h2v2h-2v-2zM8 8h2v2H8V8zm0 3h2v2H8v-2zm-1 2H5v-2h2v2zm0-3H5V8h2v2zm9 7H8v-2h8v2zm0-4h-2v-2h2v2zm0-3h-2V8h2v2zm3 3h-2v-2h2v2zm0-3h-2V8h2v2z"/>
          </svg>`,color:"#404040",textColor:"#666"}),ie.length>1&&(ie[ie.length-1].content={isTimeButton:!0})}}function be(){const d=[];if(t(L)==="6-6-6")for(let b=0;b<t(ce);b++)ze(d,b,de);else t(L)==="4-4-4"&&xt(d,de);return d}function ze(d,b,ie){const Z=b%2===1;if(ie==="symmetrical"){const ne=Z?te:te-1;if(ne<0)return;if(Z)for(let re=0;re<ne;re++)d.push({id:`full-${b}-${re}`,type:"full",content:null,rowIndex:b,columnIndex:re});else{d.push({id:`half-start-${b}`,type:"left-half",content:null,rowIndex:b,columnIndex:0});for(let re=0;re<ne;re++)d.push({id:`full-${b}-${re}`,type:"full",content:null,rowIndex:b,columnIndex:re+1});d.push({id:`half-end-${b}`,type:"right-half",content:null,rowIndex:b,columnIndex:ne+1})}}else{const ne=te;if(Z){for(let re=0;re<ne;re++)d.push({id:`full-${b}-${re}`,type:"full",content:null,rowIndex:b,columnIndex:re});d.push({id:`half-end-${b}`,type:"right-half",content:null,rowIndex:b,columnIndex:ne})}else{d.push({id:`half-start-${b}`,type:"left-half",content:null,rowIndex:b,columnIndex:0});for(let re=0;re<ne;re++)d.push({id:`full-${b}-${re}`,type:"full",content:null,rowIndex:b,columnIndex:re+1})}}}function xt(d,b){for(let ie=0;ie<rectTotalRows;ie++)gt(d,ie,b)}function gt(d,b,ie){const Z=b%2===1;if(ie==="symmetrical"){const ne=Z?rectItemsPerRow:rectItemsPerRow-1;if(ne<0)return;if(Z)for(let re=0;re<ne;re++)d.push({id:`rect-full-${b}-${re}`,type:"rect-grid",content:null,rowIndex:b,columnIndex:re,width:t(ee),height:t(J)});else{d.push({id:`rect-half-start-${b}`,type:"left-half-rect",content:null,rowIndex:b,columnIndex:0,width:t(ee)/2-Ae/2,height:t(J)});for(let re=0;re<ne;re++)d.push({id:`rect-full-${b}-${re}`,type:"rect-grid",content:null,rowIndex:b,columnIndex:re+1,width:t(ee),height:t(J)});d.push({id:`rect-half-end-${b}`,type:"right-half-rect",content:null,rowIndex:b,columnIndex:ne+1,width:t(ee)/2-Ae/2,height:t(J)})}}else{const ne=rectItemsPerRow;if(Z){for(let re=0;re<ne;re++)d.push({id:`rect-full-${b}-${re}`,type:"rect-grid",content:null,rowIndex:b,columnIndex:re,width:t(ee),height:t(J)});d.push({id:`rect-half-end-${b}`,type:"right-half-rect",content:null,rowIndex:b,columnIndex:ne,width:t(ee)/2-Ae/2,height:t(J)})}else{d.push({id:`rect-half-start-${b}`,type:"left-half-rect",content:null,rowIndex:b,columnIndex:0,width:t(ee)/2-Ae/2,height:t(J)});for(let re=0;re<ne;re++)d.push({id:`rect-full-${b}-${re}`,type:"rect-grid",content:null,rowIndex:b,columnIndex:re+1,width:t(ee),height:t(J)})}}}function St(d){d.content?.onClick?d.content.onClick():d.data&&(t(I)==="categories"&&d.data.id?dt({detail:{data:d.data}}):t(I)==="products"&&d.data.id&&mt({detail:{data:d.data}}))}function He(d){if(d.content?.type==="pinpad")return{label:d.content.label,component:ds,onClick:ft,active:!0};if(d.content?.type==="bar"||d.content?.type==="karte"){const re=c()&&c().total>0&&c().status==="active";return{label:d.content.label,onClick:d.content.onClick,active:re,disabled:!re,paymentButton:!0,color:re?d.content.type==="bar"?"#28a745":"#007bff":"#666"}}const b=t(I)==="categories",ie=b?Se(d.content.category_names).de||"Unnamed":Se(d.content.display_names).button.de||"Unnamed Product";let Z;!b&&d.content?.additional_item_attributes?.ui_suggestions?.background_color_hex?Z=d.content.additional_item_attributes.ui_suggestions.background_color_hex:b||(Z="#666666");const ne={label:ie,data:d.content,active:!0};return b?(ne.color="#3A2F20",ne.backgroundStyle="radial-gradient(ellipse at center, #645540 0%, #5A4B35 30%, #4A3B28 70%, #3A2F20 100%)",ne.textColor="#DDDDD0"):Z&&(ne.color=Z),ne}let ot=V([]);function dt({detail:d}){d.data?.id&&(N=d.data,h(m,"Loading..."),ge.send({command:"getItemsByCategory",payload:{categoryId:d.data.id}}))}async function mt({detail:d}){d.data?.id&&await tt.addItem(d.data.id,1)}function Ke(){h(I,"categories"),N=null,h(T,[]),h(m,"")}function De(){h(L,t(L)==="6-6-6"?"4-4-4":"6-6-6")}function je(){Wl()}async function We(){if(s().isAuthenticated){const d=s().currentUser,b=`👤 **${d.full_name}** (${d.role})

🔐 **Status:** Erfolgreich angemeldet
💡 **Tipp:** Lange drücken zum Abmelden`;we.addMessage({type:"agent",message:b}),K("INFO",`User ${d.username} viewed profile information`)}}function lt(d){let b;tt.subscribe(ie=>b=ie)(),b&&b.total>0&&tt.finishOrder({type:d.charAt(0).toUpperCase()+d.slice(1),amount:b.total})}function ft(){o().isActive?Qe.deactivate():Qe.activateAlphaInput(()=>{},()=>{},we)}function an({detail:d}){d.data&&!d.data.isBackButton&&(h(p,d.data),h(D,d.mouseX),h(C,d.mouseY),h(q,!0))}function Fe(){h(q,!1)}function Ye({detail:d}){d.item.category_names?(h(X,d.item),h(M,!0)):(h(v,d.item),h(_,!0)),h(q,!1)}async function ht({detail:d}){K("DEBUG",`Advanced edit requested for item: ${d.item.id}`),h(q,!1);const b=d.item,ie=!!b.category_names;let Z=`🔧 **Advanced Edit Mode**

`;if(Z+=`📝 **Type:** ${ie?"Category":"Product"}
`,Z+=`🆔 **ID:** ${b.id}
`,ie){const ne=Se(b.category_names);Z+=`📛 **Name:** ${ne.de||"Unnamed"}
`,b.category_type&&(Z+=`🏷️ **Type:** ${b.category_type}
`)}else{const ne=Se(b.display_names);Z+=`📛 **Name:** ${ne.button?.de||"Unnamed Product"}
`,b.price&&(Z+=`💰 **Price:** €${b.price}
`)}Z+=`
💡 **Available Actions:**
`,Z+=`• Standard Edit (Right-click → Edit)
`,Z+=`• Database Direct Access
`,Z+=`• Bulk Operations
`,Z+="• Advanced Properties",we.addMessage({type:"agent",message:Z}),ie?(h(X,b),h(M,!0)):(h(v,b),h(_,!0))}async function nt({detail:d}){try{(await ge.send({command:"updateProduct",payload:{productId:d.productId,updates:d.updates,sessionId:"admin-session-placeholder"}})).status==="success"&&(K("INFO",`Product ${d.productId} updated successfully`),t(I)==="products"&&N&&ge.send({command:"getItemsByCategory",payload:{categoryId:N.id}}))}catch(b){console.error("Product update error:",b),K("ERROR",`Failed to update product ${d.productId}: ${b.message}`)}h(_,!1)}async function Ve({detail:d}){try{(await ge.send({command:"updateCategory",payload:{categoryId:d.categoryId,updates:d.updates}})).status==="success"&&(K("INFO",`Category ${d.categoryId} updated successfully`),t(I)==="categories"&&ge.send({command:"getCategories"}))}catch(b){console.error("Category update error:",b),K("ERROR",`Failed to update category ${d.categoryId}: ${b.message}`)}h(M,!1)}function Ht(){h(_,!1)}function Bt(){h(M,!1)}Wn.subscribe(d=>{d.style}),kn.subscribe(d=>{}),tn(()=>{t(fe)&&(me=new ResizeObserver(b=>{ve&&clearTimeout(ve),ve=setTimeout(()=>{for(let ie of b){const Z=ie.contentRect.width,ne=ie.contentRect.height;(t(B)!==Z||t(Q)!==ne)&&(h(B,Z),h(Q,ne),he())}},150)}),me.observe(t(fe)),setTimeout(()=>{h(B,t(fe).clientWidth),h(Q,t(fe).clientHeight),he()},100));const d=()=>{h(I,"categories"),N=null,yt.set("order")};return window.addEventListener("autoCollapseComplete",d),$e(),()=>{me?.disconnect(),window.removeEventListener("autoCollapseComplete",d),pe&&clearInterval(pe)}}),ge.subscribe(d=>{x=d.isConnected,x&&!_e&&(_e=!0,h(m,"Loading categories..."),setTimeout(()=>{ge.send({command:"getCategories"}).then(b=>{b.status==="success"&&Array.isArray(b.payload)?(h(g,b.payload),h(m,""),ye()):(h(m,"Error: Could not load categories from backend."),console.error("Failed to load categories:",b))}).catch(b=>{h(m,"Error: Failed to get response for categories."),console.error("Error in getCategories promise:",b)})},500)),d.lastMessage?.command==="getItemsByCategoryResponse"&&(d.lastMessage.status==="success"&&Array.isArray(d.lastMessage.payload)?(h(T,d.lastMessage.payload),h(I,"products"),h(m,"")):(h(m,"Error: Could not load products from backend."),console.error("Failed to load products:",d.lastMessage)))});function sn(d){return d.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})}function Pt(d){if(d.content?.type==="pinpad")return{label:d.content.label,component:ds,onClick:ft,active:!0};if(d.content?.type==="bar"||d.content?.type==="karte"){const re=c()&&c().total>0&&c().status==="active";return{label:d.content.label,onClick:d.content.onClick,active:re,disabled:!re,paymentButton:!0,color:re?d.content.type==="bar"?"#28a745":"#007bff":"#666"}}if(d.content?.isUserButton)return t(U);if(d.content?.isSmartNavigation)return t(ke);if(d.content?.isTimeButton){const re=sn(u().time),Nt=u().time.getDate().toString().padStart(2,"0"),Xe=(u().time.getMonth()+1).toString().padStart(2,"0");return{label:`${re}
${Nt}.${Xe}`,onClick:je,active:!0,customStyle:"font-family: monospace; font-size: 14px; font-weight: bold; line-height: 1.2; text-align: center; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);"}}if(d.content?.isLayoutToggle)return{label:t(L)==="6-6-6"?"6⬡6⬡6":"4▢4▢4",onClick:De,active:!0,customStyle:"font-family: monospace; font-size: 16px; font-weight: bold; text-align: center;"};if(d.content?.isBackButton)return{label:"⬅ Categories",onClick:Ke,active:!0,data:{isBackButton:!0},color:"#6c757d"};if(d.content?.isKeyboardToggle)return{label:d.content.label||"⌨",icon:d.content.icon,color:d.content.color,textColor:d.content.textColor,onClick:ft,active:!0};if(d.content?.isPaymentButton){const re=c().total>0&&c().status==="active";return{label:d.content.label,onClick:re?()=>lt(d.content.paymentType):void 0,active:re,disabled:!re,paymentButton:!0,color:re?d.content.color:"#666",icon:d.content.icon,textColor:re?d.content.textColor:void 0,backgroundStyle:re?d.content.backgroundStyle:void 0}}const b=t(I)==="categories",ie=b?Se(d.content.category_names).de||"Unnamed":Se(d.content.display_names).button.de||"Unnamed Product";let Z;!b&&d.content?.additional_item_attributes?.ui_suggestions?.background_color_hex?Z=d.content.additional_item_attributes.ui_suggestions.background_color_hex:b||(Z="#666666");const ne={label:ie,data:d.content,active:!0};return b?(ne.color="#3A2F20",ne.backgroundStyle="radial-gradient(ellipse at center, #645540 0%, #5A4B35 30%, #4A3B28 70%, #3A2F20 100%)",ne.textColor="#DDDDD0"):Z&&(ne.color=Z),ne}Be(()=>(s(),Qe),()=>{h(U,(()=>{const d=s().currentUser;return d?{label:Pe(d.full_name),data:{isUserButton:!0,authenticated:!0},onClick:We,active:!0,color:"#28a745",textColor:"#666",customStyle:"font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; line-height: 1.1; white-space: pre-line; text-align: center; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);"}:{label:"Login",data:{isUserButton:!0,authenticated:!1},onClick:()=>Qe.activate("agent",null,null,"numeric"),active:!0,color:"#6c757d",textColor:"#666",customStyle:"font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; line-height: 1.1; white-space: pre-line; text-align: center; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);"}})())}),Be(()=>(i(),H(G())),()=>{h(ke,(()=>{let d="#2c2c2e";if(i().style)switch(i().style){case"error":d="#d32f2f";break;case"warning":d="#f57c00";break;case"info":d="#1976d2";break;case"success":d="#388e3c";break;default:d="#2c2c2e"}return{icon:us,showShape:!0,color:d,onClick:()=>G()("betrugerCap"),active:!0}})())}),Be(()=>l(),()=>{h(y,l().MIN_BUTTON_WIDTH)}),Be(()=>(t(B),t(Q),t(L)),()=>{t(B)>0&&t(Q)>0&&t(L)&&he()}),Be(()=>(t(A),t(I),t(g),t(T)),()=>{t(A)&&(t(I)==="categories"&&t(g).length>=0||t(I)==="products"&&t(T).length>=0)&&ye()}),Be(()=>(t(A),c()),()=>{t(A)&&c()&&ye()}),Be(()=>(t(A),t(U),t(ke)),()=>{t(A)&&(t(U)||t(ke))&&ye()}),Be(()=>(t(F),t(L),t(ce)),()=>{const d=[],b=new Map;t(F).forEach(Z=>{b.has(Z.rowIndex)||b.set(Z.rowIndex,[]),b.get(Z.rowIndex).push(Z)});const ie=t(L)==="4-4-4"?rectTotalRows:t(ce);for(let Z=0;Z<ie;Z++)b.has(Z)&&d.push(b.get(Z).sort((ne,re)=>ne.columnIndex-re.columnIndex));h(ot,d)}),pn(),Mt();var Ot=zc(),Wt=f(Ot);{var An=d=>{var b=Bc();let ie;var Z=f(b);let ne;var re=f(Z);{let Nt=et(()=>t(y)/4*3);ec(re,{onClose:()=>Qe.deactivate(),get minButtonSize(){return t(Nt)}})}le((Nt,Xe)=>{ie=Ze(b,1,"pinpad-overlay svelte-lb1vpy",null,ie,Nt),ne=Ze(Z,1,"pinpad-container svelte-lb1vpy",null,ne,Xe)},[()=>({numeric:o().layout==="numeric",alpha:o().layout==="alpha"}),()=>({numeric:o().layout==="numeric",alpha:o().layout==="alpha"})]),k(d,b)};W(Wt,d=>{o(),S(()=>o().isActive)&&d(An)})}var gn=w(Wt,2);mc(gn,{get item(){return t(p)},get x(){return t(D)},get y(){return t(C)},get visible(){return t(q)},$$events:{close:Fe,edit:Ye,"advanced-edit":ht}});var mn=w(gn,2);Sc(mn,{get visible(){return t(_)},get product(){return t(v)},$$events:{save:nt,close:Ht}});var hn=w(mn,2);Cc(hn,{get visible(){return t(M)},get category(){return t(X)},$$events:{save:Ve,close:Bt}});var rr=w(hn,2),ar=f(rr);{var sr=d=>{var b=Lc(),ie=f(b);le(()=>se(ie,t(m))),k(d,b)},ir=d=>{var b=qc();let ie;var Z=f(b);{var ne=Xe=>{var Ge=Fc();k(Xe,Ge)};W(Z,Xe=>{t(I),t(T),S(()=>t(I)==="products"&&t(T).length===0)&&Xe(ne)})}var re=w(Z,2);Et(re,1,()=>t(ot),wr,(Xe,Ge)=>{var Jt=Uc();let $n;Et(Jt,5,()=>t(Ge),rt=>`${t(I)}-${rt.id}-${t(L)}-${t(E)||t(ee)}-${t(z)||t(J)}`,(rt,ct)=>{const $=et(()=>(t(ct),S(()=>Pt(t(ct)))));var ut=Ie(),or=xe(ut);{var yn=Ue=>{var Rn=Ie(),Kt=xe(Rn);{var Je=Pn=>{{let Er=et(()=>getButtonProps(t(ct)));Lt(Pn,Yt(()=>t(Er),{get label(){return H(t($)),S(()=>t($).label)},get active(){return H(t($)),S(()=>t($).active)},get disabled(){return H(t($)),S(()=>t($).disabled)},get color(){return H(t($)),S(()=>t($).color)},get icon(){return H(t($)),S(()=>t($).icon)},get textColor(){return H(t($)),S(()=>t($).textColor)},get backgroundStyle(){return H(t($)),S(()=>t($).backgroundStyle)},$$events:{click(...na){t($).onClick?.apply(this,na)}}}))}},kt=Pn=>{var Er=Ie(),na=xe(Er);{var ni=On=>{{let Ir=et(()=>getButtonProps(t(ct)));Lt(On,Yt(()=>t(Ir),{get label(){return H(t($)),S(()=>t($).label)},get color(){return H(t($)),S(()=>t($).color)},get active(){return H(t($)),S(()=>t($).active)},$$events:{click(...lr){t($).onClick?.apply(this,lr)}},children:(lr,qa)=>{us(lr)},$$slots:{default:!0}}))}},ri=On=>{var Ir=Ie(),lr=xe(Ir);{var qa=Nn=>{{let Mr=et(()=>getButtonProps(t(ct)));Lt(Nn,Yt(()=>t(Mr),{get label(){return H(t($)),S(()=>t($).label)},get icon(){return H(t($)),S(()=>t($).icon)},get color(){return H(t($)),S(()=>t($).color)},get textColor(){return H(t($)),S(()=>t($).textColor)},get active(){return H(t($)),S(()=>t($).active)},$$events:{click(...ra){t($).onClick?.apply(this,ra)}}}))}},ai=Nn=>{var Mr=Ie(),ra=xe(Mr);{var si=Dn=>{{let Ar=et(()=>getButtonProps(t(ct)));Lt(Dn,Yt(()=>t(Ar),{get active(){return H(t($)),S(()=>t($).active)},$$events:{click(...cr){t($).onClick?.apply(this,cr)}},children:(cr,za)=>{var $r=Ie(),on=xe($r);Js(on,()=>t($).component,(Bn,ur)=>{ur(Bn,{})}),k(cr,$r)},$$slots:{default:!0}}))}},ii=Dn=>{var Ar=Ie(),cr=xe(Ar);{var za=on=>{{let Bn=et(()=>getButtonProps(t(ct)));Lt(on,Yt(()=>t(Bn),{get label(){return H(t($)),S(()=>t($).label)},get active(){return H(t($)),S(()=>t($).active)},get disabled(){return H(t($)),S(()=>t($).disabled)},get color(){return H(t($)),S(()=>t($).color)},get textColor(){return H(t($)),S(()=>t($).textColor)},get backgroundStyle(){return H(t($)),S(()=>t($).backgroundStyle)},$$events:{click(...ur){t($).onClick?.apply(this,ur)}}}))}},$r=on=>{var Bn=Ie(),ur=xe(Bn);{var oi=Ln=>{{let Rr=et(()=>getButtonProps(t(ct)));Lt(Ln,Yt(()=>t(Rr),{disabled:!0}))}},li=Ln=>{var Rr=Ie(),ci=xe(Rr);{var ui=Fn=>{{let Pr=et(()=>getButtonProps(t(ct)));Lt(Fn,Yt(()=>t(Pr),{get icon(){return H(t($)),S(()=>t($).icon)},get active(){return H(t($)),S(()=>t($).active)},get showShape(){return H(t($)),S(()=>t($).showShape)},get color(){return H(t($)),S(()=>t($).color)},get textColor(){return H(t($)),S(()=>t($).textColor)},get backgroundStyle(){return H(t($)),S(()=>t($).backgroundStyle)},get notificationStyle(){return H(t($)),S(()=>t($).notificationStyle)},$$events:{click(...aa){t($).onClick?.apply(this,aa)}}}))}},di=Fn=>{var Pr=Ie(),aa=xe(Pr);{var fi=sa=>{{let vi=et(()=>getButtonProps(t(ct)));Lt(sa,Yt(()=>t(vi),{get label(){return H(t($)),S(()=>t($).label)},get data(){return H(t($)),S(()=>t($).data)},get active(){return H(t($)),S(()=>t($).active)},get color(){return H(t($)),S(()=>t($).color)},get backgroundStyle(){return H(t($)),S(()=>t($).backgroundStyle)},get textColor(){return H(t($)),S(()=>t($).textColor)},$$events:{click(...pi){t($).onClick?.apply(this,pi)},secondaryaction:an}}))}};W(aa,sa=>{H(t($)),S(()=>t($).label)&&sa(fi)},!0)}k(Fn,Pr)};W(ci,Fn=>{H(t($)),S(()=>t($).icon!==void 0||t($).showShape)?Fn(ui):Fn(di,!1)},!0)}k(Ln,Rr)};W(ur,Ln=>{H(t($)),S(()=>t($).disabled)?Ln(oi):Ln(li,!1)},!0)}k(on,Bn)};W(cr,on=>{H(t($)),S(()=>t($).label&&!t($).data)?on(za):on($r,!1)},!0)}k(Dn,Ar)};W(ra,Dn=>{H(t($)),S(()=>t($).component)?Dn(si):Dn(ii,!1)},!0)}k(Nn,Mr)};W(lr,Nn=>{H(t($)),S(()=>t($).isKeyboardToggle)?Nn(qa):Nn(ai,!1)},!0)}k(On,Ir)};W(na,On=>{H(t($)),S(()=>t($).isBetrugerCap)?On(ni):On(ri,!1)},!0)}k(Pn,Er)};W(Kt,Pn=>{H(t($)),S(()=>t($).paymentButton)?Pn(Je):Pn(kt,!1)})}k(Ue,Rn)};W(or,Ue=>{t(ct),S(()=>t(ct).type.includes("half"))&&Ue(yn)})}k(rt,ut)}),le(rt=>$n=Ze(Jt,1,"button-row",null,$n,rt),[()=>({"hex-row":t(L)==="6-6-6","rect-row":t(L)==="4-4-4"})]),k(Xe,Jt)});var Nt=w(re,2);Et(Nt,1,()=>t(Y),Xe=>Xe.id,(Xe,Ge)=>{var Jt=jc(),$n=f(Jt);{let rt=et(()=>t(L)==="6-6-6"?"hex":"rect"),ct=et(()=>t(L)==="6-6-6"?t(E):t(ee)),$=et(()=>t(L)==="6-6-6"?t(z):t(J)),ut=et(()=>He(t(Ge)));Lt($n,Yt({get shape(){return t(rt)},get width(){return t(ct)},get height(){return t($)}},()=>t(ut),{$$events:{click:()=>St(t(Ge)),secondaryaction:an}}))}le(()=>Sn(Jt,`${t(Ge),S(()=>t(Ge).cssTransform)??""}; position: absolute;`)),k(Xe,Jt)}),le(Xe=>{ie=Ze(b,1,"grid-container-unified svelte-lb1vpy",null,ie,Xe),Sn(b,`
             --optimal-hex-height: ${t(z)??""}px; 
             --hex-vertical-padding: 6px;
             --rect-vertical-padding: 6px;
             --optimal-hex-width: ${t(E)??""}px;
             --rect-button-height: ${t(J)??""}px;
           `)},[()=>({hex:t(L)==="6-6-6",rect:t(L)==="4-4-4"})]),k(d,b)};W(ar,d=>{t(m)?d(sr):d(ir,!1)})}fn(Ot,d=>h(fe,d),()=>t(fe)),k(e,Ot),bt(),a()}var Gc=j('<input type="file" accept=".pdf,.jpg,.jpeg,.png" multiple style="display: none;" class="svelte-1wvon5f"/>'),Hc=j('<div class="importing-indicator svelte-1wvon5f"><div class="spinner svelte-1wvon5f"></div> <p class="svelte-1wvon5f">Importing menu...</p></div>'),Wc=j('<div class="loading-files svelte-1wvon5f"><div class="spinner svelte-1wvon5f"></div> <p class="svelte-1wvon5f">Loading available files...</p></div>'),Jc=j('<div class="error-message svelte-1wvon5f"><p class="svelte-1wvon5f"> </p> <button class="retry-btn svelte-1wvon5f">Retry</button></div>'),Kc=j('<div class="upload-area svelte-1wvon5f"><div class="upload-prompt svelte-1wvon5f"><p class="svelte-1wvon5f">No files selected yet.</p> <button class="upload-btn svelte-1wvon5f"><svg class="upload-icon svelte-1wvon5f" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" class="svelte-1wvon5f"></path></svg> Choose Files</button> <p class="upload-hint svelte-1wvon5f">Select multiple PDF, JPG, or PNG files</p></div></div>'),Yc=j('<div class="no-files svelte-1wvon5f"><p class="svelte-1wvon5f">No menu files found in the menu_inputs directory.</p> <p class="svelte-1wvon5f">Please add PDF, JPG, or PNG files to the menu_inputs folder.</p></div>'),Xc=j('<span class="svelte-1wvon5f"> </span>'),Qc=j('<span class="svelte-1wvon5f"> </span>'),Zc=j('<button class="control-btn svelte-1wvon5f">Add More Files</button>'),eu=j('<div class="size-warning svelte-1wvon5f"></div>'),tu=j('<div><label class="file-checkbox svelte-1wvon5f"><input type="checkbox" class="svelte-1wvon5f"/> <div class="file-info svelte-1wvon5f"><div class="file-name svelte-1wvon5f"> </div> <div class="file-details svelte-1wvon5f"><span class="file-type svelte-1wvon5f"> </span> <span class="file-date svelte-1wvon5f"> </span></div> <!></div></label></div>'),nu=j('<span class="upload-status uploaded svelte-1wvon5f">✓ Uploaded</span>'),ru=j('<span class="upload-status pending svelte-1wvon5f">Pending upload</span>'),au=j('<div><label class="file-checkbox svelte-1wvon5f"><input type="checkbox" class="svelte-1wvon5f"/> <div class="file-info svelte-1wvon5f"><div class="file-name svelte-1wvon5f"> </div> <div class="file-details svelte-1wvon5f"><span class="file-type svelte-1wvon5f"> </span> <!></div></div></label> <button class="remove-btn svelte-1wvon5f" title="Remove file"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="svelte-1wvon5f"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" class="svelte-1wvon5f"></path></svg></button></div>'),su=j('<div class="file-controls svelte-1wvon5f"><div class="selection-info svelte-1wvon5f"><!></div> <div class="control-buttons svelte-1wvon5f"><!> <button class="control-btn svelte-1wvon5f">Select All Valid</button> <button class="control-btn svelte-1wvon5f">Clear Selection</button></div></div> <div class="file-list svelte-1wvon5f"><!></div> <div class="import-controls svelte-1wvon5f"><button class="import-btn svelte-1wvon5f"> </button></div>',1),iu=j('<div class="file-selector svelte-1wvon5f"><!></div>'),ou=j('<div class="menu-importer svelte-1wvon5f"><h3 class="svelte-1wvon5f">Menu Import</h3> <p class="svelte-1wvon5f"><!></p> <p class="size-limit svelte-1wvon5f"></p> <!> <!></div>');function lu(e,n){_t(n,!1);const r=Mn();let a=V(!1),s=V([]),i=V(new Set),l=V(!0),c=V(null),o=V([]);const u=50*1024*1024,y=typeof window<"u"&&window.electronAPI,g=!y;let T=V();tn(async()=>{y?await m():h(l,!1)});async function m(){if(y){h(l,!0),h(c,null);try{const O=await window.electronAPI.invoke("list-menu-files");O&&O.error?(h(c,O.error),h(s,[])):Array.isArray(O)?h(s,O):(h(c,"Unexpected response format"),h(s,[]))}catch(O){console.error("Error loading files:",O),h(c,O.message),h(s,[])}finally{h(l,!1)}}}async function x(O){const E=O.target.files;if(!(!E||E.length===0)){for(const z of E){if(!["application/pdf","image/jpeg","image/png","image/jpg"].includes(z.type)){we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`File "${z.name}" has unsupported format. Please select PDF, JPG, or PNG files.`});continue}const J=u;if(z.size>J){const ce=Math.round(J/1048576),de=Math.round(z.size/(1024*1024)*100)/100;we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`File "${z.name}" (${de}MB) exceeds maximum size of ${ce}MB .`});continue}const te={file:z,name:z.name,size:Math.round(z.size/(1024*1024)*100)/100,type:z.type.split("/")[1].toUpperCase(),selected:!0,uploaded:!1};h(o,[...t(o),te])}t(T)&&qe(T,t(T).value="")}}function I(){t(T)&&t(T).click()}function N(O){h(o,t(o).filter((E,z)=>z!==O))}function L(O){if(y)t(i).has(O.path)?t(i).delete(O.path):t(i).add(O.path),h(i,t(i));else{const E=t(o).findIndex(z=>z.name===O.name);E!==-1&&(qe(o,t(o)[E].selected=!t(o)[E].selected),h(o,t(o)))}}function q(){if(y){const O=t(s).filter(E=>E.sizeValid);h(i,new Set(O.map(E=>E.path)))}else h(o,t(o).map(O=>({...O,selected:!0})))}function p(){y?h(i,new Set):h(o,t(o).map(O=>({...O,selected:!1})))}function D(){return y?t(i).size:t(o).filter(O=>O.selected).length}async function C(){const O=D();if(!(t(a)||O===0))if(y){const E=Array.from(t(i));await M(E)}else{const E=t(o).filter(z=>z.selected);await X(E)}}function _(O){return`${O.type} • ${O.size}MB`}function v(O){return new Date(O).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}async function M(O){if(t(a))return;h(a,!0),r("close"),yt.set("agent");const E=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),z=Array.isArray(O)?O.length:1,ee=Array.isArray(O)?O.map(J=>J.split("/").pop()).join(", "):O.split("/").pop();we.addMessage({timestamp:E,type:"agent",message:`Starting menu import from ${z} file(s): ${ee}

This process will:
1. Parse the menu(s) with AI
2. Clean existing data
3. Import new menu structure
4. Create optimized layouts

Please wait...`});try{const J=await window.electronAPI.invoke("start-menu-import",O);if(J&&!J.success&&J.message){we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Import failed: ${J.message}`}),h(a,!1);return}}catch(J){console.error("Error starting import:",J),we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Import failed: ${J.message}`}),h(a,!1)}}async function X(O){if(t(a)||O.length===0)return;h(a,!0),r("close"),yt.set("agent");const E=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),z=O.map(ee=>ee.name).join(", ");we.addMessage({timestamp:E,type:"agent",message:`Starting menu import from ${O.length} file(s): ${z}

This process will:
1. Upload files to server
2. Parse the menu(s) with AI
3. Clean existing data
4. Import new menu structure
5. Create optimized layouts

Please wait...`});try{const ee=`${window.location.protocol}//${window.location.host}`;we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Uploading ${O.length} files...`});const J=new FormData;O.forEach((fe,me)=>{J.append("menuFiles",fe.file)});const te=new XMLHttpRequest,de=await new Promise((fe,me)=>{te.upload.addEventListener("progress",ve=>{if(ve.lengthComputable){const _e=Math.round(ve.loaded/ve.total*100);we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Uploading files: ${_e}%`})}}),te.onload=function(){if(te.status>=200&&te.status<300)try{const ve=JSON.parse(te.responseText);fe(ve)}catch{me(new Error("Invalid response format"))}else try{const ve=JSON.parse(te.responseText);me(new Error(ve.message||`HTTP ${te.status}`))}catch{me(new Error(`HTTP ${te.status}: ${te.statusText}`))}},te.onerror=function(){me(new Error("Network error occurred"))},te.open("POST",`${ee}/api/menu/upload-and-import`),te.send(J)});if(!de.success)throw new Error(de.message||"Upload failed");we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`All files uploaded successfully. Processing ${de.fileCount} files: ${de.filenames.join(", ")}`}),O.forEach(fe=>{fe.uploaded=!0}),we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`✅ Menu import completed successfully!

You can now navigate back to the selection area to see your new menu items.`}),K("INFO","Refreshing categories after successful menu import"),ge.send({command:"getCategories"})}catch(ee){console.error("Error uploading and importing files:",ee),we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Import failed: ${ee.message}`})}finally{h(a,!1)}}typeof window<"u"&&window.electronAPI&&window.electronAPI.onImportProgress&&(window.electronAPI.onImportProgress(O=>{const E=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});we.addMessage({timestamp:E,type:"agent",message:O})}),window.electronAPI.onImportComplete((O,E)=>{const z=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});O&&(K("INFO","Refreshing categories after successful menu import"),ge.send({command:"getCategories"})),we.addMessage({timestamp:z,type:"agent",message:O?`✅ Import completed successfully!

${E}

You can now navigate back to the selection area to see your new menu items.`:`❌ Import failed: ${E}`}),h(a,!1)})),Mt();var B=ou(),Q=w(f(B),2),F=f(Q);{var A=O=>{var E=zt("Select one or more menu files from the menu_inputs directory");k(O,E)},Y=O=>{var E=zt("Upload and import menu files (PDF, JPG, PNG)");k(O,E)};W(F,O=>{y?O(A):O(Y,!1)})}var G=w(Q,2);G.textContent="Max file size: 50MB";var U=w(G,2);{var ke=O=>{var E=Gc();fn(E,z=>h(T,z),()=>t(T)),ae("change",E,x),k(O,E)};W(U,O=>{g&&O(ke)})}var Ee=w(U,2);{var Ae=O=>{var E=Hc();k(O,E)},oe=O=>{var E=Ie(),z=xe(E);{var ee=te=>{var ce=Wc();k(te,ce)},J=te=>{var ce=Ie(),de=xe(ce);{var fe=ve=>{var _e=Jc(),pe=f(_e),Se=f(pe),Pe=w(pe,2);le(()=>se(Se,`Error loading files: ${t(c)??""}`)),ae("click",Pe,m),k(ve,_e)},me=ve=>{var _e=iu(),pe=f(_e);{var Se=$e=>{var Re=Kc(),he=f(Re),Ce=w(f(he),2);ae("click",Ce,I),k($e,Re)},Pe=$e=>{var Re=Ie(),he=xe(Re);{var Ce=P=>{var R=Yc();k(P,R)},ye=P=>{var R=su(),ue=xe(R),be=f(ue),ze=f(be);{var xt=Fe=>{var Ye=Xc(),ht=f(Ye);le(()=>se(ht,`${t(i).size??""} of ${t(s).length??""} files selected`)),k(Fe,Ye)},gt=Fe=>{var Ye=Qc(),ht=f(Ye);le(nt=>se(ht,`${nt??""} of ${t(o).length??""} files selected`),[()=>t(o).filter(nt=>nt.selected).length]),k(Fe,Ye)};W(ze,Fe=>{y?Fe(xt):Fe(gt,!1)})}var St=w(be,2),He=f(St);{var ot=Fe=>{var Ye=Zc();ae("click",Ye,I),k(Fe,Ye)};W(He,Fe=>{g&&Fe(ot)})}var dt=w(He,2),mt=w(dt,2),Ke=w(ue,2),De=f(Ke);{var je=Fe=>{var Ye=Ie(),ht=xe(Ye);Et(ht,1,()=>t(s),nt=>nt.path,(nt,Ve)=>{var Ht=tu();let Bt;var sn=f(Ht),Pt=f(sn),Ot=w(Pt,2),Wt=f(Ot),An=f(Wt),gn=w(Wt,2),mn=f(gn),hn=f(mn),rr=w(mn,2),ar=f(rr),sr=w(gn,2);{var ir=d=>{var b=eu();b.textContent="File too large (max 50MB)",k(d,b)};W(sr,d=>{t(Ve).sizeValid||d(ir)})}le((d,b,ie,Z)=>{Bt=Ze(Ht,1,"file-item svelte-1wvon5f",null,Bt,d),Pt.disabled=!t(Ve).sizeValid,rs(Pt,b),se(An,t(Ve).name),se(hn,ie),se(ar,`Modified: ${Z??""}`)},[()=>({invalid:!t(Ve).sizeValid,selected:t(i).has(t(Ve).path)}),()=>t(i).has(t(Ve).path),()=>_(t(Ve)),()=>v(t(Ve).lastModified)]),ae("change",Pt,()=>L(t(Ve))),k(nt,Ht)}),k(Fe,Ye)},We=Fe=>{var Ye=Ie(),ht=xe(Ye);Et(ht,3,()=>t(o),nt=>nt.name,(nt,Ve,Ht)=>{var Bt=au();let sn;var Pt=f(Bt),Ot=f(Pt),Wt=w(Ot,2),An=f(Wt),gn=f(An),mn=w(An,2),hn=f(mn),rr=f(hn),ar=w(hn,2);{var sr=b=>{var ie=nu();k(b,ie)},ir=b=>{var ie=ru();k(b,ie)};W(ar,b=>{t(Ve).uploaded?b(sr):b(ir,!1)})}var d=w(Pt,2);le(b=>{sn=Ze(Bt,1,"file-item svelte-1wvon5f",null,sn,b),rs(Ot,t(Ve).selected),se(gn,t(Ve).name),se(rr,`${t(Ve).type??""} • ${t(Ve).size??""}MB`)},[()=>({selected:t(Ve).selected,uploaded:t(Ve).uploaded})]),ae("change",Ot,()=>L(t(Ve))),ae("click",d,()=>N(t(Ht))),k(nt,Bt)}),k(Fe,Ye)};W(De,Fe=>{y?Fe(je):Fe(We,!1)})}var lt=w(Ke,2),ft=f(lt),an=f(ft);le((Fe,Ye,ht,nt)=>{dt.disabled=Fe,mt.disabled=Ye,ft.disabled=ht,se(an,`Import Selected Files (${nt??""})`)},[()=>y?t(s).every(Fe=>!Fe.sizeValid):t(o).length===0,()=>D()===0,()=>D()===0,D]),ae("click",dt,q),ae("click",mt,p),ae("click",ft,C),k(P,R)};W(he,P=>{y&&t(s).length===0?P(Ce):P(ye,!1)},!0)}k($e,Re)};W(pe,$e=>{g&&t(o).length===0?$e(Se):$e(Pe,!1)})}k(ve,_e)};W(de,ve=>{y&&t(c)?ve(fe):ve(me,!1)},!0)}k(te,ce)};W(z,te=>{y&&t(l)?te(ee):te(J,!1)},!0)}k(O,E)};W(Ee,O=>{t(a)?O(Ae):O(oe,!1)})}k(e,B),bt()}var cu=j('<button class="download-btn svelte-1dlpwa7">📥 Download Export</button> <button class="reset-btn svelte-1dlpwa7">🔄 New Export</button>',1),uu=j('<button class="cancel-btn svelte-1dlpwa7">❌ Cancel</button>'),du=j('<button class="export-btn svelte-1dlpwa7" disabled><!></button> <!>',1),fu=j('<button class="export-btn svelte-1dlpwa7">🚀 Generate Export</button>'),vu=j('<div class="error-message svelte-1dlpwa7"> <button class="retry-btn svelte-1dlpwa7">Try Again</button></div>'),pu=j('<div class="job-info svelte-1dlpwa7"><small> </small></div>'),gu=j('<div class="dsfinvk-exporter svelte-1dlpwa7"><h3 class="svelte-1dlpwa7">DSFinV-K Export</h3> <div class="date-range-picker svelte-1dlpwa7"><div class="date-input svelte-1dlpwa7"><label for="dsfinvk-start" class="svelte-1dlpwa7">Start Date:</label> <input type="date" id="dsfinvk-start" class="svelte-1dlpwa7"/></div> <div class="date-input svelte-1dlpwa7"><label for="dsfinvk-end" class="svelte-1dlpwa7">End Date:</label> <input type="date" id="dsfinvk-end" class="svelte-1dlpwa7"/></div></div> <div class="export-actions svelte-1dlpwa7"><!></div> <!> <!></div>');function mu(e,n){_t(n,!1);let r=V(new Date().toISOString().split("T")[0]),a=V(new Date().toISOString().split("T")[0]),s=V(!1),i=V(null),l=V(null),c=V(null),o=null,u=V(null);const y=typeof window<"u"&&window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1";async function g(){h(s,!0),h(i,null),h(c,null),h(u,null),we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`🚀 Starting DSFinV-K export for period ${t(r)} to ${t(a)}...`,style:"info"});try{y?await m():await T()}catch(G){we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`❌ DSFinV-K export failed: ${G.message}`,style:"error"}),h(i,"failed"),h(u,G.message)}finally{y||h(s,!1)}}async function T(){try{const G=await fetch("/api/export/dsfinvk/start",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({startDate:t(r),endDate:t(a)})});if(G.ok&&G.headers.get("content-type")?.includes("application/zip")){const U=await G.blob(),ke=window.URL.createObjectURL(U),Ee=`dsfinvk-export-${t(r)}-to-${t(a)}.zip`,Ae=document.createElement("a");Ae.href=ke,Ae.download=Ee,document.body.appendChild(Ae),Ae.click(),document.body.removeChild(Ae),window.URL.revokeObjectURL(ke),we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`✅ DSFinV-K export complete! File downloaded as ${Ee}`,style:"success"}),h(i,"complete")}else{const U=await G.json();if(!U.success)throw new Error(U.error||"Export failed")}}catch{const U=await ge.send({command:"generateDsfinvkExport",payload:{startDate:t(r),endDate:t(a)}});if(U.status==="success"&&U.payload.success)we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`✅ DSFinV-K export complete! File available at: ${U.payload.path}`,style:"success"}),h(i,"complete");else throw new Error(U.payload?.message||U.error||"Unknown export error")}}async function m(){const U=await(await fetch("/api/export/dsfinvk/start",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({startDate:t(r),endDate:t(a)})})).json();if(!U.success)throw new Error(U.error||"Failed to start export job");h(l,U.jobId),h(i,U.status),we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`📊 Export job started (Job ID: ${t(l)}). Generating report...`,style:"info"}),x()}function x(){o&&clearInterval(o),o=setInterval(async()=>{try{const U=await(await fetch(`/api/export/dsfinvk/status/${t(l)}`,{credentials:"include"})).json();if(!U.success)throw new Error(U.error||"Failed to check job status");h(i,U.status.toLowerCase()),t(i)==="complete"?(clearInterval(o),o=null,h(c,U.downloadUrl),h(s,!1),we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"✅ DSFinV-K export complete! Ready for download.",style:"success"})):t(i)==="failed"?(clearInterval(o),o=null,h(s,!1),h(u,U.error||"Export job failed"),we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`❌ DSFinV-K export failed: ${t(u)}`,style:"error"})):t(i)==="processing"&&we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"⚙️ Export job is processing...",style:"info"})}catch(G){console.error("Error polling job status:",G),we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`⚠️ Error checking export status: ${G.message}`,style:"warning"})}},3e3)}function I(){t(c)&&(window.open(t(c),"_blank"),we.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"📥 Download initiated for DSFinV-K export.",style:"success"}))}function N(){o&&(clearInterval(o),o=null),h(s,!1),h(i,null),h(l,null),h(c,null),h(u,null)}Ua(()=>{o&&clearInterval(o)}),Mt();var L=gu(),q=w(f(L),2),p=f(q),D=w(f(p),2),C=w(p,2),_=w(f(C),2),v=w(q,2),M=f(v);{var X=G=>{var U=cu(),ke=xe(U),Ee=w(ke,2);ae("click",ke,I),ae("click",Ee,N),k(G,U)},B=G=>{var U=Ie(),ke=xe(U);{var Ee=oe=>{var O=du(),E=xe(O),z=f(E);{var ee=de=>{var fe=zt("⏳ Queued...");k(de,fe)},J=de=>{var fe=Ie(),me=xe(fe);{var ve=pe=>{var Se=zt("⚙️ Processing...");k(pe,Se)},_e=pe=>{var Se=zt("🔄 Generating...");k(pe,Se)};W(me,pe=>{t(i)==="processing"?pe(ve):pe(_e,!1)},!0)}k(de,fe)};W(z,de=>{t(i)==="pending"?de(ee):de(J,!1)})}var te=w(E,2);{var ce=de=>{var fe=uu();ae("click",fe,N),k(de,fe)};W(te,de=>{y&&de(ce)})}k(oe,O)},Ae=oe=>{var O=fu();ae("click",O,g),k(oe,O)};W(ke,oe=>{t(s)||t(i)==="pending"||t(i)==="processing"?oe(Ee):oe(Ae,!1)},!0)}k(G,U)};W(M,G=>{t(i)==="complete"&&t(c)?G(X):G(B,!1)})}var Q=w(v,2);{var F=G=>{var U=vu(),ke=f(U),Ee=w(ke);le(()=>se(ke,`❌ Export failed: ${t(u)??""} `)),ae("click",Ee,N),k(G,U)};W(Q,G=>{t(i)==="failed"&&t(u)&&G(F)})}var A=w(Q,2);{var Y=G=>{var U=pu(),ke=f(U),Ee=f(ke);le(()=>se(Ee,`Job ID: ${t(l)??""}`)),k(G,U)};W(A,G=>{y&&t(l)&&G(Y)})}le(()=>{D.disabled=t(s),_.disabled=t(s)}),Xt(D,()=>t(r),G=>h(r,G)),Xt(_,()=>t(a),G=>h(a,G)),k(e,L),bt()}var hu=j('<div class="control-center-overlay svelte-mpduov"><div class="control-center-panel svelte-mpduov"><div class="panel-header svelte-mpduov"><h2 class="svelte-mpduov">Control Center</h2> <button class="close-btn svelte-mpduov">×</button></div> <div class="panel-content svelte-mpduov"><div class="section svelte-mpduov"><h3 class="svelte-mpduov">System Time</h3> <div class="time-display svelte-mpduov"> </div> <p class="time-description svelte-mpduov">Current system time. Time synchronization is managed automatically.</p></div> <div class="section svelte-mpduov"><h3 class="svelte-mpduov">Language & Region</h3> <div class="locale-settings svelte-mpduov"><label for="locale-select" class="locale-label svelte-mpduov">Display Locale:</label> <select id="locale-select" class="locale-select svelte-mpduov"><option class="svelte-mpduov">Deutsch (Deutschland)</option><option class="svelte-mpduov">English (United States)</option><option class="svelte-mpduov">English (United Kingdom)</option></select></div> <p class="locale-description svelte-mpduov">Changes how numbers, currencies, and dates are displayed in the interface.</p></div> <div class="section svelte-mpduov"><!></div> <div class="section svelte-mpduov"><!></div> <div class="section svelte-mpduov"><h3 class="svelte-mpduov">System Information</h3> <div class="system-info svelte-mpduov"><div class="info-item svelte-mpduov"><span class="label svelte-mpduov">Status:</span> <span class="value connected svelte-mpduov">Connected</span></div> <div class="info-item svelte-mpduov"><span class="label svelte-mpduov">Mode:</span> <span class="value svelte-mpduov">Development</span></div></div></div></div></div></div>');function yu(e,n){_t(n,!1);const[r,a]=Tr(),s=()=>st(ja,"$controlCenterVisible",r),i=()=>st(ma,"$currentTime",r),l=()=>st(Zn,"$localeStore",r);Mn();function c(){Jl()}function o(I){return I.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})}function u(){c()}function y(I){const N=I.target.value;il(N)}function g(I){I.key==="Escape"&&c()}Mt();var T=Ie();ae("keydown",_r,g);var m=xe(T);{var x=I=>{var N=hu(),L=f(N),q=f(L),p=w(f(q),2),D=w(q,2),C=f(D),_=w(f(C),2),v=f(_),M=w(C,2),X=w(f(M),2),B=w(f(X),2);le(()=>{l(),Us(()=>{})});var Q=f(B);Q.value=Q.__value="de-DE";var F=w(Q);F.value=F.__value="en-US";var A=w(F);A.value=A.__value="en-GB";var Y=w(M,2),G=f(Y);lu(G,{$$events:{close:u}});var U=w(Y,2),ke=f(U);mu(ke,{}),le(Ee=>se(v,Ee),[()=>o(i())]),ae("click",p,c),Ys(B,l,Ee=>Do(Zn,Ee)),ae("change",B,y),ae("click",N,No(c)),k(I,N)};W(m,I=>{s()&&I(x)})}k(e,T),bt(),a()}var _u=j('<main class="pos-grid svelte-1ji6e50"><div class="grid-item-display svelte-1ji6e50"><!></div> <div class="grid-selection-area svelte-1ji6e50"><!></div></main> <!>',1);function bu(e,n){_t(n,!1);let r=V(),a=V(!1);tn(async()=>{await kn.checkSession();const m=ge.subscribe(x=>{x.lastMessage?.command==="sessionEstablished"&&(console.log("Demo mode: Received session established message"),kn.establishSession(x.lastMessage.payload))});return typeof window<"u"&&window.electronAPI&&window.electronAPI.onUiRefreshRequest&&window.electronAPI.onUiRefreshRequest(()=>{console.log("UI refresh requested - switching to selection view and refreshing data"),K("INFO","UI refresh requested after menu import"),yt.set("selection"),ge.send({command:"getCategories"}),setTimeout(()=>{window.location.reload()},1e3)}),()=>{m()}});function s(m){h(a,m.detail)}function i(){t(r)&&typeof t(r).getIsAtBottom=="function"&&(t(r).getIsAtBottom()&&typeof t(r).cycleViews=="function"?t(r).cycleViews():typeof t(r).scrollToBottom=="function"&&t(r).scrollToBottom())}Mt();var l=_u(),c=xe(l),o=f(c),u=f(o);fn(Hl(u,{$$events:{scrollstate:s},$$legacy:!0}),m=>h(r,m),()=>t(r));var y=w(o,2),g=f(y);Vc(g,{handleSmartAction:i,get isAtBottom(){return t(a)},get consoleViewComponent(){return t(r)}});var T=w(c,2);yu(T,{}),k(e,l),bt()}window.onerror=function(e,n,r,a,s){return K("ERROR","Unhandled Frontend Exception",{type:"window.onerror",message:e,source:n,lineno:r,colno:a,error:s?s.stack:"N/A"}),!0};window.addEventListener("unhandledrejection",e=>{K("ERROR","Unhandled Promise Rejection",{type:"unhandledrejection",reason:e.reason?e.reason.message||e.reason:"No reason provided",stack:e.reason?e.reason.stack:"N/A"})});bo(bu,{target:document.getElementById("app")});
