(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const ks=!1;var Yn=Array.isArray,ma=Array.prototype.indexOf,Nr=Array.from,sr=Object.defineProperty,ln=Object.getOwnPropertyDescriptor,Cs=Object.getOwnPropertyDescriptors,ga=Object.prototype,ha=Array.prototype,Or=Object.getPrototypeOf,ns=Object.isExtensible;const en=()=>{};function _a(e){return e()}function ar(e){for(var t=0;t<e.length;t++)e[t]()}function ya(){var e,t,n=new Promise((i,s)=>{e=i,t=s});return{promise:n,resolve:e,reject:t}}const St=2,Dr=4,pr=8,Xn=16,Wt=32,pn=64,Es=128,Ct=256,ir=512,st=1024,Et=2048,Ht=4096,Mt=8192,mn=16384,Pr=32768,Lr=65536,rs=1<<17,ba=1<<18,Ur=1<<19,Fr=1<<20,Er=1<<21,jr=1<<22,cn=1<<23,qt=Symbol("$state"),wa=Symbol("legacy props"),Br=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Sa(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function mr(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function xa(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Ta(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function ka(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function Ca(e){throw new Error("https://svelte.dev/e/effect_orphan")}function Ea(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function Ia(e){throw new Error("https://svelte.dev/e/lifecycle_legacy_only")}function Ma(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function $a(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function Aa(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Ra(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const gr=1,hr=2,Is=4,Na=8,Oa=16,Da=2,Pa=4,La=8,Ua=1,Fa=2,nt=Symbol(),ja="http://www.w3.org/1999/xhtml";function Ba(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let qa=!1;function Ms(e){return e===this.v}function $s(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function As(e){return!$s(e,this.v)}let Rn=!1,Va=!1;function Ga(){Rn=!0}let $e=null;function or(e){$e=e}function pt(e,t=!1,n){$e={p:$e,c:null,e:null,s:e,x:null,l:Rn&&!t?{s:null,u:null,$:[]}:null}}function mt(e){var t=$e,n=t.e;if(n!==null){t.e=null;for(var i of n)Gs(i)}return e!==void 0&&(t.x=e),$e=t.p,e??{}}function Nn(){return!Rn||$e!==null&&$e.l===null}const za=new WeakMap;function Wa(e){var t=_e;if(t===null)return we.f|=cn,e;if((t.f&Pr)===0){if((t.f&Es)===0)throw!t.parent&&e instanceof Error&&Rs(e),e;t.b.error(e)}else qr(e,t)}function qr(e,t){for(;t!==null;){if((t.f&Es)!==0)try{t.b.error(e);return}catch(n){e=n}t=t.parent}throw e instanceof Error&&Rs(e),e}function Rs(e){const t=za.get(e);t&&(sr(e,"message",{value:t.message}),sr(e,"stack",{value:t.stack}))}let lr=[];function Ha(){var e=lr;lr=[],ar(e)}function Vr(e){lr.length===0&&queueMicrotask(Ha),lr.push(e)}function Ja(){for(var e=_e.b;e!==null&&!e.has_pending_snippet();)e=e.parent;return e===null&&Sa(),e}function Gr(e){var t=St|Et,n=we!==null&&(we.f&St)!==0?we:null;return _e===null||n!==null&&(n.f&Ct)!==0?t|=Ct:_e.f|=Ur,{ctx:$e,deps:null,effects:null,equals:Ms,f:t,fn:e,reactions:null,rv:0,v:nt,wv:0,parent:n??_e,ac:null}}function Ka(e,t){let n=_e;n===null&&xa();var i=n.b,s=void 0,a=Wn(nt),o=null,u=!we;return li(()=>{try{var l=e()}catch(m){l=Promise.reject(m)}var c=()=>l;s=o?.then(c,c)??Promise.resolve(l),o=s;var g=Oe,p=i.pending;u&&(i.update_pending_count(1),p||g.increment());const w=(m,y=void 0)=>{o=null,p||g.activate(),y?y!==Br&&(a.f|=cn,Mn(a,y)):((a.f&cn)!==0&&(a.f^=cn),Mn(a,m)),u&&(i.update_pending_count(-1),p||g.decrement()),Ds()};if(s.then(w,m=>w(null,m||"unknown")),g)return()=>{queueMicrotask(()=>g.neuter())}}),new Promise(l=>{function c(g){function p(){g===s?l(a):c(s)}g.then(p,p)}c(s)})}function Me(e){const t=Gr(e);return t.equals=As,t}function Ns(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)Gt(t[n])}}function Ya(e){for(var t=e.parent;t!==null;){if((t.f&St)===0)return t;t=t.parent}return null}function zr(e){var t,n=_e;rn(Ya(e));try{Ns(e),t=na(e)}finally{rn(n)}return t}function Os(e){var t=zr(e);if(e.equals(t)||(e.v=t,e.wv=ea()),!gn)if(En!==null)En.set(e,e.v);else{var n=(Zt||(e.f&Ct)!==0)&&e.deps!==null?Ht:st;dt(e,n)}}function Xa(e,t,n){const i=Nn()?Gr:Me;if(t.length===0){n(e.map(i));return}var s=Oe,a=_e,o=Qa(),u=Ja();Promise.all(t.map(l=>Ka(l))).then(l=>{s?.activate(),o();try{n([...e.map(i),...l])}catch(c){(a.f&mn)===0&&qr(c,a)}s?.deactivate(),Ds()}).catch(l=>{u.error(l)})}function Qa(){var e=_e,t=we,n=$e;return function(){rn(e),Lt(t),or(n)}}function Ds(){rn(null),Lt(null),or(null)}const jn=new Set;let Oe=null,rr=null,En=null,ss=new Set,cr=[];function Ps(){const e=cr.shift();cr.length>0&&queueMicrotask(Ps),e()}let zn=[],Wr=null,Ir=!1;class In{current=new Map;#e=new Map;#n=new Set;#t=0;#s=null;#u=!1;#a=[];#o=[];#i=[];#r=[];#l=[];#d=[];#f=[];skipped_effects=new Set;process(t){zn=[],rr=null;var n=null;if(jn.size>1){n=new Map,En=new Map;for(const[a,o]of this.current)n.set(a,{v:a.v,wv:a.wv}),a.v=o;for(const a of jn)if(a!==this)for(const[o,u]of a.#e)n.has(o)||(n.set(o,{v:o.v,wv:o.wv}),o.v=u)}for(const a of t)this.#p(a);if(this.#a.length===0&&this.#t===0){this.#v();var i=this.#i,s=this.#r;this.#i=[],this.#r=[],this.#l=[],rr=Oe,Oe=null,as(i),as(s),Oe===null?Oe=this:jn.delete(this),this.#s?.resolve()}else this.#c(this.#i),this.#c(this.#r),this.#c(this.#l);if(n){for(const[a,{v:o,wv:u}]of n)a.wv<=u&&(a.v=o);En=null}for(const a of this.#a)kn(a);for(const a of this.#o)kn(a);this.#a=[],this.#o=[]}#p(t){t.f^=st;for(var n=t.first;n!==null;){var i=n.f,s=(i&(Wt|pn))!==0,a=s&&(i&st)!==0,o=a||(i&Mt)!==0||this.skipped_effects.has(n);if(!o&&n.fn!==null){if(s)n.f^=st;else if((i&st)===0)if((i&Dr)!==0)this.#r.push(n);else if((i&jr)!==0){var u=n.b?.pending?this.#o:this.#a;u.push(n)}else Qn(n)&&((n.f&Xn)!==0&&this.#l.push(n),kn(n));var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)n=c.next,c=c.parent}}#c(t){for(const n of t)((n.f&Et)!==0?this.#d:this.#f).push(n),dt(n,st);t.length=0}capture(t,n){this.#e.has(t)||this.#e.set(t,n),this.current.set(t,t.v)}activate(){Oe=this}deactivate(){Oe=null,rr=null;for(const t of ss)if(ss.delete(t),t(),Oe!==null)break}neuter(){this.#u=!0}flush(){zn.length>0?Za():this.#v(),Oe===this&&(this.#t===0&&jn.delete(this),this.deactivate())}#v(){if(!this.#u)for(const t of this.#n)t();this.#n.clear()}increment(){this.#t+=1}decrement(){if(this.#t-=1,this.#t===0){for(const t of this.#d)dt(t,Et),fn(t);for(const t of this.#f)dt(t,Ht),fn(t);this.#i=[],this.#r=[],this.flush()}else this.deactivate()}add_callback(t){this.#n.add(t)}settled(){return(this.#s??=ya()).promise}static ensure(){if(Oe===null){const t=Oe=new In;jn.add(Oe),In.enqueue(()=>{Oe===t&&t.flush()})}return Oe}static enqueue(t){cr.length===0&&queueMicrotask(Ps),cr.unshift(t)}}function Za(){var e=Tn;Ir=!0;try{var t=0;for(ls(!0);zn.length>0;){var n=In.ensure();if(t++>1e3){var i,s;ei()}n.process(zn),un.clear()}}finally{Ir=!1,ls(e),Wr=null}}function ei(){try{Ea()}catch(e){qr(e,Wr)}}function as(e){var t=e.length;if(t!==0){for(var n=0;n<t;){var i=e[n++];if((i.f&(mn|Mt))===0&&Qn(i)){var s=Oe?Oe.current.size:0;if(kn(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null&&i.ac===null?Ks(i):i.fn=null),Oe!==null&&Oe.current.size>s&&(i.f&Fr)!==0)break}}for(;n<t;)fn(e[n++])}}function fn(e){for(var t=Wr=e;t.parent!==null;){t=t.parent;var n=t.f;if(Ir&&t===_e&&(n&Xn)!==0)return;if((n&(pn|Wt))!==0){if((n&st)===0)return;t.f^=st}}zn.push(t)}const un=new Map;function Wn(e,t){var n={f:0,v:e,reactions:null,equals:Ms,rv:0,wv:0};return n}function Xt(e,t){const n=Wn(e);return di(n),n}function V(e,t=!1,n=!0){const i=Wn(e);return t||(i.equals=As),Rn&&n&&$e!==null&&$e.l!==null&&($e.l.s??=[]).push(i),i}function Be(e,t){return b(e,M(()=>r(e))),t}function b(e,t,n=!1){we!==null&&(!Ot||(we.f&rs)!==0)&&Nn()&&(we.f&(St|Xn|jr|rs))!==0&&!Vt?.includes(e)&&Ra();let i=n?xn(t):t;return Mn(e,i)}function Mn(e,t){if(!e.equals(t)){var n=e.v;gn?un.set(e,t):un.set(e,n),e.v=t;var i=In.ensure();i.capture(e,n),(e.f&St)!==0&&((e.f&Et)!==0&&zr(e),dt(e,(e.f&Ct)===0?st:Ht)),e.wv=ea(),Ls(e,Et),Nn()&&_e!==null&&(_e.f&st)!==0&&(_e.f&(Wt|pn))===0&&(kt===null?fi([e]):kt.push(e))}return t}function Sr(e){b(e,e.v+1)}function Ls(e,t){var n=e.reactions;if(n!==null)for(var i=Nn(),s=n.length,a=0;a<s;a++){var o=n[a],u=o.f;if(!(!i&&o===_e)){var l=(u&Et)===0;l&&dt(o,t),(u&St)!==0?Ls(o,Ht):l&&fn(o)}}}function xn(e){if(typeof e!="object"||e===null||qt in e)return e;const t=Or(e);if(t!==ga&&t!==ha)return e;var n=new Map,i=Yn(e),s=Xt(0),a=dn,o=u=>{if(dn===a)return u();var l=we,c=dn;Lt(null),us(a);var g=u();return Lt(l),us(c),g};return i&&n.set("length",Xt(e.length)),new Proxy(e,{defineProperty(u,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&$a();var g=n.get(l);return g===void 0?g=o(()=>{var p=Xt(c.value);return n.set(l,p),p}):b(g,c.value,!0),!0},deleteProperty(u,l){var c=n.get(l);if(c===void 0){if(l in u){const g=o(()=>Xt(nt));n.set(l,g),Sr(s)}}else b(c,nt),Sr(s);return!0},get(u,l,c){if(l===qt)return e;var g=n.get(l),p=l in u;if(g===void 0&&(!p||ln(u,l)?.writable)&&(g=o(()=>{var m=xn(p?u[l]:nt),y=Xt(m);return y}),n.set(l,g)),g!==void 0){var w=r(g);return w===nt?void 0:w}return Reflect.get(u,l,c)},getOwnPropertyDescriptor(u,l){var c=Reflect.getOwnPropertyDescriptor(u,l);if(c&&"value"in c){var g=n.get(l);g&&(c.value=r(g))}else if(c===void 0){var p=n.get(l),w=p?.v;if(p!==void 0&&w!==nt)return{enumerable:!0,configurable:!0,value:w,writable:!0}}return c},has(u,l){if(l===qt)return!0;var c=n.get(l),g=c!==void 0&&c.v!==nt||Reflect.has(u,l);if(c!==void 0||_e!==null&&(!g||ln(u,l)?.writable)){c===void 0&&(c=o(()=>{var w=g?xn(u[l]):nt,m=Xt(w);return m}),n.set(l,c));var p=r(c);if(p===nt)return!1}return g},set(u,l,c,g){var p=n.get(l),w=l in u;if(i&&l==="length")for(var m=c;m<p.v;m+=1){var y=n.get(m+"");y!==void 0?b(y,nt):m in u&&(y=o(()=>Xt(nt)),n.set(m+"",y))}if(p===void 0)(!w||ln(u,l)?.writable)&&(p=o(()=>Xt(void 0)),b(p,xn(c)),n.set(l,p));else{w=p.v!==nt;var k=o(()=>xn(c));b(p,k)}var O=Reflect.getOwnPropertyDescriptor(u,l);if(O?.set&&O.set.call(g,c),!w){if(i&&typeof l=="string"){var F=n.get("length"),q=Number(l);Number.isInteger(q)&&q>=F.v&&b(F,q+1)}Sr(s)}return!0},ownKeys(u){r(s);var l=Reflect.ownKeys(u).filter(p=>{var w=n.get(p);return w===void 0||w.v!==nt});for(var[c,g]of n)g.v!==nt&&!(c in u)&&l.push(c);return l},setPrototypeOf(){Aa()}})}function is(e){try{if(e!==null&&typeof e=="object"&&qt in e)return e[qt]}catch{}return e}function ti(e,t){return Object.is(is(e),is(t))}var Hn,Us,Fs,js;function ni(){if(Hn===void 0){Hn=window,Us=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,n=Text.prototype;Fs=ln(t,"firstChild").get,js=ln(t,"nextSibling").get,ns(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),ns(n)&&(n.__t=void 0)}}function On(e=""){return document.createTextNode(e)}function Dt(e){return Fs.call(e)}function _r(e){return js.call(e)}function f(e,t){return Dt(e)}function ke(e,t){{var n=Dt(e);return n instanceof Comment&&n.data===""?_r(n):n}}function h(e,t=1,n=!1){let i=e;for(;t--;)i=_r(i);return i}function ri(e){e.textContent=""}function Bs(){return!1}let os=!1;function si(){os||(os=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{if(!e.defaultPrevented)for(const t of e.target.elements)t.__on_r?.()})},{capture:!0}))}function yr(e){var t=we,n=_e;Lt(null),rn(null);try{return e()}finally{Lt(t),rn(n)}}function qs(e,t,n,i=n){e.addEventListener(t,()=>yr(n));const s=e.__on_r;s?e.__on_r=()=>{s(),i(!0)}:e.__on_r=()=>i(!0),si()}function Vs(e){_e===null&&we===null&&Ca(),we!==null&&(we.f&Ct)!==0&&_e===null&&ka(),gn&&Ta()}function ai(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function Ut(e,t,n,i=!0){var s=_e;s!==null&&(s.f&Mt)!==0&&(e|=Mt);var a={ctx:$e,deps:null,nodes_start:null,nodes_end:null,f:e|Et,first:null,fn:t,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{kn(a),a.f|=Pr}catch(l){throw Gt(a),l}else t!==null&&fn(a);var o=n&&a.deps===null&&a.first===null&&a.nodes_start===null&&a.teardown===null&&(a.f&Ur)===0;if(!o&&i&&(s!==null&&ai(a,s),we!==null&&(we.f&St)!==0&&(e&pn)===0)){var u=we;(u.effects??=[]).push(a)}return a}function br(e){const t=Ut(pr,null,!1);return dt(t,st),t.teardown=e,t}function Mr(e){Vs();var t=_e.f,n=!we&&(t&Wt)!==0&&(t&Pr)===0;if(n){var i=$e;(i.e??=[]).push(e)}else return Gs(e)}function Gs(e){return Ut(Dr|Fr,e,!1)}function ii(e){return Vs(),Ut(pr|Fr,e,!0)}function oi(e){In.ensure();const t=Ut(pn,e,!0);return(n={})=>new Promise(i=>{n.outro?Jr(t,()=>{Gt(t),i(void 0)}):(Gt(t),i(void 0))})}function Hr(e){return Ut(Dr,e,!1)}function Fe(e,t){var n=$e,i={effect:null,ran:!1,deps:e};n.l.$.push(i),i.effect=wr(()=>{e(),!i.ran&&(i.ran=!0,M(t))})}function sn(){var e=$e;wr(()=>{for(var t of e.l.$){t.deps();var n=t.effect;(n.f&st)!==0&&dt(n,Ht),Qn(n)&&kn(n),t.ran=!1}})}function li(e){return Ut(jr|Ur,e,!0)}function wr(e,t=0){return Ut(pr|t,e,!0)}function ee(e,t=[],n=[]){Xa(t,n,i=>{Ut(pr,()=>e(...i.map(r)),!0)})}function zs(e,t=0){var n=Ut(Xn|t,e,!0);return n}function Jn(e,t=!0){return Ut(Wt,e,!0,t)}function Ws(e){var t=e.teardown;if(t!==null){const n=gn,i=we;cs(!0),Lt(null);try{t.call(null)}finally{cs(n),Lt(i)}}}function Hs(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){const s=n.ac;s!==null&&yr(()=>{s.abort(Br)});var i=n.next;(n.f&pn)!==0?n.parent=null:Gt(n,t),n=i}}function ci(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&Wt)===0&&Gt(t),t=n}}function Gt(e,t=!0){var n=!1;(t||(e.f&ba)!==0)&&e.nodes_start!==null&&e.nodes_end!==null&&(Js(e.nodes_start,e.nodes_end),n=!0),Hs(e,t&&!n),ur(e,0),dt(e,mn);var i=e.transitions;if(i!==null)for(const a of i)a.stop();Ws(e);var s=e.parent;s!==null&&s.first!==null&&Ks(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=e.ac=null}function Js(e,t){for(;e!==null;){var n=e===t?null:_r(e);e.remove(),e=n}}function Ks(e){var t=e.parent,n=e.prev,i=e.next;n!==null&&(n.next=i),i!==null&&(i.prev=n),t!==null&&(t.first===e&&(t.first=i),t.last===e&&(t.last=n))}function Jr(e,t){var n=[];Kr(e,n,!0),Ys(n,()=>{Gt(e),t&&t()})}function Ys(e,t){var n=e.length;if(n>0){var i=()=>--n||t();for(var s of e)s.out(i)}else t()}function Kr(e,t,n){if((e.f&Mt)===0){if(e.f^=Mt,e.transitions!==null)for(const o of e.transitions)(o.is_global||n)&&t.push(o);for(var i=e.first;i!==null;){var s=i.next,a=(i.f&Lr)!==0||(i.f&Wt)!==0;Kr(i,t,a?n:!1),i=s}}}function Yr(e){Xs(e,!0)}function Xs(e,t){if((e.f&Mt)!==0){e.f^=Mt,(e.f&st)===0&&(dt(e,Et),fn(e));for(var n=e.first;n!==null;){var i=n.next,s=(n.f&Lr)!==0||(n.f&Wt)!==0;Xs(n,s?t:!1),n=i}if(e.transitions!==null)for(const a of e.transitions)(a.is_global||t)&&a.in()}}let Sn=null;function ui(e){var t=Sn;try{if(Sn=new Set,M(e),t!==null)for(var n of Sn)t.add(n);return Sn}finally{Sn=t}}function Qs(e){for(var t of ui(e))Mn(t,t.v)}let Tn=!1;function ls(e){Tn=e}let gn=!1;function cs(e){gn=e}let we=null,Ot=!1;function Lt(e){we=e}let _e=null;function rn(e){_e=e}let Vt=null;function di(e){we!==null&&(Vt===null?Vt=[e]:Vt.push(e))}let ut=null,bt=0,kt=null;function fi(e){kt=e}let Zs=1,Kn=0,dn=Kn;function us(e){dn=e}let Zt=!1;function ea(){return++Zs}function Qn(e){var t=e.f;if((t&Et)!==0)return!0;if((t&Ht)!==0){var n=e.deps,i=(t&Ct)!==0;if(n!==null){var s,a,o=(t&ir)!==0,u=i&&_e!==null&&!Zt,l=n.length;if((o||u)&&(_e===null||(_e.f&mn)===0)){var c=e,g=c.parent;for(s=0;s<l;s++)a=n[s],(o||!a?.reactions?.includes(c))&&(a.reactions??=[]).push(c);o&&(c.f^=ir),u&&g!==null&&(g.f&Ct)===0&&(c.f^=Ct)}for(s=0;s<l;s++)if(a=n[s],Qn(a)&&Os(a),a.wv>e.wv)return!0}(!i||_e!==null&&!Zt)&&dt(e,st)}return!1}function ta(e,t,n=!0){var i=e.reactions;if(i!==null&&!Vt?.includes(e))for(var s=0;s<i.length;s++){var a=i[s];(a.f&St)!==0?ta(a,t,!1):t===a&&(n?dt(a,Et):(a.f&st)!==0&&dt(a,Ht),fn(a))}}function na(e){var t=ut,n=bt,i=kt,s=we,a=Zt,o=Vt,u=$e,l=Ot,c=dn,g=e.f;ut=null,bt=0,kt=null,Zt=(g&Ct)!==0&&(Ot||!Tn||we===null),we=(g&(Wt|pn))===0?e:null,Vt=null,or(e.ctx),Ot=!1,dn=++Kn,e.ac!==null&&(yr(()=>{e.ac.abort(Br)}),e.ac=null);try{e.f|=Er;var p=e.fn,w=p(),m=e.deps;if(ut!==null){var y;if(ur(e,bt),m!==null&&bt>0)for(m.length=bt+ut.length,y=0;y<ut.length;y++)m[bt+y]=ut[y];else e.deps=m=ut;if(!Zt||(g&St)!==0&&e.reactions!==null)for(y=bt;y<m.length;y++)(m[y].reactions??=[]).push(e)}else m!==null&&bt<m.length&&(ur(e,bt),m.length=bt);if(Nn()&&kt!==null&&!Ot&&m!==null&&(e.f&(St|Ht|Et))===0)for(y=0;y<kt.length;y++)ta(kt[y],e);return s!==null&&s!==e&&(Kn++,kt!==null&&(i===null?i=kt:i.push(...kt))),(e.f&cn)!==0&&(e.f^=cn),w}catch(k){return Wa(k)}finally{e.f^=Er,ut=t,bt=n,kt=i,we=s,Zt=a,Vt=o,or(u),Ot=l,dn=c}}function vi(e,t){let n=t.reactions;if(n!==null){var i=ma.call(n,e);if(i!==-1){var s=n.length-1;s===0?n=t.reactions=null:(n[i]=n[s],n.pop())}}n===null&&(t.f&St)!==0&&(ut===null||!ut.includes(t))&&(dt(t,Ht),(t.f&(Ct|ir))===0&&(t.f^=ir),Ns(t),ur(t,0))}function ur(e,t){var n=e.deps;if(n!==null)for(var i=t;i<n.length;i++)vi(e,n[i])}function kn(e){var t=e.f;if((t&mn)===0){dt(e,st);var n=_e,i=Tn;_e=e,Tn=!0;try{(t&Xn)!==0?ci(e):Hs(e),Ws(e);var s=na(e);e.teardown=typeof s=="function"?s:null,e.wv=Zs;var a;ks&&Va&&(e.f&Et)!==0&&e.deps}finally{Tn=i,_e=n}}}function r(e){var t=e.f,n=(t&St)!==0;if(Sn?.add(e),we!==null&&!Ot){var i=_e!==null&&(_e.f&mn)!==0;if(!i&&!Vt?.includes(e)){var s=we.deps;if((we.f&Er)!==0)e.rv<Kn&&(e.rv=Kn,ut===null&&s!==null&&s[bt]===e?bt++:ut===null?ut=[e]:(!Zt||!ut.includes(e))&&ut.push(e));else{(we.deps??=[]).push(e);var a=e.reactions;a===null?e.reactions=[we]:a.includes(we)||a.push(we)}}}else if(n&&e.deps===null&&e.effects===null){var o=e,u=o.parent;u!==null&&(u.f&Ct)===0&&(o.f^=Ct)}if(gn){if(un.has(e))return un.get(e);if(n){o=e;var l=o.v;return((o.f&st)===0&&o.reactions!==null||ra(o))&&(l=zr(o)),un.set(o,l),l}}else if(n){if(o=e,En?.has(o))return En.get(o);Qn(o)&&Os(o)}if((e.f&cn)!==0)throw e.v;return e.v}function ra(e){if(e.v===nt)return!0;if(e.deps===null)return!1;for(const t of e.deps)if(un.has(t)||(t.f&St)!==0&&ra(t))return!0;return!1}function M(e){var t=Ot;try{return Ot=!0,e()}finally{Ot=t}}const pi=-7169;function dt(e,t){e.f=e.f&pi|t}function ue(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(qt in e)$r(e);else if(!Array.isArray(e))for(let t in e){const n=e[t];typeof n=="object"&&n&&qt in n&&$r(n)}}}function $r(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let i in e)try{$r(e[i],t)}catch{}const n=Or(e);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const i=Cs(n);for(let s in i){const a=i[s].get;if(a)try{a.call(e)}catch{}}}}}const mi=["touchstart","touchmove"];function gi(e){return mi.includes(e)}const hi=new Set,ds=new Set;function _i(e,t,n,i={}){function s(a){if(i.capture||Bn.call(t,a),!a.cancelBubble)return yr(()=>n?.call(this,a))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Vr(()=>{t.addEventListener(e,s,i)}):t.addEventListener(e,s,i),s}function Y(e,t,n,i,s){var a={capture:i,passive:s},o=_i(e,t,n,a);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&br(()=>{t.removeEventListener(e,o,a)})}let fs=null;function Bn(e){var t=this,n=t.ownerDocument,i=e.type,s=e.composedPath?.()||[],a=s[0]||e.target;fs=e;var o=0,u=fs===e&&e.__root;if(u){var l=s.indexOf(u);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var c=s.indexOf(t);if(c===-1)return;l<=c&&(o=l)}if(a=s[o]||e.target,a!==t){sr(e,"currentTarget",{configurable:!0,get(){return a||n}});var g=we,p=_e;Lt(null),rn(null);try{for(var w,m=[];a!==null;){var y=a.assignedSlot||a.parentNode||a.host||null;try{var k=a["__"+i];if(k!=null&&(!a.disabled||e.target===a))if(Yn(k)){var[O,...F]=k;O.apply(a,[e,...F])}else k.call(a,e)}catch(q){w?m.push(q):w=q}if(e.cancelBubble||y===t||y===null)break;a=y}if(w){for(let q of m)queueMicrotask(()=>{throw q});throw w}}finally{e.__root=t,delete e.currentTarget,Lt(g),rn(p)}}}function Xr(e){var t=document.createElement("template");return t.innerHTML=e.replaceAll("<!>","<!---->"),t.content}function $n(e,t){var n=_e;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=t)}function U(e,t){var n=(t&Ua)!==0,i=(t&Fa)!==0,s,a=!e.startsWith("<!>");return()=>{s===void 0&&(s=Xr(a?e:"<!>"+e),n||(s=Dt(s)));var o=i||Us?document.importNode(s,!0):s.cloneNode(!0);if(n){var u=Dt(o),l=o.lastChild;$n(u,l)}else $n(o,o);return o}}function yi(e,t,n="svg"){var i=!e.startsWith("<!>"),s=`<${n}>${i?e:"<!>"+e}</${n}>`,a;return()=>{if(!a){var o=Xr(s),u=Dt(o);a=Dt(u)}var l=a.cloneNode(!0);return $n(l,l),l}}function sa(e,t){return yi(e,t,"svg")}function Pt(e=""){{var t=On(e+"");return $n(t,t),t}}function Ve(){var e=document.createDocumentFragment(),t=document.createComment(""),n=On();return e.append(t,n),$n(t,n),e}function T(e,t){e!==null&&e.before(t)}function Z(e,t){var n=t==null?"":typeof t=="object"?t+"":t;n!==(e.__t??=e.nodeValue)&&(e.__t=n,e.nodeValue=n+"")}function bi(e,t){return wi(e,t)}const yn=new Map;function wi(e,{target:t,anchor:n,props:i={},events:s,context:a,intro:o=!0}){ni();var u=new Set,l=p=>{for(var w=0;w<p.length;w++){var m=p[w];if(!u.has(m)){u.add(m);var y=gi(m);t.addEventListener(m,Bn,{passive:y});var k=yn.get(m);k===void 0?(document.addEventListener(m,Bn,{passive:y}),yn.set(m,1)):yn.set(m,k+1)}}};l(Nr(hi)),ds.add(l);var c=void 0,g=oi(()=>{var p=n??t.appendChild(On());return Jn(()=>{if(a){pt({});var w=$e;w.c=a}s&&(i.$$events=s),c=e(p,i)||{},a&&mt()}),()=>{for(var w of u){t.removeEventListener(w,Bn);var m=yn.get(w);--m===0?(document.removeEventListener(w,Bn),yn.delete(w)):yn.set(w,m)}ds.delete(l),p!==n&&p.parentNode?.removeChild(p)}});return Si.set(c,g),c}let Si=new WeakMap;function H(e,t,n=!1){var i=e,s=null,a=null,o=nt,u=n?Lr:0,l=!1;const c=(m,y=!0)=>{l=!0,w(y,m)};var g=null;function p(){g!==null&&(g.lastChild.remove(),i.before(g),g=null);var m=o?s:a,y=o?a:s;m&&Yr(m),y&&Jr(y,()=>{o?a=null:s=null})}const w=(m,y)=>{if(o!==(o=m)){var k=Bs(),O=i;if(k&&(g=document.createDocumentFragment(),g.append(O=On())),o?s??=y&&Jn(()=>y(O)):a??=y&&Jn(()=>y(O)),k){var F=Oe,q=o?s:a,d=o?a:s;q&&F.skipped_effects.delete(q),d&&F.skipped_effects.add(d),F.add_callback(p)}else p()}};zs(()=>{l=!1,t(c),l||w(null,null)},u)}function dr(e,t){return t}function xi(e,t,n){for(var i=e.items,s=[],a=t.length,o=0;o<a;o++)Kr(t[o].e,s,!0);var u=a>0&&s.length===0&&n!==null;if(u){var l=n.parentNode;ri(l),l.append(n),i.clear(),Nt(e,t[0].prev,t[a-1].next)}Ys(s,()=>{for(var c=0;c<a;c++){var g=t[c];u||(i.delete(g.k),Nt(e,g.prev,g.next)),Gt(g.e,!u)}})}function $t(e,t,n,i,s,a=null){var o=e,u={flags:t,items:new Map,first:null},l=(t&Is)!==0;if(l){var c=e;o=c.appendChild(On())}var g=null,p=!1,w=new Map,m=Me(()=>{var F=n();return Yn(F)?F:F==null?[]:Nr(F)}),y,k;function O(){Ti(k,y,u,w,o,s,t,i,n),a!==null&&(y.length===0?g?Yr(g):g=Jn(()=>a(o)):g!==null&&Jr(g,()=>{g=null}))}zs(()=>{k??=_e,y=r(m);var F=y.length;if(!(p&&F===0)){p=F===0;var q,d,A,x;if(Bs()){var _=new Set,v=Oe;for(d=0;d<F;d+=1){A=y[d],x=i(A,d);var C=u.items.get(x)??w.get(x);C?(t&(gr|hr))!==0&&aa(C,A,d,t):(q=ia(null,u,null,null,A,x,d,s,t,n,!0),w.set(x,q)),_.add(x)}for(const[z,D]of u.items)_.has(z)||v.skipped_effects.add(D.e);v.add_callback(O)}else O();r(m)}})}function Ti(e,t,n,i,s,a,o,u,l){var c=(o&Na)!==0,g=(o&(gr|hr))!==0,p=t.length,w=n.items,m=n.first,y=m,k,O=null,F,q=[],d=[],A,x,_,v;if(c)for(v=0;v<p;v+=1)A=t[v],x=u(A,v),_=w.get(x),_!==void 0&&(_.a?.measure(),(F??=new Set).add(_));for(v=0;v<p;v+=1){if(A=t[v],x=u(A,v),_=w.get(x),_===void 0){var C=i.get(x);if(C!==void 0){i.delete(x),w.set(x,C);var z=O?O.next:y;Nt(n,O,C),Nt(n,C,z),xr(C,z,s),O=C}else{var D=y?y.e.nodes_start:s;O=ia(D,n,O,O===null?n.first:O.next,A,x,v,a,o,l)}w.set(x,O),q=[],d=[],y=O.next;continue}if(g&&aa(_,A,v,o),(_.e.f&Mt)!==0&&(Yr(_.e),c&&(_.a?.unfix(),(F??=new Set).delete(_))),_!==y){if(k!==void 0&&k.has(_)){if(q.length<d.length){var K=d[0],L;O=K.prev;var E=q[0],G=q[q.length-1];for(L=0;L<q.length;L+=1)xr(q[L],K,s);for(L=0;L<d.length;L+=1)k.delete(d[L]);Nt(n,E.prev,G.next),Nt(n,O,E),Nt(n,G,K),y=K,O=G,v-=1,q=[],d=[]}else k.delete(_),xr(_,y,s),Nt(n,_.prev,_.next),Nt(n,_,O===null?n.first:O.next),Nt(n,O,_),O=_;continue}for(q=[],d=[];y!==null&&y.k!==x;)(y.e.f&Mt)===0&&(k??=new Set).add(y),d.push(y),y=y.next;if(y===null)continue;_=y}q.push(_),O=_,y=_.next}if(y!==null||k!==void 0){for(var B=k===void 0?[]:Nr(k);y!==null;)(y.e.f&Mt)===0&&B.push(y),y=y.next;var P=B.length;if(P>0){var fe=(o&Is)!==0&&p===0?s:null;if(c){for(v=0;v<P;v+=1)B[v].a?.measure();for(v=0;v<P;v+=1)B[v].a?.fix()}xi(n,B,fe)}}c&&Vr(()=>{if(F!==void 0)for(_ of F)_.a?.apply()}),e.first=n.first&&n.first.e,e.last=O&&O.e;for(var be of i.values())Gt(be.e);i.clear()}function aa(e,t,n,i){(i&gr)!==0&&Mn(e.v,t),(i&hr)!==0?Mn(e.i,n):e.i=n}function ia(e,t,n,i,s,a,o,u,l,c,g){var p=(l&gr)!==0,w=(l&Oa)===0,m=p?w?V(s,!1,!1):Wn(s):s,y=(l&hr)===0?o:Wn(o),k={i:y,v:m,k:a,a:null,e:null,prev:n,next:i};try{if(e===null){var O=document.createDocumentFragment();O.append(e=On())}return k.e=Jn(()=>u(e,m,y,c),qa),k.e.prev=n&&n.e,k.e.next=i&&i.e,n===null?g||(t.first=k):(n.next=k,n.e.next=k.e),i!==null&&(i.prev=k,i.e.prev=k.e),k}finally{}}function xr(e,t,n){for(var i=e.next?e.next.e.nodes_start:n,s=t?t.e.nodes_start:n,a=e.e.nodes_start;a!==null&&a!==i;){var o=_r(a);s.before(a),a=o}}function Nt(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function vs(e,t,n=!1,i=!1,s=!1){var a=e,o="";ee(()=>{var u=_e;if(o!==(o=t()??"")&&(u.nodes_start!==null&&(Js(u.nodes_start,u.nodes_end),u.nodes_start=u.nodes_end=null),o!=="")){var l=o+"";n?l=`<svg>${l}</svg>`:i&&(l=`<math>${l}</math>`);var c=Xr(l);if((n||i)&&(c=Dt(c)),$n(Dt(c),c.lastChild),n||i)for(;Dt(c);)a.before(Dt(c));else a.before(c)}})}function ki(e,t,n,i,s){var a=t.$$slots?.[n],o=!1;a===!0&&(a=t.children,o=!0),a===void 0||a(e,o?()=>i:i)}function Ci(e){const t={};e.children&&(t.default=!0);for(const n in e.$$slots)t[n]=!0;return t}const ps=[...` 	
\r\f \v\uFEFF`];function Ei(e,t,n){var i=e==null?"":""+e;if(t&&(i=i?i+" "+t:t),n){for(var s in n)if(n[s])i=i?i+" "+s:s;else if(i.length)for(var a=s.length,o=0;(o=i.indexOf(s,o))>=0;){var u=o+a;(o===0||ps.includes(i[o-1]))&&(u===i.length||ps.includes(i[u]))?i=(o===0?"":i.substring(0,o))+i.substring(u+1):o=u}}return i===""?null:i}function Ii(e,t){return e==null?null:String(e)}function Xe(e,t,n,i,s,a){var o=e.__className;if(o!==n||o===void 0){var u=Ei(n,i,a);u==null?e.removeAttribute("class"):e.className=u,e.__className=n}else if(a&&s!==a)for(var l in a){var c=!!a[l];(s==null||c!==!!s[l])&&e.classList.toggle(l,c)}return a}function vn(e,t,n,i){var s=e.__style;if(s!==t){var a=Ii(t);a==null?e.removeAttribute("style"):e.style.cssText=a,e.__style=t}return i}function oa(e,t,n=!1){if(e.multiple){if(t==null)return;if(!Yn(t))return Ba();for(var i of e.options)i.selected=t.includes(Gn(i));return}for(i of e.options){var s=Gn(i);if(ti(s,t)){i.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Mi(e){var t=new MutationObserver(()=>{oa(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),br(()=>{t.disconnect()})}function la(e,t,n=t){var i=!0;qs(e,"change",s=>{var a=s?"[selected]":":checked",o;if(e.multiple)o=[].map.call(e.querySelectorAll(a),Gn);else{var u=e.querySelector(a)??e.querySelector("option:not([disabled])");o=u&&Gn(u)}n(o)}),Hr(()=>{var s=t();if(oa(e,s,i),i&&s===void 0){var a=e.querySelector(":checked");a!==null&&(s=Gn(a),n(s))}e.__value=s,i=!1}),Mi(e)}function Gn(e){return"__value"in e?e.__value:e.value}const $i=Symbol("is custom element"),Ai=Symbol("is html");function ms(e,t){var n=ca(e);n.checked!==(n.checked=t??void 0)&&(e.checked=t)}function Ri(e,t,n,i){var s=ca(e);s[t]!==(s[t]=n)&&(n==null?e.removeAttribute(t):typeof n!="string"&&Ni(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function ca(e){return e.__attributes??={[$i]:e.nodeName.includes("-"),[Ai]:e.namespaceURI===ja}}var gs=new Map;function Ni(e){var t=gs.get(e.nodeName);if(t)return t;gs.set(e.nodeName,t=[]);for(var n,i=e,s=Element.prototype;s!==i;){n=Cs(i);for(var a in n)n[a].set&&t.push(a);i=Or(i)}return t}function Bt(e,t,n=t){var i=Nn(),s=new WeakSet;qs(e,"input",a=>{var o=a?e.defaultValue:e.value;if(o=Tr(e)?kr(o):o,n(o),Oe!==null&&s.add(Oe),i&&o!==(o=t())){var u=e.selectionStart,l=e.selectionEnd;e.value=o??"",l!==null&&(e.selectionStart=u,e.selectionEnd=Math.min(l,e.value.length))}}),M(t)==null&&e.value&&(n(Tr(e)?kr(e.value):e.value),Oe!==null&&s.add(Oe)),wr(()=>{var a=t();if(e===document.activeElement){var o=rr??Oe;if(s.has(o))return}Tr(e)&&a===kr(e.value)||e.type==="date"&&!a&&!e.value||a!==e.value&&(e.value=a??"")})}function Tr(e){var t=e.type;return t==="number"||t==="range"}function kr(e){return e===""?null:+e}function er(e,t,n){var i=ln(e,t);i&&i.set&&(e[t]=n,br(()=>{e[t]=null}))}class Qr{#e=new WeakMap;#n;#t;static entries=new WeakMap;constructor(t){this.#t=t}observe(t,n){var i=this.#e.get(t)||new Set;return i.add(n),this.#e.set(t,i),this.#s().observe(t,this.#t),()=>{var s=this.#e.get(t);s.delete(n),s.size===0&&(this.#e.delete(t),this.#n.unobserve(t))}}#s(){return this.#n??(this.#n=new ResizeObserver(t=>{for(var n of t){Qr.entries.set(n.target,n);for(var i of this.#e.get(n.target)||[])i(n)}}))}}var Oi=new Qr({box:"border-box"});function hs(e,t,n){var i=Oi.observe(e,()=>n(e[t]));Hr(()=>(M(()=>n(e[t])),i))}function _s(e,t){return e===t||e?.[qt]===t}function tn(e={},t,n,i){return Hr(()=>{var s,a;return wr(()=>{s=a,a=[],M(()=>{e!==n(...a)&&(t(e,...a),s&&_s(n(...s),e)&&t(null,...s))})}),()=>{Vr(()=>{a&&_s(n(...a),e)&&t(null,...a)})}}),e}function Di(e){return function(...t){var n=t[0];n.target===this&&e?.apply(this,t)}}function ua(e){return function(...t){var n=t[0];return n.preventDefault(),e?.apply(this,t)}}function xt(e=!1){const t=$e,n=t.l.u;if(!n)return;let i=()=>ue(t.s);if(e){let s=0,a={};const o=Gr(()=>{let u=!1;const l=t.s;for(const c in l)l[c]!==a[c]&&(a[c]=l[c],u=!0);return u&&s++,s});i=()=>r(o)}n.b.length&&ii(()=>{ys(t,i),ar(n.b)}),Mr(()=>{const s=M(()=>n.m.map(_a));return()=>{for(const a of s)typeof a=="function"&&a()}}),n.a.length&&Mr(()=>{ys(t,i),ar(n.a)})}function ys(e,t){if(e.l.s)for(const n of e.l.s)r(n);t()}function Zr(e,t,n){if(e==null)return t(void 0),n&&n(void 0),en;const i=M(()=>e.subscribe(t,n));return i.unsubscribe?()=>i.unsubscribe():i}const bn=[];function da(e,t){return{subscribe:gt(e,t).subscribe}}function gt(e,t=en){let n=null;const i=new Set;function s(u){if($s(e,u)&&(e=u,n)){const l=!bn.length;for(const c of i)c[1](),bn.push(c,e);if(l){for(let c=0;c<bn.length;c+=2)bn[c][0](bn[c+1]);bn.length=0}}}function a(u){s(u(e))}function o(u,l=en){const c=[u,l];return i.add(c),i.size===1&&(n=t(s,a)||en),u(e),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:s,update:a,subscribe:o}}function es(e,t,n){const i=!Array.isArray(e),s=i?[e]:e;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=t.length<2;return da(n,(o,u)=>{let l=!1;const c=[];let g=0,p=en;const w=()=>{if(g)return;p();const y=t(i?c[0]:c,o,u);a?o(y):p=typeof y=="function"?y:en},m=s.map((y,k)=>Zr(y,O=>{c[k]=O,g&=~(1<<k),l&&w()},()=>{g|=1<<k}));return l=!0,w(),function(){ar(m),p(),l=!1}})}function Dn(e){let t;return Zr(e,n=>t=n)(),t}let tr=!1,Ar=Symbol();function rt(e,t,n){const i=n[t]??={store:null,source:V(void 0),unsubscribe:en};if(i.store!==e&&!(Ar in n))if(i.unsubscribe(),i.store=e??null,e==null)i.source.v=void 0,i.unsubscribe=en;else{var s=!0;i.unsubscribe=Zr(e,a=>{s?i.source.v=a:b(i.source,a)}),s=!1}return e&&Ar in n?Dn(e):r(i.source)}function Pi(e,t){return e.set(t),t}function Zn(){const e={};function t(){br(()=>{for(var n in e)e[n].unsubscribe();sr(e,Ar,{enumerable:!1,value:!0})})}return[e,t]}function Li(e){var t=tr;try{return tr=!1,[e(),tr]}finally{tr=t}}function Ee(e,t,n,i){var s=!Rn||(n&Da)!==0,a=(n&La)!==0,o=i,u=!0,l=()=>(u&&(u=!1,o=i),o),c;{var g=qt in e||wa in e;c=ln(e,t)?.set??(g&&t in e?q=>e[t]=q:void 0)}var p,w=!1;[p,w]=Li(()=>e[t]),p===void 0&&i!==void 0&&(p=l(),c&&(s&&Ma(),c(p)));var m;if(s?m=()=>{var q=e[t];return q===void 0?l():(u=!0,q)}:m=()=>{var q=e[t];return q!==void 0&&(o=void 0),q===void 0?o:q},s&&(n&Pa)===0)return m;if(c){var y=e.$$legacy;return(function(q,d){return arguments.length>0?((!s||!d||y||w)&&c(d?m():q),q):m()})}var k=!1,O=Me(()=>(k=!1,m()));r(O);var F=_e;return(function(q,d){if(arguments.length>0){const A=d?r(O):s&&a?xn(q):q;return b(O,A),k=!0,o!==void 0&&(o=A),q}return gn&&k||(F.f&mn)!==0?O.v:r(O)})}function zt(e){$e===null&&mr(),Rn&&$e.l!==null?va($e).m.push(e):Mr(()=>{const t=M(e);if(typeof t=="function")return t})}function fa(e){$e===null&&mr(),zt(()=>()=>M(e))}function Ui(e,t,{bubbles:n=!1,cancelable:i=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:i})}function hn(){const e=$e;return e===null&&mr(),(t,n,i)=>{const s=e.s.$$events?.[t];if(s){const a=Yn(s)?s.slice():[s],o=Ui(t,n,i);for(const u of a)u.call(e.x,o);return!o.defaultPrevented}return!0}}function Fi(e){$e===null&&mr(),$e.l===null&&Ia(),va($e).a.push(e)}function va(e){var t=e.l;return t.u??={a:[],b:[],m:[]}}const ji="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(ji);Ga();const Bi="modulepreload",qi=function(e){return"/"+e},bs={},Qt=function(t,n,i){let s=Promise.resolve();if(n&&n.length>0){let c=function(g){return Promise.all(g.map(p=>Promise.resolve(p).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};var o=c;document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),l=u?.nonce||u?.getAttribute("nonce");s=c(n.map(g=>{if(g=qi(g),g in bs)return;bs[g]=!0;const p=g.endsWith(".css"),w=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${w}`))return;const m=document.createElement("link");if(m.rel=p?"stylesheet":Bi,p||(m.as="script"),m.crossOrigin="",m.href=g,l&&m.setAttribute("nonce",l),document.head.appendChild(m),p)return new Promise((y,k)=>{m.addEventListener("load",y),m.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${g}`)))})}))}function a(u){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=u,window.dispatchEvent(l),!l.defaultPrevented)throw u}return s.then(u=>{for(const l of u||[])l.status==="rejected"&&a(l.reason);return t().catch(a)})};class Vi{constructor(){this.store=gt({serverTime:null,clientTime:null,timeOffset:0,lastSync:null}),this.subscribe=this.store.subscribe,this.update=this.store.update,this.set=this.store.set}updateServerTime(t){const n=new Date(t),i=new Date,s=n.getTime()-i.getTime();this.update(a=>({...a,serverTime:n,clientTime:i,timeOffset:s,lastSync:i}))}getServerTime(){let t;if(this.subscribe(i=>t=i)(),!t.lastSync)return new Date;const n=new Date;return new Date(n.getTime()+t.timeOffset)}formatTimeElapsed(t){const n=new Date,i=new Date(t),s=n.getTime()-i.getTime(),a=Math.floor(s/(1e3*60));return a>0?a:0}resetTimeOffset(){this.update(t=>({...t,timeOffset:0,lastSync:null}))}}const fr=new Vi,Rr=es(fr,(e,t)=>{const n=()=>{const s=fr.getServerTime();t(s)};n();const i=setInterval(n,1e3);return()=>clearInterval(i)},new Date),Gi=es(Rr,(e,t)=>{let n=null;return Rr.subscribe(i=>{const s=i.getMinutes();n!==s&&(n=s,t({time:i,minute:s}))})},{time:new Date,minute:new Date().getMinutes()});function zi(){const{subscribe:e,set:t,update:n}=gt({connected:!1,isConnected:!1,lastMessage:null,error:null,sessionId:null,currentServer:null,serverIndex:0,connectionAttempts:0}),i=()=>{const _=window.location.hostname;return window.location.protocol==="https:"?[_]:[`${_}:3030`]};let s=null,a=null,o=0,u=0,l=null;const c=new Map,g=10,p=new Map;function w(){i().forEach(v=>{p.has(v)||p.set(v,{successfulConnections:0,failedConnections:0,averageResponseTime:0,lastConnectionTime:null,reliability:1})})}function m(_){const v=_.successfulConnections+_.failedConnections;if(v===0)return 1;const C=_.successfulConnections/v,z=_.averageResponseTime<1e3?.1:0;return Math.min(C+z,1)}function y(){const _=i();if(_.length===1)return 0;const v=_.map(D=>{const K=p.get(D);return K?K.reliability:1}),C=v.reduce((D,K)=>D+K,0);let z=Math.random()*C;for(let D=0;D<v.length;D++)if(z-=v[D],z<=0)return D;return Math.floor(Math.random()*_.length)}function k(){w(),o=y();const _=i();console.log(`Initialized with smart-selected server index: ${o} (${_[o]})`),console.log("Server reliability scores:",Array.from(p.entries()).map(([v,C])=>`${v}: ${(C.reliability*100).toFixed(1)}%`).join(", "))}function O(){const _=localStorage.getItem("ecKasse-session-id");_?a=_:(a=A(),localStorage.setItem("ecKasse-session-id",a)),n(v=>({...v,sessionId:a})),console.log("Session ID initialized:",a)}function F(){const _=i(),v=_[o];return o=(o+1)%_.length,v}function q(_=0){if(l&&(clearTimeout(l),l=null),_>=g){console.error("Max reconnection attempts reached. Stopping reconnection."),n(v=>({...v,connected:!1,isConnected:!1,error:"Failed to connect to any server after maximum attempts",connectionAttempts:_}));return}try{const v=F(),z=`${window.location.protocol==="https:"?"wss:":"ws:"}//${v}`;console.log(`Attempting WebSocket connection to ${z} (attempt ${_+1}/${g})`),n(L=>({...L,currentServer:v,serverIndex:o,connectionAttempts:_+1,error:null})),s=new WebSocket(z);const D=Date.now();s.onopen=()=>{const L=Date.now()-D;if(console.log(`WebSocket connected to ${v} (${L}ms)`),p.has(v)){const E=p.get(v);E.successfulConnections++,E.lastConnectionTime=L,E.averageResponseTime=E.averageResponseTime===0?L:(E.averageResponseTime+L)/2,E.reliability=m(E),p.set(v,E)}u=0,n(E=>({...E,connected:!0,isConnected:!0,error:null,connectionAttempts:0}))},s.onmessage=L=>{try{const E=JSON.parse(L.data);if(console.log("WebSocket message received:",E),E.serverTime&&fr.updateServerTime(E.serverTime),n(G=>({...G,lastMessage:E})),E.command==="ui-refresh-request"){console.log("UI refresh request received, reloading page..."),window.location.reload();return}if(E.command==="displayAgentMessage"){console.log("🌐 [WebSocket] Received displayAgentMessage:",{timestamp:E.payload?.timestamp,type:E.payload?.type,message:E.payload?.message?.substring(0,100)+(E.payload?.message?.length>100?"...":""),style:E.payload?.style,hasStyle:!!E.payload?.style,fullPayload:E.payload}),Qt(async()=>{const{agentStore:G}=await Promise.resolve().then(()=>Vn);return{agentStore:G}},void 0).then(({agentStore:G})=>{console.log("🌐 [WebSocket] Calling agentStore.addMessage with payload"),G.addMessage(E.payload)});return}if(E.operationId&&c.has(E.operationId)){const G=c.get(E.operationId);c.delete(E.operationId),G(E)}}catch(E){console.error("Error parsing WebSocket message:",E)}},s.onclose=L=>{if(console.log(`WebSocket disconnected from ${v} (code: ${L.code}, reason: ${L.reason})`),L.code!==1e3&&p.has(v)){const G=p.get(v);G.failedConnections++,G.reliability=m(G),p.set(v,G),console.log(`Updated reliability for ${v}: ${(G.reliability*100).toFixed(1)}%`)}n(G=>({...G,connected:!1,isConnected:!1}));const E=Math.min(1e3*Math.pow(2,Math.floor(_/3)),3e4);console.log(`Reconnecting in ${E}ms to next server...`),l=setTimeout(()=>{q(_+1)},E)},s.onerror=L=>{if(console.error(`WebSocket error on ${v}:`,L),p.has(v)){const E=p.get(v);E.failedConnections++,E.reliability=m(E),p.set(v,E)}n(E=>({...E,error:`Connection error: ${v}`}))};const K=setTimeout(()=>{s&&s.readyState===WebSocket.CONNECTING&&(console.log(`Connection timeout for ${v}, trying next server...`),s.close())},1e4);s.onopen=(L=>function(...E){return clearTimeout(K),L.apply(this,E)})(s.onopen)}catch(v){console.error("Failed to create WebSocket connection:",v),n(C=>({...C,error:v.message})),l=setTimeout(()=>{q(_+1)},2e3)}}function d(_){if(console.log("[wsStore] send() called with:",_),console.log("[wsStore] WebSocket state:",{exists:!!s,readyState:s?s.readyState:"N/A",readyStateText:s?s.readyState===0?"CONNECTING":s.readyState===1?"OPEN":s.readyState===2?"CLOSING":"CLOSED":"N/A",sessionId:a}),s&&s.readyState===WebSocket.OPEN){const v={operationId:A(),..._,payload:{..._.payload,sessionId:a}};return _.command==="getCategories"&&(console.log("🔍 [wsStore] SENDING getCategories command:",v),console.log("🔍 [wsStore] WebSocket ready state confirmed OPEN for getCategories")),console.log("Sending WebSocket message:",v),s.send(JSON.stringify(v)),new Promise(C=>{c.set(v.operationId,C),setTimeout(()=>{c.has(v.operationId)&&(c.delete(v.operationId),_.command==="getCategories"&&console.error("❌ [wsStore] getCategories TIMEOUT after 10 seconds"),C({error:"Timeout waiting for response"}))},1e4),_.command==="getCategories"&&console.log("🔍 [wsStore] getCategories promise created, waiting for response...")})}else{const v="WebSocket not connected";return console.log(`❌ [wsStore] ${v}:`,{command:_.command,wsExists:!!s,readyState:s?s.readyState:"N/A"}),_.command==="getCategories"&&console.error("❌ [wsStore] getCategories FAILED - WebSocket not connected!"),Promise.resolve({error:v})}}function A(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(_){const v=Math.random()*16|0;return(_==="x"?v:v&3|8).toString(16)})}return k(),O(),q(),{subscribe:e,send:d,connect:q,getSessionId:()=>a,getCurrentServer:()=>x({subscribe:e}).currentServer,getConnectionStats:()=>{const _=x({subscribe:e});return{currentServer:_.currentServer,serverIndex:_.serverIndex,connectionAttempts:_.connectionAttempts,availableServers:i(),serverStats:Array.from(p.entries()).map(([v,C])=>({server:v,reliability:Math.round(C.reliability*100),successfulConnections:C.successfulConnections,failedConnections:C.failedConnections,averageResponseTime:Math.round(C.averageResponseTime),lastConnectionTime:C.lastConnectionTime}))}},forceReconnect:()=>{s&&s.close(),o=0,u=0,q()},switchToBestServer:()=>{s&&s.close(),o=y(),u=0,console.log("Switching to best performing server..."),q()},resetServerStats:()=>{p.clear(),w(),console.log("Server statistics reset")}};function x(_){let v;return _.subscribe(C=>v=C)(),v}}const ce=zi(),Wi=Object.freeze(Object.defineProperty({__proto__:null,wsStore:ce},Symbol.toStringTag,{value:"Module"})),Hi=gt([]);function Ji(e){if(!e||typeof e!="object")return{};const t={};for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const i=e[n];["string","number","boolean"].includes(typeof i)?t[n]=i:i instanceof Error?t[n]={message:i.message,stack:i.stack}:t[n]=JSON.stringify(i,null,2)}return t}function W(e,t,n={}){const i=new Date().toISOString().slice(0,19).replace("T"," ");Hi.update(a=>[...a.slice(-100),{timestamp:i,level:e,message:t,context:n}]);let s;ce.subscribe(a=>s=a)(),ce&&s&&s.connected&&ce.send({command:"logClientEvent",payload:{level:e,message:t,context:Ji(n)}})}const nr={isAuthenticated:!1,currentUser:null,sessionId:null,users:[],selectedUser:null,loginState:"user_selection",error:null,isLoading:!1};function Ki(){const{subscribe:e,set:t,update:n}=gt(nr);return{subscribe:e,async fetchUsers(){try{n(s=>({...s,isLoading:!0,error:null}));const i=await ce.send({command:"getLoginUsers",payload:{}});if(i.status==="success")n(s=>({...s,users:i.payload||[],isLoading:!1})),W("INFO",`Fetched ${i.payload?.length||0} users for login`);else throw new Error(i.payload?.error||"Failed to fetch users")}catch(i){W("ERROR",`Failed to fetch users: ${i.message}`),n(s=>({...s,error:i.message,isLoading:!1}))}},selectUser(i){n(s=>({...s,selectedUser:i,loginState:"pin_entry",error:null})),W("INFO",`Selected user: ${i.username}`)},backToUserSelection(){n(i=>({...i,selectedUser:null,loginState:"user_selection",error:null}))},async login(i,s){try{n(o=>({...o,isLoading:!0,loginState:"authenticating",error:null}));const a=await ce.send({command:"login",payload:{username:i,password:s,ipAddress:"localhost",userAgent:navigator.userAgent}});if(a.status==="success"&&a.payload.success){const{user:o,session:u}=a.payload;try{await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:i,password:s})})}catch(c){W("WARN",`HTTP session establishment failed: ${c.message}`)}const l={...o,permissions:["all","order.change_price","order.reduce_quantity"]};return n(c=>({...c,isAuthenticated:!0,currentUser:l,sessionId:u.sessionId,loginState:"authenticated",isLoading:!1,error:null,selectedUser:null})),W("SUCCESS",`User ${i} authenticated successfully`),{success:!0}}else{const o=a.payload?.error||"Authentication failed";throw new Error(o)}}catch(a){return W("ERROR",`Authentication failed: ${a.message}`),n(o=>({...o,error:a.message,loginState:"pin_entry",isLoading:!1})),{success:!1,error:a.message}}},async logout(){try{const i={...nr};let s=null;if(n(a=>(s=a.sessionId,i)),s)try{await ce.send({command:"logout",payload:{sessionId:s}}),W("INFO","User logged out successfully")}catch(a){W("WARN",`Logout request failed: ${a.message}`)}try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(a){W("WARN",`HTTP logout failed: ${a.message}`)}return t(i),{success:!0}}catch(i){return W("ERROR",`Logout failed: ${i.message}`),t(nr),{success:!1,error:i.message}}},async getCurrentUser(){try{let i=null;if(n(a=>(i=a.sessionId,a)),!i)throw new Error("No active session");const s=await ce.send({command:"getCurrentUser",payload:{sessionId:i}});if(s.status==="success"&&s.payload.success)return n(a=>({...a,currentUser:s.payload.user})),{success:!0,user:s.payload.user};throw new Error(s.payload?.error||"Failed to get current user")}catch(i){return W("ERROR",`Failed to get current user: ${i.message}`),{success:!1,error:i.message}}},clearError(){n(i=>({...i,error:null}))},reset(){t(nr)},async checkSession(){try{n(s=>({...s,isLoading:!0}));const i=await fetch("/api/session/status",{credentials:"include"});if(i.ok){const s=await i.json();if(s.authenticated&&s.user){const a={...s.user,permissions:["all","order.change_price","order.reduce_quantity"]};return n(o=>({...o,isAuthenticated:!0,currentUser:a,sessionId:null,loginState:"authenticated",isLoading:!1,error:null,selectedUser:null})),W("SUCCESS",`Session restored for user: ${s.user.username}`),{success:!0,user:s.user}}}return n(s=>({...s,isLoading:!1})),{success:!1,error:"No valid session"}}catch(i){return W("ERROR",`Failed to check session: ${i.message}`),n(s=>({...s,isLoading:!1,error:i.message})),{success:!1,error:i.message}}},establishSession(i){try{const{user:s,session:a}=i,o={...s,permissions:["all","order.change_price","order.reduce_quantity"]};return n(u=>({...u,isAuthenticated:!0,currentUser:o,sessionId:a.sessionId,loginState:"authenticated",isLoading:!1,error:null,selectedUser:null})),W("SUCCESS",`Demo mode: Auto-authenticated as ${s.username}`),{success:!0}}catch(s){return W("ERROR",`Failed to establish demo session: ${s.message}`),{success:!1,error:s.message}}}}}const nn=Ki(),ws=Object.freeze(Object.defineProperty({__proto__:null,authStore:nn},Symbol.toStringTag,{value:"Module"})),vt=gt("agent");es(vt,e=>{const t=["order","receipts","agent"],n=t.indexOf(e);return[...t.slice(n),...t.slice(0,n)]});function Yi(){const{subscribe:e,set:t,update:n}=gt({transactionId:null,uuid:null,items:[],total:0,tax:0,status:"idle",paymentType:null,paymentAmount:null,metadata:{},activeTransactionItemId:null});let i=null,s=[];function a(){t({transactionId:null,uuid:null,items:[],total:0,tax:0,status:"idle",paymentType:null,paymentAmount:null,metadata:{},activeTransactionItemId:null}),i=null,s=[],W("INFO","Order reset and ready for new transaction.")}ce.subscribe(d=>{let A;if(e(x=>A=x)(),d.lastMessage?.command==="orderUpdated"&&d.lastMessage.status==="success"&&d.lastMessage.payload){const x=d.lastMessage.payload,_=(x.items||[]).map(D=>{const K=A.items.find(L=>L.id===D.id);return{...D,isEdited:K?.isEdited||!1}}),v=D=>{const K=[];return D.created_at&&K.push(new Date(D.created_at)),D.updated_at&&K.push(new Date(D.updated_at)),K.length>0?Math.max(...K):0};let C=null;_.length>0&&(C=[..._].sort((K,L)=>{const E=v(K),G=v(L);return E!==G?G-E:L.id-K.id})[0].id);const z=[..._].sort((D,K)=>{const L=v(D),E=v(K);return L!==E?L-E:D.id-K.id});if(n(D=>({...D,transactionId:x.id,uuid:x.uuid,items:z,total:parseFloat(x.total_amount),tax:parseFloat(x.tax_amount),status:"active",metadata:x.metadata?typeof x.metadata=="string"?JSON.parse(x.metadata):x.metadata:{},activeTransactionItemId:C})),W("INFO",`Order ${x.id} updated.`),A.status==="initializing"&&s.length>0){const D=[...s];s=[],D.forEach(({itemId:K,quantity:L,userId:E})=>{W("INFO",`Adding queued item ${K} to transaction ${x.id}`),ce.send({command:"addItemToTransaction",payload:{transactionId:x.id,itemId:K,quantity:L,userId:E}})})}}else if(d.lastMessage?.command==="transactionFinished"&&d.lastMessage.status==="success"){const x=d.lastMessage.payload;x.printStatus&&(x.printStatus.status==="failed"?W("ERROR",`Receipt print failed: ${x.printStatus.error}`):x.printStatus.status==="success"&&W("SUCCESS","Receipt printed successfully")),x.transaction?(n(_=>({..._,transactionId:x.transaction.id,uuid:x.transaction.uuid,items:x.transaction.items||[],total:parseFloat(x.transaction.total_amount),tax:parseFloat(x.transaction.tax_amount),status:"finished",paymentType:x.transaction.payment_type,paymentAmount:parseFloat(x.transaction.payment_amount),metadata:x.transaction.metadata?typeof x.transaction.metadata=="string"?JSON.parse(x.transaction.metadata):x.transaction.metadata:{},activeTransactionItemId:null})),W("SUCCESS",`Transaction ${x.transaction.id} finished successfully.`)):(W("SUCCESS",`Transaction ${A.transactionId} finished successfully.`),n(_=>({..._,status:"finished"}))),setTimeout(()=>{W("INFO","Auto-resetting order for next transaction."),a()},2e3)}});function o(){const d=Dn(nn)?.currentUser;if(!d?.id)throw new Error("User must be authenticated to perform this action");return d.id}async function u(d={}){if(i)return i;const A=o();return n(x=>({...x,status:"initializing"})),W("INFO","Initializing new order..."),i=new Promise((x,_)=>{let v;v=ce.subscribe(C=>{C.lastMessage?.command==="orderUpdated"&&C.lastMessage.status==="success"?(v&&v(),x(C.lastMessage.payload)):C.lastMessage?.command==="orderUpdated"&&C.lastMessage.status==="error"&&(v&&v(),n(z=>({...z,status:"error"})),_(new Error(C.lastMessage.payload?.message||"Failed to initialize order")))})}),ce.send({command:"findOrCreateActiveTransaction",payload:{criteria:{metadata:d},userId:A}}),i}async function l(d,A=1){vt.set("order");const x=o();let _;if(e(v=>_=v)(),_.status==="idle"){W("INFO",`First item click detected. Initializing order and queuing item ${d}...`),s.push({itemId:d,quantity:A,userId:x});try{await u(x)}catch(v){W("ERROR",`Failed to initialize order: ${v.message}`),s=[];return}return}if(_.status==="initializing"){W("INFO",`Order initializing. Queuing item ${d}...`),s.push({itemId:d,quantity:A,userId:x});return}if(_.status==="active"&&_.transactionId){const v=_.items.find(C=>C.item_id===d&&!C.notes?.includes("Custom price:")&&!C.isEdited);if(v){const C=parseFloat(v.quantity)+A;W("INFO",`Item ${d} already exists and not edited, updating quantity to ${C}`),O(v.id,C,!1);return}W("INFO",`Adding new item ${d} to transaction ${_.transactionId}`),ce.send({command:"addItemToTransaction",payload:{transactionId:_.transactionId,itemId:d,quantity:A,userId:x}});return}W("ERROR","Cannot add item: invalid order state.")}async function c(d){const A=o();let x;if(e(_=>x=_)(),!x.transactionId||x.status!=="active"){W("ERROR","No active order to finish.");return}W("INFO",`Finishing transaction ${x.transactionId}...`),ce.send({command:"finishTransaction",payload:{transactionId:x.transactionId,paymentData:d,userId:A}})}async function g(d,A=!0){const x=o();let _;if(e(v=>_=v)(),!_.transactionId||_.status!=="active"){W("ERROR","No active order to park.");return}return W("INFO",`Parking transaction ${_.transactionId} to table ${d} (updateTime: ${A})...`),new Promise(async(v,C)=>{const z=ce.subscribe(async D=>{D.lastMessage?.command==="parkTransactionResponse"&&D.lastMessage.status==="success"?(z(),a(),W("SUCCESS",`Order parked to table ${d}`),v(D.lastMessage.payload)):D.lastMessage?.command==="parkTransactionResponse"&&D.lastMessage.status==="error"&&(z(),W("ERROR",`Failed to park order: ${D.lastMessage.payload?.message||"Unknown error"}`),C(new Error(D.lastMessage.payload?.message||"Failed to park order")))});ce.send({command:"parkTransaction",payload:{transactionId:_.transactionId,tableIdentifier:d,userId:x,updateTimestamp:A}})})}function p(d){vt.set("order"),W("INFO",`Loading order ${d.id}...`),n(A=>({...A,transactionId:d.id,uuid:d.uuid,items:d.items||[],total:parseFloat(d.total_amount),tax:parseFloat(d.tax_amount),status:"active",metadata:d.metadata?typeof d.metadata=="string"?JSON.parse(d.metadata):d.metadata:{},activeTransactionItemId:null})),W("SUCCESS",`Order ${d.id} loaded successfully`)}async function w(d){const A=o();let x;if(e(_=>x=_)(),!x.transactionId||x.status!=="active")throw W("ERROR","No active order to assign table number to."),new Error("No active order to assign table number to.");W("INFO",`Checking availability and assigning table ${d} to transaction ${x.transactionId}...`);try{const _=Math.random().toString(36).substring(2,15),v=await new Promise((z,D)=>{const K=setTimeout(()=>{L&&L(),D(new Error("Table availability check timeout"))},5e3);let L;L=ce.subscribe(E=>{E.lastMessage?.command==="checkTableAvailabilityResponse"&&E.lastMessage?.operationId===_&&(clearTimeout(K),L&&L(),z(E.lastMessage))}),ce.send({operationId:_,command:"checkTableAvailability",payload:{tableNumber:d,excludeTransactionId:x.transactionId}})});if(console.log("Table availability check result:",v),v.status==="success"&&v.payload.isInUse)return W("ERROR",`Table ${d} is already in use by another order`),{tableInUse:!0};n(z=>({...z,metadata:{...z.metadata,table:d}}));const C=Math.random().toString(36).substring(2,15);await new Promise((z,D)=>{const K=setTimeout(()=>{L&&L(),D(new Error("Metadata update timeout"))},5e3);let L;L=ce.subscribe(E=>{E.lastMessage?.command==="updateTransactionMetadataResponse"&&E.lastMessage?.operationId===C&&(clearTimeout(K),L&&L(),E.lastMessage.status==="success"?z(E.lastMessage):D(new Error(E.lastMessage.payload?.message||"Failed to update metadata")))}),ce.send({operationId:C,command:"updateTransactionMetadata",payload:{transactionId:x.transactionId,metadata:{...x.metadata,table:d},userId:A}})}),W("SUCCESS",`Table ${d} assigned to order`)}catch(_){throw W("ERROR",`Failed to assign table ${d}: ${_.message}`),_}}async function m(){W("INFO","Clearing active order view"),a()}function y(d,A){const x=o();let _;if(e(v=>_=v)(),_.status!=="active"||!_.transactionId){W("ERROR","Cannot update quantity: no active transaction");return}W("INFO",`Updating item quantity for item ${d} to ${A}`),ce.send({command:"updateItemQuantity",payload:{transactionId:_.transactionId,transactionItemId:d,newQuantity:A,userId:x}})}function k(d,A,x=1){const _=o();let v;if(e(C=>v=C)(),v.status!=="active"||!v.transactionId){W("ERROR","Cannot add custom price item: no active transaction");return}W("INFO",`Adding custom price item ${d} with price ${A} and quantity ${x}`),ce.send({command:"addCustomPriceItem",payload:{transactionId:v.transactionId,itemId:d,customPrice:A,quantity:x,userId:_}})}async function O(d,A,x=!0){const _=o();let v;if(e(C=>v=C)(),v.status!=="active"||!v.transactionId){W("ERROR","Cannot update quantity: no active transaction");return}x&&n(C=>({...C,items:C.items.map(z=>z.id===d?{...z,isEdited:!0}:z)})),W("INFO",`Updating item quantity for item ${d} to ${A}${x?" (marked as edited)":""}`),ce.send({command:"updateItemQuantity",payload:{transactionId:v.transactionId,transactionItemId:d,newQuantity:A,userId:_}})}async function F(d,A,x=!1){const _=o();let v;if(e(C=>v=C)(),v.status!=="active"||!v.transactionId){W("ERROR","Cannot update price: no active transaction");return}n(C=>({...C,items:C.items.map(z=>z.id===d?{...z,isEdited:!0}:z)})),W("INFO",`Updating item price for item ${d} to ${A} (marked as edited)`),ce.send({command:"updateItemPrice",payload:{transactionId:v.transactionId,transactionItemId:d,newPrice:A,isTotalPrice:x,userId:_}})}function q(){n(d=>({...d,activeTransactionItemId:null})),W("INFO","Item deselected from order view")}return{subscribe:e,set:t,update:n,initializeOrder:u,addItem:l,updateQuantity:y,updateItemQuantity:O,updateItemPrice:F,addWithCustomPrice:k,finishOrder:c,resetOrder:a,parkCurrentOrder:g,assignTableNumber:w,loadOrder:p,clearActiveOrderView:m,deselectItem:q}}const Ze=Yi();function Xi(e){if(typeof e=="object"&&e!==null)return e;if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}function Qi(){const{subscribe:e,set:t,update:n}=gt({receipts:[],loading:!1,error:null,lastUpdated:null});ce.subscribe(a=>{if(a.lastMessage?.command==="getRecentReceiptsResponse")if(a.lastMessage.status==="success"){const o=a.lastMessage.payload;if(o.success&&o.transactions){const u=o.transactions.map(l=>({...l,metadata:l.metadata?Xi(l.metadata):{}}));n(l=>({...l,receipts:u,loading:!1,error:null,lastUpdated:new Date})),W("INFO",`Loaded ${o.transactions.length} recent receipts.`)}else n(u=>({...u,loading:!1,error:o.message||"Failed to load receipts"})),W("ERROR",`Failed to load receipts: ${o.message||"Unknown error"}`)}else n(o=>({...o,loading:!1,error:a.lastMessage.payload?.message||"Failed to load receipts"})),W("ERROR",`Failed to load receipts: ${a.lastMessage.payload?.message||"Unknown error"}`)});function i(a=20){n(u=>({...u,loading:!0,error:null})),W("INFO",`Loading recent receipts (limit: ${a})...`);let o;ce.subscribe(u=>o=u)(),o&&o.connected?ce.send({command:"getRecentReceipts",payload:{limit:a}}):(W("WARNING","WebSocket not connected, skipping receipt load"),n(u=>({...u,loading:!1,error:"WebSocket connection not available"})))}function s(){W("INFO","Refreshing receipts..."),i()}return{subscribe:e,loadReceipts:i,refresh:s}}const vr=Qi();class Zi{constructor(){this.store=gt([]),this.subscribe=this.store.subscribe,this.set=this.store.set,this.update=this.store.update}async refreshParkedOrders(){try{W("DEBUG","Requesting parked transactions...");const t=this.generateUUID();W("DEBUG",`Generated operationId: ${t}`);const n=await this.sendRequestWithFallback(t,"getParkedTransactions",{});W("DEBUG",`Parked transactions response: ${JSON.stringify(n)}`),n.status==="success"?(W("DEBUG",`Setting parked orders: ${JSON.stringify(n.payload)}`),this.set(n.payload||[])):(W("ERROR",`Failed to fetch parked orders: ${JSON.stringify(n)}`),this.set([]))}catch(t){W("ERROR",`Error fetching parked orders: ${t.message}`),this.set([])}}async sendRequestWithFallback(t,n,i){try{return await this.sendWebSocketRequest(t,n,i)}catch(s){W("WARNING",`WebSocket request failed, trying HTTP fallback: ${s.message}`);try{return await this.sendHttpRequest(t,n,i)}catch(a){throw W("ERROR",`Both WebSocket and HTTP requests failed: ${a.message}`),a}}}sendWebSocketRequest(t,n,i){return new Promise((s,a)=>{let o;if(ce.subscribe(c=>o=c)(),!o||!o.connected){a(new Error("WebSocket is not connected"));return}const u=setTimeout(()=>{l(),a(new Error("WebSocket request timeout"))},3e3),l=ce.subscribe(c=>{c.lastMessage&&c.lastMessage.operationId===t&&(clearTimeout(u),l(),s(c.lastMessage))});ce.send({operationId:t,command:n,payload:i})})}async sendHttpRequest(t,n,i){const s=await fetch("/api/websocket-fallback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({operationId:t,command:n,payload:i})});if(!s.ok)throw new Error(`HTTP request failed: ${s.status}`);return await s.json()}refresh(){return this.refreshParkedOrders()}async activateOrder(t,n=!1){try{const i=this.generateUUID(),s=await this.sendRequestWithFallback(i,"activateTransaction",{transactionId:t,userId:1,updateTimestamp:n});if(s.status==="success")return n&&await this.refreshParkedOrders(),s.payload;throw new Error(s.payload?.message||"Failed to activate order")}catch(i){throw W("ERROR",`Error activating order: ${i.message}`),i}}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const n=Math.random()*16|0;return(t==="x"?n:n&3|8).toString(16)})}}const qn=new Zi,wn={DE:[["q","w","e","r","t","z","u","i","o","p","ü","ß"],["a","s","d","f","g","h","j","k","l","ö","ä"],["y","x","c","v","b","n","m"]],EN:[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l"],["z","x","c","v","b","n","m"]],RU:[["й","ц","у","к","е","н","г","ш","щ","з","х","ъ"],["ф","ы","в","а","п","р","о","л","д","ж","э"],["я","ч","с","м","и","т","ь","б","ю"]]};function eo(){const{subscribe:e,set:t,update:n}=gt({isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:wn});return{subscribe:e,activate(i,s,a,o="numeric"){t({isActive:!0,mode:i,layout:o,liveValue:o==="alpha"?{text:"",cursor:0}:"",confirmCallback:s,cancelCallback:a,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:wn})},deactivate(){t({isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:wn})},append(i,s=null){n(a=>{if(!a.isActive)return a;if(a.layout==="alpha"){const o=a.liveValue.text,u=a.liveValue.cursor,l=o.slice(0,u)+i+o.slice(u),c={text:l,cursor:u+1};return a.mode==="agent"&&s&&s.updateDraftMessage(l),{...a,liveValue:c,errorMessage:null}}else return{...a,liveValue:a.liveValue+i,errorMessage:null}})},backspace(i=null){n(s=>{if(!s.isActive)return s;if(s.layout==="alpha"){const a=s.liveValue.text,o=s.liveValue.cursor;if(o>0){const u=a.slice(0,o-1)+a.slice(o),l={text:u,cursor:o-1};return s.mode==="agent"&&i&&i.updateDraftMessage(u),{...s,liveValue:l,errorMessage:null}}return{...s,errorMessage:null}}else return{...s,liveValue:s.liveValue.slice(0,-1),errorMessage:null}})},clear(i=null){n(s=>s.isActive?(s.mode==="agent"&&i&&i.updateDraftMessage(""),{...s,liveValue:s.layout==="alpha"?{text:"",cursor:0}:"",errorMessage:null}):s)},async confirm(){let i,s;if(n(u=>(i=u,u)),!i.isActive)return;s=i.layout==="alpha"?i.liveValue.text:i.liveValue;let a;if(Ze.subscribe(u=>a=u)(),a.activeTransactionItemId&&i.layout==="numeric"&&i.mode!=="agent"&&i.mode!=="table"){const u=s.trim();if(!u){this.deactivate();return}const l=a.items.find(c=>c.id===a.activeTransactionItemId);if(l){const{authStore:c}=await Qt(async()=>{const{authStore:w}=await Promise.resolve().then(()=>ws);return{authStore:w}},void 0);let g;c.subscribe(w=>g=w)();const p=g.currentUser?.permissions||[];if(u.includes(".")||u.includes(",")){const w=parseFloat(u.replace(",","."));if(!isNaN(w)&&w>0){const m=parseFloat(l.unit_price);let y=null;if(w<m&&(y="order.change_price"),p.includes("all")||(y?p.includes(y):!0)){const F=parseFloat(l.quantity)>1;Ze.updateItemPrice(l.id,w,F),Ze.deselectItem()}else{n(O=>({...O,errorMessage:"Permission denied to change price."}));return}}}else{const w=parseInt(u);if(!isNaN(w)&&w>0){const m=parseFloat(l.quantity);let y=null;if(w<m&&(y="order.reduce_quantity"),p.includes("all")||(y?p.includes(y):!0))Ze.updateItemQuantity(l.id,w),Ze.deselectItem();else{n(O=>({...O,errorMessage:"Permission denied to reduce quantity."}));return}}}}n(c=>({...c,liveValue:c.layout==="alpha"?{text:"",cursor:0}:"",errorMessage:null})),this.deactivate();return}if(i.mode==="agent"){if(i.layout==="numeric"&&/^\d{4,6}$/.test(s)){const{authStore:l}=await Qt(async()=>{const{authStore:c}=await Promise.resolve().then(()=>ws);return{authStore:c}},void 0);try{if((await l.login(null,s)).success){const{agentStore:g}=await Qt(async()=>{const{agentStore:m}=await Promise.resolve().then(()=>Vn);return{agentStore:m}},void 0);let p;l.subscribe(m=>p=m)();const w=`✅ Erfolgreich angemeldet als ${p.currentUser.full_name}!

⏰ Überprüfe Systemzeit...
🔍 Prüfe ausstehende Transaktionen...

Bitte warten Sie einen Moment...`;g.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:w}),g.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`🤖 KI-Assistent bereit!

Verfügbare Tools:
• findProduct - Produkte suchen und finden
• createProduct - Neue Produkte erstellen
• updateProduct - Produktdaten aktualisieren
• getSalesReport - Verkaufsberichte abrufen
• generateDsfinvkExport - DSFinV-K konforme Datenexporte erstellen

Ich wähle automatisch das richtige Tool für Ihre Anfrage aus. Stellen Sie einfach Ihre Frage!`}),setTimeout(async()=>{await this.checkSystemStatus(p.currentUser,g)},1e3),n(m=>({...m,liveValue:m.layout==="alpha"?{text:"",cursor:0}:"",errorMessage:null})),this.deactivate();return}else{const{agentStore:g}=await Qt(async()=>{const{agentStore:p}=await Promise.resolve().then(()=>Vn);return{agentStore:p}},void 0);g.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`❌ Ungültige PIN-Eingabe!

Bitte überprüfen Sie Ihre PIN und versuchen Sie es erneut. Sie können eine 4-6 stellige PIN über das Tastenfeld eingeben.`}),n(p=>({...p,liveValue:p.layout==="alpha"?{text:"",cursor:0}:"",errorMessage:null}));return}}catch{console.log("Direct login failed, falling back to agent message")}}const{agentStore:u}=await Qt(async()=>{const{agentStore:l}=await Promise.resolve().then(()=>Vn);return{agentStore:l}},void 0);try{await u.sendMessage(s),n(l=>({...l,liveValue:l.layout==="alpha"?{text:"",cursor:0}:""}))}catch(l){console.error("Agent message send failed:",l),n(c=>({...c,liveValue:c.layout==="alpha"?{text:"",cursor:0}:""}))}return}if(!i.confirmCallback)return;const o=i.confirmCallback;try{await o(s),n(()=>({isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:wn}))}catch(u){console.error("Pinpad confirm callback failed:",u),n(()=>({isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:wn}))}},cancel(i=null){n(s=>{const a=Date.now();if(a-s.lastRedClickTime<300){const u=s.cancelCallback;s.mode==="agent"&&Qt(async()=>{const{agentStore:c}=await Promise.resolve().then(()=>Vn);return{agentStore:c}},void 0).then(({agentStore:c})=>{c.cancelDraftMessage()});const l={isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:wn};return u&&setTimeout(()=>u(),0),l}else return s.mode==="agent"&&i&&i.updateDraftMessage(""),{...s,liveValue:s.layout==="alpha"?{text:"",cursor:0}:"",lastRedClickTime:a,errorMessage:null}})},activateTableEntry(){vt.set("order"),this.activate("table",async i=>{if(i&&i.trim())try{const s=await Ze.assignTableNumber(i.trim());if(s&&s.tableInUse){n(a=>({...a,liveValue:a.layout==="alpha"?{text:"",cursor:0}:""}));return}return s}catch(s){throw s}},()=>{})},activateTableEntryWithAutoCollapse(){vt.set("order"),this.activate("table",async i=>{if(i&&i.trim())try{const s=await Ze.assignTableNumber(i.trim());if(s&&s.tableInUse){n(l=>({...l,liveValue:l.layout==="alpha"?{text:"",cursor:0}:""}));return}let a;Ze.subscribe(l=>a=l)();const o=a.items&&a.items.length>0,u=a.metadata&&a.metadata.table;return o&&u?(await Ze.parkCurrentOrder(u,1,!1),await qn.refresh(),Ze.resetOrder(),window.dispatchEvent(new CustomEvent("autoCollapseComplete")),{autoCollapsed:!0}):s}catch(s){throw s}},()=>{})},activateAlphaInput(i,s,a=null){a&&a.startDraftMessage(),this.activate("agent",i,s,"alpha")},moveCursorLeft(){n(i=>{if(!i.isActive||i.layout!=="alpha")return i;const s=Math.max(0,i.liveValue.cursor-1);return{...i,liveValue:{...i.liveValue,cursor:s}}})},moveCursorRight(){n(i=>{if(!i.isActive||i.layout!=="alpha")return i;const s=Math.min(i.liveValue.text.length,i.liveValue.cursor+1);return{...i,liveValue:{...i.liveValue,cursor:s}}})},switchLanguage(i=null){n(s=>{const a=Object.keys(s.layouts);if(i&&a.includes(i))return{...s,currentLanguage:i};if(!s.isActive||s.layout!=="alpha"){const c=(a.indexOf(s.currentLanguage)+1)%a.length;return{...s,currentLanguage:a[c]}}const u=(a.indexOf(s.currentLanguage)+1)%a.length;return{...s,currentLanguage:a[u]}})},async checkSystemStatus(i,s){try{const{wsStore:a}=await Qt(async()=>{const{wsStore:c}=await Promise.resolve().then(()=>Wi);return{wsStore:c}},void 0);let o=0,u=!0;try{const c=await a.send({command:"systemTimeCheck",payload:{clientTime:new Date().toISOString()}});c.status==="success"?(o=c.payload.timeDifferenceSeconds,u=Math.abs(o)<=30):u=!1}catch{u=!1}if(u){s.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`✅ Erfolgreich angemeldet als ${i.full_name}!`});return}let l=`🎉 Willkommen zurück, ${i.full_name}!

`;if(u||(o!==0?l+=`⚠️ Zeitabweichung erkannt: ${Math.abs(o)} Sekunden ${o>0?"voraus":"zurück"}
`:l+=`⚠️ Zeitprüfung fehlgeschlagen
`),i.permissions.includes("all")||i.permissions.includes("manage_transactions"))try{const c=await a.send({command:"getPendingTransactions",payload:{}});c.status==="success"&&c.payload.length>0?(l+=`
🔄 ${c.payload.length} ausstehende Transaktionen gefunden!

`,l+=`Als ${i.role} können Sie diese Transaktionen verwalten:
`,l+=`• Fiskalisieren (abschließen)
`,l+=`• Stornieren (rückgängig machen)
`,l+=`• Verschieben (später bearbeiten)

`,l+="Möchten Sie diese jetzt bearbeiten? Verwenden Sie die entsprechenden Schaltflächen oder fragen Sie mich nach Hilfe."):l+=`
✅ Keine ausstehenden Transaktionen
`}catch{l+=`
⚠️ Konnte ausstehende Transaktionen nicht überprüfen
`}else l+=`
📋 Ihre Rolle: ${i.role}
`,l+=`Sie haben Zugriff auf grundlegende Kassenfunktionen.
`;l+=`
🚀 System ist bereit! Sie können mit der Arbeit beginnen.`,s.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:l})}catch(a){s.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`❌ Systemprüfung fehlgeschlagen: ${a.message}

Sie können trotzdem mit der Arbeit beginnen, aber einige Funktionen sind möglicherweise eingeschränkt.`})}}}}const Je=eo();function to(){const e=parseInt(void 0)||160;return da({MIN_BUTTON_WIDTH:e})}const pa=to(),Cr={hasNotification:!1,style:null};function no(){const{subscribe:e,set:t,update:n}=gt(Cr);return{subscribe:e,setNotification:i=>{console.log("🟡 [NotificationStore] setNotification called with style:",i),n(s=>{console.log("🟡 [NotificationStore] Previous state:",s);const a={hasNotification:!0,style:i};return console.log("🟡 [NotificationStore] New state:",a),a})},clearNotification:()=>{console.log("🟠 [NotificationStore] clearNotification called"),console.log("🟠 [NotificationStore] Clearing notification, setting to initial state:",Cr),t(Cr)}}}const Cn=no();function ro(){const{subscribe:e,set:t,update:n}=gt({history:[],messages:[{timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Willkommen bei ecKasse!

Eine Kasse, die hilft – nicht kostet.

👥 Verfügbare Benutzer:
• Admin (Vollzugriff)
• Kassier (Kassenfunktionen)
• Aushilfe (Grundfunktionen)

⏰ Überprüfe Systemzeit und ausstehende Transaktionen...

💡 Geben Sie einfach Ihre 4-6 stellige PIN ein - das System erkennt Sie automatisch. Bei neuer oder Testkasse: Admin-PIN ist 1234`}],draftMessage:null,shouldActivatePinpad:!0});return ce.subscribe(i=>{if(i.lastMessage&&i.lastMessage.command==="firstRunAdminCreated"){const s=i.lastMessage.payload;n(a=>({...a,messages:[{timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:s.message||`Willkommen! Admin-Benutzer '${s.username}' wurde erstellt mit PIN: ${s.password}`}]}))}if(i.lastMessage&&i.lastMessage.command==="getEntityJsonResponse"){const s=i.lastMessage.payload;if(s.success&&s.entity){const a=JSON.stringify(s.entity,null,2);n(o=>({...o,messages:[...o.messages,{timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"system",message:`JSON for viewing ${s.entityType} ID ${s.entityId}. For editing, use AI commands like 'update price to 29.99' or 'change name to Super Widget Pro':
\`\`\`json
${a}
\`\`\``}]}))}}}),{subscribe:e,addMessage:i=>{console.log("🔔 [AgentStore] addMessage called:",{timestamp:i.timestamp,type:i.type,message:i.message?.substring(0,100)+(i.message?.length>100?"...":""),style:i.style,hasStyle:!!i.style}),n(s=>({...s,messages:[...s.messages,i]})),i.style?(console.log("🟢 [AgentStore] Message has style, triggering notification:",i.style),Cn.setNotification(i.style)):console.log("🔴 [AgentStore] Message has NO style, no notification triggered")},setHistory:i=>{n(s=>({...s,history:i}))},getHistory:()=>{let i;return e(s=>i=s.history)(),i},clearMessages:()=>{n(i=>({...i,messages:[]}))},startDraftMessage:()=>{n(i=>({...i,draftMessage:{id:"draft-"+Date.now(),timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"user",message:"",isDraft:!0}}))},updateDraftMessage:i=>{n(s=>({...s,draftMessage:s.draftMessage?{...s.draftMessage,message:i}:null}))},finalizeDraftMessage:()=>{n(i=>{if(!i.draftMessage)return i;const s={...i.draftMessage,isDraft:!1};return{...i,messages:[...i.messages,s],draftMessage:null}})},cancelDraftMessage:()=>{n(i=>({...i,draftMessage:null}))},sendMessage:async i=>{if(!(!i||!i.trim()))try{const a=Dn(nn).sessionId,o={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"user",message:i};let u;e(p=>u=p)(),n(p=>({...p,messages:[...p.messages,o],draftMessage:null}));const l=await fetch("/api/llm/ping-gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:i,history:u.history,sessionId:a})});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const c=await l.json(),g={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:c.gemini_response_text};n(p=>({...p,messages:[...p.messages,g],history:c.history}))}catch(s){console.error("Failed to send message to AI:",s);const a={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"Sorry, I encountered an error. Please try again."};n(o=>({...o,messages:[...o.messages,a]}))}},shouldActivatePinpadOnLoad(){let i=!1;return n(s=>(i=s.shouldActivatePinpad,{...s,shouldActivatePinpad:!1})),i}}}const pe=ro(),Vn=Object.freeze(Object.defineProperty({__proto__:null,agentStore:pe},Symbol.toStringTag,{value:"Module"})),so=()=>typeof localStorage<"u"&&localStorage.getItem("app-locale")||"de-DE",An=gt(so());An.subscribe(e=>{typeof localStorage<"u"&&localStorage.setItem("app-locale",e)});const ao=e=>{An.set(e)},wt=(e,t="EUR")=>{const n=Dn(An);return e==null||isNaN(e)?new Intl.NumberFormat(n,{style:"currency",currency:t}).format(0):new Intl.NumberFormat(n,{style:"currency",currency:t}).format(e)},io=(e,t={})=>{const n=Dn(An);if(!e)return"";const i=typeof e=="string"?new Date(e):e;if(isNaN(i.getTime()))return"";const s={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",...t};return new Intl.DateTimeFormat(n,s).format(i)};var oo=U('<div class="loading svelte-1dtcyze">Loading receipts...</div>'),lo=U('<div class="error svelte-1dtcyze"> </div>'),co=U('<div class="empty svelte-1dtcyze">No receipts found.</div>'),uo=U('<span class="receipt-table-large svelte-1dtcyze"> </span>'),fo=U('<div><span class="item-qty svelte-1dtcyze"> </span> <span> </span> <span> </span></div>'),vo=U('<div class="receipt-details svelte-1dtcyze"><div class="items-list svelte-1dtcyze"></div> <div class="receipt-totals svelte-1dtcyze"><div class="total-row svelte-1dtcyze"><span>Tax:</span> <span class="price svelte-1dtcyze"> </span></div> <div class="total-row total svelte-1dtcyze"><span>Total:</span> <span class="price svelte-1dtcyze"> </span></div></div> <div class="receipt-actions svelte-1dtcyze"><button class="action-button svelte-1dtcyze">🖨️ Reprint</button></div></div>'),po=U('<div><button class="receipt-summary svelte-1dtcyze"><div class="receipt-left svelte-1dtcyze"><div class="receipt-main-line svelte-1dtcyze"><span class="receipt-id-large svelte-1dtcyze"> </span> <!></div> <div class="receipt-date svelte-1dtcyze"> </div> <div class="receipt-payment svelte-1dtcyze"> </div></div> <div class="receipt-right svelte-1dtcyze"><div class="receipt-price svelte-1dtcyze"><span class="price svelte-1dtcyze"> </span></div> <div class="receipt-meta svelte-1dtcyze"><div class="receipt-items-count svelte-1dtcyze"> </div></div></div> <div class="expand-icon svelte-1dtcyze"> </div></button> <!></div>'),mo=U('<div class="receipt-list svelte-1dtcyze"></div>'),go=U('<div class="receipt-feed svelte-1dtcyze"><!></div>');function ho(e,t){pt(t,!1);const[n,i]=Zn(),s=()=>rt(vr,"$receiptsStore",n);let a=Ee(t,"autoExpandLatest",8,!1),o=V(null),u=V(!1),l=V();zt(()=>{vr.loadReceipts()});function c(d){b(u,!0),b(o,r(o)===d?null:d)}function g(d){return io(d)}function p(d){return d.notes==="STORNO"&&d.display_names&&d.display_names.menu&&d.display_names.menu.de?`STORNO: ${d.display_names.menu.de}`:d.notes==="DISCOUNT"?"DISCOUNT":d.notes==="SURCHARGE"?"SURCHARGE":d.display_names&&d.display_names.menu&&d.display_names.menu.de?d.display_names.menu.de:"Unnamed Item"}function w(d){return d.notes==="STORNO"||d.notes==="DISCOUNT"||d.notes==="SURCHARGE"}function m(d){if(d.notes==="DISCOUNT"||d.notes==="SURCHARGE")return"";const A=parseFloat(d.quantity);return A===1?"":A+"x"}async function y(d){W("INFO",`Reprint requested for receipt №${d.id}`),pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Reprint initiated for receipt №${d.id}`,style:"info"}),ce.send("reprintReceipt",{transactionId:d.id})}Fe(()=>ue(a()),()=>{a()&&b(u,!1)}),Fe(()=>(ue(a()),r(u),s(),r(o)),()=>{if(a()&&!r(u)&&s().receipts.length>0){const A=s().receipts.sort((x,_)=>new Date(_.fiscal_timestamp||_.updated_at)-new Date(x.fiscal_timestamp||x.updated_at))[0]?.id;A&&r(o)!==A&&b(o,A)}}),sn(),xt();var k=go(),O=f(k);{var F=d=>{var A=oo();T(d,A)},q=d=>{var A=Ve(),x=ke(A);{var _=C=>{var z=lo(),D=f(z);ee(()=>Z(D,`Error: ${s(),M(()=>s().error)??""}`)),T(C,z)},v=C=>{var z=Ve(),D=ke(z);{var K=E=>{var G=co();T(E,G)},L=E=>{var G=mo();$t(G,5,()=>(s(),M(()=>s().receipts.sort((B,P)=>new Date(B.fiscal_timestamp||B.updated_at)-new Date(P.fiscal_timestamp||P.updated_at)))),B=>B.id,(B,P)=>{var fe=po();let be;var de=f(fe),oe=f(de),$=f(oe),S=f($),j=f(S),X=h(S,2);{var J=R=>{var N=uo(),te=f(N);ee(()=>Z(te,`#${r(P),M(()=>r(P).metadata.table)??""}`)),T(R,N)};H(X,R=>{r(P),M(()=>r(P).metadata?.table)&&R(J)})}var Q=h($,2),re=f(Q),se=h(Q,2),ie=f(se),le=h(oe,2),ae=f(le),ye=f(ae),ge=f(ye),Ce=h(ae,2),Ae=f(Ce),De=f(Ae),Pe=h(le,2),me=f(Pe),Se=h(de,2);{var he=R=>{var N=vo(),te=f(N);$t(te,5,()=>(r(P),M(()=>r(P).items)),ze=>ze.id,(ze,Ie)=>{var Le=fo();let We;var ot=f(Le),yt=f(ot),an=h(ot,2);let Re;var He=f(an),lt=h(an,2);let Ke;var je=f(lt);ee((Ft,It,Jt,Tt,At,Kt)=>{We=Xe(Le,1,"item-row svelte-1dtcyze",null,We,Ft),Z(yt,It),Re=Xe(an,1,"item-name svelte-1dtcyze",null,Re,Jt),Z(He,Tt),Ke=Xe(lt,1,"item-price svelte-1dtcyze",null,Ke,At),Z(je,Kt)},[()=>({"modification-item":w(r(Ie))}),()=>(r(Ie),M(()=>m(r(Ie)))),()=>({"modification-name":w(r(Ie))}),()=>(r(Ie),M(()=>p(r(Ie)))),()=>({"negative-price":parseFloat(r(Ie).total_price)<0}),()=>(ue(wt),r(Ie),M(()=>wt(r(Ie).total_price)))]),T(ze,Le)});var ve=h(te,2),qe=f(ve),ht=h(f(qe),2),ft=f(ht),_t=h(qe,2),Ge=h(f(_t),2),at=f(Ge),et=h(ve,2),it=f(et);ee((ze,Ie)=>{Z(ft,ze),Z(at,Ie)},[()=>(ue(wt),r(P),M(()=>wt(r(P).tax_amount))),()=>(ue(wt),r(P),M(()=>wt(r(P).total_amount)))]),Y("click",it,()=>y(r(P))),T(R,N)};H(Se,R=>{r(o),r(P),M(()=>r(o)===r(P).id)&&R(he)})}ee((R,N,te)=>{be=Xe(fe,1,"receipt-item svelte-1dtcyze",null,be,R),Z(j,`№${r(P),M(()=>r(P).id)??""}`),Z(re,N),Z(ie,(r(P),M(()=>r(P).payment_type||"Unknown"))),Z(ge,te),Z(De,`${r(P),M(()=>r(P).items?.length||0)??""} items`),Z(me,(r(o),r(P),M(()=>r(o)===r(P).id?"▼":"▶")))},[()=>({expanded:r(o)===r(P).id}),()=>(r(P),M(()=>g(r(P).fiscal_timestamp||r(P).updated_at))),()=>(ue(wt),r(P),M(()=>wt(r(P).total_amount)))]),Y("click",de,()=>c(r(P).id)),T(B,fe)}),tn(G,B=>b(l,B),()=>r(l)),T(E,G)};H(D,E=>{s(),M(()=>s().receipts.length===0)?E(K):E(L,!1)},!0)}T(C,z)};H(x,C=>{s(),M(()=>s().error)?C(_):C(v,!1)},!0)}T(d,A)};H(O,d=>{s(),M(()=>s().loading)?d(F):d(q,!1)})}T(e,k),mt(),i()}var _o=U('<button class="order-item svelte-1gswy6n"><div class="table-number svelte-1gswy6n"> </div> <div class="order-stats svelte-1gswy6n"><div class="stat-price svelte-1gswy6n"> </div> <div class="stat-open svelte-1gswy6n"> </div> <div class="stat-activity svelte-1gswy6n"> </div></div></button>'),yo=U('<div class="parked-orders-container svelte-1gswy6n"><div class="orders-list svelte-1gswy6n"></div></div>');function bo(e,t){pt(t,!1);let n=V([]),i,s,a=!1;zt(async()=>{i=qn.subscribe(m=>{b(n,m)}),s=ce.subscribe(async m=>{m.connected&&!a&&(a=!0,await qn.refreshParkedOrders())})}),fa(()=>{i&&i(),s&&s()});async function o(m){try{let y;if(Ze.subscribe(O=>y=O)(),y.transactionId&&y.status==="active"){const O=y.items&&y.items.length>0,F=y.metadata&&y.metadata.table;if(O&&F)await Ze.parkCurrentOrder(F,1,!1),await qn.refreshParkedOrders();else if(O&&!F){vt.set("order"),Je.activateTableEntry();return}else Ze.resetOrder()}const k=await qn.activateOrder(m.id,!1);Ze.loadOrder(k)}catch(y){console.error("Failed to switch to order:",y)}}function u(m){const k=(m.metadata||{}).table||m.id.toString();return k.length>3?`#${k.substring(0,3)}`:`#${k}`}function l(m){return fr.formatTimeElapsed(m)}function c(m){const y=l(m.created_at),k=l(m.updated_at);return{price:wt(m.total_amount),openMinutes:y,activityMinutes:k}}xt();var g=Ve(),p=ke(g);{var w=m=>{var y=yo(),k=f(y);$t(k,5,()=>r(n),O=>O.id,(O,F)=>{var q=_o(),d=f(q),A=f(d),x=h(d,2),_=f(x),v=f(_),C=h(_,2),z=f(C),D=h(C,2),K=f(D);ee((L,E,G,B)=>{Z(A,L),Z(v,E),Z(z,`${G??""}min`),Z(K,`${B??""}min`)},[()=>u(r(F)),()=>c(r(F)).price,()=>c(r(F)).openMinutes,()=>c(r(F)).activityMinutes]),Y("click",q,()=>o(r(F))),T(O,q)}),T(m,y)};H(p,m=>{r(n).length>0&&m(w)})}T(e,g),mt()}var wo=sa(`<svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%;"><defs><filter height="150%" id="sh0" width="150%" x="-0.25" y="-0.25"><feConvolveMatrix id="3_|_y" in="SourceAlpha" result="19y" order="1,17" divisor="6632" bias="0" preserveAlpha="false" kernelMatrix=" 10 30 77 169 320 527 752 931 1000 931 752 527 320 169 77 30 10"></feConvolveMatrix><feConvolveMatrix id="3_|_x" result="19x" order="17,1" divisor="6632" bias="0" preserveAlpha="false" kernelMatrix=" 10 30 77 169 320 527 752 931 1000 931 752 527 320 169 77 30 10"></feConvolveMatrix><feConvolveMatrix id="9_|_y" in="SourceAlpha" result="49y" order="1,47" divisor="19856" bias="0" preserveAlpha="false" kernelMatrix=" 15 21 30 42 57 77 101 132 169 212 263 320 384 453 527 603 678 752 820 881 931 968 992 1000 992 968 931 881 820 752 678 603 527 453 384 320 263 212 169 132 101 77 57 42 30 21 15"></feConvolveMatrix><feConvolveMatrix id="9_|_x" result="49x" order="47,1" divisor="19856" bias="0" preserveAlpha="false" kernelMatrix=" 15 21 30 42 57 77 101 132 169 212 263 320 384 453 527 603 678 752 820 881 931 968 992 1000 992 968 931 881 820 752 678 603 527 453 384 320 263 212 169 132 101 77 57 42 30 21 15"></feConvolveMatrix><feTurbulence class="seed" result="noise" type="fractalNoise" stitchTiles="stitch" seed="43" baseFrequency="0.06 0.08 " numOctaves="3"></feTurbulence><feMorphology operator="erode" radius="1.2"></feMorphology><feComposite in="noise" operator="arithmetic" k1="0" k2="8" k3="0" k4="-3"></feComposite><feComposite in="49x" result="49noise" operator="arithmetic" k1="0" k2="2" k3="-0.2" k4="-1"></feComposite><feComposite in="49noise" in2="19x" operator="arithmetic" k1="0" k2="0.5" k3="1.5" k4="-1"></feComposite><feDiffuseLighting surfaceScale="2" lighting-color="#fff"><feDistantLight azimuth="240" elevation="20"></feDistantLight></feDiffuseLighting><feComposite in2="SourceGraphic" operator="arithmetic" k1="1" k2="0" k3="0" k4="0"></feComposite></filter><filter height="170%" id="sh2" width="170%" x="-0.2" y="-0.2"><feOffset dx="0" dy="0" in="SourceAlpha"></feOffset><feGaussianBlur stdDeviation="1.2"></feGaussianBlur><feColorMatrix result="out" type="matrix" values=" 
               0 0 0 0 0.4         
               0 0 0 0 0.4                    
               0 0 0 0 0.4                
               0 0 0 10 0 "></feColorMatrix><feMerge><feMergeNode in="out"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter><filter height="130%" id="sh1" width="130%" x="-0.2" y="-0.2"><feOffset dx="3" dy="4" in="SourceAlpha"></feOffset><feGaussianBlur stdDeviation="3"></feGaussianBlur><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.8 0"></feColorMatrix><feBlend in="SourceGraphic"></feBlend></filter><linearGradient id="svg_66" x1="0" x2="1" y1="0" y2="0"><stop offset="0" stop-color="hsl(40, 23%, 35%)"></stop><stop offset="0.4" stop-color="hsl(40, 23%, 60%)"></stop><stop offset="0.65" stop-color="hsl(40, 23%, 70%)"></stop><stop offset="0.75" stop-color="hsl(40, 23%, 60%)"></stop><stop offset="1" stop-color="hsl(40, 23%, 35%)"></stop></linearGradient><circle id="bell" fill="#070" stroke="#030" r="5.5" filter="url(#sh0)"></circle><g id="cap" filter="url(#sh2)"><path id="capPath" fill="#070" filter="url(#sh0)" stroke="#030" d="M72,89 C78.6,68 67.2,30.7 89,68 C86.9,37.6 66.91,32 62,61 C58,44.1 67.5,38.8 52,10 C53.6,47 46.91,36.2 45,61 C39.3,43.4 22,46.6 13,43 C32.9,55.8 35.7,66.62 32,89 C35,97.9 68.6,99 72,89 Z"></path><use id="bell1" x="13" y="43" href="#bell"></use><use id="bell2" x="52" y="10" href="#bell"></use><use id="bell3" x="89" y="68" href="#bell"></use><ellipse cx="52.19" cy="90.01" fill="url(#svg_66)" rx="14.76" ry="3.56"></ellipse><path d="M34,86.5C36,82,53.5,81,60,83C54,81,34,81.5,34,86.5Z" fill="none" stroke="hsl(40, 23%, 60%)"></path></g></defs><use href="#cap"></use></svg>`);function So(e){var t=wo();T(e,t)}var xo=U('<div class="slot-container svelte-12whdgj"><!></div>'),To=U('<div class="button-icon-wrapper svelte-12whdgj"><span class="button-icon svelte-12whdgj"><!></span></div>'),ko=U("<div></div>"),Co=U("<!> <!>",1),Eo=U('<span class="button-text svelte-12whdgj"><!></span>'),Io=U('<button><div class="button-shape svelte-12whdgj"><!></div></button>');function Rt(e,t){const n=Ci(t);pt(t,!1);const i=V(),s=V(),a=V();let o=Ee(t,"label",8,""),u=Ee(t,"icon",8,""),l=Ee(t,"color",8,"#666666"),c=Ee(t,"textColor",8,""),g=Ee(t,"backgroundStyle",8,""),p=Ee(t,"customStyle",8,""),w=Ee(t,"disabled",8,!1),m=Ee(t,"data",8,null),y=Ee(t,"width",8,120),k=Ee(t,"height",8,80),O=Ee(t,"shape",8,"rect"),F=Ee(t,"side",8,""),q=Ee(t,"active",8,!1),d=Ee(t,"showShape",8,""),A=Ee(t,"notificationStyle",8,null);const x=hn();let _,v=!1;function C(){!w()&&!v&&x("click",{data:m(),label:o()})}function z(de){w()||(de.preventDefault(),x("secondaryaction",{data:m(),label:o(),mouseX:de.clientX,mouseY:de.clientY,originalEvent:de}))}function D(de){!w()&&de.button===0&&(v=!1,_=setTimeout(()=>{v=!0,x("secondaryaction",{data:m(),label:o(),mouseX:de.clientX,mouseY:de.clientY,originalEvent:de})},500))}function K(){clearTimeout(_),setTimeout(()=>{v=!1},10)}function L(){clearTimeout(_),v=!1}Fe(()=>ue(F()),()=>{b(i,F()==="left"||F()==="right")}),Fe(()=>ue(o()),()=>{b(s,o())}),Fe(()=>(ue(O()),r(i),ue(F())),()=>{b(a,O()==="hex"&&r(i)?F()==="left"?"polygon(0% 0%, 100% 25%, 100% 75%, 0% 100%)":"polygon(0% 25%, 100% 0%, 100% 100%, 0% 75%)":O()==="hex"?"polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%)":"none")}),sn(),xt();var E=Io();let G;var B=f(E),P=f(B);{var fe=de=>{var oe=xo(),$=f(oe);ki($,t,"default",{}),T(de,oe)},be=de=>{var oe=Ve(),$=ke(oe);{var S=X=>{var J=Co(),Q=ke(J);{var re=le=>{var ae=To(),ye=f(ae),ge=f(ye);vs(ge,u),T(le,ae)};H(Q,le=>{u()&&le(re)})}var se=h(Q,2);{var ie=le=>{var ae=ko();ee(()=>Xe(ae,1,`shape-overlay ${d()??""}`,"svelte-12whdgj")),T(le,ae)};H(se,le=>{d()&&le(ie)})}T(X,J)},j=X=>{var J=Ve(),Q=ke(J);{var re=se=>{var ie=Eo(),le=f(ie);vs(le,()=>r(s)),ee(()=>vn(ie,p())),T(se,ie)};H(Q,se=>{o()&&se(re)},!0)}T(X,J)};H($,X=>{u()||d()?X(S):X(j,!1)},!0)}T(de,oe)};H(P,de=>{M(()=>n.default)?de(fe):de(be,!1)})}ee(de=>{G=Xe(E,1,`universal-button ${O()??""}`,"svelte-12whdgj",G,de),vn(E,`
    --button-width: ${y()??""}px; 
    --button-height: ${k()??""}px; 
    --button-color: ${l()??""};
    ${c()?`--button-text-color: ${c()};`:""}
    ${g()?`--button-background-style: ${g()};`:""}
    --clip-path: ${r(a)??""};
  `)},[()=>({disabled:w(),half:r(i),left:F()==="left",right:F()==="right",active:q(),notification:!!A(),error:A()==="error",warning:A()==="warning",success:A()==="success",print:A()?.startsWith("print")})]),Y("click",E,C),Y("contextmenu",E,z),Y("mousedown",E,D),Y("mouseup",E,K),Y("mouseleave",E,L),T(e,E),mt()}var Mo=U('<span class="table-number svelte-x88uh0"> </span>'),$o=U('<div class="pinpad-error-message svelte-x88uh0"> </div>'),Ao=U('<span class="qty svelte-x88uh0"> </span>'),Ro=U('<span class="input-overlay svelte-x88uh0"> </span>'),No=U('<li><!> <div class="name-container svelte-x88uh0"><span> </span> <!></div> <span class="price svelte-x88uh0"> </span></li>'),Oo=U('<div class="view-content order-view svelte-x88uh0"><div class="orders-stack svelte-x88uh0"><div class="parked-orders-section svelte-x88uh0"><!></div> <div class="active-order-section svelte-x88uh0"><div class="order-content svelte-x88uh0"><h2 class="svelte-x88uh0"><span class="order-number svelte-x88uh0"> </span><!></h2> <!> <div class="scrollable-items-content svelte-x88uh0"><ul class="item-list svelte-x88uh0"></ul></div> <div class="spacer svelte-x88uh0"></div> <div class="total svelte-x88uh0"><span class="svelte-x88uh0">Total:</span> <span class="price svelte-x88uh0"> </span></div></div></div></div></div>'),Do=U('<div class="view-content receipts-view svelte-x88uh0"><div class="receipts-stack svelte-x88uh0"><!></div></div>'),Po=U('<div class="agent-header-icon svelte-x88uh0"><!></div>'),Lo=U('<div class="message-actions svelte-x88uh0"></div>'),Uo=U('<div><div class="message-header svelte-x88uh0"><span class="message-timestamp svelte-x88uh0"> </span> <span class="message-type svelte-x88uh0"> </span></div> <div class="message-content svelte-x88uh0"> </div> <!></div>'),Fo=U(' <span class="cursor svelte-x88uh0">|</span>',1),jo=U(' <span class="cursor svelte-x88uh0">|</span>',1),Bo=U('<span class="cursor svelte-x88uh0">|</span>'),qo=U('<div class="agent-message user draft svelte-x88uh0"><div class="message-header svelte-x88uh0"><span class="message-timestamp svelte-x88uh0"> </span> <span class="message-type svelte-x88uh0">User</span></div> <div class="message-content svelte-x88uh0"><!></div></div>'),Vo=U('<div class="view-content agent-view svelte-x88uh0"><!> <div class="scroll-content svelte-x88uh0"><div class="agent-messages svelte-x88uh0"><!> <!></div></div></div>'),Go=U('<div class="console-view svelte-x88uh0"><div class="content-area svelte-x88uh0"><!></div></div>');function zo(e,t){pt(t,!1);const[n,i]=Zn(),s=()=>rt(Ze,"$orderStore",n),a=()=>rt(vt,"$currentView",n),o=()=>rt(vr,"$receiptsStore",n),u=()=>rt(pe,"$agentStore",n),l=()=>rt(Je,"$pinpadStore",n),c=()=>rt(pa,"$uiConstantsStore",n),g=hn();let p=V(),w=V(),m=V(),y=!1,k=V(!1),O=!1,F=V(!1),q=V("order"),d=V(!1),A=V(s().status),x=V(s().items.length),_=V(s().transactionId),v=V(s().metadata?.table),C=V(a());zt(()=>{setTimeout(()=>{if(O||(E(),L(),O=!0),a()==="agent"&&pe.shouldActivatePinpadOnLoad()&&Je.activate("agent",()=>{},()=>{},"numeric"),r(p)){const S=new ResizeObserver(()=>{r(p)&&b(F,r(p).scrollHeight>r(p).clientHeight)});return S.observe(r(p)),b(F,r(p).scrollHeight>r(p).clientHeight),()=>{S.disconnect()}}},200)}),Fi(()=>{if(!r(k)){let S=null;a()==="order"?S=r(w):a()==="agent"?S=r(p):a()==="receipts"&&(S=r(m)),S&&setTimeout(()=>{if(S&&!r(k)){if(L(),a()==="agent"&&r(p)){const j=r(p).scrollHeight>r(p).clientHeight;j!==r(F)&&b(F,j)}y||(b(k,!0),S.scrollTop=S.scrollHeight,setTimeout(()=>{b(k,!1),L()},100))}},50)}});function z(S){if(typeof S=="object"&&S!==null)return S;if(typeof S=="string")try{return JSON.parse(S)}catch{return S}return S}function D(){const j={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"Select language / Sprache auswählen / Выберите язык:",actions:[{id:"lang-de",label:"DE",action:"selectLanguage",param:"DE"},{id:"lang-en",label:"EN",action:"selectLanguage",param:"EN"},{id:"lang-ru",label:"RU",action:"selectLanguage",param:"RU"}]};pe.addMessage(j),setTimeout(()=>{r(p)&&(Be(p,r(p).scrollTop=r(p).scrollHeight),L())},100)}function K(S,j){if(S==="selectLanguage"){Je.switchLanguage(j);const X=u().messages.filter(re=>!re.actions);pe.clearMessages(),X.forEach(re=>pe.addMessage(re));const Q={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Language changed to ${j}`};pe.addMessage(Q),setTimeout(()=>{r(p)&&(Be(p,r(p).scrollTop=r(p).scrollHeight),L())},100)}}function L(){if(!r(k)){let S=null;if(a()==="order"?S=r(w):a()==="agent"?S=r(p):a()==="receipts"&&(S=r(m)),S){const X=S.scrollTop,J=S.clientHeight,Q=S.scrollHeight;y=X+J>=Q-1}else y=!0;g("scrollstate",y)}}function E(){let S=null;a()==="order"?S=r(w):a()==="agent"?S=r(p):a()==="receipts"&&(S=r(m)),S&&(S.scrollTop=S.scrollHeight,y=!0)}function G(){if(Dn(Cn).hasNotification){vt.set("agent");return}let j;switch(r(q)){case"order":j=["order","receipts","agent"];break;case"receipts":j=["receipts","order","agent"];break;case"agent":j=["agent","order","receipts"];break;default:j=["order","receipts","agent"]}const J=(j.indexOf(a())+1)%j.length,Q=j[J];a()==="receipts"&&Q!=="receipts"&&b(d,!1),vt.set(Q)}function B(){return y}zt(()=>{const S=ce.subscribe(j=>{if(j.lastMessage?.command==="menu-import-progress"){const X=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});pe.addMessage({timestamp:X,type:"agent",message:j.lastMessage.payload.message}),setTimeout(()=>{r(p)&&a()==="agent"&&(Be(p,r(p).scrollTop=r(p).scrollHeight),L())},100)}});return()=>{S()}}),typeof window<"u"&&window.electronAPI&&window.electronAPI.onImportComplete&&window.electronAPI.onImportComplete((S,j)=>{const X=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});pe.addMessage({timestamp:X,type:"agent",message:j}),S&&(W("INFO","Refreshing categories after successful menu import"),ce.send({command:"getCategories"}),setTimeout(()=>{const J=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});pe.addMessage({timestamp:J,type:"agent",message:"Menu import completed successfully! Your new menu structure is now ready for use. You can navigate back to the selection area to explore the imported categories and products."}),setTimeout(()=>{r(p)&&a()==="agent"&&(Be(p,r(p).scrollTop=r(p).scrollHeight),L())},100)},1e3)),setTimeout(()=>{r(p)&&a()==="agent"&&(Be(p,r(p).scrollTop=r(p).scrollHeight),L())},100)}),Fe(()=>(a(),r(C),Cn),()=>{a()==="agent"&&r(C)!=="agent"?(console.log("🔵 [ConsoleView] User switched TO agent view, will clear notification in 100ms"),console.log("🔵 [ConsoleView] Previous view:",r(C),"Current view:",a()),setTimeout(()=>{console.log("🔵 [ConsoleView] Clearing notification now"),Cn.clearNotification()},100)):a()==="agent"&&r(C)==="agent"?console.log("🔵 [ConsoleView] Already in agent view, NOT clearing notification"):a()!=="agent"&&console.log("🔵 [ConsoleView] Not in agent view, NOT clearing notification. Current view:",a()),b(C,a())}),Fe(()=>(r(A),s(),r(m)),()=>{r(A)==="finished"&&s().status==="idle"&&(b(q,"receipts"),b(d,!0),vt.set("receipts"),vr.refresh(),setTimeout(()=>{r(m)&&(Be(m,r(m).scrollTop=r(m).scrollHeight),L())},300)),b(A,s().status)}),Fe(()=>(o(),r(m),a()),()=>{o().receipts&&r(m)&&a()==="receipts"&&setTimeout(()=>{L()},100)}),Fe(()=>(u(),r(p),a(),r(F)),()=>{u().messages&&r(p)&&a()==="agent"&&setTimeout(()=>{if(r(p)){const S=r(p).scrollHeight>r(p).clientHeight;S!==r(F)&&b(F,S)}},100)}),Fe(()=>(a(),r(w),s(),r(x),r(_),r(v)),()=>{if(a()==="order"&&r(w)){const S=s().items.length,j=s().transactionId,X=s().metadata?.table;(S!==r(x)||j!==r(_)||X!==r(v))&&setTimeout(()=>{r(w)&&Be(w,r(w).scrollTop=r(w).scrollHeight)},100),b(x,S),b(_,j),b(v,X)}}),sn(),xt();var P=Go(),fe=f(P),be=f(fe);{var de=S=>{var j=Oo(),X=f(j),J=f(X),Q=f(J);bo(Q,{});var re=h(J,2),se=f(re),ie=f(se),le=f(ie),ae=f(le),ye=h(le);{var ge=R=>{var N=Mo(),te=f(N);ee(()=>Z(te,`#${l(),s(),M(()=>l().isActive&&l().mode==="table"?l().liveValue:s().metadata?.table)??""}`)),T(R,N)};H(ye,R=>{s(),l(),M(()=>s().metadata?.table||l().isActive&&l().mode==="table")&&R(ge)})}var Ce=h(ie,2);{var Ae=R=>{var N=$o(),te=f(N);ee(()=>Z(te,(l(),M(()=>l().errorMessage)))),T(R,N)};H(Ce,R=>{l(),M(()=>l().errorMessage)&&R(Ae)})}var De=h(Ce,2),Pe=f(De);$t(Pe,5,()=>(s(),M(()=>s().items)),R=>R.id,(R,N)=>{var te=No();let ve;var qe=f(te);{var ht=Le=>{var We=Ao(),ot=f(We);ee(yt=>Z(ot,`${yt??""}x`),[()=>(r(N),M(()=>parseFloat(r(N).quantity)))]),T(Le,We)};H(qe,Le=>{r(N),M(()=>parseFloat(r(N).quantity)>1)&&Le(ht)})}var ft=h(qe,2),_t=f(ft);let Ge;var at=f(_t),et=h(_t,2);{var it=Le=>{var We=Ro(),ot=f(We);ee(()=>Z(ot,(l(),M(()=>l().liveValue)))),T(Le,We)};H(et,Le=>{s(),r(N),l(),M(()=>s().activeTransactionItemId===r(N).id&&l().isActive&&l().mode!=="agent"&&l().liveValue)&&Le(it)})}var ze=h(ft,2),Ie=f(ze);ee((Le,We,ot,yt)=>{ve=Xe(te,1,"svelte-x88uh0",null,ve,Le),Ge=Xe(_t,1,"name svelte-x88uh0",null,Ge,We),Z(at,ot),Z(Ie,yt)},[()=>({active:s().activeTransactionItemId===r(N).id}),()=>({"input-mode":s().activeTransactionItemId===r(N).id&&l().isActive&&l().mode!=="agent"&&l().liveValue}),()=>(r(N),M(()=>r(N).display_names?z(r(N).display_names).menu.de||"N/A":"Loading...")),()=>(ue(wt),r(N),M(()=>wt(parseFloat(r(N).total_price))))]),T(R,te)});var me=h(De,4),Se=h(f(me),2),he=f(Se);tn(X,R=>b(w,R),()=>r(w)),ee(R=>{Z(ae,`Order №${s(),M(()=>s().transactionId||"...")??""}`),Z(he,R)},[()=>(ue(wt),s(),M(()=>wt(s().total)))]),Y("scroll",X,()=>!r(k)&&L()),T(S,j)},oe=S=>{var j=Ve(),X=ke(j);{var J=re=>{var se=Do(),ie=f(se),le=f(ie);ho(le,{get autoExpandLatest(){return r(d)}}),tn(ie,ae=>b(m,ae),()=>r(m)),Y("scroll",ie,()=>!r(k)&&L()),T(re,se)},Q=re=>{var se=Ve(),ie=ke(se);{var le=ae=>{var ye=Vo(),ge=f(ye);{var Ce=he=>{var R=Po(),N=f(R);So(N),T(he,R)};H(ge,he=>{r(F)||he(Ce)})}var Ae=h(ge,2),De=f(Ae),Pe=f(De);$t(Pe,1,()=>(u(),M(()=>u().messages)),dr,(he,R)=>{var N=Uo();let te;var ve=f(N),qe=f(ve),ht=f(qe),ft=h(qe,2),_t=f(ft),Ge=h(ve,2),at=f(Ge),et=h(Ge,2);{var it=ze=>{var Ie=Lo();$t(Ie,5,()=>(r(R),M(()=>r(R).actions)),dr,(Le,We)=>{{let ot=Me(()=>(r(We),M(()=>({display:r(We).label,action:()=>K(r(We).action,r(We).param)})))),yt=Me(()=>(c(),M(()=>({width:c().MIN_BUTTON_WIDTH,height:Math.round(c().MIN_BUTTON_WIDTH*.4)}))));Rt(Le,{get content(){return r(ot)},get size(){return r(yt)},style:"rectangular"})}}),T(ze,Ie)};H(et,ze=>{r(R),M(()=>r(R).actions)&&ze(it)})}ee(ze=>{te=Xe(N,1,"agent-message svelte-x88uh0",null,te,ze),Z(ht,(r(R),M(()=>r(R).timestamp))),Z(_t,(r(R),M(()=>r(R).type==="user"?"User":"Agent"))),Z(at,(r(R),M(()=>r(R).message)))},[()=>({user:r(R).type==="user",agent:r(R).type==="agent",error:r(R).style==="error",success:r(R).style==="success",warning:r(R).style==="warning",print:r(R).style?.startsWith("print")})]),T(he,N)});var me=h(Pe,2);{var Se=he=>{var R=qo(),N=f(R),te=f(N),ve=f(te),qe=h(N,2),ht=f(qe);{var ft=Ge=>{var at=Fo(),et=ke(at);ee(it=>Z(et,it),[()=>(l(),M(()=>"*".repeat(l().liveValue.length)))]),T(Ge,at)},_t=Ge=>{var at=Ve(),et=ke(at);{var it=Ie=>{var Le=jo(),We=ke(Le);ee(()=>Z(We,(u(),M(()=>u().draftMessage.message)))),T(Ie,Le)},ze=Ie=>{var Le=Bo();T(Ie,Le)};H(et,Ie=>{l(),u(),M(()=>l().layout==="alpha"&&u().draftMessage)?Ie(it):Ie(ze,!1)},!0)}T(Ge,at)};H(ht,Ge=>{l(),M(()=>l().layout==="numeric")?Ge(ft):Ge(_t,!1)})}ee(Ge=>Z(ve,Ge),[()=>M(()=>new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}))]),T(he,R)};H(me,he=>{l(),M(()=>l().isActive&&l().mode==="agent")&&he(Se)})}tn(Ae,he=>b(p,he),()=>r(p)),Y("scroll",Ae,()=>!r(k)&&L()),T(ae,ye)};H(ie,ae=>{a()==="agent"&&ae(le)},!0)}T(re,se)};H(X,re=>{a()==="receipts"?re(J):re(Q,!1)},!0)}T(S,j)};H(be,S=>{a()==="order"?S(de):S(oe,!1)})}T(e,P),er(t,"scrollToBottom",E),er(t,"cycleViews",G),er(t,"getIsAtBottom",B),er(t,"displayLanguageSelector",D);var $=mt({scrollToBottom:E,cycleViews:G,getIsAtBottom:B,displayLanguageSelector:D});return i(),$}const ts=gt(!1);function Wo(){ts.update(e=>!e)}function Ho(){ts.set(!1)}var Jo=U('<div class="pinpad-grid numeric svelte-l3qs12"><button class="numpad-key svelte-l3qs12">1</button> <button class="numpad-key svelte-l3qs12">2</button> <button class="numpad-key svelte-l3qs12">3</button> <button class="function-key key-cancel svelte-l3qs12" aria-label="Cancel">X</button> <button class="numpad-key svelte-l3qs12">4</button> <button class="numpad-key svelte-l3qs12">5</button> <button class="numpad-key svelte-l3qs12">6</button> <button class="function-key key-correct svelte-l3qs12" aria-label="Correct">←</button> <button class="numpad-key svelte-l3qs12">7</button> <button class="numpad-key svelte-l3qs12">8</button> <button class="numpad-key svelte-l3qs12">9</button> <button class="function-key key-enter svelte-l3qs12" aria-label="Enter">↵</button> <button class="numpad-key function-key key-plus svelte-l3qs12">.99</button> <button class="numpad-key svelte-l3qs12">0</button> <button class="numpad-key function-key key-minus svelte-l3qs12">.</button></div>'),Ko=U('<button class="alpha-key letter-key svelte-l3qs12"> </button>'),Yo=U('<div class="alpha-row svelte-l3qs12"></div>'),Xo=U('<div class="pinpad-grid alpha svelte-l3qs12"><!> <div class="alpha-bottom-row svelte-l3qs12"><button class="alpha-key space-key svelte-l3qs12" aria-label="Space">space</button> <button class="function-key cursor-key svelte-l3qs12" aria-label="Move cursor left">←</button> <button class="function-key cursor-key svelte-l3qs12" aria-label="Move cursor right">→</button> <button class="function-key language-key svelte-l3qs12" aria-label="Switch language"> </button> <button class="function-key key-cancel svelte-l3qs12" aria-label="Cancel">X</button> <button class="function-key key-correct svelte-l3qs12" aria-label="Backspace">⌫</button> <button class="function-key key-enter key-enter-large svelte-l3qs12" aria-label="Enter">↵</button></div></div>'),Qo=U('<div class="pinpad-wrapper svelte-l3qs12"><!></div>');function Zo(e,t){pt(t,!1);const[n,i]=Zn(),s=()=>rt(Je,"$pinpadStore",n);let a=Ee(t,"onClose",8,()=>{}),o=Ee(t,"minButtonSize",8,160),u=V(0),l=V(0),c=V(80),g=V(107),p=V(50),w=V(50),m=null,y=null;const k=6;let O=V(0),F=V(null),q=V(null),d=V(null),A=V(null);function x(oe){Je.append(oe,pe)}function _(){Je.backspace(pe)}function v(){Je.confirm()}function C(){Je.cancel(pe)}function z(){a()()}function D(oe){y=oe,m=setTimeout(()=>{y===oe&&(Je.append(oe.toUpperCase(),pe),y=null)},500)}function K(){m&&(clearTimeout(m),m=null),y&&(Je.append(y.toLowerCase(),pe),y=null)}function L(){m&&(clearTimeout(m),m=null),y=null}function E(){Je.moveCursorLeft()}function G(){Je.moveCursorRight()}function B(){Je.switchLanguage()}Fe(()=>(r(l),r(O),r(F)),()=>{r(l)>0&&Math.abs(r(l)-r(O))>5&&(r(F)&&clearTimeout(r(F)),b(F,setTimeout(()=>{b(O,r(l))},50)))}),Fe(()=>(s(),r(O),r(q),r(d),r(A),ue(o()),r(p),r(g)),()=>{const oe=s().layout,$=s().currentLanguage;if(r(O)>0&&(r(q)!==oe||r(d)!==$||r(A)!==o()||r(q)===null&&r(d)===null)){if(oe==="alpha"&&s().layouts&&$){const S=s().layouts[$],j=Math.max(...S.map(re=>re.length)),X=r(O)-k*(j-1);let J=Math.floor(X/j);const Q=o();J>Q&&(J=Q),b(p,J),b(w,Math.floor(r(p)*(3/4)))}else if(oe==="numeric"){const j=r(O)-k*3;let X=Math.floor(j/4);const J=o();X>J&&(X=J),b(g,X),b(c,Math.floor(r(g)*(3/4)))}b(q,oe),b(d,$),b(A,o())}}),sn(),xt();var P=Qo(),fe=f(P);{var be=oe=>{var $=Jo(),S=f($),j=h(S,2),X=h(j,2),J=h(X,2),Q=h(J,2),re=h(Q,2),se=h(re,2),ie=h(se,2),le=h(ie,2),ae=h(le,2),ye=h(ae,2),ge=h(ye,2),Ce=h(ge,2),Ae=h(Ce,2),De=h(Ae,2);ee(()=>vn($,`--button-height: ${r(c)??""}px; --button-width: ${r(g)??""}px;`)),Y("click",S,()=>x("1")),Y("click",j,()=>x("2")),Y("click",X,()=>x("3")),Y("click",J,C),Y("dblclick",J,z),Y("click",Q,()=>x("4")),Y("click",re,()=>x("5")),Y("click",se,()=>x("6")),Y("click",ie,_),Y("click",le,()=>x("7")),Y("click",ae,()=>x("8")),Y("click",ye,()=>x("9")),Y("click",ge,v),Y("click",Ce,()=>x(".99")),Y("click",Ae,()=>x("0")),Y("click",De,()=>x(".")),T(oe,$)},de=oe=>{var $=Ve(),S=ke($);{var j=X=>{var J=Xo(),Q=f(J);$t(Q,1,()=>(s(),M(()=>s().layouts[s().currentLanguage])),dr,(De,Pe)=>{var me=Yo();$t(me,5,()=>r(Pe),dr,(Se,he)=>{var R=Ko(),N=f(R);ee(()=>{Ri(R,"aria-label",`Letter ${r(he)??""}`),Z(N,r(he))}),Y("mousedown",R,()=>D(r(he))),Y("mouseup",R,K),Y("mouseleave",R,L),T(Se,R)}),T(De,me)});var re=h(Q,2),se=f(re),ie=h(se,2),le=h(ie,2),ae=h(le,2),ye=f(ae),ge=h(ae,2),Ce=h(ge,2),Ae=h(Ce,2);ee(()=>{vn(J,`--alpha-button-width: ${r(p)??""}px; --alpha-button-height: ${r(w)??""}px;`),Z(ye,(s(),M(()=>s().currentLanguage)))}),Y("click",se,()=>x(" ")),Y("click",ie,E),Y("click",le,G),Y("click",ae,B),Y("click",ge,C),Y("dblclick",ge,z),Y("click",Ce,_),Y("click",Ae,v),T(X,J)};H(S,X=>{s(),M(()=>s().layout==="alpha")&&X(j)},!0)}T(oe,$)};H(fe,oe=>{s(),M(()=>s().layout==="numeric")?oe(be):oe(de,!1)})}hs(P,"clientHeight",oe=>b(u,oe)),hs(P,"clientWidth",oe=>b(l,oe)),T(e,P),mt(),i()}var el=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Description:</span> <span class="value svelte-yjty9j"> </span></div>'),tl=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Allergens:</span> <span class="value svelte-yjty9j"> </span></div>'),nl=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Dietary:</span> <span class="value svelte-yjty9j"> </span></div>'),rl=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Category:</span> <span class="value svelte-yjty9j"> </span></div>'),sl=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Status:</span> <span class="value svelte-yjty9j"> </span></div>'),al=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Last Modified:</span> <span class="value svelte-yjty9j"> </span></div>'),il=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Product ID:</span> <span class="value svelte-yjty9j"> </span></div>'),ol=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Price:</span> <span class="value svelte-yjty9j"> </span></div> <!> <!> <!> <!> <!> <!> <!>',1),ll=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Type:</span> <span class="value svelte-yjty9j"> </span></div>'),cl=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Category ID:</span> <span class="value svelte-yjty9j"> </span></div>'),ul=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Parent Category:</span> <span class="value svelte-yjty9j"> </span></div>'),dl=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Main Group:</span> <span class="value svelte-yjty9j"> </span></div>'),fl=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Source ID:</span> <span class="value svelte-yjty9j"> </span></div>'),vl=U("<!> <!> <!> <!> <!>",1),pl=U('<div class="context-menu svelte-yjty9j"><div class="menu-header svelte-yjty9j"><h3 class="svelte-yjty9j"><!></h3></div> <div class="menu-content svelte-yjty9j"><!></div> <div class="menu-footer svelte-yjty9j"><button class="edit-button svelte-yjty9j">Edit</button> <button class="advanced-edit-button svelte-yjty9j">View</button> <button class="close-button svelte-yjty9j">Close</button></div></div>');function ml(e,t){pt(t,!1);const n=V(),i=V(),s=V();let a=Ee(t,"item",8,null),o=Ee(t,"x",8,0),u=Ee(t,"y",8,0),l=Ee(t,"visible",8,!1);const c=hn();let g=V(),p=V(0),w=V(0);zt(()=>{function v(z){r(g)&&!r(g).contains(z.target)&&c("close")}function C(z){z.key==="Escape"&&c("close")}return l()&&(document.addEventListener("click",v),document.addEventListener("keydown",C)),()=>{document.removeEventListener("click",v),document.removeEventListener("keydown",C)}});function m(v){return typeof v=="number"?`€${v.toFixed(2)}`:a()&&a().item_price_value&&typeof a().item_price_value=="number"?`€${a().item_price_value.toFixed(2)}`:v||"N/A"}function y(v){try{const C=JSON.parse(v);return C.menu?.de||C.button?.de||C.de||"Unnamed"}catch{return v||"Unnamed"}}function k(v){try{return JSON.parse(v).de||"Unnamed Category"}catch{return v||"Unnamed Category"}}function O(v){try{return JSON.parse(v)}catch{return{}}}function F(){if(!r(g))return;const v=r(g).getBoundingClientRect(),C=window.innerWidth,z=window.innerHeight;if(v.width===0||v.height===0){setTimeout(()=>F(),10);return}const D=10,K=10,L=v.width>C-D*2,E=v.height>z-D*2;let G,B;L&&E?(G=D,B=D):L?(G=D,B=u()+K,B+v.height>z-D&&(B=u()-v.height-K),B<D&&(B=D)):E?(B=D,G=o()+K,G+v.width>C-D&&(G=o()-v.width-K),G<D&&(G=D)):(G=o()+K,B=u()+K,G+v.width>C-D&&(G=o()-v.width-K),B+v.height>z-D&&(B=u()-v.height-K),G<D&&(G=D),B<D&&(B=D)),b(p,G),b(w,B)}function q(){c("edit",{item:a()}),c("close")}function d(){c("advanced-edit",{item:a()}),c("close")}Fe(()=>ue(a()),()=>{b(n,a()&&a().category_names)}),Fe(()=>ue(a()),()=>{b(i,a()&&a().display_names)}),Fe(()=>(r(i),ue(a())),()=>{b(s,r(i)&&a().additional_item_attributes?O(a().additional_item_attributes):{})}),Fe(()=>(ue(l()),r(g)),()=>{l()&&r(g)&&requestAnimationFrame(()=>F())}),sn(),xt();var A=Ve(),x=ke(A);{var _=v=>{var C=pl(),z=f(C),D=f(z),K=f(D);{var L=S=>{var j=Pt();ee(X=>Z(j,X),[()=>(ue(a()),M(()=>k(a().category_names)))]),T(S,j)},E=S=>{var j=Ve(),X=ke(j);{var J=re=>{var se=Pt();ee(ie=>Z(se,ie),[()=>(ue(a()),M(()=>y(a().display_names)))]),T(re,se)},Q=re=>{var se=Pt("Item Details");T(re,se)};H(X,re=>{r(i)?re(J):re(Q,!1)},!0)}T(S,j)};H(K,S=>{r(n)?S(L):S(E,!1)})}var G=h(z,2),B=f(G);{var P=S=>{var j=ol(),X=ke(j),J=h(f(X),2),Q=f(J),re=h(X,2);{var se=R=>{var N=el(),te=h(f(N),2),ve=f(te);ee(()=>Z(ve,(r(s),M(()=>r(s).description)))),T(R,N)};H(re,R=>{r(s),M(()=>r(s).description)&&R(se)})}var ie=h(re,2);{var le=R=>{var N=tl(),te=h(f(N),2),ve=f(te);ee(qe=>Z(ve,qe),[()=>(r(s),M(()=>r(s).allergens.join(", ")))]),T(R,N)};H(ie,R=>{r(s),M(()=>r(s).allergens&&r(s).allergens.length>0)&&R(le)})}var ae=h(ie,2);{var ye=R=>{var N=nl(),te=h(f(N),2),ve=f(te);ee(qe=>Z(ve,qe),[()=>(r(s),M(()=>r(s).dietary_info.join(", ")))]),T(R,N)};H(ae,R=>{r(s),M(()=>r(s).dietary_info&&r(s).dietary_info.length>0)&&R(ye)})}var ge=h(ae,2);{var Ce=R=>{var N=rl(),te=h(f(N),2),ve=f(te);ee(()=>Z(ve,(ue(a()),M(()=>a().associated_category_unique_identifier)))),T(R,N)};H(ge,R=>{ue(a()),M(()=>a().associated_category_unique_identifier)&&R(Ce)})}var Ae=h(ge,2);{var De=R=>{var N=sl(),te=h(f(N),2),ve=f(te);ee(()=>Z(ve,(ue(a()),M(()=>a().item_flags.is_sellable?"Available":"Not Available")))),T(R,N)};H(Ae,R=>{ue(a()),M(()=>a().item_flags&&a().item_flags.is_sellable!==void 0)&&R(De)})}var Pe=h(Ae,2);{var me=R=>{var N=al(),te=h(f(N),2),ve=f(te);ee(qe=>Z(ve,qe),[()=>(ue(a()),M(()=>new Date(a().audit_trail.updated_at||a().audit_trail.created_at).toLocaleDateString()))]),T(R,N)};H(Pe,R=>{ue(a()),M(()=>a().audit_trail)&&R(me)})}var Se=h(Pe,2);{var he=R=>{var N=il(),te=h(f(N),2),ve=f(te);ee(()=>Z(ve,(ue(a()),M(()=>a().id)))),T(R,N)};H(Se,R=>{ue(a()),M(()=>a().id)&&R(he)})}ee(R=>Z(Q,R),[()=>(ue(a()),M(()=>m(a().item_price_value)))]),T(S,j)},fe=S=>{var j=Ve(),X=ke(j);{var J=Q=>{var re=vl(),se=ke(re);{var ie=me=>{var Se=ll(),he=h(f(Se),2),R=f(he);ee(()=>Z(R,(ue(a()),M(()=>a().category_type)))),T(me,Se)};H(se,me=>{ue(a()),M(()=>a().category_type)&&me(ie)})}var le=h(se,2);{var ae=me=>{var Se=cl(),he=h(f(Se),2),R=f(he);ee(()=>Z(R,(ue(a()),M(()=>a().id)))),T(me,Se)};H(le,me=>{ue(a()),M(()=>a().id)&&me(ae)})}var ye=h(le,2);{var ge=me=>{var Se=ul(),he=h(f(Se),2),R=f(he);ee(()=>Z(R,(ue(a()),M(()=>a().parent_category_unique_identifier)))),T(me,Se)};H(ye,me=>{ue(a()),M(()=>a().parent_category_unique_identifier)&&me(ge)})}var Ce=h(ye,2);{var Ae=me=>{var Se=dl(),he=h(f(Se),2),R=f(he);ee(()=>Z(R,(ue(a()),M(()=>a().default_linked_main_group_unique_identifier)))),T(me,Se)};H(Ce,me=>{ue(a()),M(()=>a().default_linked_main_group_unique_identifier)&&me(Ae)})}var De=h(Ce,2);{var Pe=me=>{var Se=fl(),he=h(f(Se),2),R=f(he);ee(()=>Z(R,(ue(a()),M(()=>a().source_unique_identifier)))),T(me,Se)};H(De,me=>{ue(a()),M(()=>a().source_unique_identifier)&&me(Pe)})}T(Q,re)};H(X,Q=>{r(n)&&Q(J)},!0)}T(S,j)};H(B,S=>{r(i)?S(P):S(fe,!1)})}var be=h(G,2),de=f(be),oe=h(de,2),$=h(oe,2);tn(C,S=>b(g,S),()=>r(g)),ee(()=>vn(C,`left: ${(r(p)||o())??""}px; top: ${(r(w)||u())??""}px;`)),Y("click",de,()=>q()),Y("click",oe,()=>d()),Y("click",$,()=>c("close")),T(v,C)};H(x,v=>{l()&&a()&&v(_)})}T(e,A),mt()}var gl=U('<span class="error-message svelte-eqo6fo"> </span>'),hl=U('<span class="error-message svelte-eqo6fo"> </span>'),_l=U('<span class="error-message svelte-eqo6fo"> </span>'),yl=U('<span class="error-message svelte-eqo6fo"> </span>'),bl=U('<span class="error-message svelte-eqo6fo"> </span>'),wl=U('<div class="modal-overlay svelte-eqo6fo" role="dialog" tabindex="-1"><div class="modal-content svelte-eqo6fo"><div class="modal-header svelte-eqo6fo"><h2 class="svelte-eqo6fo">Edit Product</h2> <button class="close-button svelte-eqo6fo" aria-label="Close">×</button></div> <form class="product-form svelte-eqo6fo"><div class="form-group svelte-eqo6fo"><label for="product-name-menu" class="svelte-eqo6fo">Name (Menu)</label> <input id="product-name-menu" type="text" placeholder="Enter menu name"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-name-button" class="svelte-eqo6fo">Name (Button)</label> <input id="product-name-button" type="text" placeholder="Enter button name"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-name-receipt" class="svelte-eqo6fo">Name (Receipt)</label> <input id="product-name-receipt" type="text" placeholder="Enter receipt name"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-price" class="svelte-eqo6fo">Price (€)</label> <input id="product-price" type="number" step="0.01" min="0" placeholder="0.00"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-category" class="svelte-eqo6fo">Category</label> <input id="product-category" type="text" placeholder="Enter category name"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-description" class="svelte-eqo6fo">Description</label> <textarea id="product-description" placeholder="Enter product description (optional)" rows="3" class="svelte-eqo6fo"></textarea></div> <div class="form-actions svelte-eqo6fo"><button type="button" class="btn-cancel svelte-eqo6fo">Cancel</button> <button type="submit" class="btn-save svelte-eqo6fo"><!></button></div></form></div></div>');function Sl(e,t){pt(t,!1);const n=hn();let i=Ee(t,"visible",8,!1),s=Ee(t,"product",8,null),a=V({name_menu:"",name_button:"",name_receipt:"",price:"",categoryName:"",description:""}),o=V({}),u=V(!1),l=V(!1),c=V({});function g(d){if(typeof d=="object"&&d!==null)return d;if(typeof d=="string")try{return JSON.parse(d)}catch{return d}return d}function p(){if(b(c,{}),r(a).name_menu.trim()||Be(c,r(c).name_menu="Menu name is required"),r(a).name_button.trim()||Be(c,r(c).name_button="Button name is required"),r(a).name_receipt.trim()||Be(c,r(c).name_receipt="Receipt name is required"),!r(a).price.trim())Be(c,r(c).price="Price is required");else{const d=parseFloat(r(a).price);(isNaN(d)||d<0)&&Be(c,r(c).price="Price must be a valid positive number")}return r(a).categoryName.trim()||Be(c,r(c).categoryName="Category is required"),Object.keys(r(c)).length===0}async function w(){if(p()){b(l,!0);try{const d={};r(a).name_menu!==r(o).name_menu&&(d.name_menu=r(a).name_menu.trim()),r(a).name_button!==r(o).name_button&&(d.name_button=r(a).name_button.trim()),r(a).name_receipt!==r(o).name_receipt&&(d.name_receipt=r(a).name_receipt.trim()),r(a).price!==r(o).price&&(d.price=parseFloat(r(a).price)),r(a).categoryName!==r(o).categoryName&&(d.categoryName=r(a).categoryName.trim()),r(a).description!==r(o).description&&(d.description=r(a).description.trim()),Object.keys(d).length>0&&n("save",{productId:s().id,updates:d}),m()}catch(d){console.error("Error saving product:",d)}finally{b(l,!1)}}}function m(){n("close")}function y(d){d.target===d.currentTarget&&m()}function k(d){d.key==="Escape"&&m()}Fe(()=>(ue(s()),ue(i()),r(a)),()=>{if(s()&&i()){const d=s().display_names?g(s().display_names):{},A=d.menu?.de||s().name||"",x=d.button?.de||d.menu?.de||s().name||"",_=d.receipt?.de||d.menu?.de||s().name||"";let v="Unknown Category";s().category_name?v=s().category_name:s().categoryName?v=s().categoryName:v=`Category ID: ${s().associated_category_unique_identifier||"N/A"}`,b(a,{name_menu:A,name_button:x,name_receipt:_,price:(s().item_price_value||s().price||0).toString(),categoryName:v,description:s().description||A}),b(o,{...r(a)}),b(u,!1),b(c,{})}}),Fe(()=>(ue(i()),r(a),r(o)),()=>{b(u,i()&&(r(a).name_menu!==r(o).name_menu||r(a).name_button!==r(o).name_button||r(a).name_receipt!==r(o).name_receipt||r(a).price!==r(o).price||r(a).categoryName!==r(o).categoryName||r(a).description!==r(o).description))}),sn(),xt();var O=Ve();Y("keydown",Hn,k);var F=ke(O);{var q=d=>{var A=wl(),x=f(A),_=f(x),v=h(f(_),2),C=h(_,2),z=f(C),D=h(f(z),2);let K;var L=h(D,2);{var E=N=>{var te=gl(),ve=f(te);ee(()=>Z(ve,(r(c),M(()=>r(c).name_menu)))),T(N,te)};H(L,N=>{r(c),M(()=>r(c).name_menu)&&N(E)})}var G=h(z,2),B=h(f(G),2);let P;var fe=h(B,2);{var be=N=>{var te=hl(),ve=f(te);ee(()=>Z(ve,(r(c),M(()=>r(c).name_button)))),T(N,te)};H(fe,N=>{r(c),M(()=>r(c).name_button)&&N(be)})}var de=h(G,2),oe=h(f(de),2);let $;var S=h(oe,2);{var j=N=>{var te=_l(),ve=f(te);ee(()=>Z(ve,(r(c),M(()=>r(c).name_receipt)))),T(N,te)};H(S,N=>{r(c),M(()=>r(c).name_receipt)&&N(j)})}var X=h(de,2),J=h(f(X),2);let Q;var re=h(J,2);{var se=N=>{var te=yl(),ve=f(te);ee(()=>Z(ve,(r(c),M(()=>r(c).price)))),T(N,te)};H(re,N=>{r(c),M(()=>r(c).price)&&N(se)})}var ie=h(X,2),le=h(f(ie),2);let ae;var ye=h(le,2);{var ge=N=>{var te=bl(),ve=f(te);ee(()=>Z(ve,(r(c),M(()=>r(c).categoryName)))),T(N,te)};H(ye,N=>{r(c),M(()=>r(c).categoryName)&&N(ge)})}var Ce=h(ie,2),Ae=h(f(Ce),2),De=h(Ce,2),Pe=f(De),me=h(Pe,2),Se=f(me);{var he=N=>{var te=Pt("Saving...");T(N,te)},R=N=>{var te=Pt("Save Changes");T(N,te)};H(Se,N=>{r(l)?N(he):N(R,!1)})}ee((N,te,ve,qe,ht,ft)=>{D.disabled=r(l),K=Xe(D,1,"svelte-eqo6fo",null,K,N),B.disabled=r(l),P=Xe(B,1,"svelte-eqo6fo",null,P,te),oe.disabled=r(l),$=Xe(oe,1,"svelte-eqo6fo",null,$,ve),J.disabled=r(l),Q=Xe(J,1,"svelte-eqo6fo",null,Q,qe),le.disabled=r(l),ae=Xe(le,1,"svelte-eqo6fo",null,ae,ht),Ae.disabled=r(l),Pe.disabled=r(l),me.disabled=ft},[()=>({error:r(c).name_menu}),()=>({error:r(c).name_button}),()=>({error:r(c).name_receipt}),()=>({error:r(c).price}),()=>({error:r(c).categoryName}),()=>(r(u),r(l),r(c),M(()=>!r(u)||r(l)||Object.keys(r(c)).length>0))]),Y("click",v,m),Bt(D,()=>r(a).name_menu,N=>Be(a,r(a).name_menu=N)),Bt(B,()=>r(a).name_button,N=>Be(a,r(a).name_button=N)),Bt(oe,()=>r(a).name_receipt,N=>Be(a,r(a).name_receipt=N)),Bt(J,()=>r(a).price,N=>Be(a,r(a).price=N)),Bt(le,()=>r(a).categoryName,N=>Be(a,r(a).categoryName=N)),Bt(Ae,()=>r(a).description,N=>Be(a,r(a).description=N)),Y("click",Pe,m),Y("submit",C,ua(w)),Y("click",A,y),Y("keydown",A,k),T(d,A)};H(F,d=>{i()&&s()&&d(q)})}T(e,O),mt()}var xl=U('<div class="modal-overlay svelte-3d9wpg"><div class="modal-content svelte-3d9wpg"><div class="modal-header svelte-3d9wpg"><h2 class="svelte-3d9wpg">Edit Category</h2> <button class="close-button svelte-3d9wpg">×</button></div> <form class="product-form svelte-3d9wpg"><div class="form-group svelte-3d9wpg"><label for="category-name" class="svelte-3d9wpg">Category Name</label> <input id="category-name" type="text" class="svelte-3d9wpg"/></div> <div class="form-group svelte-3d9wpg"><label for="category-type" class="svelte-3d9wpg">Category Type</label> <select id="category-type" class="svelte-3d9wpg"><option>Food</option><option>Drink</option><option>Other</option></select></div> <div class="form-actions svelte-3d9wpg"><button type="button" class="btn-cancel svelte-3d9wpg">Cancel</button> <button type="submit" class="btn-save svelte-3d9wpg"> </button></div></form></div></div>');function Tl(e,t){pt(t,!1);let n=Ee(t,"visible",8,!1),i=Ee(t,"category",8,null);const s=hn();let a=V({name:"",type:"food"}),o=V({}),u=V(!1);async function l(){if(!r(a).name.trim()){alert("Category name is required.");return}b(u,!0);const k={};r(a).name!==r(o).name&&(k.name=r(a).name.trim()),r(a).type!==r(o).type&&(k.type=r(a).type),Object.keys(k).length>0&&s("save",{categoryId:i().id,updates:k}),c()}function c(){b(u,!1),s("close")}function g(k){k.target===k.currentTarget&&c()}function p(k){k.key==="Escape"&&c()}Fe(()=>(ue(i()),ue(n()),r(a)),()=>{if(i()&&n()){const k=JSON.parse(i().category_names||"{}");b(a,{name:k.de||"",type:i().category_type||"food"}),b(o,{...r(a)})}}),sn(),xt();var w=Ve();Y("keydown",Hn,p);var m=ke(w);{var y=k=>{var O=xl(),F=f(O),q=f(F),d=h(f(q),2),A=h(q,2),x=f(A),_=h(f(x),2),v=h(x,2),C=h(f(v),2);ee(()=>{r(a),Qs(()=>{r(u)})});var z=f(C);z.value=z.__value="food";var D=h(z);D.value=D.__value="drink";var K=h(D);K.value=K.__value="other";var L=h(v,2),E=f(L),G=h(E,2),B=f(G);ee(()=>{_.disabled=r(u),C.disabled=r(u),E.disabled=r(u),G.disabled=r(u),Z(B,r(u)?"Saving...":"Save Changes")}),Y("click",d,c),Bt(_,()=>r(a).name,P=>Be(a,r(a).name=P)),la(C,()=>r(a).type,P=>Be(a,r(a).type=P)),Y("click",E,c),Y("submit",A,ua(l)),Y("click",O,g),T(k,O)};H(m,k=>{n()&&i()&&k(y)})}T(e,w),mt()}var kl=sa(`<svg viewBox="-10 -10 120 120" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%;"><defs><filter height="170%" id="sh2" width="170%" x="-0.2" y="-0.2"><feOffset dx="0" dy="0" in="SourceAlpha"></feOffset><feGaussianBlur stdDeviation="1.2"></feGaussianBlur><feColorMatrix result="out" type="matrix" values=" 
               0 0 0 0 0.2         
               0 0 0 0 0.2                    
               0 0 0 0 0.2                
               0 0 0 10 0 "></feColorMatrix><feMerge><feMergeNode in="out"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter></defs><g filter="url(#sh2)"><path fill="#2c2c2e" stroke="#666" stroke-width="1.5" d="M72,89 C78.6,68 67.2,30.7 89,68 C86.9,37.6 66.91,32 62,61 C58,44.1 67.5,38.8 52,10 C53.6,47 46.91,36.2 45,61 C39.3,43.4 22,46.6 13,43 C32.9,55.8 35.7,66.62 32,89 C35,97.9 68.6,99 72,89 Z"></path><circle fill="#2c2c2e" stroke="#666" stroke-width="1.5" cx="13" cy="43" r="5.5"></circle><circle fill="#2c2c2e" stroke="#666" stroke-width="1.5" cx="52" cy="10" r="5.5"></circle><circle fill="#2c2c2e" stroke="#666" stroke-width="1.5" cx="89" cy="68" r="5.5"></circle></g></svg>`);function Ss(e){var t=kl();T(e,t)}class Cl{constructor(t,n,i=!0){this.row=t,this.col=n,this.content=null,this.isEmpty=!0,this.isUsable=i,this.priority=0,this.id=`slot-${t}-${n}`}setContent(t,n=1){this.content=t,this.isEmpty=!1,this.priority=n}clearContent(){this.content=null,this.isEmpty=!0,this.priority=0}}class El{constructor(t,n){this.rows=t,this.cols=n,this.slots=[],this.contentSlots=[],this.initializeGrid()}initializeGrid(){for(let t=0;t<this.rows;t++){const n=[];for(let i=0;i<this.cols;i++){const s=t%2!==i%2,a=new Cl(t,i,s);n.push(a),this.contentSlots.push(a)}this.slots.push(n)}}getSlot(t,n){return t>=0&&t<this.rows&&n>=0&&n<this.cols?this.slots[t][n]:null}getAllSlots(){return this.contentSlots}getUsableEmptySlots(){return this.contentSlots.filter(t=>t.isUsable&&t.isEmpty)}getUsableFilledSlots(){return this.contentSlots.filter(t=>t.isUsable&&!t.isEmpty)}getUsableSlots(){return this.contentSlots.filter(t=>t.isUsable)}placeContentAt(t,n,i,s){const a=this.getSlot(t,n);return a&&a.isUsable&&(a.isEmpty||s>a.priority)?(a.setContent(i,s),!0):!1}clearAllContent(){this.contentSlots.forEach(t=>{t.clearContent()})}getPrioritizedSlots(){return this.contentSlots.filter(t=>t.isUsable).sort((t,n)=>n.priority-t.priority)}}function Il(e,t,n){const{cellWidth:i=120,cellHeight:s=80,buttonGap:a=6,hexOffset:o=.5,shape:u="hex"}=n;return u==="hex"?Ml(e,t,i,s,a):$l(e,t,i,s,a)}function Ml(e,t,n,i,s,a){const o=t%2===1,u=Math.floor(t/2),l=u*(n+s)+(o?(n+s)/2:0),c=i*.75,g=e*(c+s);return console.log(`🔮 [hexPositioning] row=${e}, col=${t}, isOddCol=${o}, visualCol=${u}, x=${l}, y=${g}, gap=${s}`),{x:l,y:g}}function $l(e,t,n,i,s){const a=t*(n+s),o=e*(i+s);return console.log(`🔮 [rectPositioning] row=${e}, col=${t}, x=${a}, y=${o}, gap=${s}`),{x:a,y:o}}function Al(e){return e?`translate(${e.x}px, ${e.y}px)`:"translate(0px, 0px)"}class Rl{constructor(t,n,i){this.id=t,this.type=n,this.logicalPosition=i,this.content=null,this.cssPosition=null,this.cssTransform=null,this.geometryMetadata={}}setContent(t){this.content=t}calculatePhysicalPosition(t){return this.cssPosition=Il(this.logicalPosition.row,this.logicalPosition.col,t),this.cssTransform=Al(this.cssPosition),this.cssPosition}}class Nl{constructor(t={}){this.options={shape:"hex",cellWidth:t.cellWidth||120,cellHeight:t.cellHeight||80,buttonGap:t.buttonGap||6,...t}}renderContentGrid(t){const n=[],i=t.getUsableFilledSlots();for(const s of i){const a=new Rl(`full-slot-${s.row}-${s.col}`,"full",{row:s.row,col:s.col});a.setContent(s.content),a.geometryMetadata.priority=s.priority,a.calculatePhysicalPosition(this.options),n.push(a)}return n}}function xs(e={}){return new Nl(e)}const Ts={MAX_CONTENT:100,PAYMENT_BUTTON:90,TABLE_BUTTON:85,PINPAD_BUTTON:80,CATEGORY_NAVIGATION:70,DEFAULT:50,MIN:1};class Ol{constructor(t={}){this.config={dimensions:{rows:4,cols:12},rendering:{shape:"hex",cellWidth:120,cellHeight:80},...t},this.contentGrid=new El(this.config.dimensions.rows,this.config.dimensions.cols),this.geometryRenderer=xs(this.config.rendering),this.renderCache=null,this.isDirty=!0,console.log("🎯 [GridManager] Initialized ContentGrid",this.config.dimensions)}clearAndReset(){this.contentGrid.clearAllContent(),this.markDirty()}placeItems(t,n=Ts.DEFAULT,i=1/0){if(!t||t.length===0)return[];const s=this.contentGrid.getUsableEmptySlots();let a=0;const o=[];t.sort((u,l)=>(u.order_index||0)-(l.order_index||0));for(const u of t){if(a>=i)break;const l=s[a];l&&(l.setContent(u,n),a++,o.push({item:u,placed:!0,slot:l}))}return this.markDirty(),o}placeSystemElements(t){const n=[];for(const i of t){const s=this.contentGrid.placeContentAt(i.row,i.col,i.content,i.priority);n.push({element:i,placed:s})}return this.markDirty(),n}getRenderStructure(){return this.renderCache&&!this.isDirty?this.renderCache:(this.contentGrid.getUsableFilledSlots(),this.renderCache=this.geometryRenderer.renderContentGrid(this.contentGrid),this.isDirty=!1,this.renderCache)}getSvelteCompatibleCells(t){return this.geometryRenderer=xs(t),this.getRenderStructure().map(i=>({...i,cssTransform:i.cssTransform,data:i.content.data||i.content,label:i.content.label||i.content.category_names?.de||i.content.display_names?.button?.de}))}getDebugInfo(){return this.contentGrid.getDebugInfo()}getUsableSlotCount(){return this.contentGrid.getUsableSlots().length}markDirty(){this.isDirty=!0}getPriorities(){return Ts}}var Dl=U('<p class="status-message svelte-1eijoyu"> </p>'),Pl=U('<div class="empty-category-info svelte-1eijoyu"><p>No products in this category.</p></div>'),Ll=U('<div class="quantum-button svelte-1eijoyu"><!></div>'),Ul=U("<div><!> <!></div>"),Fl=U("<div><div><!></div></div>"),jl=U('<div class="selection-area svelte-1eijoyu"><div class="side-rail left svelte-1eijoyu"><!> <!> <!> <!></div> <div class="grid-container svelte-1eijoyu"><!></div> <div class="side-rail right svelte-1eijoyu"><!> <!> <!> <!></div> <!> <!> <!> <!></div>');function Bl(e,t){pt(t,!1);const[n,i]=Zn(),s=()=>rt(pa,"$uiConstantsStore",n),a=()=>rt(Ze,"$orderStore",n),o=()=>rt(nn,"$authStore",n),u=()=>rt(Cn,"$notificationStore",n),l=()=>rt(Je,"$pinpadStore",n),c=()=>rt(Gi,"$currentMinuteTime",n),g=V(),p=V(),w=V();let m=V([]),y=V([]),k=V("Connecting to backend..."),O=!1,F=V("categories"),q=null,d=V("6-6-6"),A=V(!1),x=V(null),_=V(0),v=V(0),C=V(!1),z=V(null),D=V(!1),K=V(null),L=0;Ee(t,"isAtBottom",8,!1),Ee(t,"consoleViewComponent",8,null);let E=0,G=V(null),B=V([]),P=Ee(t,"handleSmartAction",8,()=>{});const fe=6,be=6,de=6,oe=6;let $=V(r(g)),S=V(r(g)*.866),j=V(r(g)),X=V(r(g)),J=1,Q=1,re=V(),se,ie,le=!1;Cn.subscribe(I=>{}),nn.subscribe(I=>{}),zt(()=>{r(re)&&(se=new ResizeObserver(ne=>{ie&&clearTimeout(ie),ie=setTimeout(()=>{for(let xe of ne){const Ue=xe.contentRect.width,Te=xe.contentRect.height;(L!==Ue||E!==Te)&&(L=Ue,E=Te,ye())}},150)}),se.observe(r(re)),setTimeout(()=>{L=r(re).clientWidth,E=r(re).clientHeight,ye()},100));const I=()=>{b(F,"categories"),q=null,vt.set("order")};return window.addEventListener("autoCollapseComplete",I),()=>{se?.disconnect(),window.removeEventListener("autoCollapseComplete",I)}}),ce.subscribe(I=>{O=I.isConnected,O&&!le&&(le=!0,b(k,"Loading categories..."),setTimeout(()=>{ce.send({command:"getCategories"}).then(ne=>{ne.status==="success"&&Array.isArray(ne.payload)?(b(m,ne.payload),b(k,"")):b(k,"Error: Could not load categories.")}).catch(ne=>{b(k,"Error: Failed to get response for categories.")})},500)),I.lastMessage?.command==="getItemsByCategoryResponse"&&(I.lastMessage.status==="success"&&Array.isArray(I.lastMessage.payload)?(b(y,I.lastMessage.payload),b(F,"products"),b(k,"")):b(k,"Error: Could not load products."))});function ae(I,ne,xe,Ue,Te,jt,Ye){const Ne=I,tt=ne-2*jt;let Qe=null;for(let ct=Math.floor((Ne-Te)/(xe+Te));ct>=1;ct--){let Yt,Pn;const Ln=(Ne-(ct+1)*Te)/ct,Un=(Ne-(ct+1)*Te)/(ct+.5);if(Ln>=xe&&Ln>=Un)Yt=Ln,Pn="symmetrical";else if(Un>=xe)Yt=Un,Pn="asymmetrical";else continue;let _n;const Fn=Yt*Ue;let on=0;if(Ye?(on=Math.max(1,Math.floor((tt-Te-Fn*.25)/(Fn*.75+Te))+1),_n=(tt-(on-1)*Te)/(1+(on-1)*.75)):(on=Math.max(1,Math.floor((tt+Te)/(Fn+Te))),_n=(tt-(on-1)*Te)/on),_n>=xe*Ue*.8){Qe={columns:ct,rows:on,buttonWidth:Yt,buttonHeight:_n,layout:Pn};break}}return Qe||{columns:1,rows:1,buttonWidth:Math.max(xe,Ne-2*Te),buttonHeight:Math.max(xe,tt),layout:"symmetrical"}}function ye(){if(!(L<=0||E<=0)){if(r(d)==="6-6-6"){const I=ae(L,E,r(g),.866,fe,de,!0);I&&(J=I.columns,Q=I.rows,b($,I.buttonWidth),b(S,I.buttonHeight),I.layout)}else{const I=ae(L,E,r(g),.75,be,oe,!1);I&&(J=I.columns,Q=I.rows,b(j,I.buttonWidth),b(X,I.buttonHeight),I.layout)}b(G,new Ol({dimensions:{rows:Q,cols:J*2},rendering:{shape:r(d)==="6-6-6"?"hex":"rect",cellWidth:r(d)==="6-6-6"?r($):r(j),cellHeight:r(d)==="6-6-6"?r(S):r(X)}})),ge()}}function ge(){if(!r(G))return;r(G).clearAndReset();const I=r(G).getPriorities(),ne=[];a().items.length>0&&(ne.push({row:Q-1,col:(J-1)*2,content:{type:"bar",label:"Bar",onClick:()=>R("cash")},priority:I.PAYMENT_BUTTON}),ne.push({row:Q-1,col:(J-2)*2,content:{type:"karte",label:"Karte",onClick:()=>R("card")},priority:I.PAYMENT_BUTTON})),ne.push({row:Q-1,col:0,content:{type:"pinpad",label:"Pinpad"},priority:I.PINPAD_BUTTON}),r(G).placeSystemElements(ne),r(F)==="categories"?r(G).placeItems(r(m),I.CATEGORY_NAVIGATION):r(G).placeItems(r(y),I.MAX_CONTENT),b(B,r(G).getSvelteCompatibleCells(r(G).config.rendering))}function Ce(I){I.content?.onClick?I.content.onClick():I.data&&(r(F)==="categories"&&I.data.id?Ae({detail:{data:I.data}}):r(F)==="products"&&I.data.id&&De({detail:{data:I.data}}))}function Ae({detail:I}){I.data?.id&&(q=I.data,b(k,"Loading..."),ce.send({command:"getItemsByCategory",payload:{categoryId:I.data.id}}))}async function De({detail:I}){I.data?.id&&await Ze.addItem(I.data.id,1)}function Pe(){b(d,r(d)==="6-6-6"?"4-4-4":"6-6-6")}function me(){Wo()}function Se(){o().currentUser&&pe.addMessage({type:"agent",message:`Logged in as ${o().currentUser.full_name}`})}async function he(){o().isAuthenticated&&await nn.logout()}function R(I){a().total>0&&Ze.finishOrder({type:I.charAt(0).toUpperCase()+I.slice(1),amount:a().total})}function N(){l().isActive?Je.deactivate():Je.activateAlphaInput(()=>{},()=>{},pe)}function te({detail:I}){I.data&&!I.data.isBackButton&&(b(x,I.data),b(_,I.mouseX),b(v,I.mouseY),b(A,!0))}function ve(){b(A,!1)}function qe({detail:I}){I.item.category_names?(b(K,I.item),b(D,!0)):(b(z,I.item),b(C,!0)),b(A,!1)}async function ht({detail:I}){}async function ft({detail:I}){await ce.send({command:"updateProduct",payload:{productId:I.productId,updates:I.updates,sessionId:"admin-session-placeholder"}}),r(F)==="products"&&q&&ce.send({command:"getItemsByCategory",payload:{categoryId:q.id}}),b(C,!1)}async function _t({detail:I}){await ce.send({command:"updateCategory",payload:{categoryId:I.categoryId,updates:I.updates}}),r(F)==="categories"&&ce.send({command:"getCategories"}),b(D,!1)}function Ge(I){return I.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})}function at(I){if(!I)return"Login";const ne=I.split(" ");let xe;if(ne.length===1)xe=ne[0].length>12?ne[0].substring(0,12)+"...":ne[0];else if(ne.length===2){const Ue=ne[0].length>8?ne[0].substring(0,8)+".":ne[0],Te=ne[1].length>8?ne[1].substring(0,8)+".":ne[1];xe=`${Ue} ${Te}`}else{const Ue=ne[0].length>6?ne[0].substring(0,6)+".":ne[0],Te=ne[ne.length-1].length>6?ne[ne.length-1].substring(0,6)+".":ne[ne.length-1];xe=`${Ue} ${Te}`}return`Angemeldet als
${xe}`}Fe(()=>s(),()=>{b(g,s().MIN_BUTTON_WIDTH)}),Fe(()=>r(d),()=>{r(d)&&ye()}),Fe(()=>(r(G),r(F),r(m),r(y),a()),()=>{r(G),r(F),r(m),r(y),a()&&ge()}),Fe(()=>(o(),Je),()=>{b(p,(()=>{const I=o().currentUser;return I?{label:at(I.full_name),data:{isUserButton:!0,authenticated:!0},onClick:Se,color:"#28a745",textColor:"#666"}:{label:"Login",data:{isUserButton:!0,authenticated:!1},onClick:()=>Je.activate("agent",null,null,"numeric"),color:"#6c757d",textColor:"#666"}})())}),Fe(()=>(u(),ue(P())),()=>{b(w,(()=>{let I="#2c2c2e";if(u().style)switch(u().style){case"error":I="#d32f2f";break;case"warning":I="#f57c00";break;case"info":I="#1976d2";break;case"success":I="#388e3c";break}return{icon:Ss,showShape:!0,color:I,onClick:()=>P()("betrugerCap")}})())}),sn(),xt();var et=jl(),it=f(et),ze=f(it);{let I=Me(()=>r($)/2-fe/2);Rt(ze,{shape:"hex",side:"left",get width(){return r(I)},get height(){return r(S)}})}var Ie=h(ze,2);{let I=Me(()=>r($)/2-fe/2),ne=Me(()=>(r(p),M(()=>r(p)?.label))),xe=Me(()=>(r(p),M(()=>r(p)?.data))),Ue=Me(()=>(r(p),M(()=>r(p)?.color)));Rt(Ie,{shape:"hex",side:"left",get width(){return r(I)},get height(){return r(S)},get label(){return r(ne)},get data(){return r(xe)},get color(){return r(Ue)},$$events:{click(...Te){r(p)?.onClick?.apply(this,Te)},secondaryaction:he}})}var Le=h(Ie,2);{let I=Me(()=>r($)/2-fe/2);Rt(Le,{shape:"hex",side:"left",get width(){return r(I)},get height(){return r(S)}})}var We=h(Le,2);{let I=Me(()=>r($)/2-fe/2),ne=Me(()=>(r(w),M(()=>r(w)?.icon))),xe=Me(()=>(r(w),M(()=>r(w)?.showShape))),Ue=Me(()=>(r(w),M(()=>r(w)?.color)));Rt(We,{shape:"hex",side:"left",get width(){return r(I)},get height(){return r(S)},get icon(){return r(ne)},get showShape(){return r(xe)},get color(){return r(Ue)},$$events:{click(...Te){r(w)?.onClick?.apply(this,Te)}}})}var ot=h(it,2),yt=f(ot);{var an=I=>{var ne=Dl(),xe=f(ne);ee(()=>Z(xe,r(k))),T(I,ne)},Re=I=>{var ne=Ul();let xe;vn(ne,"padding: 6px 0;");var Ue=f(ne);{var Te=Ye=>{var Ne=Pl();T(Ye,Ne)};H(Ue,Ye=>{r(F),r(y),M(()=>r(F)==="products"&&r(y).length===0)&&Ye(Te)})}var jt=h(Ue,2);$t(jt,1,()=>r(B),Ye=>Ye.id,(Ye,Ne)=>{var tt=Ll(),Qe=f(tt);{let ct=Me(()=>r(d)==="6-6-6"?"hex":"rect"),Yt=Me(()=>r(d)==="6-6-6"?r($):r(j)),Pn=Me(()=>r(d)==="6-6-6"?r(S):r(X)),Ln=Me(()=>(r(Ne),M(()=>r(Ne).data?.color))),Un=Me(()=>(r(Ne),M(()=>r(Ne).data?.backgroundStyle))),_n=Me(()=>(r(Ne),M(()=>r(Ne).data?.textColor)));Rt(Qe,{get shape(){return r(ct)},get width(){return r(Yt)},get height(){return r(Pn)},get label(){return r(Ne),M(()=>r(Ne).label)},get data(){return r(Ne),M(()=>r(Ne).data)},get color(){return r(Ln)},get backgroundStyle(){return r(Un)},get textColor(){return r(_n)},$$events:{click:()=>Ce(r(Ne)),secondaryaction:Fn=>te(Fn)}})}ee(()=>vn(tt,`${r(Ne),M(()=>r(Ne).cssTransform)??""}; position: absolute;`)),T(Ye,tt)}),ee(Ye=>xe=Xe(ne,1,"grid-container-unified svelte-1eijoyu",null,xe,Ye),[()=>({hex:r(d)==="6-6-6"})]),T(I,ne)};H(yt,I=>{r(k)?I(an):I(Re,!1)})}var He=h(ot,2),lt=f(He);{let I=Me(()=>r($)/2-fe/2);Rt(lt,{shape:"hex",side:"right",get width(){return r(I)},get height(){return r(S)},$$events:{click:Pe}})}var Ke=h(lt,2);{let I=Me(()=>r($)/2-fe/2);Rt(Ke,{shape:"hex",side:"right",get width(){return r(I)},get height(){return r(S)},$$events:{click:()=>P()("betrugerCap")},children:(ne,xe)=>{Ss(ne)},$$slots:{default:!0}})}var je=h(Ke,2);{let I=Me(()=>r($)/2-fe/2);Rt(je,{shape:"hex",side:"right",get width(){return r(I)},get height(){return r(S)},$$events:{click:N}})}var Ft=h(je,2);{let I=Me(()=>r($)/2-fe/2),ne=Me(()=>(c(),M(()=>Ge(c().time))));Rt(Ft,{shape:"hex",side:"right",get width(){return r(I)},get height(){return r(S)},get label(){return r(ne)},$$events:{click:me}})}var It=h(He,2);{var Jt=I=>{var ne=Fl();let xe;var Ue=f(ne);let Te;var jt=f(Ue);{let Ye=Me(()=>r(g)/4*3);Zo(jt,{onClose:()=>Je.deactivate(),get minButtonSize(){return r(Ye)}})}ee((Ye,Ne)=>{xe=Xe(ne,1,"pinpad-overlay svelte-1eijoyu",null,xe,Ye),Te=Xe(Ue,1,"pinpad-container svelte-1eijoyu",null,Te,Ne)},[()=>({numeric:l().layout==="numeric",alpha:l().layout==="alpha"}),()=>({numeric:l().layout==="numeric",alpha:l().layout==="alpha"})]),T(I,ne)};H(It,I=>{l(),M(()=>l().isActive)&&I(Jt)})}var Tt=h(It,2);ml(Tt,{get item(){return r(x)},get x(){return r(_)},get y(){return r(v)},get visible(){return r(A)},$$events:{close:ve,edit:qe,"advanced-edit":ht}});var At=h(Tt,2);Sl(At,{get visible(){return r(C)},get product(){return r(z)},$$events:{save:ft,close:()=>b(C,!1)}});var Kt=h(At,2);Tl(Kt,{get visible(){return r(D)},get category(){return r(K)},$$events:{save:_t,close:()=>b(D,!1)}}),tn(et,I=>b(re,I),()=>r(re)),T(e,et),mt(),i()}var ql=U('<input type="file" accept=".pdf,.jpg,.jpeg,.png" multiple style="display: none;" class="svelte-1wvon5f"/>'),Vl=U('<div class="importing-indicator svelte-1wvon5f"><div class="spinner svelte-1wvon5f"></div> <p class="svelte-1wvon5f">Importing menu...</p></div>'),Gl=U('<div class="loading-files svelte-1wvon5f"><div class="spinner svelte-1wvon5f"></div> <p class="svelte-1wvon5f">Loading available files...</p></div>'),zl=U('<div class="error-message svelte-1wvon5f"><p class="svelte-1wvon5f"> </p> <button class="retry-btn svelte-1wvon5f">Retry</button></div>'),Wl=U('<div class="upload-area svelte-1wvon5f"><div class="upload-prompt svelte-1wvon5f"><p class="svelte-1wvon5f">No files selected yet.</p> <button class="upload-btn svelte-1wvon5f"><svg class="upload-icon svelte-1wvon5f" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" class="svelte-1wvon5f"></path></svg> Choose Files</button> <p class="upload-hint svelte-1wvon5f">Select multiple PDF, JPG, or PNG files</p></div></div>'),Hl=U('<div class="no-files svelte-1wvon5f"><p class="svelte-1wvon5f">No menu files found in the menu_inputs directory.</p> <p class="svelte-1wvon5f">Please add PDF, JPG, or PNG files to the menu_inputs folder.</p></div>'),Jl=U('<span class="svelte-1wvon5f"> </span>'),Kl=U('<span class="svelte-1wvon5f"> </span>'),Yl=U('<button class="control-btn svelte-1wvon5f">Add More Files</button>'),Xl=U('<div class="size-warning svelte-1wvon5f"></div>'),Ql=U('<div><label class="file-checkbox svelte-1wvon5f"><input type="checkbox" class="svelte-1wvon5f"/> <div class="file-info svelte-1wvon5f"><div class="file-name svelte-1wvon5f"> </div> <div class="file-details svelte-1wvon5f"><span class="file-type svelte-1wvon5f"> </span> <span class="file-date svelte-1wvon5f"> </span></div> <!></div></label></div>'),Zl=U('<span class="upload-status uploaded svelte-1wvon5f">✓ Uploaded</span>'),ec=U('<span class="upload-status pending svelte-1wvon5f">Pending upload</span>'),tc=U('<div><label class="file-checkbox svelte-1wvon5f"><input type="checkbox" class="svelte-1wvon5f"/> <div class="file-info svelte-1wvon5f"><div class="file-name svelte-1wvon5f"> </div> <div class="file-details svelte-1wvon5f"><span class="file-type svelte-1wvon5f"> </span> <!></div></div></label> <button class="remove-btn svelte-1wvon5f" title="Remove file"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="svelte-1wvon5f"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" class="svelte-1wvon5f"></path></svg></button></div>'),nc=U('<div class="file-controls svelte-1wvon5f"><div class="selection-info svelte-1wvon5f"><!></div> <div class="control-buttons svelte-1wvon5f"><!> <button class="control-btn svelte-1wvon5f">Select All Valid</button> <button class="control-btn svelte-1wvon5f">Clear Selection</button></div></div> <div class="file-list svelte-1wvon5f"><!></div> <div class="import-controls svelte-1wvon5f"><button class="import-btn svelte-1wvon5f"> </button></div>',1),rc=U('<div class="file-selector svelte-1wvon5f"><!></div>'),sc=U('<div class="menu-importer svelte-1wvon5f"><h3 class="svelte-1wvon5f">Menu Import</h3> <p class="svelte-1wvon5f"><!></p> <p class="size-limit svelte-1wvon5f"></p> <!> <!></div>');function ac(e,t){pt(t,!1);const n=hn();let i=V(!1),s=V([]),a=V(new Set),o=V(!0),u=V(null),l=V([]);const c=50*1024*1024,g=typeof window<"u"&&window.electronAPI,p=!g;let w=V();zt(async()=>{g?await m():b(o,!1)});async function m(){if(g){b(o,!0),b(u,null);try{const $=await window.electronAPI.invoke("list-menu-files");$&&$.error?(b(u,$.error),b(s,[])):Array.isArray($)?b(s,$):(b(u,"Unexpected response format"),b(s,[]))}catch($){console.error("Error loading files:",$),b(u,$.message),b(s,[])}finally{b(o,!1)}}}async function y($){const S=$.target.files;if(!(!S||S.length===0)){for(const j of S){if(!["application/pdf","image/jpeg","image/png","image/jpg"].includes(j.type)){pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`File "${j.name}" has unsupported format. Please select PDF, JPG, or PNG files.`});continue}const J=c;if(j.size>J){const re=Math.round(J/1048576),se=Math.round(j.size/(1024*1024)*100)/100;pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`File "${j.name}" (${se}MB) exceeds maximum size of ${re}MB .`});continue}const Q={file:j,name:j.name,size:Math.round(j.size/(1024*1024)*100)/100,type:j.type.split("/")[1].toUpperCase(),selected:!0,uploaded:!1};b(l,[...r(l),Q])}r(w)&&Be(w,r(w).value="")}}function k(){r(w)&&r(w).click()}function O($){b(l,r(l).filter((S,j)=>j!==$))}function F($){if(g)r(a).has($.path)?r(a).delete($.path):r(a).add($.path),b(a,r(a));else{const S=r(l).findIndex(j=>j.name===$.name);S!==-1&&(Be(l,r(l)[S].selected=!r(l)[S].selected),b(l,r(l)))}}function q(){if(g){const $=r(s).filter(S=>S.sizeValid);b(a,new Set($.map(S=>S.path)))}else b(l,r(l).map($=>({...$,selected:!0})))}function d(){g?b(a,new Set):b(l,r(l).map($=>({...$,selected:!1})))}function A(){return g?r(a).size:r(l).filter($=>$.selected).length}async function x(){const $=A();if(!(r(i)||$===0))if(g){const S=Array.from(r(a));await C(S)}else{const S=r(l).filter(j=>j.selected);await z(S)}}function _($){return`${$.type} • ${$.size}MB`}function v($){return new Date($).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}async function C($){if(r(i))return;b(i,!0),n("close"),vt.set("agent");const S=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),j=Array.isArray($)?$.length:1,X=Array.isArray($)?$.map(J=>J.split("/").pop()).join(", "):$.split("/").pop();pe.addMessage({timestamp:S,type:"agent",message:`Starting menu import from ${j} file(s): ${X}

This process will:
1. Parse the menu(s) with AI
2. Clean existing data
3. Import new menu structure
4. Create optimized layouts

Please wait...`});try{const J=await window.electronAPI.invoke("start-menu-import",$);if(J&&!J.success&&J.message){pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Import failed: ${J.message}`}),b(i,!1);return}}catch(J){console.error("Error starting import:",J),pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Import failed: ${J.message}`}),b(i,!1)}}async function z($){if(r(i)||$.length===0)return;b(i,!0),n("close"),vt.set("agent");const S=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),j=$.map(X=>X.name).join(", ");pe.addMessage({timestamp:S,type:"agent",message:`Starting menu import from ${$.length} file(s): ${j}

This process will:
1. Upload files to server
2. Parse the menu(s) with AI
3. Clean existing data
4. Import new menu structure
5. Create optimized layouts

Please wait...`});try{const X=`${window.location.protocol}//${window.location.host}`;pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Uploading ${$.length} files...`});const J=new FormData;$.forEach((ie,le)=>{J.append("menuFiles",ie.file)});const Q=new XMLHttpRequest,se=await new Promise((ie,le)=>{Q.upload.addEventListener("progress",ae=>{if(ae.lengthComputable){const ye=Math.round(ae.loaded/ae.total*100);pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Uploading files: ${ye}%`})}}),Q.onload=function(){if(Q.status>=200&&Q.status<300)try{const ae=JSON.parse(Q.responseText);ie(ae)}catch{le(new Error("Invalid response format"))}else try{const ae=JSON.parse(Q.responseText);le(new Error(ae.message||`HTTP ${Q.status}`))}catch{le(new Error(`HTTP ${Q.status}: ${Q.statusText}`))}},Q.onerror=function(){le(new Error("Network error occurred"))},Q.open("POST",`${X}/api/menu/upload-and-import`),Q.send(J)});if(!se.success)throw new Error(se.message||"Upload failed");pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`All files uploaded successfully. Processing ${se.fileCount} files: ${se.filenames.join(", ")}`}),$.forEach(ie=>{ie.uploaded=!0}),pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`✅ Menu import completed successfully!

You can now navigate back to the selection area to see your new menu items.`}),W("INFO","Refreshing categories after successful menu import"),ce.send({command:"getCategories"})}catch(X){console.error("Error uploading and importing files:",X),pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Import failed: ${X.message}`})}finally{b(i,!1)}}typeof window<"u"&&window.electronAPI&&window.electronAPI.onImportProgress&&(window.electronAPI.onImportProgress($=>{const S=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});pe.addMessage({timestamp:S,type:"agent",message:$})}),window.electronAPI.onImportComplete(($,S)=>{const j=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});$&&(W("INFO","Refreshing categories after successful menu import"),ce.send({command:"getCategories"})),pe.addMessage({timestamp:j,type:"agent",message:$?`✅ Import completed successfully!

${S}

You can now navigate back to the selection area to see your new menu items.`:`❌ Import failed: ${S}`}),b(i,!1)})),xt();var D=sc(),K=h(f(D),2),L=f(K);{var E=$=>{var S=Pt("Select one or more menu files from the menu_inputs directory");T($,S)},G=$=>{var S=Pt("Upload and import menu files (PDF, JPG, PNG)");T($,S)};H(L,$=>{g?$(E):$(G,!1)})}var B=h(K,2);B.textContent="Max file size: 50MB";var P=h(B,2);{var fe=$=>{var S=ql();tn(S,j=>b(w,j),()=>r(w)),Y("change",S,y),T($,S)};H(P,$=>{p&&$(fe)})}var be=h(P,2);{var de=$=>{var S=Vl();T($,S)},oe=$=>{var S=Ve(),j=ke(S);{var X=Q=>{var re=Gl();T(Q,re)},J=Q=>{var re=Ve(),se=ke(re);{var ie=ae=>{var ye=zl(),ge=f(ye),Ce=f(ge),Ae=h(ge,2);ee(()=>Z(Ce,`Error loading files: ${r(u)??""}`)),Y("click",Ae,m),T(ae,ye)},le=ae=>{var ye=rc(),ge=f(ye);{var Ce=De=>{var Pe=Wl(),me=f(Pe),Se=h(f(me),2);Y("click",Se,k),T(De,Pe)},Ae=De=>{var Pe=Ve(),me=ke(Pe);{var Se=R=>{var N=Hl();T(R,N)},he=R=>{var N=nc(),te=ke(N),ve=f(te),qe=f(ve);{var ht=Re=>{var He=Jl(),lt=f(He);ee(()=>Z(lt,`${r(a).size??""} of ${r(s).length??""} files selected`)),T(Re,He)},ft=Re=>{var He=Kl(),lt=f(He);ee(Ke=>Z(lt,`${Ke??""} of ${r(l).length??""} files selected`),[()=>r(l).filter(Ke=>Ke.selected).length]),T(Re,He)};H(qe,Re=>{g?Re(ht):Re(ft,!1)})}var _t=h(ve,2),Ge=f(_t);{var at=Re=>{var He=Yl();Y("click",He,k),T(Re,He)};H(Ge,Re=>{p&&Re(at)})}var et=h(Ge,2),it=h(et,2),ze=h(te,2),Ie=f(ze);{var Le=Re=>{var He=Ve(),lt=ke(He);$t(lt,1,()=>r(s),Ke=>Ke.path,(Ke,je)=>{var Ft=Ql();let It;var Jt=f(Ft),Tt=f(Jt),At=h(Tt,2),Kt=f(At),I=f(Kt),ne=h(Kt,2),xe=f(ne),Ue=f(xe),Te=h(xe,2),jt=f(Te),Ye=h(ne,2);{var Ne=tt=>{var Qe=Xl();Qe.textContent="File too large (max 50MB)",T(tt,Qe)};H(Ye,tt=>{r(je).sizeValid||tt(Ne)})}ee((tt,Qe,ct,Yt)=>{It=Xe(Ft,1,"file-item svelte-1wvon5f",null,It,tt),Tt.disabled=!r(je).sizeValid,ms(Tt,Qe),Z(I,r(je).name),Z(Ue,ct),Z(jt,`Modified: ${Yt??""}`)},[()=>({invalid:!r(je).sizeValid,selected:r(a).has(r(je).path)}),()=>r(a).has(r(je).path),()=>_(r(je)),()=>v(r(je).lastModified)]),Y("change",Tt,()=>F(r(je))),T(Ke,Ft)}),T(Re,He)},We=Re=>{var He=Ve(),lt=ke(He);$t(lt,3,()=>r(l),Ke=>Ke.name,(Ke,je,Ft)=>{var It=tc();let Jt;var Tt=f(It),At=f(Tt),Kt=h(At,2),I=f(Kt),ne=f(I),xe=h(I,2),Ue=f(xe),Te=f(Ue),jt=h(Ue,2);{var Ye=Qe=>{var ct=Zl();T(Qe,ct)},Ne=Qe=>{var ct=ec();T(Qe,ct)};H(jt,Qe=>{r(je).uploaded?Qe(Ye):Qe(Ne,!1)})}var tt=h(Tt,2);ee(Qe=>{Jt=Xe(It,1,"file-item svelte-1wvon5f",null,Jt,Qe),ms(At,r(je).selected),Z(ne,r(je).name),Z(Te,`${r(je).type??""} • ${r(je).size??""}MB`)},[()=>({selected:r(je).selected,uploaded:r(je).uploaded})]),Y("change",At,()=>F(r(je))),Y("click",tt,()=>O(r(Ft))),T(Ke,It)}),T(Re,He)};H(Ie,Re=>{g?Re(Le):Re(We,!1)})}var ot=h(ze,2),yt=f(ot),an=f(yt);ee((Re,He,lt,Ke)=>{et.disabled=Re,it.disabled=He,yt.disabled=lt,Z(an,`Import Selected Files (${Ke??""})`)},[()=>g?r(s).every(Re=>!Re.sizeValid):r(l).length===0,()=>A()===0,()=>A()===0,A]),Y("click",et,q),Y("click",it,d),Y("click",yt,x),T(R,N)};H(me,R=>{g&&r(s).length===0?R(Se):R(he,!1)},!0)}T(De,Pe)};H(ge,De=>{p&&r(l).length===0?De(Ce):De(Ae,!1)})}T(ae,ye)};H(se,ae=>{g&&r(u)?ae(ie):ae(le,!1)},!0)}T(Q,re)};H(j,Q=>{g&&r(o)?Q(X):Q(J,!1)},!0)}T($,S)};H(be,$=>{r(i)?$(de):$(oe,!1)})}T(e,D),mt()}var ic=U('<button class="download-btn svelte-1dlpwa7">📥 Download Export</button> <button class="reset-btn svelte-1dlpwa7">🔄 New Export</button>',1),oc=U('<button class="cancel-btn svelte-1dlpwa7">❌ Cancel</button>'),lc=U('<button class="export-btn svelte-1dlpwa7" disabled><!></button> <!>',1),cc=U('<button class="export-btn svelte-1dlpwa7">🚀 Generate Export</button>'),uc=U('<div class="error-message svelte-1dlpwa7"> <button class="retry-btn svelte-1dlpwa7">Try Again</button></div>'),dc=U('<div class="job-info svelte-1dlpwa7"><small> </small></div>'),fc=U('<div class="dsfinvk-exporter svelte-1dlpwa7"><h3 class="svelte-1dlpwa7">DSFinV-K Export</h3> <div class="date-range-picker svelte-1dlpwa7"><div class="date-input svelte-1dlpwa7"><label for="dsfinvk-start" class="svelte-1dlpwa7">Start Date:</label> <input type="date" id="dsfinvk-start" class="svelte-1dlpwa7"/></div> <div class="date-input svelte-1dlpwa7"><label for="dsfinvk-end" class="svelte-1dlpwa7">End Date:</label> <input type="date" id="dsfinvk-end" class="svelte-1dlpwa7"/></div></div> <div class="export-actions svelte-1dlpwa7"><!></div> <!> <!></div>');function vc(e,t){pt(t,!1);let n=V(new Date().toISOString().split("T")[0]),i=V(new Date().toISOString().split("T")[0]),s=V(!1),a=V(null),o=V(null),u=V(null),l=null,c=V(null);const g=typeof window<"u"&&window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1";async function p(){b(s,!0),b(a,null),b(u,null),b(c,null),pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`🚀 Starting DSFinV-K export for period ${r(n)} to ${r(i)}...`,style:"info"});try{g?await m():await w()}catch(B){pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`❌ DSFinV-K export failed: ${B.message}`,style:"error"}),b(a,"failed"),b(c,B.message)}finally{g||b(s,!1)}}async function w(){try{const B=await fetch("/api/export/dsfinvk/start",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({startDate:r(n),endDate:r(i)})});if(B.ok&&B.headers.get("content-type")?.includes("application/zip")){const P=await B.blob(),fe=window.URL.createObjectURL(P),be=`dsfinvk-export-${r(n)}-to-${r(i)}.zip`,de=document.createElement("a");de.href=fe,de.download=be,document.body.appendChild(de),de.click(),document.body.removeChild(de),window.URL.revokeObjectURL(fe),pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`✅ DSFinV-K export complete! File downloaded as ${be}`,style:"success"}),b(a,"complete")}else{const P=await B.json();if(!P.success)throw new Error(P.error||"Export failed")}}catch{const P=await ce.send({command:"generateDsfinvkExport",payload:{startDate:r(n),endDate:r(i)}});if(P.status==="success"&&P.payload.success)pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`✅ DSFinV-K export complete! File available at: ${P.payload.path}`,style:"success"}),b(a,"complete");else throw new Error(P.payload?.message||P.error||"Unknown export error")}}async function m(){const P=await(await fetch("/api/export/dsfinvk/start",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({startDate:r(n),endDate:r(i)})})).json();if(!P.success)throw new Error(P.error||"Failed to start export job");b(o,P.jobId),b(a,P.status),pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`📊 Export job started (Job ID: ${r(o)}). Generating report...`,style:"info"}),y()}function y(){l&&clearInterval(l),l=setInterval(async()=>{try{const P=await(await fetch(`/api/export/dsfinvk/status/${r(o)}`,{credentials:"include"})).json();if(!P.success)throw new Error(P.error||"Failed to check job status");b(a,P.status.toLowerCase()),r(a)==="complete"?(clearInterval(l),l=null,b(u,P.downloadUrl),b(s,!1),pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"✅ DSFinV-K export complete! Ready for download.",style:"success"})):r(a)==="failed"?(clearInterval(l),l=null,b(s,!1),b(c,P.error||"Export job failed"),pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`❌ DSFinV-K export failed: ${r(c)}`,style:"error"})):r(a)==="processing"&&pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"⚙️ Export job is processing...",style:"info"})}catch(B){console.error("Error polling job status:",B),pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`⚠️ Error checking export status: ${B.message}`,style:"warning"})}},3e3)}function k(){r(u)&&(window.open(r(u),"_blank"),pe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"📥 Download initiated for DSFinV-K export.",style:"success"}))}function O(){l&&(clearInterval(l),l=null),b(s,!1),b(a,null),b(o,null),b(u,null),b(c,null)}fa(()=>{l&&clearInterval(l)}),xt();var F=fc(),q=h(f(F),2),d=f(q),A=h(f(d),2),x=h(d,2),_=h(f(x),2),v=h(q,2),C=f(v);{var z=B=>{var P=ic(),fe=ke(P),be=h(fe,2);Y("click",fe,k),Y("click",be,O),T(B,P)},D=B=>{var P=Ve(),fe=ke(P);{var be=oe=>{var $=lc(),S=ke($),j=f(S);{var X=se=>{var ie=Pt("⏳ Queued...");T(se,ie)},J=se=>{var ie=Ve(),le=ke(ie);{var ae=ge=>{var Ce=Pt("⚙️ Processing...");T(ge,Ce)},ye=ge=>{var Ce=Pt("🔄 Generating...");T(ge,Ce)};H(le,ge=>{r(a)==="processing"?ge(ae):ge(ye,!1)},!0)}T(se,ie)};H(j,se=>{r(a)==="pending"?se(X):se(J,!1)})}var Q=h(S,2);{var re=se=>{var ie=oc();Y("click",ie,O),T(se,ie)};H(Q,se=>{g&&se(re)})}T(oe,$)},de=oe=>{var $=cc();Y("click",$,p),T(oe,$)};H(fe,oe=>{r(s)||r(a)==="pending"||r(a)==="processing"?oe(be):oe(de,!1)},!0)}T(B,P)};H(C,B=>{r(a)==="complete"&&r(u)?B(z):B(D,!1)})}var K=h(v,2);{var L=B=>{var P=uc(),fe=f(P),be=h(fe);ee(()=>Z(fe,`❌ Export failed: ${r(c)??""} `)),Y("click",be,O),T(B,P)};H(K,B=>{r(a)==="failed"&&r(c)&&B(L)})}var E=h(K,2);{var G=B=>{var P=dc(),fe=f(P),be=f(fe);ee(()=>Z(be,`Job ID: ${r(o)??""}`)),T(B,P)};H(E,B=>{g&&r(o)&&B(G)})}ee(()=>{A.disabled=r(s),_.disabled=r(s)}),Bt(A,()=>r(n),B=>b(n,B)),Bt(_,()=>r(i),B=>b(i,B)),T(e,F),mt()}var pc=U('<div class="control-center-overlay svelte-mpduov"><div class="control-center-panel svelte-mpduov"><div class="panel-header svelte-mpduov"><h2 class="svelte-mpduov">Control Center</h2> <button class="close-btn svelte-mpduov">×</button></div> <div class="panel-content svelte-mpduov"><div class="section svelte-mpduov"><h3 class="svelte-mpduov">System Time</h3> <div class="time-display svelte-mpduov"> </div> <p class="time-description svelte-mpduov">Current system time. Time synchronization is managed automatically.</p></div> <div class="section svelte-mpduov"><h3 class="svelte-mpduov">Language & Region</h3> <div class="locale-settings svelte-mpduov"><label for="locale-select" class="locale-label svelte-mpduov">Display Locale:</label> <select id="locale-select" class="locale-select svelte-mpduov"><option class="svelte-mpduov">Deutsch (Deutschland)</option><option class="svelte-mpduov">English (United States)</option><option class="svelte-mpduov">English (United Kingdom)</option></select></div> <p class="locale-description svelte-mpduov">Changes how numbers, currencies, and dates are displayed in the interface.</p></div> <div class="section svelte-mpduov"><!></div> <div class="section svelte-mpduov"><!></div> <div class="section svelte-mpduov"><h3 class="svelte-mpduov">System Information</h3> <div class="system-info svelte-mpduov"><div class="info-item svelte-mpduov"><span class="label svelte-mpduov">Status:</span> <span class="value connected svelte-mpduov">Connected</span></div> <div class="info-item svelte-mpduov"><span class="label svelte-mpduov">Mode:</span> <span class="value svelte-mpduov">Development</span></div></div></div></div></div></div>');function mc(e,t){pt(t,!1);const[n,i]=Zn(),s=()=>rt(ts,"$controlCenterVisible",n),a=()=>rt(Rr,"$currentTime",n),o=()=>rt(An,"$localeStore",n);hn();function u(){Ho()}function l(k){return k.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})}function c(){u()}function g(k){const O=k.target.value;ao(O)}function p(k){k.key==="Escape"&&u()}xt();var w=Ve();Y("keydown",Hn,p);var m=ke(w);{var y=k=>{var O=pc(),F=f(O),q=f(F),d=h(f(q),2),A=h(q,2),x=f(A),_=h(f(x),2),v=f(_),C=h(x,2),z=h(f(C),2),D=h(f(z),2);ee(()=>{o(),Qs(()=>{})});var K=f(D);K.value=K.__value="de-DE";var L=h(K);L.value=L.__value="en-US";var E=h(L);E.value=E.__value="en-GB";var G=h(C,2),B=f(G);ac(B,{$$events:{close:c}});var P=h(G,2),fe=f(P);vc(fe,{}),ee(be=>Z(v,be),[()=>l(a())]),Y("click",d,u),la(D,o,be=>Pi(An,be)),Y("change",D,g),Y("click",O,Di(u)),T(k,O)};H(m,k=>{s()&&k(y)})}T(e,w),mt(),i()}var gc=U('<main class="pos-grid svelte-1ji6e50"><div class="grid-item-display svelte-1ji6e50"><!></div> <div class="grid-selection-area svelte-1ji6e50"><!></div></main> <!>',1);function hc(e,t){pt(t,!1);let n=V(),i=V(!1);zt(async()=>{await nn.checkSession();const m=ce.subscribe(y=>{y.lastMessage?.command==="sessionEstablished"&&(console.log("Demo mode: Received session established message"),nn.establishSession(y.lastMessage.payload))});return typeof window<"u"&&window.electronAPI&&window.electronAPI.onUiRefreshRequest&&window.electronAPI.onUiRefreshRequest(()=>{console.log("UI refresh requested - switching to selection view and refreshing data"),W("INFO","UI refresh requested after menu import"),vt.set("selection"),ce.send({command:"getCategories"}),setTimeout(()=>{window.location.reload()},1e3)}),()=>{m()}});function s(m){b(i,m.detail)}function a(){r(n)&&typeof r(n).getIsAtBottom=="function"&&(r(n).getIsAtBottom()&&typeof r(n).cycleViews=="function"?r(n).cycleViews():typeof r(n).scrollToBottom=="function"&&r(n).scrollToBottom())}xt();var o=gc(),u=ke(o),l=f(u),c=f(l);tn(zo(c,{$$events:{scrollstate:s},$$legacy:!0}),m=>b(n,m),()=>r(n));var g=h(l,2),p=f(g);Bl(p,{handleSmartAction:a,get isAtBottom(){return r(i)},get consoleViewComponent(){return r(n)}});var w=h(u,2);mc(w,{}),T(e,o),mt()}window.onerror=function(e,t,n,i,s){return W("ERROR","Unhandled Frontend Exception",{type:"window.onerror",message:e,source:t,lineno:n,colno:i,error:s?s.stack:"N/A"}),!0};window.addEventListener("unhandledrejection",e=>{W("ERROR","Unhandled Promise Rejection",{type:"unhandledrejection",reason:e.reason?e.reason.message||e.reason:"No reason provided",stack:e.reason?e.reason.stack:"N/A"})});bi(hc,{target:document.getElementById("app")});
