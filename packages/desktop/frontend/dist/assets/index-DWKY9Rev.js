(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const gs=!1;var Pn=Array.isArray,or=Array.prototype.indexOf,ka=Array.from,Wn=Object.defineProperty,Xt=Object.getOwnPropertyDescriptor,hs=Object.getOwnPropertyDescriptors,lr=Object.prototype,cr=Array.prototype,Ea=Object.getPrototypeOf,Ja=Object.isExtensible;const qt=()=>{};function ur(e){return e()}function Hn(e){for(var t=0;t<e.length;t++)e[t]()}function dr(){var e,t,n=new Promise((i,s)=>{e=i,t=s});return{promise:n,resolve:e,reject:t}}const _t=2,Ca=4,na=8,$n=16,Lt=32,an=64,_s=128,wt=256,Jn=512,Qe=1024,St=2048,Ut=4096,xt=8192,sn=16384,Ia=32768,Ma=65536,Ka=1<<17,fr=1<<18,Aa=1<<19,Na=1<<20,ya=1<<21,Ra=1<<22,Qt=1<<23,Dt=Symbol("$state"),vr=Symbol("legacy props"),Oa=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function pr(){throw new Error("https://svelte.dev/e/await_outside_boundary")}function aa(e){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function mr(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function gr(e){throw new Error("https://svelte.dev/e/effect_in_teardown")}function hr(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function _r(e){throw new Error("https://svelte.dev/e/effect_orphan")}function yr(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function br(e){throw new Error("https://svelte.dev/e/lifecycle_legacy_only")}function wr(e){throw new Error("https://svelte.dev/e/props_invalid_value")}function Sr(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function xr(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function Tr(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}const sa=1,ra=2,ys=4,kr=8,Er=16,Cr=2,Ir=4,Mr=8,Ar=1,Nr=2,Ye=Symbol(),Rr="http://www.w3.org/1999/xhtml";function Or(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}let Dr=!1;function bs(e){return e===this.v}function ws(e,t){return e!=e?t==t:e!==t||e!==null&&typeof e=="object"||typeof e=="function"}function Ss(e){return!ws(e,this.v)}let Sn=!1,Pr=!1;function $r(){Sn=!0}let Oe=null;function Kn(e){Oe=e}function ct(e,t=!1,n){Oe={p:Oe,c:null,e:null,s:e,x:null,l:Sn&&!t?{s:null,u:null,$:[]}:null}}function ut(e){var t=Oe,n=t.e;if(n!==null){t.e=null;for(var i of n)Ps(i)}return e!==void 0&&(t.x=e),Oe=t.p,e??{}}function xn(){return!Sn||Oe!==null&&Oe.l===null}const Lr=new WeakMap;function Ur(e){var t=be;if(t===null)return Se.f|=Qt,e;if((t.f&Ia)===0){if((t.f&_s)===0)throw!t.parent&&e instanceof Error&&xs(e),e;t.b.error(e)}else Da(e,t)}function Da(e,t){for(;t!==null;){if((t.f&_s)!==0)try{t.b.error(e);return}catch(n){e=n}t=t.parent}throw e instanceof Error&&xs(e),e}function xs(e){const t=Lr.get(e);t&&(Wn(e,"message",{value:t.message}),Wn(e,"stack",{value:t.stack}))}let Yn=[];function Fr(){var e=Yn;Yn=[],Hn(e)}function Pa(e){Yn.length===0&&queueMicrotask(Fr),Yn.push(e)}function Br(){for(var e=be.b;e!==null&&!e.has_pending_snippet();)e=e.parent;return e===null&&pr(),e}function $a(e){var t=_t|St,n=Se!==null&&(Se.f&_t)!==0?Se:null;return be===null||n!==null&&(n.f&wt)!==0?t|=wt:be.f|=Aa,{ctx:Oe,deps:null,effects:null,equals:bs,f:t,fn:e,reactions:null,rv:0,v:Ye,wv:0,parent:n??be,ac:null}}function jr(e,t){let n=be;n===null&&mr();var i=n.b,s=void 0,a=Nn(Ye),o=null,u=!Se;return ei(()=>{try{var l=e()}catch(m){l=Promise.reject(m)}var c=()=>l;s=o?.then(c,c)??Promise.resolve(l),o=s;var h=$e,p=i.pending;u&&(i.update_pending_count(1),p||h.increment());const w=(m,b=void 0)=>{o=null,p||h.activate(),b?b!==Oa&&(a.f|=Qt,yn(a,b)):((a.f&Qt)!==0&&(a.f^=Qt),yn(a,m)),u&&(i.update_pending_count(-1),p||h.decrement()),Es()};if(s.then(w,m=>w(null,m||"unknown")),h)return()=>{queueMicrotask(()=>h.neuter())}}),new Promise(l=>{function c(h){function p(){h===s?l(a):c(s)}h.then(p,p)}c(s)})}function gn(e){const t=$a(e);return t.equals=Ss,t}function Ts(e){var t=e.effects;if(t!==null){e.effects=null;for(var n=0;n<t.length;n+=1)$t(t[n])}}function qr(e){for(var t=e.parent;t!==null;){if((t.f&_t)===0)return t;t=t.parent}return null}function La(e){var t,n=be;zt(qr(e));try{Ts(e),t=Hs(e)}finally{zt(n)}return t}function ks(e){var t=La(e);if(e.equals(t)||(e.v=t,e.wv=zs()),!rn)if(hn!==null)hn.set(e,e.v);else{var n=(jt||(e.f&wt)!==0)&&e.deps!==null?Ut:Qe;ot(e,n)}}function Gr(e,t,n){const i=xn()?$a:gn;if(t.length===0){n(e.map(i));return}var s=$e,a=be,o=Vr(),u=Br();Promise.all(t.map(l=>jr(l))).then(l=>{s?.activate(),o();try{n([...e.map(i),...l])}catch(c){(a.f&sn)===0&&Da(c,a)}s?.deactivate(),Es()}).catch(l=>{u.error(l)})}function Vr(){var e=be,t=Se,n=Oe;return function(){zt(e),At(t),Kn(n)}}function Es(){zt(null),At(null),Kn(null)}const En=new Set;let $e=null,zn=null,hn=null,Ya=new Set,Xn=[];function Cs(){const e=Xn.shift();Xn.length>0&&queueMicrotask(Cs),e()}let An=[],Ua=null,ba=!1;class _n{current=new Map;#e=new Map;#n=new Set;#t=0;#s=null;#u=!1;#r=[];#o=[];#i=[];#a=[];#l=[];#d=[];#f=[];skipped_effects=new Set;process(t){An=[],zn=null;var n=null;if(En.size>1){n=new Map,hn=new Map;for(const[a,o]of this.current)n.set(a,{v:a.v,wv:a.wv}),a.v=o;for(const a of En)if(a!==this)for(const[o,u]of a.#e)n.has(o)||(n.set(o,{v:o.v,wv:o.wv}),o.v=u)}for(const a of t)this.#p(a);if(this.#r.length===0&&this.#t===0){this.#v();var i=this.#i,s=this.#a;this.#i=[],this.#a=[],this.#l=[],zn=$e,$e=null,Xa(i),Xa(s),$e===null?$e=this:En.delete(this),this.#s?.resolve()}else this.#c(this.#i),this.#c(this.#a),this.#c(this.#l);if(n){for(const[a,{v:o,wv:u}]of n)a.wv<=u&&(a.v=o);hn=null}for(const a of this.#r)pn(a);for(const a of this.#o)pn(a);this.#r=[],this.#o=[]}#p(t){t.f^=Qe;for(var n=t.first;n!==null;){var i=n.f,s=(i&(Lt|an))!==0,a=s&&(i&Qe)!==0,o=a||(i&xt)!==0||this.skipped_effects.has(n);if(!o&&n.fn!==null){if(s)n.f^=Qe;else if((i&Qe)===0)if((i&Ca)!==0)this.#a.push(n);else if((i&Ra)!==0){var u=n.b?.pending?this.#o:this.#r;u.push(n)}else Ln(n)&&((n.f&$n)!==0&&this.#l.push(n),pn(n));var l=n.first;if(l!==null){n=l;continue}}var c=n.parent;for(n=n.next;n===null&&c!==null;)n=c.next,c=c.parent}}#c(t){for(const n of t)((n.f&St)!==0?this.#d:this.#f).push(n),ot(n,Qe);t.length=0}capture(t,n){this.#e.has(t)||this.#e.set(t,n),this.current.set(t,t.v)}activate(){$e=this}deactivate(){$e=null,zn=null;for(const t of Ya)if(Ya.delete(t),t(),$e!==null)break}neuter(){this.#u=!0}flush(){An.length>0?zr():this.#v(),$e===this&&(this.#t===0&&En.delete(this),this.deactivate())}#v(){if(!this.#u)for(const t of this.#n)t();this.#n.clear()}increment(){this.#t+=1}decrement(){if(this.#t-=1,this.#t===0){for(const t of this.#d)ot(t,St),tn(t);for(const t of this.#f)ot(t,Ut),tn(t);this.#i=[],this.#a=[],this.flush()}else this.deactivate()}add_callback(t){this.#n.add(t)}settled(){return(this.#s??=dr()).promise}static ensure(){if($e===null){const t=$e=new _n;En.add($e),_n.enqueue(()=>{$e===t&&t.flush()})}return $e}static enqueue(t){Xn.length===0&&queueMicrotask(Cs),Xn.unshift(t)}}function zr(){var e=vn;ba=!0;try{var t=0;for(es(!0);An.length>0;){var n=_n.ensure();if(t++>1e3){var i,s;Wr()}n.process(An),Zt.clear()}}finally{ba=!1,es(e),Ua=null}}function Wr(){try{yr()}catch(e){Da(e,Ua)}}function Xa(e){var t=e.length;if(t!==0){for(var n=0;n<t;){var i=e[n++];if((i.f&(sn|xt))===0&&Ln(i)){var s=$e?$e.current.size:0;if(pn(i),i.deps===null&&i.first===null&&i.nodes_start===null&&(i.teardown===null&&i.ac===null?Bs(i):i.fn=null),$e!==null&&$e.current.size>s&&(i.f&Na)!==0)break}}for(;n<t;)tn(e[n++])}}function tn(e){for(var t=Ua=e;t.parent!==null;){t=t.parent;var n=t.f;if(ba&&t===be&&(n&$n)!==0)return;if((n&(an|Lt))!==0){if((n&Qe)===0)return;t.f^=Qe}}An.push(t)}const Zt=new Map;function Nn(e,t){var n={f:0,v:e,reactions:null,equals:bs,rv:0,wv:0};return n}function Bt(e,t){const n=Nn(e);return ai(n),n}function V(e,t=!1,n=!0){const i=Nn(e);return t||(i.equals=Ss),Sn&&n&&Oe!==null&&Oe.l!==null&&(Oe.l.s??=[]).push(i),i}function Fe(e,t){return y(e,M(()=>r(e))),t}function y(e,t,n=!1){Se!==null&&(!Ct||(Se.f&Ka)!==0)&&xn()&&(Se.f&(_t|$n|Ra|Ka))!==0&&!Pt?.includes(e)&&Tr();let i=n?fn(t):t;return yn(e,i)}function yn(e,t){if(!e.equals(t)){var n=e.v;rn?Zt.set(e,t):Zt.set(e,n),e.v=t;var i=_n.ensure();i.capture(e,n),(e.f&_t)!==0&&((e.f&St)!==0&&La(e),ot(e,(e.f&wt)===0?Qe:Ut)),e.wv=zs(),Is(e,St),xn()&&be!==null&&(be.f&Qe)!==0&&(be.f&(Lt|an))===0&&(bt===null?si([e]):bt.push(e))}return t}function pa(e){y(e,e.v+1)}function Is(e,t){var n=e.reactions;if(n!==null)for(var i=xn(),s=n.length,a=0;a<s;a++){var o=n[a],u=o.f;if(!(!i&&o===be)){var l=(u&St)===0;l&&ot(o,t),(u&_t)!==0?Is(o,Ut):l&&tn(o)}}}function fn(e){if(typeof e!="object"||e===null||Dt in e)return e;const t=Ea(e);if(t!==lr&&t!==cr)return e;var n=new Map,i=Pn(e),s=Bt(0),a=en,o=u=>{if(en===a)return u();var l=Se,c=en;At(null),ns(a);var h=u();return At(l),ns(c),h};return i&&n.set("length",Bt(e.length)),new Proxy(e,{defineProperty(u,l,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&Sr();var h=n.get(l);return h===void 0?h=o(()=>{var p=Bt(c.value);return n.set(l,p),p}):y(h,c.value,!0),!0},deleteProperty(u,l){var c=n.get(l);if(c===void 0){if(l in u){const h=o(()=>Bt(Ye));n.set(l,h),pa(s)}}else y(c,Ye),pa(s);return!0},get(u,l,c){if(l===Dt)return e;var h=n.get(l),p=l in u;if(h===void 0&&(!p||Xt(u,l)?.writable)&&(h=o(()=>{var m=fn(p?u[l]:Ye),b=Bt(m);return b}),n.set(l,h)),h!==void 0){var w=r(h);return w===Ye?void 0:w}return Reflect.get(u,l,c)},getOwnPropertyDescriptor(u,l){var c=Reflect.getOwnPropertyDescriptor(u,l);if(c&&"value"in c){var h=n.get(l);h&&(c.value=r(h))}else if(c===void 0){var p=n.get(l),w=p?.v;if(p!==void 0&&w!==Ye)return{enumerable:!0,configurable:!0,value:w,writable:!0}}return c},has(u,l){if(l===Dt)return!0;var c=n.get(l),h=c!==void 0&&c.v!==Ye||Reflect.has(u,l);if(c!==void 0||be!==null&&(!h||Xt(u,l)?.writable)){c===void 0&&(c=o(()=>{var w=h?fn(u[l]):Ye,m=Bt(w);return m}),n.set(l,c));var p=r(c);if(p===Ye)return!1}return h},set(u,l,c,h){var p=n.get(l),w=l in u;if(i&&l==="length")for(var m=c;m<p.v;m+=1){var b=n.get(m+"");b!==void 0?y(b,Ye):m in u&&(b=o(()=>Bt(Ye)),n.set(m+"",b))}if(p===void 0)(!w||Xt(u,l)?.writable)&&(p=o(()=>Bt(void 0)),y(p,fn(c)),n.set(l,p));else{w=p.v!==Ye;var T=o(()=>fn(c));y(p,T)}var N=Reflect.getOwnPropertyDescriptor(u,l);if(N?.set&&N.set.call(h,c),!w){if(i&&typeof l=="string"){var F=n.get("length"),q=Number(l);Number.isInteger(q)&&q>=F.v&&y(F,q+1)}pa(s)}return!0},ownKeys(u){r(s);var l=Reflect.ownKeys(u).filter(p=>{var w=n.get(p);return w===void 0||w.v!==Ye});for(var[c,h]of n)h.v!==Ye&&!(c in u)&&l.push(c);return l},setPrototypeOf(){xr()}})}function Qa(e){try{if(e!==null&&typeof e=="object"&&Dt in e)return e[Dt]}catch{}return e}function Hr(e,t){return Object.is(Qa(e),Qa(t))}var Rn,Ms,As,Ns;function Jr(){if(Rn===void 0){Rn=window,Ms=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype,n=Text.prototype;As=Xt(t,"firstChild").get,Ns=Xt(t,"nextSibling").get,Ja(e)&&(e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0),Ja(n)&&(n.__t=void 0)}}function Tn(e=""){return document.createTextNode(e)}function It(e){return As.call(e)}function ia(e){return Ns.call(e)}function f(e,t){return It(e)}function Ce(e,t){{var n=It(e);return n instanceof Comment&&n.data===""?ia(n):n}}function _(e,t=1,n=!1){let i=e;for(;t--;)i=ia(i);return i}function Kr(e){e.textContent=""}function Rs(){return!1}let Za=!1;function Yr(){Za||(Za=!0,document.addEventListener("reset",e=>{Promise.resolve().then(()=>{if(!e.defaultPrevented)for(const t of e.target.elements)t.__on_r?.()})},{capture:!0}))}function oa(e){var t=Se,n=be;At(null),zt(null);try{return e()}finally{At(t),zt(n)}}function Os(e,t,n,i=n){e.addEventListener(t,()=>oa(n));const s=e.__on_r;s?e.__on_r=()=>{s(),i(!0)}:e.__on_r=()=>i(!0),Yr()}function Ds(e){be===null&&Se===null&&_r(),Se!==null&&(Se.f&wt)!==0&&be===null&&hr(),rn&&gr()}function Xr(e,t){var n=t.last;n===null?t.last=t.first=e:(n.next=e,e.prev=n,t.last=e)}function Rt(e,t,n,i=!0){var s=be;s!==null&&(s.f&xt)!==0&&(e|=xt);var a={ctx:Oe,deps:null,nodes_start:null,nodes_end:null,f:e|St,first:null,fn:t,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{pn(a),a.f|=Ia}catch(l){throw $t(a),l}else t!==null&&tn(a);var o=n&&a.deps===null&&a.first===null&&a.nodes_start===null&&a.teardown===null&&(a.f&Aa)===0;if(!o&&i&&(s!==null&&Xr(a,s),Se!==null&&(Se.f&_t)!==0&&(e&an)===0)){var u=Se;(u.effects??=[]).push(a)}return a}function la(e){const t=Rt(na,null,!1);return ot(t,Qe),t.teardown=e,t}function wa(e){Ds();var t=be.f,n=!Se&&(t&Lt)!==0&&(t&Ia)===0;if(n){var i=Oe;(i.e??=[]).push(e)}else return Ps(e)}function Ps(e){return Rt(Ca|Na,e,!1)}function Qr(e){return Ds(),Rt(na|Na,e,!0)}function Zr(e){_n.ensure();const t=Rt(an,e,!0);return(n={})=>new Promise(i=>{n.outro?Ba(t,()=>{$t(t),i(void 0)}):($t(t),i(void 0))})}function Fa(e){return Rt(Ca,e,!1)}function Re(e,t){var n=Oe,i={effect:null,ran:!1,deps:e};n.l.$.push(i),i.effect=ca(()=>{e(),!i.ran&&(i.ran=!0,M(t))})}function Ht(){var e=Oe;ca(()=>{for(var t of e.l.$){t.deps();var n=t.effect;(n.f&Qe)!==0&&ot(n,Ut),Ln(n)&&pn(n),t.ran=!1}})}function ei(e){return Rt(Ra|Aa,e,!0)}function ca(e,t=0){return Rt(na|t,e,!0)}function ae(e,t=[],n=[]){Gr(t,n,i=>{Rt(na,()=>e(...i.map(r)),!0)})}function $s(e,t=0){var n=Rt($n|t,e,!0);return n}function On(e,t=!0){return Rt(Lt,e,!0,t)}function Ls(e){var t=e.teardown;if(t!==null){const n=rn,i=Se;ts(!0),At(null);try{t.call(null)}finally{ts(n),At(i)}}}function Us(e,t=!1){var n=e.first;for(e.first=e.last=null;n!==null;){const s=n.ac;s!==null&&oa(()=>{s.abort(Oa)});var i=n.next;(n.f&an)!==0?n.parent=null:$t(n,t),n=i}}function ti(e){for(var t=e.first;t!==null;){var n=t.next;(t.f&Lt)===0&&$t(t),t=n}}function $t(e,t=!0){var n=!1;(t||(e.f&fr)!==0)&&e.nodes_start!==null&&e.nodes_end!==null&&(Fs(e.nodes_start,e.nodes_end),n=!0),Us(e,t&&!n),Qn(e,0),ot(e,sn);var i=e.transitions;if(i!==null)for(const a of i)a.stop();Ls(e);var s=e.parent;s!==null&&s.first!==null&&Bs(e),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=e.ac=null}function Fs(e,t){for(;e!==null;){var n=e===t?null:ia(e);e.remove(),e=n}}function Bs(e){var t=e.parent,n=e.prev,i=e.next;n!==null&&(n.next=i),i!==null&&(i.prev=n),t!==null&&(t.first===e&&(t.first=i),t.last===e&&(t.last=n))}function Ba(e,t){var n=[];ja(e,n,!0),js(n,()=>{$t(e),t&&t()})}function js(e,t){var n=e.length;if(n>0){var i=()=>--n||t();for(var s of e)s.out(i)}else t()}function ja(e,t,n){if((e.f&xt)===0){if(e.f^=xt,e.transitions!==null)for(const o of e.transitions)(o.is_global||n)&&t.push(o);for(var i=e.first;i!==null;){var s=i.next,a=(i.f&Ma)!==0||(i.f&Lt)!==0;ja(i,t,a?n:!1),i=s}}}function qa(e){qs(e,!0)}function qs(e,t){if((e.f&xt)!==0){e.f^=xt,(e.f&Qe)===0&&(ot(e,St),tn(e));for(var n=e.first;n!==null;){var i=n.next,s=(n.f&Ma)!==0||(n.f&Lt)!==0;qs(n,s?t:!1),n=i}if(e.transitions!==null)for(const a of e.transitions)(a.is_global||t)&&a.in()}}let dn=null;function ni(e){var t=dn;try{if(dn=new Set,M(e),t!==null)for(var n of dn)t.add(n);return dn}finally{dn=t}}function Gs(e){for(var t of ni(e))yn(t,t.v)}let vn=!1;function es(e){vn=e}let rn=!1;function ts(e){rn=e}let Se=null,Ct=!1;function At(e){Se=e}let be=null;function zt(e){be=e}let Pt=null;function ai(e){Se!==null&&(Pt===null?Pt=[e]:Pt.push(e))}let it=null,gt=0,bt=null;function si(e){bt=e}let Vs=1,Dn=0,en=Dn;function ns(e){en=e}let jt=!1;function zs(){return++Vs}function Ln(e){var t=e.f;if((t&St)!==0)return!0;if((t&Ut)!==0){var n=e.deps,i=(t&wt)!==0;if(n!==null){var s,a,o=(t&Jn)!==0,u=i&&be!==null&&!jt,l=n.length;if((o||u)&&(be===null||(be.f&sn)===0)){var c=e,h=c.parent;for(s=0;s<l;s++)a=n[s],(o||!a?.reactions?.includes(c))&&(a.reactions??=[]).push(c);o&&(c.f^=Jn),u&&h!==null&&(h.f&wt)===0&&(c.f^=wt)}for(s=0;s<l;s++)if(a=n[s],Ln(a)&&ks(a),a.wv>e.wv)return!0}(!i||be!==null&&!jt)&&ot(e,Qe)}return!1}function Ws(e,t,n=!0){var i=e.reactions;if(i!==null&&!Pt?.includes(e))for(var s=0;s<i.length;s++){var a=i[s];(a.f&_t)!==0?Ws(a,t,!1):t===a&&(n?ot(a,St):(a.f&Qe)!==0&&ot(a,Ut),tn(a))}}function Hs(e){var t=it,n=gt,i=bt,s=Se,a=jt,o=Pt,u=Oe,l=Ct,c=en,h=e.f;it=null,gt=0,bt=null,jt=(h&wt)!==0&&(Ct||!vn||Se===null),Se=(h&(Lt|an))===0?e:null,Pt=null,Kn(e.ctx),Ct=!1,en=++Dn,e.ac!==null&&(oa(()=>{e.ac.abort(Oa)}),e.ac=null);try{e.f|=ya;var p=e.fn,w=p(),m=e.deps;if(it!==null){var b;if(Qn(e,gt),m!==null&&gt>0)for(m.length=gt+it.length,b=0;b<it.length;b++)m[gt+b]=it[b];else e.deps=m=it;if(!jt||(h&_t)!==0&&e.reactions!==null)for(b=gt;b<m.length;b++)(m[b].reactions??=[]).push(e)}else m!==null&&gt<m.length&&(Qn(e,gt),m.length=gt);if(xn()&&bt!==null&&!Ct&&m!==null&&(e.f&(_t|Ut|St))===0)for(b=0;b<bt.length;b++)Ws(bt[b],e);return s!==null&&s!==e&&(Dn++,bt!==null&&(i===null?i=bt:i.push(...bt))),(e.f&Qt)!==0&&(e.f^=Qt),w}catch(T){return Ur(T)}finally{e.f^=ya,it=t,gt=n,bt=i,Se=s,jt=a,Pt=o,Kn(u),Ct=l,en=c}}function ri(e,t){let n=t.reactions;if(n!==null){var i=or.call(n,e);if(i!==-1){var s=n.length-1;s===0?n=t.reactions=null:(n[i]=n[s],n.pop())}}n===null&&(t.f&_t)!==0&&(it===null||!it.includes(t))&&(ot(t,Ut),(t.f&(wt|Jn))===0&&(t.f^=Jn),Ts(t),Qn(t,0))}function Qn(e,t){var n=e.deps;if(n!==null)for(var i=t;i<n.length;i++)ri(e,n[i])}function pn(e){var t=e.f;if((t&sn)===0){ot(e,Qe);var n=be,i=vn;be=e,vn=!0;try{(t&$n)!==0?ti(e):Us(e),Ls(e);var s=Hs(e);e.teardown=typeof s=="function"?s:null,e.wv=Vs;var a;gs&&Pr&&(e.f&St)!==0&&e.deps}finally{vn=i,be=n}}}function r(e){var t=e.f,n=(t&_t)!==0;if(dn?.add(e),Se!==null&&!Ct){var i=be!==null&&(be.f&sn)!==0;if(!i&&!Pt?.includes(e)){var s=Se.deps;if((Se.f&ya)!==0)e.rv<Dn&&(e.rv=Dn,it===null&&s!==null&&s[gt]===e?gt++:it===null?it=[e]:(!jt||!it.includes(e))&&it.push(e));else{(Se.deps??=[]).push(e);var a=e.reactions;a===null?e.reactions=[Se]:a.includes(Se)||a.push(Se)}}}else if(n&&e.deps===null&&e.effects===null){var o=e,u=o.parent;u!==null&&(u.f&wt)===0&&(o.f^=wt)}if(rn){if(Zt.has(e))return Zt.get(e);if(n){o=e;var l=o.v;return((o.f&Qe)===0&&o.reactions!==null||Js(o))&&(l=La(o)),Zt.set(o,l),l}}else if(n){if(o=e,hn?.has(o))return hn.get(o);Ln(o)&&ks(o)}if((e.f&Qt)!==0)throw e.v;return e.v}function Js(e){if(e.v===Ye)return!0;if(e.deps===null)return!1;for(const t of e.deps)if(Zt.has(t)||(t.f&_t)!==0&&Js(t))return!0;return!1}function M(e){var t=Ct;try{return Ct=!0,e()}finally{Ct=t}}const ii=-7169;function ot(e,t){e.f=e.f&ii|t}function pe(e){if(!(typeof e!="object"||!e||e instanceof EventTarget)){if(Dt in e)Sa(e);else if(!Array.isArray(e))for(let t in e){const n=e[t];typeof n=="object"&&n&&Dt in n&&Sa(n)}}}function Sa(e,t=new Set){if(typeof e=="object"&&e!==null&&!(e instanceof EventTarget)&&!t.has(e)){t.add(e),e instanceof Date&&e.getTime();for(let i in e)try{Sa(e[i],t)}catch{}const n=Ea(e);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const i=hs(n);for(let s in i){const a=i[s].get;if(a)try{a.call(e)}catch{}}}}}const oi=["touchstart","touchmove"];function li(e){return oi.includes(e)}const ci=new Set,as=new Set;function ui(e,t,n,i={}){function s(a){if(i.capture||Cn.call(t,a),!a.cancelBubble)return oa(()=>n?.call(this,a))}return e.startsWith("pointer")||e.startsWith("touch")||e==="wheel"?Pa(()=>{t.addEventListener(e,s,i)}):t.addEventListener(e,s,i),s}function Y(e,t,n,i,s){var a={capture:i,passive:s},o=ui(e,t,n,a);(t===document.body||t===window||t===document||t instanceof HTMLMediaElement)&&la(()=>{t.removeEventListener(e,o,a)})}let ss=null;function Cn(e){var t=this,n=t.ownerDocument,i=e.type,s=e.composedPath?.()||[],a=s[0]||e.target;ss=e;var o=0,u=ss===e&&e.__root;if(u){var l=s.indexOf(u);if(l!==-1&&(t===document||t===window)){e.__root=t;return}var c=s.indexOf(t);if(c===-1)return;l<=c&&(o=l)}if(a=s[o]||e.target,a!==t){Wn(e,"currentTarget",{configurable:!0,get(){return a||n}});var h=Se,p=be;At(null),zt(null);try{for(var w,m=[];a!==null;){var b=a.assignedSlot||a.parentNode||a.host||null;try{var T=a["__"+i];if(T!=null&&(!a.disabled||e.target===a))if(Pn(T)){var[N,...F]=T;N.apply(a,[e,...F])}else T.call(a,e)}catch(q){w?m.push(q):w=q}if(e.cancelBubble||b===t||b===null)break;a=b}if(w){for(let q of m)queueMicrotask(()=>{throw q});throw w}}finally{e.__root=t,delete e.currentTarget,At(h),zt(p)}}}function Ga(e){var t=document.createElement("template");return t.innerHTML=e.replaceAll("<!>","<!---->"),t.content}function bn(e,t){var n=be;n.nodes_start===null&&(n.nodes_start=e,n.nodes_end=t)}function U(e,t){var n=(t&Ar)!==0,i=(t&Nr)!==0,s,a=!e.startsWith("<!>");return()=>{s===void 0&&(s=Ga(a?e:"<!>"+e),n||(s=It(s)));var o=i||Ms?document.importNode(s,!0):s.cloneNode(!0);if(n){var u=It(o),l=o.lastChild;bn(u,l)}else bn(o,o);return o}}function di(e,t,n="svg"){var i=!e.startsWith("<!>"),s=`<${n}>${i?e:"<!>"+e}</${n}>`,a;return()=>{if(!a){var o=Ga(s),u=It(o);a=It(u)}var l=a.cloneNode(!0);return bn(l,l),l}}function fi(e,t){return di(e,t,"svg")}function Mt(e=""){{var t=Tn(e+"");return bn(t,t),t}}function Ge(){var e=document.createDocumentFragment(),t=document.createComment(""),n=Tn();return e.append(t,n),bn(t,n),e}function E(e,t){e!==null&&e.before(t)}function ee(e,t){var n=t==null?"":typeof t=="object"?t+"":t;n!==(e.__t??=e.nodeValue)&&(e.__t=n,e.nodeValue=n+"")}function vi(e,t){return pi(e,t)}const ln=new Map;function pi(e,{target:t,anchor:n,props:i={},events:s,context:a,intro:o=!0}){Jr();var u=new Set,l=p=>{for(var w=0;w<p.length;w++){var m=p[w];if(!u.has(m)){u.add(m);var b=li(m);t.addEventListener(m,Cn,{passive:b});var T=ln.get(m);T===void 0?(document.addEventListener(m,Cn,{passive:b}),ln.set(m,1)):ln.set(m,T+1)}}};l(ka(ci)),as.add(l);var c=void 0,h=Zr(()=>{var p=n??t.appendChild(Tn());return On(()=>{if(a){ct({});var w=Oe;w.c=a}s&&(i.$$events=s),c=e(p,i)||{},a&&ut()}),()=>{for(var w of u){t.removeEventListener(w,Cn);var m=ln.get(w);--m===0?(document.removeEventListener(w,Cn),ln.delete(w)):ln.set(w,m)}as.delete(l),p!==n&&p.parentNode?.removeChild(p)}});return mi.set(c,h),c}let mi=new WeakMap;function J(e,t,n=!1){var i=e,s=null,a=null,o=Ye,u=n?Ma:0,l=!1;const c=(m,b=!0)=>{l=!0,w(b,m)};var h=null;function p(){h!==null&&(h.lastChild.remove(),i.before(h),h=null);var m=o?s:a,b=o?a:s;m&&qa(m),b&&Ba(b,()=>{o?a=null:s=null})}const w=(m,b)=>{if(o!==(o=m)){var T=Rs(),N=i;if(T&&(h=document.createDocumentFragment(),h.append(N=Tn())),o?s??=b&&On(()=>b(N)):a??=b&&On(()=>b(N)),T){var F=$e,q=o?s:a,v=o?a:s;q&&F.skipped_effects.delete(q),v&&F.skipped_effects.add(v),F.add_callback(p)}else p()}};$s(()=>{l=!1,t(c),l||w(null,null)},u)}function Zn(e,t){return t}function gi(e,t,n){for(var i=e.items,s=[],a=t.length,o=0;o<a;o++)ja(t[o].e,s,!0);var u=a>0&&s.length===0&&n!==null;if(u){var l=n.parentNode;Kr(l),l.append(n),i.clear(),kt(e,t[0].prev,t[a-1].next)}js(s,()=>{for(var c=0;c<a;c++){var h=t[c];u||(i.delete(h.k),kt(e,h.prev,h.next)),$t(h.e,!u)}})}function Tt(e,t,n,i,s,a=null){var o=e,u={flags:t,items:new Map,first:null},l=(t&ys)!==0;if(l){var c=e;o=c.appendChild(Tn())}var h=null,p=!1,w=new Map,m=gn(()=>{var F=n();return Pn(F)?F:F==null?[]:ka(F)}),b,T;function N(){hi(T,b,u,w,o,s,t,i,n),a!==null&&(b.length===0?h?qa(h):h=On(()=>a(o)):h!==null&&Ba(h,()=>{h=null}))}$s(()=>{T??=be,b=r(m);var F=b.length;if(!(p&&F===0)){p=F===0;var q,v,R,S;if(Rs()){var g=new Set,d=$e;for(v=0;v<F;v+=1){R=b[v],S=i(R,v);var C=u.items.get(S)??w.get(S);C?(t&(sa|ra))!==0&&Ks(C,R,v,t):(q=Ys(null,u,null,null,R,S,v,s,t,n,!0),w.set(S,q)),g.add(S)}for(const[z,P]of u.items)g.has(z)||d.skipped_effects.add(P.e);d.add_callback(N)}else N();r(m)}})}function hi(e,t,n,i,s,a,o,u,l){var c=(o&kr)!==0,h=(o&(sa|ra))!==0,p=t.length,w=n.items,m=n.first,b=m,T,N=null,F,q=[],v=[],R,S,g,d;if(c)for(d=0;d<p;d+=1)R=t[d],S=u(R,d),g=w.get(S),g!==void 0&&(g.a?.measure(),(F??=new Set).add(g));for(d=0;d<p;d+=1){if(R=t[d],S=u(R,d),g=w.get(S),g===void 0){var C=i.get(S);if(C!==void 0){i.delete(S),w.set(S,C);var z=N?N.next:b;kt(n,N,C),kt(n,C,z),ma(C,z,s),N=C}else{var P=b?b.e.nodes_start:s;N=Ys(P,n,N,N===null?n.first:N.next,R,S,d,a,o,l)}w.set(S,N),q=[],v=[],b=N.next;continue}if(h&&Ks(g,R,d,o),(g.e.f&xt)!==0&&(qa(g.e),c&&(g.a?.unfix(),(F??=new Set).delete(g))),g!==b){if(T!==void 0&&T.has(g)){if(q.length<v.length){var K=v[0],L;N=K.prev;var k=q[0],H=q[q.length-1];for(L=0;L<q.length;L+=1)ma(q[L],K,s);for(L=0;L<v.length;L+=1)T.delete(v[L]);kt(n,k.prev,H.next),kt(n,N,k),kt(n,H,K),b=K,N=H,d-=1,q=[],v=[]}else T.delete(g),ma(g,b,s),kt(n,g.prev,g.next),kt(n,g,N===null?n.first:N.next),kt(n,N,g),N=g;continue}for(q=[],v=[];b!==null&&b.k!==S;)(b.e.f&xt)===0&&(T??=new Set).add(b),v.push(b),b=b.next;if(b===null)continue;g=b}q.push(g),N=g,b=g.next}if(b!==null||T!==void 0){for(var j=T===void 0?[]:ka(T);b!==null;)(b.e.f&xt)===0&&j.push(b),b=b.next;var $=j.length;if($>0){var he=(o&ys)!==0&&p===0?s:null;if(c){for(d=0;d<$;d+=1)j[d].a?.measure();for(d=0;d<$;d+=1)j[d].a?.fix()}gi(n,j,he)}}c&&Pa(()=>{if(F!==void 0)for(g of F)g.a?.apply()}),e.first=n.first&&n.first.e,e.last=N&&N.e;for(var we of i.values())$t(we.e);i.clear()}function Ks(e,t,n,i){(i&sa)!==0&&yn(e.v,t),(i&ra)!==0?yn(e.i,n):e.i=n}function Ys(e,t,n,i,s,a,o,u,l,c,h){var p=(l&sa)!==0,w=(l&Er)===0,m=p?w?V(s,!1,!1):Nn(s):s,b=(l&ra)===0?o:Nn(o),T={i:b,v:m,k:a,a:null,e:null,prev:n,next:i};try{if(e===null){var N=document.createDocumentFragment();N.append(e=Tn())}return T.e=On(()=>u(e,m,b,c),Dr),T.e.prev=n&&n.e,T.e.next=i&&i.e,n===null?h||(t.first=T):(n.next=T,n.e.next=T.e),i!==null&&(i.prev=T,i.e.prev=T.e),T}finally{}}function ma(e,t,n){for(var i=e.next?e.next.e.nodes_start:n,s=t?t.e.nodes_start:n,a=e.e.nodes_start;a!==null&&a!==i;){var o=ia(a);s.before(a),a=o}}function kt(e,t,n){t===null?e.first=n:(t.next=n,t.e.next=n&&n.e),n!==null&&(n.prev=t,n.e.prev=t&&t.e)}function rs(e,t,n=!1,i=!1,s=!1){var a=e,o="";ae(()=>{var u=be;if(o!==(o=t()??"")&&(u.nodes_start!==null&&(Fs(u.nodes_start,u.nodes_end),u.nodes_start=u.nodes_end=null),o!=="")){var l=o+"";n?l=`<svg>${l}</svg>`:i&&(l=`<math>${l}</math>`);var c=Ga(l);if((n||i)&&(c=It(c)),bn(It(c),c.lastChild),n||i)for(;It(c);)a.before(It(c));else a.before(c)}})}function _i(e,t,n,i,s){var a=t.$$slots?.[n],o=!1;a===!0&&(a=t.children,o=!0),a===void 0||a(e,o?()=>i:i)}function yi(e){const t={};e.children&&(t.default=!0);for(const n in e.$$slots)t[n]=!0;return t}const is=[...` 	
\r\f \v\uFEFF`];function bi(e,t,n){var i=e==null?"":""+e;if(t&&(i=i?i+" "+t:t),n){for(var s in n)if(n[s])i=i?i+" "+s:s;else if(i.length)for(var a=s.length,o=0;(o=i.indexOf(s,o))>=0;){var u=o+a;(o===0||is.includes(i[o-1]))&&(u===i.length||is.includes(i[u]))?i=(o===0?"":i.substring(0,o))+i.substring(u+1):o=u}}return i===""?null:i}function wi(e,t){return e==null?null:String(e)}function Ke(e,t,n,i,s,a){var o=e.__className;if(o!==n||o===void 0){var u=bi(n,i,a);u==null?e.removeAttribute("class"):e.className=u,e.__className=n}else if(a&&s!==a)for(var l in a){var c=!!a[l];(s==null||c!==!!s[l])&&e.classList.toggle(l,c)}return a}function nn(e,t,n,i){var s=e.__style;if(s!==t){var a=wi(t);a==null?e.removeAttribute("style"):e.style.cssText=a,e.__style=t}return i}function Xs(e,t,n=!1){if(e.multiple){if(t==null)return;if(!Pn(t))return Or();for(var i of e.options)i.selected=t.includes(Mn(i));return}for(i of e.options){var s=Mn(i);if(Hr(s,t)){i.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Si(e){var t=new MutationObserver(()=>{Xs(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),la(()=>{t.disconnect()})}function Qs(e,t,n=t){var i=!0;Os(e,"change",s=>{var a=s?"[selected]":":checked",o;if(e.multiple)o=[].map.call(e.querySelectorAll(a),Mn);else{var u=e.querySelector(a)??e.querySelector("option:not([disabled])");o=u&&Mn(u)}n(o)}),Fa(()=>{var s=t();if(Xs(e,s,i),i&&s===void 0){var a=e.querySelector(":checked");a!==null&&(s=Mn(a),n(s))}e.__value=s,i=!1}),Si(e)}function Mn(e){return"__value"in e?e.__value:e.value}const xi=Symbol("is custom element"),Ti=Symbol("is html");function os(e,t){var n=Zs(e);n.checked!==(n.checked=t??void 0)&&(e.checked=t)}function ki(e,t,n,i){var s=Zs(e);s[t]!==(s[t]=n)&&(n==null?e.removeAttribute(t):typeof n!="string"&&Ei(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function Zs(e){return e.__attributes??={[xi]:e.nodeName.includes("-"),[Ti]:e.namespaceURI===Rr}}var ls=new Map;function Ei(e){var t=ls.get(e.nodeName);if(t)return t;ls.set(e.nodeName,t=[]);for(var n,i=e,s=Element.prototype;s!==i;){n=hs(i);for(var a in n)n[a].set&&t.push(a);i=Ea(i)}return t}function Ot(e,t,n=t){var i=xn(),s=new WeakSet;Os(e,"input",a=>{var o=a?e.defaultValue:e.value;if(o=ga(e)?ha(o):o,n(o),$e!==null&&s.add($e),i&&o!==(o=t())){var u=e.selectionStart,l=e.selectionEnd;e.value=o??"",l!==null&&(e.selectionStart=u,e.selectionEnd=Math.min(l,e.value.length))}}),M(t)==null&&e.value&&(n(ga(e)?ha(e.value):e.value),$e!==null&&s.add($e)),ca(()=>{var a=t();if(e===document.activeElement){var o=zn??$e;if(s.has(o))return}ga(e)&&a===ha(e.value)||e.type==="date"&&!a&&!e.value||a!==e.value&&(e.value=a??"")})}function ga(e){var t=e.type;return t==="number"||t==="range"}function ha(e){return e===""?null:+e}function qn(e,t,n){var i=Xt(e,t);i&&i.set&&(e[t]=n,la(()=>{e[t]=null}))}class Va{#e=new WeakMap;#n;#t;static entries=new WeakMap;constructor(t){this.#t=t}observe(t,n){var i=this.#e.get(t)||new Set;return i.add(n),this.#e.set(t,i),this.#s().observe(t,this.#t),()=>{var s=this.#e.get(t);s.delete(n),s.size===0&&(this.#e.delete(t),this.#n.unobserve(t))}}#s(){return this.#n??(this.#n=new ResizeObserver(t=>{for(var n of t){Va.entries.set(n.target,n);for(var i of this.#e.get(n.target)||[])i(n)}}))}}var Ci=new Va({box:"border-box"});function cs(e,t,n){var i=Ci.observe(e,()=>n(e[t]));Fa(()=>(M(()=>n(e[t])),i))}function us(e,t){return e===t||e?.[Dt]===t}function Gt(e={},t,n,i){return Fa(()=>{var s,a;return ca(()=>{s=a,a=[],M(()=>{e!==n(...a)&&(t(e,...a),s&&us(n(...s),e)&&t(null,...s))})}),()=>{Pa(()=>{a&&us(n(...a),e)&&t(null,...a)})}}),e}function Ii(e){return function(...t){var n=t[0];n.target===this&&e?.apply(this,t)}}function er(e){return function(...t){var n=t[0];return n.preventDefault(),e?.apply(this,t)}}function yt(e=!1){const t=Oe,n=t.l.u;if(!n)return;let i=()=>pe(t.s);if(e){let s=0,a={};const o=$a(()=>{let u=!1;const l=t.s;for(const c in l)l[c]!==a[c]&&(a[c]=l[c],u=!0);return u&&s++,s});i=()=>r(o)}n.b.length&&Qr(()=>{ds(t,i),Hn(n.b)}),wa(()=>{const s=M(()=>n.m.map(ur));return()=>{for(const a of s)typeof a=="function"&&a()}}),n.a.length&&wa(()=>{ds(t,i),Hn(n.a)})}function ds(e,t){if(e.l.s)for(const n of e.l.s)r(n);t()}function za(e,t,n){if(e==null)return t(void 0),n&&n(void 0),qt;const i=M(()=>e.subscribe(t,n));return i.unsubscribe?()=>i.unsubscribe():i}const cn=[];function tr(e,t){return{subscribe:dt(e,t).subscribe}}function dt(e,t=qt){let n=null;const i=new Set;function s(u){if(ws(e,u)&&(e=u,n)){const l=!cn.length;for(const c of i)c[1](),cn.push(c,e);if(l){for(let c=0;c<cn.length;c+=2)cn[c][0](cn[c+1]);cn.length=0}}}function a(u){s(u(e))}function o(u,l=qt){const c=[u,l];return i.add(c),i.size===1&&(n=t(s,a)||qt),u(e),()=>{i.delete(c),i.size===0&&n&&(n(),n=null)}}return{set:s,update:a,subscribe:o}}function Wa(e,t,n){const i=!Array.isArray(e),s=i?[e]:e;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=t.length<2;return tr(n,(o,u)=>{let l=!1;const c=[];let h=0,p=qt;const w=()=>{if(h)return;p();const b=t(i?c[0]:c,o,u);a?o(b):p=typeof b=="function"?b:qt},m=s.map((b,T)=>za(b,N=>{c[T]=N,h&=~(1<<T),l&&w()},()=>{h|=1<<T}));return l=!0,w(),function(){Hn(m),p(),l=!1}})}function Wt(e){let t;return za(e,n=>t=n)(),t}let Gn=!1,xa=Symbol();function Xe(e,t,n){const i=n[t]??={store:null,source:V(void 0),unsubscribe:qt};if(i.store!==e&&!(xa in n))if(i.unsubscribe(),i.store=e??null,e==null)i.source.v=void 0,i.unsubscribe=qt;else{var s=!0;i.unsubscribe=za(e,a=>{s?i.source.v=a:y(i.source,a)}),s=!1}return e&&xa in n?Wt(e):r(i.source)}function Mi(e,t){return e.set(t),t}function Un(){const e={};function t(){la(()=>{for(var n in e)e[n].unsubscribe();Wn(e,xa,{enumerable:!1,value:!0})})}return[e,t]}function Ai(e){var t=Gn;try{return Gn=!1,[e(),Gn]}finally{Gn=t}}function Ie(e,t,n,i){var s=!Sn||(n&Cr)!==0,a=(n&Mr)!==0,o=i,u=!0,l=()=>(u&&(u=!1,o=i),o),c;{var h=Dt in e||vr in e;c=Xt(e,t)?.set??(h&&t in e?q=>e[t]=q:void 0)}var p,w=!1;[p,w]=Ai(()=>e[t]),p===void 0&&i!==void 0&&(p=l(),c&&(s&&wr(),c(p)));var m;if(s?m=()=>{var q=e[t];return q===void 0?l():(u=!0,q)}:m=()=>{var q=e[t];return q!==void 0&&(o=void 0),q===void 0?o:q},s&&(n&Ir)===0)return m;if(c){var b=e.$$legacy;return(function(q,v){return arguments.length>0?((!s||!v||b||w)&&c(v?m():q),q):m()})}var T=!1,N=gn(()=>(T=!1,m()));r(N);var F=be;return(function(q,v){if(arguments.length>0){const R=v?r(N):s&&a?fn(q):q;return y(N,R),T=!0,o!==void 0&&(o=R),q}return rn&&T||(F.f&sn)!==0?N.v:r(N)})}function Nt(e){Oe===null&&aa(),Sn&&Oe.l!==null?nr(Oe).m.push(e):wa(()=>{const t=M(e);if(typeof t=="function")return t})}function Ha(e){Oe===null&&aa(),Nt(()=>()=>M(e))}function Ni(e,t,{bubbles:n=!1,cancelable:i=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:i})}function on(){const e=Oe;return e===null&&aa(),(t,n,i)=>{const s=e.s.$$events?.[t];if(s){const a=Pn(s)?s.slice():[s],o=Ni(t,n,i);for(const u of a)u.call(e.x,o);return!o.defaultPrevented}return!0}}function Ri(e){Oe===null&&aa(),Oe.l===null&&br(),nr(Oe).a.push(e)}function nr(e){var t=e.l;return t.u??={a:[],b:[],m:[]}}const Oi="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Oi);$r();const Di="modulepreload",Pi=function(e){return"/"+e},fs={},Et=function(t,n,i){let s=Promise.resolve();if(n&&n.length>0){let c=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(w=>({status:"fulfilled",value:w}),w=>({status:"rejected",reason:w}))))};var o=c;document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),l=u?.nonce||u?.getAttribute("nonce");s=c(n.map(h=>{if(h=Pi(h),h in fs)return;fs[h]=!0;const p=h.endsWith(".css"),w=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${w}`))return;const m=document.createElement("link");if(m.rel=p?"stylesheet":Di,p||(m.as="script"),m.crossOrigin="",m.href=h,l&&m.setAttribute("nonce",l),document.head.appendChild(m),p)return new Promise((b,T)=>{m.addEventListener("load",b),m.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${h}`)))})}))}function a(u){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=u,window.dispatchEvent(l),!l.defaultPrevented)throw u}return s.then(u=>{for(const l of u||[])l.status==="rejected"&&a(l.reason);return t().catch(a)})};class $i{constructor(){this.store=dt({serverTime:null,clientTime:null,timeOffset:0,lastSync:null}),this.subscribe=this.store.subscribe,this.update=this.store.update,this.set=this.store.set}updateServerTime(t){const n=new Date(t),i=new Date,s=n.getTime()-i.getTime();this.update(a=>({...a,serverTime:n,clientTime:i,timeOffset:s,lastSync:i}))}getServerTime(){let t;if(this.subscribe(i=>t=i)(),!t.lastSync)return new Date;const n=new Date;return new Date(n.getTime()+t.timeOffset)}formatTimeElapsed(t){const n=new Date,i=new Date(t),s=n.getTime()-i.getTime(),a=Math.floor(s/(1e3*60));return a>0?a:0}resetTimeOffset(){this.update(t=>({...t,timeOffset:0,lastSync:null}))}}const ea=new $i,Ta=Wa(ea,(e,t)=>{const n=()=>{const s=ea.getServerTime();t(s)};n();const i=setInterval(n,1e3);return()=>clearInterval(i)},new Date),Li=Wa(Ta,(e,t)=>{let n=null;return Ta.subscribe(i=>{const s=i.getMinutes();n!==s&&(n=s,t({time:i,minute:s}))})},{time:new Date,minute:new Date().getMinutes()});function Ui(){const{subscribe:e,set:t,update:n}=dt({connected:!1,isConnected:!1,lastMessage:null,error:null,sessionId:null,currentServer:null,serverIndex:0,connectionAttempts:0}),i=()=>{const g=window.location.hostname;return window.location.protocol==="https:"?[g]:[`${g}:3030`]};let s=null,a=null,o=0,u=0,l=null;const c=new Map,h=10,p=new Map;function w(){i().forEach(d=>{p.has(d)||p.set(d,{successfulConnections:0,failedConnections:0,averageResponseTime:0,lastConnectionTime:null,reliability:1})})}function m(g){const d=g.successfulConnections+g.failedConnections;if(d===0)return 1;const C=g.successfulConnections/d,z=g.averageResponseTime<1e3?.1:0;return Math.min(C+z,1)}function b(){const g=i();if(g.length===1)return 0;const d=g.map(P=>{const K=p.get(P);return K?K.reliability:1}),C=d.reduce((P,K)=>P+K,0);let z=Math.random()*C;for(let P=0;P<d.length;P++)if(z-=d[P],z<=0)return P;return Math.floor(Math.random()*g.length)}function T(){w(),o=b();const g=i();console.log(`Initialized with smart-selected server index: ${o} (${g[o]})`),console.log("Server reliability scores:",Array.from(p.entries()).map(([d,C])=>`${d}: ${(C.reliability*100).toFixed(1)}%`).join(", "))}function N(){const g=localStorage.getItem("ecKasse-session-id");g?a=g:(a=R(),localStorage.setItem("ecKasse-session-id",a)),n(d=>({...d,sessionId:a})),console.log("Session ID initialized:",a)}function F(){const g=i(),d=g[o];return o=(o+1)%g.length,d}function q(g=0){if(l&&(clearTimeout(l),l=null),g>=h){console.error("Max reconnection attempts reached. Stopping reconnection."),n(d=>({...d,connected:!1,isConnected:!1,error:"Failed to connect to any server after maximum attempts",connectionAttempts:g}));return}try{const d=F(),z=`${window.location.protocol==="https:"?"wss:":"ws:"}//${d}`;console.log(`Attempting WebSocket connection to ${z} (attempt ${g+1}/${h})`),n(L=>({...L,currentServer:d,serverIndex:o,connectionAttempts:g+1,error:null})),s=new WebSocket(z);const P=Date.now();s.onopen=()=>{const L=Date.now()-P;if(console.log(`WebSocket connected to ${d} (${L}ms)`),p.has(d)){const k=p.get(d);k.successfulConnections++,k.lastConnectionTime=L,k.averageResponseTime=k.averageResponseTime===0?L:(k.averageResponseTime+L)/2,k.reliability=m(k),p.set(d,k)}u=0,n(k=>({...k,connected:!0,isConnected:!0,error:null,connectionAttempts:0}))},s.onmessage=L=>{try{const k=JSON.parse(L.data);if(console.log("WebSocket message received:",k),k.serverTime&&ea.updateServerTime(k.serverTime),n(H=>({...H,lastMessage:k})),k.command==="ui-refresh-request"){console.log("UI refresh request received, reloading page..."),window.location.reload();return}if(k.command==="displayAgentMessage"){console.log("🌐 [WebSocket] Received displayAgentMessage:",{timestamp:k.payload?.timestamp,type:k.payload?.type,message:k.payload?.message?.substring(0,100)+(k.payload?.message?.length>100?"...":""),style:k.payload?.style,hasStyle:!!k.payload?.style,fullPayload:k.payload}),Et(async()=>{const{agentStore:H}=await Promise.resolve().then(()=>Yt);return{agentStore:H}},void 0).then(({agentStore:H})=>{console.log("🌐 [WebSocket] Calling agentStore.addMessage with payload"),H.addMessage(k.payload)});return}if(k.operationId&&c.has(k.operationId)){const H=c.get(k.operationId);c.delete(k.operationId),H(k)}}catch(k){console.error("Error parsing WebSocket message:",k)}},s.onclose=L=>{if(console.log(`WebSocket disconnected from ${d} (code: ${L.code}, reason: ${L.reason})`),L.code!==1e3&&p.has(d)){const H=p.get(d);H.failedConnections++,H.reliability=m(H),p.set(d,H),console.log(`Updated reliability for ${d}: ${(H.reliability*100).toFixed(1)}%`)}n(H=>({...H,connected:!1,isConnected:!1}));const k=Math.min(1e3*Math.pow(2,Math.floor(g/3)),3e4);console.log(`Reconnecting in ${k}ms to next server...`),l=setTimeout(()=>{q(g+1)},k)},s.onerror=L=>{if(console.error(`WebSocket error on ${d}:`,L),p.has(d)){const k=p.get(d);k.failedConnections++,k.reliability=m(k),p.set(d,k)}n(k=>({...k,error:`Connection error: ${d}`}))};const K=setTimeout(()=>{s&&s.readyState===WebSocket.CONNECTING&&(console.log(`Connection timeout for ${d}, trying next server...`),s.close())},1e4);s.onopen=(L=>function(...k){return clearTimeout(K),L.apply(this,k)})(s.onopen)}catch(d){console.error("Failed to create WebSocket connection:",d),n(C=>({...C,error:d.message})),l=setTimeout(()=>{q(g+1)},2e3)}}function v(g){if(console.log("[wsStore] send() called with:",g),console.log("[wsStore] WebSocket state:",{exists:!!s,readyState:s?s.readyState:"N/A",readyStateText:s?s.readyState===0?"CONNECTING":s.readyState===1?"OPEN":s.readyState===2?"CLOSING":"CLOSED":"N/A",sessionId:a}),s&&s.readyState===WebSocket.OPEN){const d={operationId:R(),...g,payload:{...g.payload,sessionId:a}};return g.command==="getCategories"&&(console.log("🔍 [wsStore] SENDING getCategories command:",d),console.log("🔍 [wsStore] WebSocket ready state confirmed OPEN for getCategories")),console.log("Sending WebSocket message:",d),s.send(JSON.stringify(d)),new Promise(C=>{c.set(d.operationId,C),setTimeout(()=>{c.has(d.operationId)&&(c.delete(d.operationId),g.command==="getCategories"&&console.error("❌ [wsStore] getCategories TIMEOUT after 10 seconds"),C({error:"Timeout waiting for response"}))},1e4),g.command==="getCategories"&&console.log("🔍 [wsStore] getCategories promise created, waiting for response...")})}else{const d="WebSocket not connected";return console.log(`❌ [wsStore] ${d}:`,{command:g.command,wsExists:!!s,readyState:s?s.readyState:"N/A"}),g.command==="getCategories"&&console.error("❌ [wsStore] getCategories FAILED - WebSocket not connected!"),Promise.resolve({error:d})}}function R(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(g){const d=Math.random()*16|0;return(g==="x"?d:d&3|8).toString(16)})}return T(),N(),q(),{subscribe:e,send:v,connect:q,getSessionId:()=>a,getCurrentServer:()=>S({subscribe:e}).currentServer,getConnectionStats:()=>{const g=S({subscribe:e});return{currentServer:g.currentServer,serverIndex:g.serverIndex,connectionAttempts:g.connectionAttempts,availableServers:i(),serverStats:Array.from(p.entries()).map(([d,C])=>({server:d,reliability:Math.round(C.reliability*100),successfulConnections:C.successfulConnections,failedConnections:C.failedConnections,averageResponseTime:Math.round(C.averageResponseTime),lastConnectionTime:C.lastConnectionTime}))}},forceReconnect:()=>{s&&s.close(),o=0,u=0,q()},switchToBestServer:()=>{s&&s.close(),o=b(),u=0,console.log("Switching to best performing server..."),q()},resetServerStats:()=>{p.clear(),w(),console.log("Server statistics reset")}};function S(g){let d;return g.subscribe(C=>d=C)(),d}}const de=Ui(),Fi=Object.freeze(Object.defineProperty({__proto__:null,wsStore:de},Symbol.toStringTag,{value:"Module"})),Bi=dt([]);function ji(e){if(!e||typeof e!="object")return{};const t={};for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const i=e[n];["string","number","boolean"].includes(typeof i)?t[n]=i:i instanceof Error?t[n]={message:i.message,stack:i.stack}:t[n]=JSON.stringify(i,null,2)}return t}function W(e,t,n={}){const i=new Date().toISOString().slice(0,19).replace("T"," ");Bi.update(a=>[...a.slice(-100),{timestamp:i,level:e,message:t,context:n}]);let s;de.subscribe(a=>s=a)(),de&&s&&s.connected&&de.send({command:"logClientEvent",payload:{level:e,message:t,context:ji(n)}})}const Vn={isAuthenticated:!1,currentUser:null,sessionId:null,users:[],selectedUser:null,loginState:"user_selection",error:null,isLoading:!1};function qi(){const{subscribe:e,set:t,update:n}=dt(Vn);return{subscribe:e,async fetchUsers(){try{n(s=>({...s,isLoading:!0,error:null}));const i=await de.send({command:"getLoginUsers",payload:{}});if(i.status==="success")n(s=>({...s,users:i.payload||[],isLoading:!1})),W("INFO",`Fetched ${i.payload?.length||0} users for login`);else throw new Error(i.payload?.error||"Failed to fetch users")}catch(i){W("ERROR",`Failed to fetch users: ${i.message}`),n(s=>({...s,error:i.message,isLoading:!1}))}},selectUser(i){n(s=>({...s,selectedUser:i,loginState:"pin_entry",error:null})),W("INFO",`Selected user: ${i.username}`)},backToUserSelection(){n(i=>({...i,selectedUser:null,loginState:"user_selection",error:null}))},async login(i,s){try{n(o=>({...o,isLoading:!0,loginState:"authenticating",error:null}));const a=await de.send({command:"login",payload:{username:i,password:s,ipAddress:"localhost",userAgent:navigator.userAgent}});if(a.status==="success"&&a.payload.success){const{user:o,session:u}=a.payload;try{await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:i,password:s})})}catch(c){W("WARN",`HTTP session establishment failed: ${c.message}`)}const l={...o,permissions:["all","order.change_price","order.reduce_quantity"]};return n(c=>({...c,isAuthenticated:!0,currentUser:l,sessionId:u.sessionId,loginState:"authenticated",isLoading:!1,error:null,selectedUser:null})),W("SUCCESS",`User ${i} authenticated successfully`),{success:!0}}else{const o=a.payload?.error||"Authentication failed";throw new Error(o)}}catch(a){return W("ERROR",`Authentication failed: ${a.message}`),n(o=>({...o,error:a.message,loginState:"pin_entry",isLoading:!1})),{success:!1,error:a.message}}},async logout(){try{const i={...Vn};let s=null;if(n(a=>(s=a.sessionId,i)),s)try{await de.send({command:"logout",payload:{sessionId:s}}),W("INFO","User logged out successfully")}catch(a){W("WARN",`Logout request failed: ${a.message}`)}try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(a){W("WARN",`HTTP logout failed: ${a.message}`)}return t(i),{success:!0}}catch(i){return W("ERROR",`Logout failed: ${i.message}`),t(Vn),{success:!1,error:i.message}}},async getCurrentUser(){try{let i=null;if(n(a=>(i=a.sessionId,a)),!i)throw new Error("No active session");const s=await de.send({command:"getCurrentUser",payload:{sessionId:i}});if(s.status==="success"&&s.payload.success)return n(a=>({...a,currentUser:s.payload.user})),{success:!0,user:s.payload.user};throw new Error(s.payload?.error||"Failed to get current user")}catch(i){return W("ERROR",`Failed to get current user: ${i.message}`),{success:!1,error:i.message}}},clearError(){n(i=>({...i,error:null}))},reset(){t(Vn)},async checkSession(){try{n(s=>({...s,isLoading:!0}));const i=await fetch("/api/session/status",{credentials:"include"});if(i.ok){const s=await i.json();if(s.authenticated&&s.user){const a={...s.user,permissions:["all","order.change_price","order.reduce_quantity"]};return n(o=>({...o,isAuthenticated:!0,currentUser:a,sessionId:null,loginState:"authenticated",isLoading:!1,error:null,selectedUser:null})),W("SUCCESS",`Session restored for user: ${s.user.username}`),{success:!0,user:s.user}}}return n(s=>({...s,isLoading:!1})),{success:!1,error:"No valid session"}}catch(i){return W("ERROR",`Failed to check session: ${i.message}`),n(s=>({...s,isLoading:!1,error:i.message})),{success:!1,error:i.message}}},establishSession(i){try{const{user:s,session:a}=i,o={...s,permissions:["all","order.change_price","order.reduce_quantity"]};return n(u=>({...u,isAuthenticated:!0,currentUser:o,sessionId:a.sessionId,loginState:"authenticated",isLoading:!1,error:null,selectedUser:null})),W("SUCCESS",`Demo mode: Auto-authenticated as ${s.username}`),{success:!0}}catch(s){return W("ERROR",`Failed to establish demo session: ${s.message}`),{success:!1,error:s.message}}}}}const Vt=qi(),vs=Object.freeze(Object.defineProperty({__proto__:null,authStore:Vt},Symbol.toStringTag,{value:"Module"})),nt=dt("agent");Wa(nt,e=>{const t=["order","receipts","agent"],n=t.indexOf(e);return[...t.slice(n),...t.slice(0,n)]});function Gi(){const{subscribe:e,set:t,update:n}=dt({transactionId:null,uuid:null,items:[],total:0,tax:0,status:"idle",paymentType:null,paymentAmount:null,metadata:{},activeTransactionItemId:null});let i=null,s=[];function a(){t({transactionId:null,uuid:null,items:[],total:0,tax:0,status:"idle",paymentType:null,paymentAmount:null,metadata:{},activeTransactionItemId:null}),i=null,s=[],W("INFO","Order reset and ready for new transaction.")}de.subscribe(v=>{let R;if(e(S=>R=S)(),v.lastMessage?.command==="orderUpdated"&&v.lastMessage.status==="success"&&v.lastMessage.payload){const S=v.lastMessage.payload,g=(S.items||[]).map(P=>{const K=R.items.find(L=>L.id===P.id);return{...P,isEdited:K?.isEdited||!1}}),d=P=>{const K=[];return P.created_at&&K.push(new Date(P.created_at)),P.updated_at&&K.push(new Date(P.updated_at)),K.length>0?Math.max(...K):0};let C=null;g.length>0&&(C=[...g].sort((K,L)=>{const k=d(K),H=d(L);return k!==H?H-k:L.id-K.id})[0].id);const z=[...g].sort((P,K)=>{const L=d(P),k=d(K);return L!==k?L-k:P.id-K.id});if(n(P=>({...P,transactionId:S.id,uuid:S.uuid,items:z,total:parseFloat(S.total_amount),tax:parseFloat(S.tax_amount),status:"active",metadata:S.metadata?typeof S.metadata=="string"?JSON.parse(S.metadata):S.metadata:{},activeTransactionItemId:C})),W("INFO",`Order ${S.id} updated.`),R.status==="initializing"&&s.length>0){const P=[...s];s=[],P.forEach(({itemId:K,quantity:L,userId:k})=>{W("INFO",`Adding queued item ${K} to transaction ${S.id}`),de.send({command:"addItemToTransaction",payload:{transactionId:S.id,itemId:K,quantity:L,userId:k}})})}}else if(v.lastMessage?.command==="transactionFinished"&&v.lastMessage.status==="success"){const S=v.lastMessage.payload;S.printStatus&&(S.printStatus.status==="failed"?W("ERROR",`Receipt print failed: ${S.printStatus.error}`):S.printStatus.status==="success"&&W("SUCCESS","Receipt printed successfully")),S.transaction?(n(g=>({...g,transactionId:S.transaction.id,uuid:S.transaction.uuid,items:S.transaction.items||[],total:parseFloat(S.transaction.total_amount),tax:parseFloat(S.transaction.tax_amount),status:"finished",paymentType:S.transaction.payment_type,paymentAmount:parseFloat(S.transaction.payment_amount),metadata:S.transaction.metadata?typeof S.transaction.metadata=="string"?JSON.parse(S.transaction.metadata):S.transaction.metadata:{},activeTransactionItemId:null})),W("SUCCESS",`Transaction ${S.transaction.id} finished successfully.`)):(W("SUCCESS",`Transaction ${R.transactionId} finished successfully.`),n(g=>({...g,status:"finished"}))),setTimeout(()=>{W("INFO","Auto-resetting order for next transaction."),a()},2e3)}});function o(){const v=Wt(Vt)?.currentUser;if(!v?.id)throw new Error("User must be authenticated to perform this action");return v.id}async function u(v={}){if(i)return i;const R=o();return n(S=>({...S,status:"initializing"})),W("INFO","Initializing new order..."),i=new Promise((S,g)=>{let d;d=de.subscribe(C=>{C.lastMessage?.command==="orderUpdated"&&C.lastMessage.status==="success"?(d&&d(),S(C.lastMessage.payload)):C.lastMessage?.command==="orderUpdated"&&C.lastMessage.status==="error"&&(d&&d(),n(z=>({...z,status:"error"})),g(new Error(C.lastMessage.payload?.message||"Failed to initialize order")))})}),de.send({command:"findOrCreateActiveTransaction",payload:{criteria:{metadata:v},userId:R}}),i}async function l(v,R=1){nt.set("order");const S=o();let g;if(e(d=>g=d)(),g.status==="idle"){W("INFO",`First item click detected. Initializing order and queuing item ${v}...`),s.push({itemId:v,quantity:R,userId:S});try{await u(S)}catch(d){W("ERROR",`Failed to initialize order: ${d.message}`),s=[];return}return}if(g.status==="initializing"){W("INFO",`Order initializing. Queuing item ${v}...`),s.push({itemId:v,quantity:R,userId:S});return}if(g.status==="active"&&g.transactionId){const d=g.items.find(C=>C.item_id===v&&!C.notes?.includes("Custom price:")&&!C.isEdited);if(d){const C=parseFloat(d.quantity)+R;W("INFO",`Item ${v} already exists and not edited, updating quantity to ${C}`),N(d.id,C,!1);return}W("INFO",`Adding new item ${v} to transaction ${g.transactionId}`),de.send({command:"addItemToTransaction",payload:{transactionId:g.transactionId,itemId:v,quantity:R,userId:S}});return}W("ERROR","Cannot add item: invalid order state.")}async function c(v){const R=o();let S;if(e(g=>S=g)(),!S.transactionId||S.status!=="active"){W("ERROR","No active order to finish.");return}W("INFO",`Finishing transaction ${S.transactionId}...`),de.send({command:"finishTransaction",payload:{transactionId:S.transactionId,paymentData:v,userId:R}})}async function h(v,R=!0){const S=o();let g;if(e(d=>g=d)(),!g.transactionId||g.status!=="active"){W("ERROR","No active order to park.");return}return W("INFO",`Parking transaction ${g.transactionId} to table ${v} (updateTime: ${R})...`),new Promise(async(d,C)=>{const z=de.subscribe(async P=>{P.lastMessage?.command==="parkTransactionResponse"&&P.lastMessage.status==="success"?(z(),a(),W("SUCCESS",`Order parked to table ${v}`),d(P.lastMessage.payload)):P.lastMessage?.command==="parkTransactionResponse"&&P.lastMessage.status==="error"&&(z(),W("ERROR",`Failed to park order: ${P.lastMessage.payload?.message||"Unknown error"}`),C(new Error(P.lastMessage.payload?.message||"Failed to park order")))});de.send({command:"parkTransaction",payload:{transactionId:g.transactionId,tableIdentifier:v,userId:S,updateTimestamp:R}})})}function p(v){nt.set("order"),W("INFO",`Loading order ${v.id}...`),n(R=>({...R,transactionId:v.id,uuid:v.uuid,items:v.items||[],total:parseFloat(v.total_amount),tax:parseFloat(v.tax_amount),status:"active",metadata:v.metadata?typeof v.metadata=="string"?JSON.parse(v.metadata):v.metadata:{},activeTransactionItemId:null})),W("SUCCESS",`Order ${v.id} loaded successfully`)}async function w(v){const R=o();let S;if(e(g=>S=g)(),!S.transactionId||S.status!=="active")throw W("ERROR","No active order to assign table number to."),new Error("No active order to assign table number to.");W("INFO",`Checking availability and assigning table ${v} to transaction ${S.transactionId}...`);try{const g=Math.random().toString(36).substring(2,15),d=await new Promise((z,P)=>{const K=setTimeout(()=>{L&&L(),P(new Error("Table availability check timeout"))},5e3);let L;L=de.subscribe(k=>{k.lastMessage?.command==="checkTableAvailabilityResponse"&&k.lastMessage?.operationId===g&&(clearTimeout(K),L&&L(),z(k.lastMessage))}),de.send({operationId:g,command:"checkTableAvailability",payload:{tableNumber:v,excludeTransactionId:S.transactionId}})});if(console.log("Table availability check result:",d),d.status==="success"&&d.payload.isInUse)return W("ERROR",`Table ${v} is already in use by another order`),{tableInUse:!0};n(z=>({...z,metadata:{...z.metadata,table:v}}));const C=Math.random().toString(36).substring(2,15);await new Promise((z,P)=>{const K=setTimeout(()=>{L&&L(),P(new Error("Metadata update timeout"))},5e3);let L;L=de.subscribe(k=>{k.lastMessage?.command==="updateTransactionMetadataResponse"&&k.lastMessage?.operationId===C&&(clearTimeout(K),L&&L(),k.lastMessage.status==="success"?z(k.lastMessage):P(new Error(k.lastMessage.payload?.message||"Failed to update metadata")))}),de.send({operationId:C,command:"updateTransactionMetadata",payload:{transactionId:S.transactionId,metadata:{...S.metadata,table:v},userId:R}})}),W("SUCCESS",`Table ${v} assigned to order`)}catch(g){throw W("ERROR",`Failed to assign table ${v}: ${g.message}`),g}}async function m(){W("INFO","Clearing active order view"),a()}function b(v,R){const S=o();let g;if(e(d=>g=d)(),g.status!=="active"||!g.transactionId){W("ERROR","Cannot update quantity: no active transaction");return}W("INFO",`Updating item quantity for item ${v} to ${R}`),de.send({command:"updateItemQuantity",payload:{transactionId:g.transactionId,transactionItemId:v,newQuantity:R,userId:S}})}function T(v,R,S=1){const g=o();let d;if(e(C=>d=C)(),d.status!=="active"||!d.transactionId){W("ERROR","Cannot add custom price item: no active transaction");return}W("INFO",`Adding custom price item ${v} with price ${R} and quantity ${S}`),de.send({command:"addCustomPriceItem",payload:{transactionId:d.transactionId,itemId:v,customPrice:R,quantity:S,userId:g}})}async function N(v,R,S=!0){const g=o();let d;if(e(C=>d=C)(),d.status!=="active"||!d.transactionId){W("ERROR","Cannot update quantity: no active transaction");return}S&&n(C=>({...C,items:C.items.map(z=>z.id===v?{...z,isEdited:!0}:z)})),W("INFO",`Updating item quantity for item ${v} to ${R}${S?" (marked as edited)":""}`),de.send({command:"updateItemQuantity",payload:{transactionId:d.transactionId,transactionItemId:v,newQuantity:R,userId:g}})}async function F(v,R,S=!1){const g=o();let d;if(e(C=>d=C)(),d.status!=="active"||!d.transactionId){W("ERROR","Cannot update price: no active transaction");return}n(C=>({...C,items:C.items.map(z=>z.id===v?{...z,isEdited:!0}:z)})),W("INFO",`Updating item price for item ${v} to ${R} (marked as edited)`),de.send({command:"updateItemPrice",payload:{transactionId:d.transactionId,transactionItemId:v,newPrice:R,isTotalPrice:S,userId:g}})}function q(){n(v=>({...v,activeTransactionItemId:null})),W("INFO","Item deselected from order view")}return{subscribe:e,set:t,update:n,initializeOrder:u,addItem:l,updateQuantity:b,updateItemQuantity:N,updateItemPrice:F,addWithCustomPrice:T,finishOrder:c,resetOrder:a,parkCurrentOrder:h,assignTableNumber:w,loadOrder:p,clearActiveOrderView:m,deselectItem:q}}const Je=Gi();function Vi(e){if(typeof e=="object"&&e!==null)return e;if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e}function zi(){const{subscribe:e,set:t,update:n}=dt({receipts:[],loading:!1,error:null,lastUpdated:null});de.subscribe(a=>{if(a.lastMessage?.command==="getRecentReceiptsResponse")if(a.lastMessage.status==="success"){const o=a.lastMessage.payload;if(o.success&&o.transactions){const u=o.transactions.map(l=>({...l,metadata:l.metadata?Vi(l.metadata):{}}));n(l=>({...l,receipts:u,loading:!1,error:null,lastUpdated:new Date})),W("INFO",`Loaded ${o.transactions.length} recent receipts.`)}else n(u=>({...u,loading:!1,error:o.message||"Failed to load receipts"})),W("ERROR",`Failed to load receipts: ${o.message||"Unknown error"}`)}else n(o=>({...o,loading:!1,error:a.lastMessage.payload?.message||"Failed to load receipts"})),W("ERROR",`Failed to load receipts: ${a.lastMessage.payload?.message||"Unknown error"}`)});function i(a=20){n(u=>({...u,loading:!0,error:null})),W("INFO",`Loading recent receipts (limit: ${a})...`);let o;de.subscribe(u=>o=u)(),o&&o.connected?de.send({command:"getRecentReceipts",payload:{limit:a}}):(W("WARNING","WebSocket not connected, skipping receipt load"),n(u=>({...u,loading:!1,error:"WebSocket connection not available"})))}function s(){W("INFO","Refreshing receipts..."),i()}return{subscribe:e,loadReceipts:i,refresh:s}}const ta=zi();class Wi{constructor(){this.store=dt([]),this.subscribe=this.store.subscribe,this.set=this.store.set,this.update=this.store.update}async refreshParkedOrders(){try{W("DEBUG","Requesting parked transactions...");const t=this.generateUUID();W("DEBUG",`Generated operationId: ${t}`);const n=await this.sendRequestWithFallback(t,"getParkedTransactions",{});W("DEBUG",`Parked transactions response: ${JSON.stringify(n)}`),n.status==="success"?(W("DEBUG",`Setting parked orders: ${JSON.stringify(n.payload)}`),this.set(n.payload||[])):(W("ERROR",`Failed to fetch parked orders: ${JSON.stringify(n)}`),this.set([]))}catch(t){W("ERROR",`Error fetching parked orders: ${t.message}`),this.set([])}}async sendRequestWithFallback(t,n,i){try{return await this.sendWebSocketRequest(t,n,i)}catch(s){W("WARNING",`WebSocket request failed, trying HTTP fallback: ${s.message}`);try{return await this.sendHttpRequest(t,n,i)}catch(a){throw W("ERROR",`Both WebSocket and HTTP requests failed: ${a.message}`),a}}}sendWebSocketRequest(t,n,i){return new Promise((s,a)=>{let o;if(de.subscribe(c=>o=c)(),!o||!o.connected){a(new Error("WebSocket is not connected"));return}const u=setTimeout(()=>{l(),a(new Error("WebSocket request timeout"))},3e3),l=de.subscribe(c=>{c.lastMessage&&c.lastMessage.operationId===t&&(clearTimeout(u),l(),s(c.lastMessage))});de.send({operationId:t,command:n,payload:i})})}async sendHttpRequest(t,n,i){const s=await fetch("/api/websocket-fallback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({operationId:t,command:n,payload:i})});if(!s.ok)throw new Error(`HTTP request failed: ${s.status}`);return await s.json()}refresh(){return this.refreshParkedOrders()}async activateOrder(t,n=!1){try{const i=this.generateUUID(),s=await this.sendRequestWithFallback(i,"activateTransaction",{transactionId:t,userId:1,updateTimestamp:n});if(s.status==="success")return n&&await this.refreshParkedOrders(),s.payload;throw new Error(s.payload?.message||"Failed to activate order")}catch(i){throw W("ERROR",`Error activating order: ${i.message}`),i}}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const n=Math.random()*16|0;return(t==="x"?n:n&3|8).toString(16)})}}const In=new Wi,un={DE:[["q","w","e","r","t","z","u","i","o","p","ü","ß"],["a","s","d","f","g","h","j","k","l","ö","ä"],["y","x","c","v","b","n","m"]],EN:[["q","w","e","r","t","y","u","i","o","p"],["a","s","d","f","g","h","j","k","l"],["z","x","c","v","b","n","m"]],RU:[["й","ц","у","к","е","н","г","ш","щ","з","х","ъ"],["ф","ы","в","а","п","р","о","л","д","ж","э"],["я","ч","с","м","и","т","ь","б","ю"]]};function Hi(){const{subscribe:e,set:t,update:n}=dt({isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:un});return{subscribe:e,activate(i,s,a,o="numeric"){t({isActive:!0,mode:i,layout:o,liveValue:o==="alpha"?{text:"",cursor:0}:"",confirmCallback:s,cancelCallback:a,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:un})},deactivate(){t({isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:un})},append(i,s=null){n(a=>{if(!a.isActive)return a;if(a.layout==="alpha"){const o=a.liveValue.text,u=a.liveValue.cursor,l=o.slice(0,u)+i+o.slice(u),c={text:l,cursor:u+1};return a.mode==="agent"&&s&&s.updateDraftMessage(l),{...a,liveValue:c,errorMessage:null}}else return{...a,liveValue:a.liveValue+i,errorMessage:null}})},backspace(i=null){n(s=>{if(!s.isActive)return s;if(s.layout==="alpha"){const a=s.liveValue.text,o=s.liveValue.cursor;if(o>0){const u=a.slice(0,o-1)+a.slice(o),l={text:u,cursor:o-1};return s.mode==="agent"&&i&&i.updateDraftMessage(u),{...s,liveValue:l,errorMessage:null}}return{...s,errorMessage:null}}else return{...s,liveValue:s.liveValue.slice(0,-1),errorMessage:null}})},clear(i=null){n(s=>s.isActive?(s.mode==="agent"&&i&&i.updateDraftMessage(""),{...s,liveValue:s.layout==="alpha"?{text:"",cursor:0}:"",errorMessage:null}):s)},async confirm(){let i,s;if(n(u=>(i=u,u)),!i.isActive)return;s=i.layout==="alpha"?i.liveValue.text:i.liveValue;let a;if(Je.subscribe(u=>a=u)(),a.activeTransactionItemId&&i.layout==="numeric"&&i.mode!=="agent"&&i.mode!=="table"){const u=s.trim();if(!u){this.deactivate();return}const l=a.items.find(c=>c.id===a.activeTransactionItemId);if(l){const{authStore:c}=await Et(async()=>{const{authStore:w}=await Promise.resolve().then(()=>vs);return{authStore:w}},void 0);let h;c.subscribe(w=>h=w)();const p=h.currentUser?.permissions||[];if(u.includes(".")||u.includes(",")){const w=parseFloat(u.replace(",","."));if(!isNaN(w)&&w>0){const m=parseFloat(l.unit_price);let b=null;if(w<m&&(b="order.change_price"),p.includes("all")||(b?p.includes(b):!0)){const F=parseFloat(l.quantity)>1;Je.updateItemPrice(l.id,w,F),Je.deselectItem()}else{n(N=>({...N,errorMessage:"Permission denied to change price."}));return}}}else{const w=parseInt(u);if(!isNaN(w)&&w>0){const m=parseFloat(l.quantity);let b=null;if(w<m&&(b="order.reduce_quantity"),p.includes("all")||(b?p.includes(b):!0))Je.updateItemQuantity(l.id,w),Je.deselectItem();else{n(N=>({...N,errorMessage:"Permission denied to reduce quantity."}));return}}}}n(c=>({...c,liveValue:c.layout==="alpha"?{text:"",cursor:0}:"",errorMessage:null})),this.deactivate();return}if(i.mode==="agent"){if(i.layout==="numeric"&&/^\d{4,6}$/.test(s)){const{authStore:l}=await Et(async()=>{const{authStore:c}=await Promise.resolve().then(()=>vs);return{authStore:c}},void 0);try{if((await l.login(null,s)).success){const{agentStore:h}=await Et(async()=>{const{agentStore:m}=await Promise.resolve().then(()=>Yt);return{agentStore:m}},void 0);let p;l.subscribe(m=>p=m)();const w=`✅ Erfolgreich angemeldet als ${p.currentUser.full_name}!

⏰ Überprüfe Systemzeit...
🔍 Prüfe ausstehende Transaktionen...

Bitte warten Sie einen Moment...`;h.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:w}),h.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`🤖 KI-Assistent bereit!

Verfügbare Tools:
• findProduct - Produkte suchen und finden
• createProduct - Neue Produkte erstellen
• updateProduct - Produktdaten aktualisieren
• getSalesReport - Verkaufsberichte abrufen
• generateDsfinvkExport - DSFinV-K konforme Datenexporte erstellen

Ich wähle automatisch das richtige Tool für Ihre Anfrage aus. Stellen Sie einfach Ihre Frage!`}),setTimeout(async()=>{await this.checkSystemStatus(p.currentUser,h)},1e3),n(m=>({...m,liveValue:m.layout==="alpha"?{text:"",cursor:0}:"",errorMessage:null})),this.deactivate();return}else{const{agentStore:h}=await Et(async()=>{const{agentStore:p}=await Promise.resolve().then(()=>Yt);return{agentStore:p}},void 0);h.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`❌ Ungültige PIN-Eingabe!

Bitte überprüfen Sie Ihre PIN und versuchen Sie es erneut. Sie können eine 4-6 stellige PIN über das Tastenfeld eingeben.`}),n(p=>({...p,liveValue:p.layout==="alpha"?{text:"",cursor:0}:"",errorMessage:null}));return}}catch{console.log("Direct login failed, falling back to agent message")}}const{agentStore:u}=await Et(async()=>{const{agentStore:l}=await Promise.resolve().then(()=>Yt);return{agentStore:l}},void 0);try{await u.sendMessage(s),n(l=>({...l,liveValue:l.layout==="alpha"?{text:"",cursor:0}:""}))}catch(l){console.error("Agent message send failed:",l),n(c=>({...c,liveValue:c.layout==="alpha"?{text:"",cursor:0}:""}))}return}if(!i.confirmCallback)return;const o=i.confirmCallback;try{await o(s),n(()=>({isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:un}))}catch(u){console.error("Pinpad confirm callback failed:",u),n(()=>({isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:un}))}},cancel(i=null){n(s=>{const a=Date.now();if(a-s.lastRedClickTime<300){const u=s.cancelCallback;s.mode==="agent"&&Et(async()=>{const{agentStore:c}=await Promise.resolve().then(()=>Yt);return{agentStore:c}},void 0).then(({agentStore:c})=>{c.cancelDraftMessage()});const l={isActive:!1,mode:null,layout:"numeric",liveValue:{text:"",cursor:0},confirmCallback:null,cancelCallback:null,lastRedClickTime:0,errorMessage:null,currentLanguage:"DE",layouts:un};return u&&setTimeout(()=>u(),0),l}else return s.mode==="agent"&&i&&i.updateDraftMessage(""),{...s,liveValue:s.layout==="alpha"?{text:"",cursor:0}:"",lastRedClickTime:a,errorMessage:null}})},activateTableEntry(){nt.set("order"),this.activate("table",async i=>{if(i&&i.trim())try{const s=await Je.assignTableNumber(i.trim());if(s&&s.tableInUse){n(a=>({...a,liveValue:a.layout==="alpha"?{text:"",cursor:0}:""}));return}return s}catch(s){throw s}},()=>{})},activateTableEntryWithAutoCollapse(){nt.set("order"),this.activate("table",async i=>{if(i&&i.trim())try{const s=await Je.assignTableNumber(i.trim());if(s&&s.tableInUse){n(l=>({...l,liveValue:l.layout==="alpha"?{text:"",cursor:0}:""}));return}let a;Je.subscribe(l=>a=l)();const o=a.items&&a.items.length>0,u=a.metadata&&a.metadata.table;return o&&u?(await Je.parkCurrentOrder(u,1,!1),await In.refresh(),Je.resetOrder(),window.dispatchEvent(new CustomEvent("autoCollapseComplete")),{autoCollapsed:!0}):s}catch(s){throw s}},()=>{})},activateAlphaInput(i,s,a=null){a&&a.startDraftMessage(),this.activate("agent",i,s,"alpha")},moveCursorLeft(){n(i=>{if(!i.isActive||i.layout!=="alpha")return i;const s=Math.max(0,i.liveValue.cursor-1);return{...i,liveValue:{...i.liveValue,cursor:s}}})},moveCursorRight(){n(i=>{if(!i.isActive||i.layout!=="alpha")return i;const s=Math.min(i.liveValue.text.length,i.liveValue.cursor+1);return{...i,liveValue:{...i.liveValue,cursor:s}}})},switchLanguage(i=null){n(s=>{const a=Object.keys(s.layouts);if(i&&a.includes(i))return{...s,currentLanguage:i};if(!s.isActive||s.layout!=="alpha"){const c=(a.indexOf(s.currentLanguage)+1)%a.length;return{...s,currentLanguage:a[c]}}const u=(a.indexOf(s.currentLanguage)+1)%a.length;return{...s,currentLanguage:a[u]}})},async checkSystemStatus(i,s){try{const{wsStore:a}=await Et(async()=>{const{wsStore:c}=await Promise.resolve().then(()=>Fi);return{wsStore:c}},void 0);let o=0,u=!0;try{const c=await a.send({command:"systemTimeCheck",payload:{clientTime:new Date().toISOString()}});c.status==="success"?(o=c.payload.timeDifferenceSeconds,u=Math.abs(o)<=30):u=!1}catch{u=!1}if(u){s.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`✅ Erfolgreich angemeldet als ${i.full_name}!`});return}let l=`🎉 Willkommen zurück, ${i.full_name}!

`;if(u||(o!==0?l+=`⚠️ Zeitabweichung erkannt: ${Math.abs(o)} Sekunden ${o>0?"voraus":"zurück"}
`:l+=`⚠️ Zeitprüfung fehlgeschlagen
`),i.permissions.includes("all")||i.permissions.includes("manage_transactions"))try{const c=await a.send({command:"getPendingTransactions",payload:{}});c.status==="success"&&c.payload.length>0?(l+=`
🔄 ${c.payload.length} ausstehende Transaktionen gefunden!

`,l+=`Als ${i.role} können Sie diese Transaktionen verwalten:
`,l+=`• Fiskalisieren (abschließen)
`,l+=`• Stornieren (rückgängig machen)
`,l+=`• Verschieben (später bearbeiten)

`,l+="Möchten Sie diese jetzt bearbeiten? Verwenden Sie die entsprechenden Schaltflächen oder fragen Sie mich nach Hilfe."):l+=`
✅ Keine ausstehenden Transaktionen
`}catch{l+=`
⚠️ Konnte ausstehende Transaktionen nicht überprüfen
`}else l+=`
📋 Ihre Rolle: ${i.role}
`,l+=`Sie haben Zugriff auf grundlegende Kassenfunktionen.
`;l+=`
🚀 System ist bereit! Sie können mit der Arbeit beginnen.`,s.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:l})}catch(a){s.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`❌ Systemprüfung fehlgeschlagen: ${a.message}

Sie können trotzdem mit der Arbeit beginnen, aber einige Funktionen sind möglicherweise eingeschränkt.`})}}}}const Be=Hi();function Ji(){const e=parseInt(void 0)||160;return tr({MIN_BUTTON_WIDTH:e})}const ar=Ji(),_a={hasNotification:!1,style:null};function Ki(){const{subscribe:e,set:t,update:n}=dt(_a);return{subscribe:e,setNotification:i=>{console.log("🟡 [NotificationStore] setNotification called with style:",i),n(s=>{console.log("🟡 [NotificationStore] Previous state:",s);const a={hasNotification:!0,style:i};return console.log("🟡 [NotificationStore] New state:",a),a})},clearNotification:()=>{console.log("🟠 [NotificationStore] clearNotification called"),console.log("🟠 [NotificationStore] Clearing notification, setting to initial state:",_a),t(_a)}}}const mn=Ki();function Yi(){const{subscribe:e,set:t,update:n}=dt({history:[],messages:[{timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Willkommen bei ecKasse!

Eine Kasse, die hilft – nicht kostet.

👥 Verfügbare Benutzer:
• Admin (Vollzugriff)
• Kassier (Kassenfunktionen)
• Aushilfe (Grundfunktionen)

⏰ Überprüfe Systemzeit und ausstehende Transaktionen...

💡 Geben Sie einfach Ihre 4-6 stellige PIN ein - das System erkennt Sie automatisch. Bei neuer oder Testkasse: Admin-PIN ist 1234`}],draftMessage:null,shouldActivatePinpad:!0});return de.subscribe(i=>{if(i.lastMessage&&i.lastMessage.command==="firstRunAdminCreated"){const s=i.lastMessage.payload;n(a=>({...a,messages:[{timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:s.message||`Willkommen! Admin-Benutzer '${s.username}' wurde erstellt mit PIN: ${s.password}`}]}))}if(i.lastMessage&&i.lastMessage.command==="getEntityJsonResponse"){const s=i.lastMessage.payload;if(s.success&&s.entity){const a=JSON.stringify(s.entity,null,2);n(o=>({...o,messages:[...o.messages,{timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"system",message:`JSON for viewing ${s.entityType} ID ${s.entityId}. For editing, use AI commands like 'update price to 29.99' or 'change name to Super Widget Pro':
\`\`\`json
${a}
\`\`\``}]}))}}}),{subscribe:e,addMessage:i=>{console.log("🔔 [AgentStore] addMessage called:",{timestamp:i.timestamp,type:i.type,message:i.message?.substring(0,100)+(i.message?.length>100?"...":""),style:i.style,hasStyle:!!i.style}),n(s=>({...s,messages:[...s.messages,i]})),i.style?(console.log("🟢 [AgentStore] Message has style, triggering notification:",i.style),mn.setNotification(i.style)):console.log("🔴 [AgentStore] Message has NO style, no notification triggered")},setHistory:i=>{n(s=>({...s,history:i}))},getHistory:()=>{let i;return e(s=>i=s.history)(),i},clearMessages:()=>{n(i=>({...i,messages:[]}))},startDraftMessage:()=>{n(i=>({...i,draftMessage:{id:"draft-"+Date.now(),timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"user",message:"",isDraft:!0}}))},updateDraftMessage:i=>{n(s=>({...s,draftMessage:s.draftMessage?{...s.draftMessage,message:i}:null}))},finalizeDraftMessage:()=>{n(i=>{if(!i.draftMessage)return i;const s={...i.draftMessage,isDraft:!1};return{...i,messages:[...i.messages,s],draftMessage:null}})},cancelDraftMessage:()=>{n(i=>({...i,draftMessage:null}))},sendMessage:async i=>{if(!(!i||!i.trim()))try{const a=Wt(Vt).sessionId,o={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"user",message:i};let u;e(p=>u=p)(),n(p=>({...p,messages:[...p.messages,o],draftMessage:null}));const l=await fetch("/api/llm/ping-gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:i,history:u.history,sessionId:a})});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const c=await l.json(),h={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:c.gemini_response_text};n(p=>({...p,messages:[...p.messages,h],history:c.history}))}catch(s){console.error("Failed to send message to AI:",s);const a={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"Sorry, I encountered an error. Please try again."};n(o=>({...o,messages:[...o.messages,a]}))}},shouldActivatePinpadOnLoad(){let i=!1;return n(s=>(i=s.shouldActivatePinpad,{...s,shouldActivatePinpad:!1})),i}}}const fe=Yi(),Yt=Object.freeze(Object.defineProperty({__proto__:null,agentStore:fe},Symbol.toStringTag,{value:"Module"})),Xi=()=>typeof localStorage<"u"&&localStorage.getItem("app-locale")||"de-DE",wn=dt(Xi());wn.subscribe(e=>{typeof localStorage<"u"&&localStorage.setItem("app-locale",e)});const Qi=e=>{wn.set(e)},ht=(e,t="EUR")=>{const n=Wt(wn);return e==null||isNaN(e)?new Intl.NumberFormat(n,{style:"currency",currency:t}).format(0):new Intl.NumberFormat(n,{style:"currency",currency:t}).format(e)},Zi=(e,t={})=>{const n=Wt(wn);if(!e)return"";const i=typeof e=="string"?new Date(e):e;if(isNaN(i.getTime()))return"";const s={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",...t};return new Intl.DateTimeFormat(n,s).format(i)};var eo=U('<div class="loading svelte-1dtcyze">Loading receipts...</div>'),to=U('<div class="error svelte-1dtcyze"> </div>'),no=U('<div class="empty svelte-1dtcyze">No receipts found.</div>'),ao=U('<span class="receipt-table-large svelte-1dtcyze"> </span>'),so=U('<div><span class="item-qty svelte-1dtcyze"> </span> <span> </span> <span> </span></div>'),ro=U('<div class="receipt-details svelte-1dtcyze"><div class="items-list svelte-1dtcyze"></div> <div class="receipt-totals svelte-1dtcyze"><div class="total-row svelte-1dtcyze"><span>Tax:</span> <span class="price svelte-1dtcyze"> </span></div> <div class="total-row total svelte-1dtcyze"><span>Total:</span> <span class="price svelte-1dtcyze"> </span></div></div> <div class="receipt-actions svelte-1dtcyze"><button class="action-button svelte-1dtcyze">🖨️ Reprint</button></div></div>'),io=U('<div><button class="receipt-summary svelte-1dtcyze"><div class="receipt-left svelte-1dtcyze"><div class="receipt-main-line svelte-1dtcyze"><span class="receipt-id-large svelte-1dtcyze"> </span> <!></div> <div class="receipt-date svelte-1dtcyze"> </div> <div class="receipt-payment svelte-1dtcyze"> </div></div> <div class="receipt-right svelte-1dtcyze"><div class="receipt-price svelte-1dtcyze"><span class="price svelte-1dtcyze"> </span></div> <div class="receipt-meta svelte-1dtcyze"><div class="receipt-items-count svelte-1dtcyze"> </div></div></div> <div class="expand-icon svelte-1dtcyze"> </div></button> <!></div>'),oo=U('<div class="receipt-list svelte-1dtcyze"></div>'),lo=U('<div class="receipt-feed svelte-1dtcyze"><!></div>');function co(e,t){ct(t,!1);const[n,i]=Un(),s=()=>Xe(ta,"$receiptsStore",n);let a=Ie(t,"autoExpandLatest",8,!1),o=V(null),u=V(!1),l=V();Nt(()=>{ta.loadReceipts()});function c(v){y(u,!0),y(o,r(o)===v?null:v)}function h(v){return Zi(v)}function p(v){return v.notes==="STORNO"&&v.display_names&&v.display_names.menu&&v.display_names.menu.de?`STORNO: ${v.display_names.menu.de}`:v.notes==="DISCOUNT"?"DISCOUNT":v.notes==="SURCHARGE"?"SURCHARGE":v.display_names&&v.display_names.menu&&v.display_names.menu.de?v.display_names.menu.de:"Unnamed Item"}function w(v){return v.notes==="STORNO"||v.notes==="DISCOUNT"||v.notes==="SURCHARGE"}function m(v){if(v.notes==="DISCOUNT"||v.notes==="SURCHARGE")return"";const R=parseFloat(v.quantity);return R===1?"":R+"x"}async function b(v){W("INFO",`Reprint requested for receipt №${v.id}`),fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Reprint initiated for receipt №${v.id}`,style:"info"}),de.send("reprintReceipt",{transactionId:v.id})}Re(()=>pe(a()),()=>{a()&&y(u,!1)}),Re(()=>(pe(a()),r(u),s(),r(o)),()=>{if(a()&&!r(u)&&s().receipts.length>0){const R=s().receipts.sort((S,g)=>new Date(g.fiscal_timestamp||g.updated_at)-new Date(S.fiscal_timestamp||S.updated_at))[0]?.id;R&&r(o)!==R&&y(o,R)}}),Ht(),yt();var T=lo(),N=f(T);{var F=v=>{var R=eo();E(v,R)},q=v=>{var R=Ge(),S=Ce(R);{var g=C=>{var z=to(),P=f(z);ae(()=>ee(P,`Error: ${s(),M(()=>s().error)??""}`)),E(C,z)},d=C=>{var z=Ge(),P=Ce(z);{var K=k=>{var H=no();E(k,H)},L=k=>{var H=oo();Tt(H,5,()=>(s(),M(()=>s().receipts.sort((j,$)=>new Date(j.fiscal_timestamp||j.updated_at)-new Date($.fiscal_timestamp||$.updated_at)))),j=>j.id,(j,$)=>{var he=io();let we;var ve=f(he),oe=f(ve),D=f(oe),x=f(D),B=f(x),Z=_(x,2);{var Q=O=>{var A=ao(),se=f(A);ae(()=>ee(se,`#${r($),M(()=>r($).metadata.table)??""}`)),E(O,A)};J(Z,O=>{r($),M(()=>r($).metadata?.table)&&O(Q)})}var ne=_(D,2),ie=f(ne),te=_(ne,2),le=f(te),ce=_(oe,2),ue=f(ce),xe=f(ue),ye=f(xe),Te=_(ue,2),Ee=f(Te),Me=f(Ee),De=_(ce,2),ge=f(De),ke=_(ve,2);{var _e=O=>{var A=ro(),se=f(A);Tt(se,5,()=>(r($),M(()=>r($).items)),ze=>ze.id,(ze,Ae)=>{var Le=so();let qe;var rt=f(Le),pt=f(rt),Jt=_(rt,2);let Pe;var He=f(Jt),I=_(Jt,2);let G;var X=f(I);ae((re,Ne,et,Ue,We,tt)=>{qe=Ke(Le,1,"item-row svelte-1dtcyze",null,qe,re),ee(pt,Ne),Pe=Ke(Jt,1,"item-name svelte-1dtcyze",null,Pe,et),ee(He,Ue),G=Ke(I,1,"item-price svelte-1dtcyze",null,G,We),ee(X,tt)},[()=>({"modification-item":w(r(Ae))}),()=>(r(Ae),M(()=>m(r(Ae)))),()=>({"modification-name":w(r(Ae))}),()=>(r(Ae),M(()=>p(r(Ae)))),()=>({"negative-price":parseFloat(r(Ae).total_price)<0}),()=>(pe(ht),r(Ae),M(()=>ht(r(Ae).total_price)))]),E(ze,Le)});var me=_(se,2),je=f(me),ft=_(f(je),2),lt=f(ft),vt=_(je,2),Ve=_(f(vt),2),at=f(Ve),st=_(me,2),Ze=f(st);ae((ze,Ae)=>{ee(lt,ze),ee(at,Ae)},[()=>(pe(ht),r($),M(()=>ht(r($).tax_amount))),()=>(pe(ht),r($),M(()=>ht(r($).total_amount)))]),Y("click",Ze,()=>b(r($))),E(O,A)};J(ke,O=>{r(o),r($),M(()=>r(o)===r($).id)&&O(_e)})}ae((O,A,se)=>{we=Ke(he,1,"receipt-item svelte-1dtcyze",null,we,O),ee(B,`№${r($),M(()=>r($).id)??""}`),ee(ie,A),ee(le,(r($),M(()=>r($).payment_type||"Unknown"))),ee(ye,se),ee(Me,`${r($),M(()=>r($).items?.length||0)??""} items`),ee(ge,(r(o),r($),M(()=>r(o)===r($).id?"▼":"▶")))},[()=>({expanded:r(o)===r($).id}),()=>(r($),M(()=>h(r($).fiscal_timestamp||r($).updated_at))),()=>(pe(ht),r($),M(()=>ht(r($).total_amount)))]),Y("click",ve,()=>c(r($).id)),E(j,he)}),Gt(H,j=>y(l,j),()=>r(l)),E(k,H)};J(P,k=>{s(),M(()=>s().receipts.length===0)?k(K):k(L,!1)},!0)}E(C,z)};J(S,C=>{s(),M(()=>s().error)?C(g):C(d,!1)},!0)}E(v,R)};J(N,v=>{s(),M(()=>s().loading)?v(F):v(q,!1)})}E(e,T),ut(),i()}var uo=U('<button class="order-item svelte-1gswy6n"><div class="table-number svelte-1gswy6n"> </div> <div class="order-stats svelte-1gswy6n"><div class="stat-price svelte-1gswy6n"> </div> <div class="stat-open svelte-1gswy6n"> </div> <div class="stat-activity svelte-1gswy6n"> </div></div></button>'),fo=U('<div class="parked-orders-container svelte-1gswy6n"><div class="orders-list svelte-1gswy6n"></div></div>');function vo(e,t){ct(t,!1);let n=V([]),i,s,a=!1;Nt(async()=>{i=In.subscribe(m=>{y(n,m)}),s=de.subscribe(async m=>{m.connected&&!a&&(a=!0,await In.refreshParkedOrders())})}),Ha(()=>{i&&i(),s&&s()});async function o(m){try{let b;if(Je.subscribe(N=>b=N)(),b.transactionId&&b.status==="active"){const N=b.items&&b.items.length>0,F=b.metadata&&b.metadata.table;if(N&&F)await Je.parkCurrentOrder(F,1,!1),await In.refreshParkedOrders();else if(N&&!F){nt.set("order"),Be.activateTableEntry();return}else Je.resetOrder()}const T=await In.activateOrder(m.id,!1);Je.loadOrder(T)}catch(b){console.error("Failed to switch to order:",b)}}function u(m){const T=(m.metadata||{}).table||m.id.toString();return T.length>3?`#${T.substring(0,3)}`:`#${T}`}function l(m){return ea.formatTimeElapsed(m)}function c(m){const b=l(m.created_at),T=l(m.updated_at);return{price:ht(m.total_amount),openMinutes:b,activityMinutes:T}}yt();var h=Ge(),p=Ce(h);{var w=m=>{var b=fo(),T=f(b);Tt(T,5,()=>r(n),N=>N.id,(N,F)=>{var q=uo(),v=f(q),R=f(v),S=_(v,2),g=f(S),d=f(g),C=_(g,2),z=f(C),P=_(C,2),K=f(P);ae((L,k,H,j)=>{ee(R,L),ee(d,k),ee(z,`${H??""}min`),ee(K,`${j??""}min`)},[()=>u(r(F)),()=>c(r(F)).price,()=>c(r(F)).openMinutes,()=>c(r(F)).activityMinutes]),Y("click",q,()=>o(r(F))),E(N,q)}),E(m,b)};J(p,m=>{r(n).length>0&&m(w)})}E(e,h),ut()}var po=fi(`<svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%;"><defs><filter height="150%" id="sh0" width="150%" x="-0.25" y="-0.25"><feConvolveMatrix id="3_|_y" in="SourceAlpha" result="19y" order="1,17" divisor="6632" bias="0" preserveAlpha="false" kernelMatrix=" 10 30 77 169 320 527 752 931 1000 931 752 527 320 169 77 30 10"></feConvolveMatrix><feConvolveMatrix id="3_|_x" result="19x" order="17,1" divisor="6632" bias="0" preserveAlpha="false" kernelMatrix=" 10 30 77 169 320 527 752 931 1000 931 752 527 320 169 77 30 10"></feConvolveMatrix><feConvolveMatrix id="9_|_y" in="SourceAlpha" result="49y" order="1,47" divisor="19856" bias="0" preserveAlpha="false" kernelMatrix=" 15 21 30 42 57 77 101 132 169 212 263 320 384 453 527 603 678 752 820 881 931 968 992 1000 992 968 931 881 820 752 678 603 527 453 384 320 263 212 169 132 101 77 57 42 30 21 15"></feConvolveMatrix><feConvolveMatrix id="9_|_x" result="49x" order="47,1" divisor="19856" bias="0" preserveAlpha="false" kernelMatrix=" 15 21 30 42 57 77 101 132 169 212 263 320 384 453 527 603 678 752 820 881 931 968 992 1000 992 968 931 881 820 752 678 603 527 453 384 320 263 212 169 132 101 77 57 42 30 21 15"></feConvolveMatrix><feTurbulence class="seed" result="noise" type="fractalNoise" stitchTiles="stitch" seed="43" baseFrequency="0.06 0.08 " numOctaves="3"></feTurbulence><feMorphology operator="erode" radius="1.2"></feMorphology><feComposite in="noise" operator="arithmetic" k1="0" k2="8" k3="0" k4="-3"></feComposite><feComposite in="49x" result="49noise" operator="arithmetic" k1="0" k2="2" k3="-0.2" k4="-1"></feComposite><feComposite in="49noise" in2="19x" operator="arithmetic" k1="0" k2="0.5" k3="1.5" k4="-1"></feComposite><feDiffuseLighting surfaceScale="2" lighting-color="#fff"><feDistantLight azimuth="240" elevation="20"></feDistantLight></feDiffuseLighting><feComposite in2="SourceGraphic" operator="arithmetic" k1="1" k2="0" k3="0" k4="0"></feComposite></filter><filter height="170%" id="sh2" width="170%" x="-0.2" y="-0.2"><feOffset dx="0" dy="0" in="SourceAlpha"></feOffset><feGaussianBlur stdDeviation="1.2"></feGaussianBlur><feColorMatrix result="out" type="matrix" values=" 
               0 0 0 0 0.4         
               0 0 0 0 0.4                    
               0 0 0 0 0.4                
               0 0 0 10 0 "></feColorMatrix><feMerge><feMergeNode in="out"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter><filter height="130%" id="sh1" width="130%" x="-0.2" y="-0.2"><feOffset dx="3" dy="4" in="SourceAlpha"></feOffset><feGaussianBlur stdDeviation="3"></feGaussianBlur><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.8 0"></feColorMatrix><feBlend in="SourceGraphic"></feBlend></filter><linearGradient id="svg_66" x1="0" x2="1" y1="0" y2="0"><stop offset="0" stop-color="hsl(40, 23%, 35%)"></stop><stop offset="0.4" stop-color="hsl(40, 23%, 60%)"></stop><stop offset="0.65" stop-color="hsl(40, 23%, 70%)"></stop><stop offset="0.75" stop-color="hsl(40, 23%, 60%)"></stop><stop offset="1" stop-color="hsl(40, 23%, 35%)"></stop></linearGradient><circle id="bell" fill="#070" stroke="#030" r="5.5" filter="url(#sh0)"></circle><g id="cap" filter="url(#sh2)"><path id="capPath" fill="#070" filter="url(#sh0)" stroke="#030" d="M72,89 C78.6,68 67.2,30.7 89,68 C86.9,37.6 66.91,32 62,61 C58,44.1 67.5,38.8 52,10 C53.6,47 46.91,36.2 45,61 C39.3,43.4 22,46.6 13,43 C32.9,55.8 35.7,66.62 32,89 C35,97.9 68.6,99 72,89 Z"></path><use id="bell1" x="13" y="43" href="#bell"></use><use id="bell2" x="52" y="10" href="#bell"></use><use id="bell3" x="89" y="68" href="#bell"></use><ellipse cx="52.19" cy="90.01" fill="url(#svg_66)" rx="14.76" ry="3.56"></ellipse><path d="M34,86.5C36,82,53.5,81,60,83C54,81,34,81.5,34,86.5Z" fill="none" stroke="hsl(40, 23%, 60%)"></path></g></defs><use href="#cap"></use></svg>`);function mo(e){var t=po();E(e,t)}var go=U('<div class="slot-container svelte-12whdgj"><!></div>'),ho=U('<div class="button-icon-wrapper svelte-12whdgj"><span class="button-icon svelte-12whdgj"><!></span></div>'),_o=U("<div></div>"),yo=U("<!> <!>",1),bo=U('<span class="button-text svelte-12whdgj"><!></span>'),wo=U('<button><div class="button-shape svelte-12whdgj"><!></div></button>');function sr(e,t){const n=yi(t);ct(t,!1);const i=V(),s=V(),a=V();let o=Ie(t,"label",8,""),u=Ie(t,"icon",8,""),l=Ie(t,"color",8,"#666666"),c=Ie(t,"textColor",8,""),h=Ie(t,"backgroundStyle",8,""),p=Ie(t,"customStyle",8,""),w=Ie(t,"disabled",8,!1),m=Ie(t,"data",8,null),b=Ie(t,"width",8,120),T=Ie(t,"height",8,80),N=Ie(t,"shape",8,"rect"),F=Ie(t,"side",8,""),q=Ie(t,"active",8,!1),v=Ie(t,"showShape",8,""),R=Ie(t,"notificationStyle",8,null);const S=on();let g,d=!1;function C(){!w()&&!d&&S("click",{data:m(),label:o()})}function z(ve){w()||(ve.preventDefault(),S("secondaryaction",{data:m(),label:o(),mouseX:ve.clientX,mouseY:ve.clientY,originalEvent:ve}))}function P(ve){!w()&&ve.button===0&&(d=!1,g=setTimeout(()=>{d=!0,S("secondaryaction",{data:m(),label:o(),mouseX:ve.clientX,mouseY:ve.clientY,originalEvent:ve})},500))}function K(){clearTimeout(g),setTimeout(()=>{d=!1},10)}function L(){clearTimeout(g),d=!1}Re(()=>pe(F()),()=>{y(i,F()==="left"||F()==="right")}),Re(()=>pe(o()),()=>{y(s,o())}),Re(()=>(pe(N()),r(i),pe(F())),()=>{y(a,N()==="hex"&&r(i)?F()==="left"?"polygon(0% 0%, 100% 25%, 100% 75%, 0% 100%)":"polygon(0% 25%, 100% 0%, 100% 100%, 0% 75%)":N()==="hex"?"polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%)":"none")}),Ht(),yt();var k=wo();let H;var j=f(k),$=f(j);{var he=ve=>{var oe=go(),D=f(oe);_i(D,t,"default",{}),E(ve,oe)},we=ve=>{var oe=Ge(),D=Ce(oe);{var x=Z=>{var Q=yo(),ne=Ce(Q);{var ie=ce=>{var ue=ho(),xe=f(ue),ye=f(xe);rs(ye,u),E(ce,ue)};J(ne,ce=>{u()&&ce(ie)})}var te=_(ne,2);{var le=ce=>{var ue=_o();ae(()=>Ke(ue,1,`shape-overlay ${v()??""}`,"svelte-12whdgj")),E(ce,ue)};J(te,ce=>{v()&&ce(le)})}E(Z,Q)},B=Z=>{var Q=Ge(),ne=Ce(Q);{var ie=te=>{var le=bo(),ce=f(le);rs(ce,()=>r(s)),ae(()=>nn(le,p())),E(te,le)};J(ne,te=>{o()&&te(ie)},!0)}E(Z,Q)};J(D,Z=>{u()||v()?Z(x):Z(B,!1)},!0)}E(ve,oe)};J($,ve=>{M(()=>n.default)?ve(he):ve(we,!1)})}ae(ve=>{H=Ke(k,1,`universal-button ${N()??""}`,"svelte-12whdgj",H,ve),nn(k,`
    --button-width: ${b()??""}px; 
    --button-height: ${T()??""}px; 
    --button-color: ${l()??""};
    ${c()?`--button-text-color: ${c()};`:""}
    ${h()?`--button-background-style: ${h()};`:""}
    --clip-path: ${r(a)??""};
  `)},[()=>({disabled:w(),half:r(i),left:F()==="left",right:F()==="right",active:q(),notification:!!R(),error:R()==="error",warning:R()==="warning",success:R()==="success",print:R()?.startsWith("print")})]),Y("click",k,C),Y("contextmenu",k,z),Y("mousedown",k,P),Y("mouseup",k,K),Y("mouseleave",k,L),E(e,k),ut()}var So=U('<span class="table-number svelte-x88uh0"> </span>'),xo=U('<div class="pinpad-error-message svelte-x88uh0"> </div>'),To=U('<span class="qty svelte-x88uh0"> </span>'),ko=U('<span class="input-overlay svelte-x88uh0"> </span>'),Eo=U('<li><!> <div class="name-container svelte-x88uh0"><span> </span> <!></div> <span class="price svelte-x88uh0"> </span></li>'),Co=U('<div class="view-content order-view svelte-x88uh0"><div class="orders-stack svelte-x88uh0"><div class="parked-orders-section svelte-x88uh0"><!></div> <div class="active-order-section svelte-x88uh0"><div class="order-content svelte-x88uh0"><h2 class="svelte-x88uh0"><span class="order-number svelte-x88uh0"> </span><!></h2> <!> <div class="scrollable-items-content svelte-x88uh0"><ul class="item-list svelte-x88uh0"></ul></div> <div class="spacer svelte-x88uh0"></div> <div class="total svelte-x88uh0"><span class="svelte-x88uh0">Total:</span> <span class="price svelte-x88uh0"> </span></div></div></div></div></div>'),Io=U('<div class="view-content receipts-view svelte-x88uh0"><div class="receipts-stack svelte-x88uh0"><!></div></div>'),Mo=U('<div class="agent-header-icon svelte-x88uh0"><!></div>'),Ao=U('<div class="message-actions svelte-x88uh0"></div>'),No=U('<div><div class="message-header svelte-x88uh0"><span class="message-timestamp svelte-x88uh0"> </span> <span class="message-type svelte-x88uh0"> </span></div> <div class="message-content svelte-x88uh0"> </div> <!></div>'),Ro=U(' <span class="cursor svelte-x88uh0">|</span>',1),Oo=U(' <span class="cursor svelte-x88uh0">|</span>',1),Do=U('<span class="cursor svelte-x88uh0">|</span>'),Po=U('<div class="agent-message user draft svelte-x88uh0"><div class="message-header svelte-x88uh0"><span class="message-timestamp svelte-x88uh0"> </span> <span class="message-type svelte-x88uh0">User</span></div> <div class="message-content svelte-x88uh0"><!></div></div>'),$o=U('<div class="view-content agent-view svelte-x88uh0"><!> <div class="scroll-content svelte-x88uh0"><div class="agent-messages svelte-x88uh0"><!> <!></div></div></div>'),Lo=U('<div class="console-view svelte-x88uh0"><div class="content-area svelte-x88uh0"><!></div></div>');function Uo(e,t){ct(t,!1);const[n,i]=Un(),s=()=>Xe(Je,"$orderStore",n),a=()=>Xe(nt,"$currentView",n),o=()=>Xe(ta,"$receiptsStore",n),u=()=>Xe(fe,"$agentStore",n),l=()=>Xe(Be,"$pinpadStore",n),c=()=>Xe(ar,"$uiConstantsStore",n),h=on();let p=V(),w=V(),m=V(),b=!1,T=V(!1),N=!1,F=V(!1),q=V("order"),v=V(!1),R=V(s().status),S=V(s().items.length),g=V(s().transactionId),d=V(s().metadata?.table),C=V(a());Nt(()=>{setTimeout(()=>{if(N||(k(),L(),N=!0),a()==="agent"&&fe.shouldActivatePinpadOnLoad()&&Be.activate("agent",()=>{},()=>{},"numeric"),r(p)){const x=new ResizeObserver(()=>{r(p)&&y(F,r(p).scrollHeight>r(p).clientHeight)});return x.observe(r(p)),y(F,r(p).scrollHeight>r(p).clientHeight),()=>{x.disconnect()}}},200)}),Ri(()=>{if(!r(T)){let x=null;a()==="order"?x=r(w):a()==="agent"?x=r(p):a()==="receipts"&&(x=r(m)),x&&setTimeout(()=>{if(x&&!r(T)){if(L(),a()==="agent"&&r(p)){const B=r(p).scrollHeight>r(p).clientHeight;B!==r(F)&&y(F,B)}b||(y(T,!0),x.scrollTop=x.scrollHeight,setTimeout(()=>{y(T,!1),L()},100))}},50)}});function z(x){if(typeof x=="object"&&x!==null)return x;if(typeof x=="string")try{return JSON.parse(x)}catch{return x}return x}function P(){const B={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"Select language / Sprache auswählen / Выберите язык:",actions:[{id:"lang-de",label:"DE",action:"selectLanguage",param:"DE"},{id:"lang-en",label:"EN",action:"selectLanguage",param:"EN"},{id:"lang-ru",label:"RU",action:"selectLanguage",param:"RU"}]};fe.addMessage(B),setTimeout(()=>{r(p)&&(Fe(p,r(p).scrollTop=r(p).scrollHeight),L())},100)}function K(x,B){if(x==="selectLanguage"){Be.switchLanguage(B);const Z=u().messages.filter(ie=>!ie.actions);fe.clearMessages(),Z.forEach(ie=>fe.addMessage(ie));const ne={timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Language changed to ${B}`};fe.addMessage(ne),setTimeout(()=>{r(p)&&(Fe(p,r(p).scrollTop=r(p).scrollHeight),L())},100)}}function L(){if(!r(T)){let x=null;if(a()==="order"?x=r(w):a()==="agent"?x=r(p):a()==="receipts"&&(x=r(m)),x){const Z=x.scrollTop,Q=x.clientHeight,ne=x.scrollHeight;b=Z+Q>=ne-1}else b=!0;h("scrollstate",b)}}function k(){let x=null;a()==="order"?x=r(w):a()==="agent"?x=r(p):a()==="receipts"&&(x=r(m)),x&&(x.scrollTop=x.scrollHeight,b=!0)}function H(){if(Wt(mn).hasNotification){nt.set("agent");return}let B;switch(r(q)){case"order":B=["order","receipts","agent"];break;case"receipts":B=["receipts","order","agent"];break;case"agent":B=["agent","order","receipts"];break;default:B=["order","receipts","agent"]}const Q=(B.indexOf(a())+1)%B.length,ne=B[Q];a()==="receipts"&&ne!=="receipts"&&y(v,!1),nt.set(ne)}function j(){return b}Nt(()=>{const x=de.subscribe(B=>{if(B.lastMessage?.command==="menu-import-progress"){const Z=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});fe.addMessage({timestamp:Z,type:"agent",message:B.lastMessage.payload.message}),setTimeout(()=>{r(p)&&a()==="agent"&&(Fe(p,r(p).scrollTop=r(p).scrollHeight),L())},100)}});return()=>{x()}}),typeof window<"u"&&window.electronAPI&&window.electronAPI.onImportComplete&&window.electronAPI.onImportComplete((x,B)=>{const Z=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});fe.addMessage({timestamp:Z,type:"agent",message:B}),x&&(W("INFO","Refreshing categories after successful menu import"),de.send({command:"getCategories"}),setTimeout(()=>{const Q=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});fe.addMessage({timestamp:Q,type:"agent",message:"Menu import completed successfully! Your new menu structure is now ready for use. You can navigate back to the selection area to explore the imported categories and products."}),setTimeout(()=>{r(p)&&a()==="agent"&&(Fe(p,r(p).scrollTop=r(p).scrollHeight),L())},100)},1e3)),setTimeout(()=>{r(p)&&a()==="agent"&&(Fe(p,r(p).scrollTop=r(p).scrollHeight),L())},100)}),Re(()=>(a(),r(C),mn),()=>{a()==="agent"&&r(C)!=="agent"?(console.log("🔵 [ConsoleView] User switched TO agent view, will clear notification in 100ms"),console.log("🔵 [ConsoleView] Previous view:",r(C),"Current view:",a()),setTimeout(()=>{console.log("🔵 [ConsoleView] Clearing notification now"),mn.clearNotification()},100)):a()==="agent"&&r(C)==="agent"?console.log("🔵 [ConsoleView] Already in agent view, NOT clearing notification"):a()!=="agent"&&console.log("🔵 [ConsoleView] Not in agent view, NOT clearing notification. Current view:",a()),y(C,a())}),Re(()=>(r(R),s(),r(m)),()=>{r(R)==="finished"&&s().status==="idle"&&(y(q,"receipts"),y(v,!0),nt.set("receipts"),ta.refresh(),setTimeout(()=>{r(m)&&(Fe(m,r(m).scrollTop=r(m).scrollHeight),L())},300)),y(R,s().status)}),Re(()=>(o(),r(m),a()),()=>{o().receipts&&r(m)&&a()==="receipts"&&setTimeout(()=>{L()},100)}),Re(()=>(u(),r(p),a(),r(F)),()=>{u().messages&&r(p)&&a()==="agent"&&setTimeout(()=>{if(r(p)){const x=r(p).scrollHeight>r(p).clientHeight;x!==r(F)&&y(F,x)}},100)}),Re(()=>(a(),r(w),s(),r(S),r(g),r(d)),()=>{if(a()==="order"&&r(w)){const x=s().items.length,B=s().transactionId,Z=s().metadata?.table;(x!==r(S)||B!==r(g)||Z!==r(d))&&setTimeout(()=>{r(w)&&Fe(w,r(w).scrollTop=r(w).scrollHeight)},100),y(S,x),y(g,B),y(d,Z)}}),Ht(),yt();var $=Lo(),he=f($),we=f(he);{var ve=x=>{var B=Co(),Z=f(B),Q=f(Z),ne=f(Q);vo(ne,{});var ie=_(Q,2),te=f(ie),le=f(te),ce=f(le),ue=f(ce),xe=_(ce);{var ye=O=>{var A=So(),se=f(A);ae(()=>ee(se,`#${l(),s(),M(()=>l().isActive&&l().mode==="table"?l().liveValue:s().metadata?.table)??""}`)),E(O,A)};J(xe,O=>{s(),l(),M(()=>s().metadata?.table||l().isActive&&l().mode==="table")&&O(ye)})}var Te=_(le,2);{var Ee=O=>{var A=xo(),se=f(A);ae(()=>ee(se,(l(),M(()=>l().errorMessage)))),E(O,A)};J(Te,O=>{l(),M(()=>l().errorMessage)&&O(Ee)})}var Me=_(Te,2),De=f(Me);Tt(De,5,()=>(s(),M(()=>s().items)),O=>O.id,(O,A)=>{var se=Eo();let me;var je=f(se);{var ft=Le=>{var qe=To(),rt=f(qe);ae(pt=>ee(rt,`${pt??""}x`),[()=>(r(A),M(()=>parseFloat(r(A).quantity)))]),E(Le,qe)};J(je,Le=>{r(A),M(()=>parseFloat(r(A).quantity)>1)&&Le(ft)})}var lt=_(je,2),vt=f(lt);let Ve;var at=f(vt),st=_(vt,2);{var Ze=Le=>{var qe=ko(),rt=f(qe);ae(()=>ee(rt,(l(),M(()=>l().liveValue)))),E(Le,qe)};J(st,Le=>{s(),r(A),l(),M(()=>s().activeTransactionItemId===r(A).id&&l().isActive&&l().mode!=="agent"&&l().liveValue)&&Le(Ze)})}var ze=_(lt,2),Ae=f(ze);ae((Le,qe,rt,pt)=>{me=Ke(se,1,"svelte-x88uh0",null,me,Le),Ve=Ke(vt,1,"name svelte-x88uh0",null,Ve,qe),ee(at,rt),ee(Ae,pt)},[()=>({active:s().activeTransactionItemId===r(A).id}),()=>({"input-mode":s().activeTransactionItemId===r(A).id&&l().isActive&&l().mode!=="agent"&&l().liveValue}),()=>(r(A),M(()=>r(A).display_names?z(r(A).display_names).menu.de||"N/A":"Loading...")),()=>(pe(ht),r(A),M(()=>ht(parseFloat(r(A).total_price))))]),E(O,se)});var ge=_(Me,4),ke=_(f(ge),2),_e=f(ke);Gt(Z,O=>y(w,O),()=>r(w)),ae(O=>{ee(ue,`Order №${s(),M(()=>s().transactionId||"...")??""}`),ee(_e,O)},[()=>(pe(ht),s(),M(()=>ht(s().total)))]),Y("scroll",Z,()=>!r(T)&&L()),E(x,B)},oe=x=>{var B=Ge(),Z=Ce(B);{var Q=ie=>{var te=Io(),le=f(te),ce=f(le);co(ce,{get autoExpandLatest(){return r(v)}}),Gt(le,ue=>y(m,ue),()=>r(m)),Y("scroll",le,()=>!r(T)&&L()),E(ie,te)},ne=ie=>{var te=Ge(),le=Ce(te);{var ce=ue=>{var xe=$o(),ye=f(xe);{var Te=_e=>{var O=Mo(),A=f(O);mo(A),E(_e,O)};J(ye,_e=>{r(F)||_e(Te)})}var Ee=_(ye,2),Me=f(Ee),De=f(Me);Tt(De,1,()=>(u(),M(()=>u().messages)),Zn,(_e,O)=>{var A=No();let se;var me=f(A),je=f(me),ft=f(je),lt=_(je,2),vt=f(lt),Ve=_(me,2),at=f(Ve),st=_(Ve,2);{var Ze=ze=>{var Ae=Ao();Tt(Ae,5,()=>(r(O),M(()=>r(O).actions)),Zn,(Le,qe)=>{{let rt=gn(()=>(r(qe),M(()=>({display:r(qe).label,action:()=>K(r(qe).action,r(qe).param)})))),pt=gn(()=>(c(),M(()=>({width:c().MIN_BUTTON_WIDTH,height:Math.round(c().MIN_BUTTON_WIDTH*.4)}))));sr(Le,{get content(){return r(rt)},get size(){return r(pt)},style:"rectangular"})}}),E(ze,Ae)};J(st,ze=>{r(O),M(()=>r(O).actions)&&ze(Ze)})}ae(ze=>{se=Ke(A,1,"agent-message svelte-x88uh0",null,se,ze),ee(ft,(r(O),M(()=>r(O).timestamp))),ee(vt,(r(O),M(()=>r(O).type==="user"?"User":"Agent"))),ee(at,(r(O),M(()=>r(O).message)))},[()=>({user:r(O).type==="user",agent:r(O).type==="agent",error:r(O).style==="error",success:r(O).style==="success",warning:r(O).style==="warning",print:r(O).style?.startsWith("print")})]),E(_e,A)});var ge=_(De,2);{var ke=_e=>{var O=Po(),A=f(O),se=f(A),me=f(se),je=_(A,2),ft=f(je);{var lt=Ve=>{var at=Ro(),st=Ce(at);ae(Ze=>ee(st,Ze),[()=>(l(),M(()=>"*".repeat(l().liveValue.length)))]),E(Ve,at)},vt=Ve=>{var at=Ge(),st=Ce(at);{var Ze=Ae=>{var Le=Oo(),qe=Ce(Le);ae(()=>ee(qe,(u(),M(()=>u().draftMessage.message)))),E(Ae,Le)},ze=Ae=>{var Le=Do();E(Ae,Le)};J(st,Ae=>{l(),u(),M(()=>l().layout==="alpha"&&u().draftMessage)?Ae(Ze):Ae(ze,!1)},!0)}E(Ve,at)};J(ft,Ve=>{l(),M(()=>l().layout==="numeric")?Ve(lt):Ve(vt,!1)})}ae(Ve=>ee(me,Ve),[()=>M(()=>new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}))]),E(_e,O)};J(ge,_e=>{l(),M(()=>l().isActive&&l().mode==="agent")&&_e(ke)})}Gt(Ee,_e=>y(p,_e),()=>r(p)),Y("scroll",Ee,()=>!r(T)&&L()),E(ue,xe)};J(le,ue=>{a()==="agent"&&ue(ce)},!0)}E(ie,te)};J(Z,ie=>{a()==="receipts"?ie(Q):ie(ne,!1)},!0)}E(x,B)};J(we,x=>{a()==="order"?x(ve):x(oe,!1)})}E(e,$),qn(t,"scrollToBottom",k),qn(t,"cycleViews",H),qn(t,"getIsAtBottom",j),qn(t,"displayLanguageSelector",P);var D=ut({scrollToBottom:k,cycleViews:H,getIsAtBottom:j,displayLanguageSelector:P});return i(),D}const rr=dt(!1);function Fo(){rr.set(!1)}var Bo=U('<div class="pinpad-grid numeric svelte-l3qs12"><button class="numpad-key svelte-l3qs12">1</button> <button class="numpad-key svelte-l3qs12">2</button> <button class="numpad-key svelte-l3qs12">3</button> <button class="function-key key-cancel svelte-l3qs12" aria-label="Cancel">X</button> <button class="numpad-key svelte-l3qs12">4</button> <button class="numpad-key svelte-l3qs12">5</button> <button class="numpad-key svelte-l3qs12">6</button> <button class="function-key key-correct svelte-l3qs12" aria-label="Correct">←</button> <button class="numpad-key svelte-l3qs12">7</button> <button class="numpad-key svelte-l3qs12">8</button> <button class="numpad-key svelte-l3qs12">9</button> <button class="function-key key-enter svelte-l3qs12" aria-label="Enter">↵</button> <button class="numpad-key function-key key-plus svelte-l3qs12">.99</button> <button class="numpad-key svelte-l3qs12">0</button> <button class="numpad-key function-key key-minus svelte-l3qs12">.</button></div>'),jo=U('<button class="alpha-key letter-key svelte-l3qs12"> </button>'),qo=U('<div class="alpha-row svelte-l3qs12"></div>'),Go=U('<div class="pinpad-grid alpha svelte-l3qs12"><!> <div class="alpha-bottom-row svelte-l3qs12"><button class="alpha-key space-key svelte-l3qs12" aria-label="Space">space</button> <button class="function-key cursor-key svelte-l3qs12" aria-label="Move cursor left">←</button> <button class="function-key cursor-key svelte-l3qs12" aria-label="Move cursor right">→</button> <button class="function-key language-key svelte-l3qs12" aria-label="Switch language"> </button> <button class="function-key key-cancel svelte-l3qs12" aria-label="Cancel">X</button> <button class="function-key key-correct svelte-l3qs12" aria-label="Backspace">⌫</button> <button class="function-key key-enter key-enter-large svelte-l3qs12" aria-label="Enter">↵</button></div></div>'),Vo=U('<div class="pinpad-wrapper svelte-l3qs12"><!></div>');function zo(e,t){ct(t,!1);const[n,i]=Un(),s=()=>Xe(Be,"$pinpadStore",n);let a=Ie(t,"onClose",8,()=>{}),o=Ie(t,"minButtonSize",8,160),u=V(0),l=V(0),c=V(80),h=V(107),p=V(50),w=V(50),m=null,b=null;const T=6;let N=V(0),F=V(null),q=V(null),v=V(null),R=V(null);function S(oe){Be.append(oe,fe)}function g(){Be.backspace(fe)}function d(){Be.confirm()}function C(){Be.cancel(fe)}function z(){a()()}function P(oe){b=oe,m=setTimeout(()=>{b===oe&&(Be.append(oe.toUpperCase(),fe),b=null)},500)}function K(){m&&(clearTimeout(m),m=null),b&&(Be.append(b.toLowerCase(),fe),b=null)}function L(){m&&(clearTimeout(m),m=null),b=null}function k(){Be.moveCursorLeft()}function H(){Be.moveCursorRight()}function j(){Be.switchLanguage()}Re(()=>(r(l),r(N),r(F)),()=>{r(l)>0&&Math.abs(r(l)-r(N))>5&&(r(F)&&clearTimeout(r(F)),y(F,setTimeout(()=>{y(N,r(l))},50)))}),Re(()=>(s(),r(N),r(q),r(v),r(R),pe(o()),r(p),r(h)),()=>{const oe=s().layout,D=s().currentLanguage;if(r(N)>0&&(r(q)!==oe||r(v)!==D||r(R)!==o()||r(q)===null&&r(v)===null)){if(oe==="alpha"&&s().layouts&&D){const x=s().layouts[D],B=Math.max(...x.map(ie=>ie.length)),Z=r(N)-T*(B-1);let Q=Math.floor(Z/B);const ne=o();Q>ne&&(Q=ne),y(p,Q),y(w,Math.floor(r(p)*(3/4)))}else if(oe==="numeric"){const B=r(N)-T*3;let Z=Math.floor(B/4);const Q=o();Z>Q&&(Z=Q),y(h,Z),y(c,Math.floor(r(h)*(3/4)))}y(q,oe),y(v,D),y(R,o())}}),Ht(),yt();var $=Vo(),he=f($);{var we=oe=>{var D=Bo(),x=f(D),B=_(x,2),Z=_(B,2),Q=_(Z,2),ne=_(Q,2),ie=_(ne,2),te=_(ie,2),le=_(te,2),ce=_(le,2),ue=_(ce,2),xe=_(ue,2),ye=_(xe,2),Te=_(ye,2),Ee=_(Te,2),Me=_(Ee,2);ae(()=>nn(D,`--button-height: ${r(c)??""}px; --button-width: ${r(h)??""}px;`)),Y("click",x,()=>S("1")),Y("click",B,()=>S("2")),Y("click",Z,()=>S("3")),Y("click",Q,C),Y("dblclick",Q,z),Y("click",ne,()=>S("4")),Y("click",ie,()=>S("5")),Y("click",te,()=>S("6")),Y("click",le,g),Y("click",ce,()=>S("7")),Y("click",ue,()=>S("8")),Y("click",xe,()=>S("9")),Y("click",ye,d),Y("click",Te,()=>S(".99")),Y("click",Ee,()=>S("0")),Y("click",Me,()=>S(".")),E(oe,D)},ve=oe=>{var D=Ge(),x=Ce(D);{var B=Z=>{var Q=Go(),ne=f(Q);Tt(ne,1,()=>(s(),M(()=>s().layouts[s().currentLanguage])),Zn,(Me,De)=>{var ge=qo();Tt(ge,5,()=>r(De),Zn,(ke,_e)=>{var O=jo(),A=f(O);ae(()=>{ki(O,"aria-label",`Letter ${r(_e)??""}`),ee(A,r(_e))}),Y("mousedown",O,()=>P(r(_e))),Y("mouseup",O,K),Y("mouseleave",O,L),E(ke,O)}),E(Me,ge)});var ie=_(ne,2),te=f(ie),le=_(te,2),ce=_(le,2),ue=_(ce,2),xe=f(ue),ye=_(ue,2),Te=_(ye,2),Ee=_(Te,2);ae(()=>{nn(Q,`--alpha-button-width: ${r(p)??""}px; --alpha-button-height: ${r(w)??""}px;`),ee(xe,(s(),M(()=>s().currentLanguage)))}),Y("click",te,()=>S(" ")),Y("click",le,k),Y("click",ce,H),Y("click",ue,j),Y("click",ye,C),Y("dblclick",ye,z),Y("click",Te,g),Y("click",Ee,d),E(Z,Q)};J(x,Z=>{s(),M(()=>s().layout==="alpha")&&Z(B)},!0)}E(oe,D)};J(he,oe=>{s(),M(()=>s().layout==="numeric")?oe(we):oe(ve,!1)})}cs($,"clientHeight",oe=>y(u,oe)),cs($,"clientWidth",oe=>y(l,oe)),E(e,$),ut(),i()}var Wo=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Description:</span> <span class="value svelte-yjty9j"> </span></div>'),Ho=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Allergens:</span> <span class="value svelte-yjty9j"> </span></div>'),Jo=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Dietary:</span> <span class="value svelte-yjty9j"> </span></div>'),Ko=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Category:</span> <span class="value svelte-yjty9j"> </span></div>'),Yo=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Status:</span> <span class="value svelte-yjty9j"> </span></div>'),Xo=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Last Modified:</span> <span class="value svelte-yjty9j"> </span></div>'),Qo=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Product ID:</span> <span class="value svelte-yjty9j"> </span></div>'),Zo=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Price:</span> <span class="value svelte-yjty9j"> </span></div> <!> <!> <!> <!> <!> <!> <!>',1),el=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Type:</span> <span class="value svelte-yjty9j"> </span></div>'),tl=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Category ID:</span> <span class="value svelte-yjty9j"> </span></div>'),nl=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Parent Category:</span> <span class="value svelte-yjty9j"> </span></div>'),al=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Main Group:</span> <span class="value svelte-yjty9j"> </span></div>'),sl=U('<div class="detail-row svelte-yjty9j"><span class="label svelte-yjty9j">Source ID:</span> <span class="value svelte-yjty9j"> </span></div>'),rl=U("<!> <!> <!> <!> <!>",1),il=U('<div class="context-menu svelte-yjty9j"><div class="menu-header svelte-yjty9j"><h3 class="svelte-yjty9j"><!></h3></div> <div class="menu-content svelte-yjty9j"><!></div> <div class="menu-footer svelte-yjty9j"><button class="edit-button svelte-yjty9j">Edit</button> <button class="advanced-edit-button svelte-yjty9j">View</button> <button class="close-button svelte-yjty9j">Close</button></div></div>');function ol(e,t){ct(t,!1);const n=V(),i=V(),s=V();let a=Ie(t,"item",8,null),o=Ie(t,"x",8,0),u=Ie(t,"y",8,0),l=Ie(t,"visible",8,!1);const c=on();let h=V(),p=V(0),w=V(0);Nt(()=>{function d(z){r(h)&&!r(h).contains(z.target)&&c("close")}function C(z){z.key==="Escape"&&c("close")}return l()&&(document.addEventListener("click",d),document.addEventListener("keydown",C)),()=>{document.removeEventListener("click",d),document.removeEventListener("keydown",C)}});function m(d){return typeof d=="number"?`€${d.toFixed(2)}`:a()&&a().item_price_value&&typeof a().item_price_value=="number"?`€${a().item_price_value.toFixed(2)}`:d||"N/A"}function b(d){try{const C=JSON.parse(d);return C.menu?.de||C.button?.de||C.de||"Unnamed"}catch{return d||"Unnamed"}}function T(d){try{return JSON.parse(d).de||"Unnamed Category"}catch{return d||"Unnamed Category"}}function N(d){try{return JSON.parse(d)}catch{return{}}}function F(){if(!r(h))return;const d=r(h).getBoundingClientRect(),C=window.innerWidth,z=window.innerHeight;if(d.width===0||d.height===0){setTimeout(()=>F(),10);return}const P=10,K=10,L=d.width>C-P*2,k=d.height>z-P*2;let H,j;L&&k?(H=P,j=P):L?(H=P,j=u()+K,j+d.height>z-P&&(j=u()-d.height-K),j<P&&(j=P)):k?(j=P,H=o()+K,H+d.width>C-P&&(H=o()-d.width-K),H<P&&(H=P)):(H=o()+K,j=u()+K,H+d.width>C-P&&(H=o()-d.width-K),j+d.height>z-P&&(j=u()-d.height-K),H<P&&(H=P),j<P&&(j=P)),y(p,H),y(w,j)}function q(){c("edit",{item:a()}),c("close")}function v(){c("advanced-edit",{item:a()}),c("close")}Re(()=>pe(a()),()=>{y(n,a()&&a().category_names)}),Re(()=>pe(a()),()=>{y(i,a()&&a().display_names)}),Re(()=>(r(i),pe(a())),()=>{y(s,r(i)&&a().additional_item_attributes?N(a().additional_item_attributes):{})}),Re(()=>(pe(l()),r(h)),()=>{l()&&r(h)&&requestAnimationFrame(()=>F())}),Ht(),yt();var R=Ge(),S=Ce(R);{var g=d=>{var C=il(),z=f(C),P=f(z),K=f(P);{var L=x=>{var B=Mt();ae(Z=>ee(B,Z),[()=>(pe(a()),M(()=>T(a().category_names)))]),E(x,B)},k=x=>{var B=Ge(),Z=Ce(B);{var Q=ie=>{var te=Mt();ae(le=>ee(te,le),[()=>(pe(a()),M(()=>b(a().display_names)))]),E(ie,te)},ne=ie=>{var te=Mt("Item Details");E(ie,te)};J(Z,ie=>{r(i)?ie(Q):ie(ne,!1)},!0)}E(x,B)};J(K,x=>{r(n)?x(L):x(k,!1)})}var H=_(z,2),j=f(H);{var $=x=>{var B=Zo(),Z=Ce(B),Q=_(f(Z),2),ne=f(Q),ie=_(Z,2);{var te=O=>{var A=Wo(),se=_(f(A),2),me=f(se);ae(()=>ee(me,(r(s),M(()=>r(s).description)))),E(O,A)};J(ie,O=>{r(s),M(()=>r(s).description)&&O(te)})}var le=_(ie,2);{var ce=O=>{var A=Ho(),se=_(f(A),2),me=f(se);ae(je=>ee(me,je),[()=>(r(s),M(()=>r(s).allergens.join(", ")))]),E(O,A)};J(le,O=>{r(s),M(()=>r(s).allergens&&r(s).allergens.length>0)&&O(ce)})}var ue=_(le,2);{var xe=O=>{var A=Jo(),se=_(f(A),2),me=f(se);ae(je=>ee(me,je),[()=>(r(s),M(()=>r(s).dietary_info.join(", ")))]),E(O,A)};J(ue,O=>{r(s),M(()=>r(s).dietary_info&&r(s).dietary_info.length>0)&&O(xe)})}var ye=_(ue,2);{var Te=O=>{var A=Ko(),se=_(f(A),2),me=f(se);ae(()=>ee(me,(pe(a()),M(()=>a().associated_category_unique_identifier)))),E(O,A)};J(ye,O=>{pe(a()),M(()=>a().associated_category_unique_identifier)&&O(Te)})}var Ee=_(ye,2);{var Me=O=>{var A=Yo(),se=_(f(A),2),me=f(se);ae(()=>ee(me,(pe(a()),M(()=>a().item_flags.is_sellable?"Available":"Not Available")))),E(O,A)};J(Ee,O=>{pe(a()),M(()=>a().item_flags&&a().item_flags.is_sellable!==void 0)&&O(Me)})}var De=_(Ee,2);{var ge=O=>{var A=Xo(),se=_(f(A),2),me=f(se);ae(je=>ee(me,je),[()=>(pe(a()),M(()=>new Date(a().audit_trail.updated_at||a().audit_trail.created_at).toLocaleDateString()))]),E(O,A)};J(De,O=>{pe(a()),M(()=>a().audit_trail)&&O(ge)})}var ke=_(De,2);{var _e=O=>{var A=Qo(),se=_(f(A),2),me=f(se);ae(()=>ee(me,(pe(a()),M(()=>a().id)))),E(O,A)};J(ke,O=>{pe(a()),M(()=>a().id)&&O(_e)})}ae(O=>ee(ne,O),[()=>(pe(a()),M(()=>m(a().item_price_value)))]),E(x,B)},he=x=>{var B=Ge(),Z=Ce(B);{var Q=ne=>{var ie=rl(),te=Ce(ie);{var le=ge=>{var ke=el(),_e=_(f(ke),2),O=f(_e);ae(()=>ee(O,(pe(a()),M(()=>a().category_type)))),E(ge,ke)};J(te,ge=>{pe(a()),M(()=>a().category_type)&&ge(le)})}var ce=_(te,2);{var ue=ge=>{var ke=tl(),_e=_(f(ke),2),O=f(_e);ae(()=>ee(O,(pe(a()),M(()=>a().id)))),E(ge,ke)};J(ce,ge=>{pe(a()),M(()=>a().id)&&ge(ue)})}var xe=_(ce,2);{var ye=ge=>{var ke=nl(),_e=_(f(ke),2),O=f(_e);ae(()=>ee(O,(pe(a()),M(()=>a().parent_category_unique_identifier)))),E(ge,ke)};J(xe,ge=>{pe(a()),M(()=>a().parent_category_unique_identifier)&&ge(ye)})}var Te=_(xe,2);{var Ee=ge=>{var ke=al(),_e=_(f(ke),2),O=f(_e);ae(()=>ee(O,(pe(a()),M(()=>a().default_linked_main_group_unique_identifier)))),E(ge,ke)};J(Te,ge=>{pe(a()),M(()=>a().default_linked_main_group_unique_identifier)&&ge(Ee)})}var Me=_(Te,2);{var De=ge=>{var ke=sl(),_e=_(f(ke),2),O=f(_e);ae(()=>ee(O,(pe(a()),M(()=>a().source_unique_identifier)))),E(ge,ke)};J(Me,ge=>{pe(a()),M(()=>a().source_unique_identifier)&&ge(De)})}E(ne,ie)};J(Z,ne=>{r(n)&&ne(Q)},!0)}E(x,B)};J(j,x=>{r(i)?x($):x(he,!1)})}var we=_(H,2),ve=f(we),oe=_(ve,2),D=_(oe,2);Gt(C,x=>y(h,x),()=>r(h)),ae(()=>nn(C,`left: ${(r(p)||o())??""}px; top: ${(r(w)||u())??""}px;`)),Y("click",ve,()=>q()),Y("click",oe,()=>v()),Y("click",D,()=>c("close")),E(d,C)};J(S,d=>{l()&&a()&&d(g)})}E(e,R),ut()}var ll=U('<span class="error-message svelte-eqo6fo"> </span>'),cl=U('<span class="error-message svelte-eqo6fo"> </span>'),ul=U('<span class="error-message svelte-eqo6fo"> </span>'),dl=U('<span class="error-message svelte-eqo6fo"> </span>'),fl=U('<span class="error-message svelte-eqo6fo"> </span>'),vl=U('<div class="modal-overlay svelte-eqo6fo" role="dialog" tabindex="-1"><div class="modal-content svelte-eqo6fo"><div class="modal-header svelte-eqo6fo"><h2 class="svelte-eqo6fo">Edit Product</h2> <button class="close-button svelte-eqo6fo" aria-label="Close">×</button></div> <form class="product-form svelte-eqo6fo"><div class="form-group svelte-eqo6fo"><label for="product-name-menu" class="svelte-eqo6fo">Name (Menu)</label> <input id="product-name-menu" type="text" placeholder="Enter menu name"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-name-button" class="svelte-eqo6fo">Name (Button)</label> <input id="product-name-button" type="text" placeholder="Enter button name"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-name-receipt" class="svelte-eqo6fo">Name (Receipt)</label> <input id="product-name-receipt" type="text" placeholder="Enter receipt name"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-price" class="svelte-eqo6fo">Price (€)</label> <input id="product-price" type="number" step="0.01" min="0" placeholder="0.00"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-category" class="svelte-eqo6fo">Category</label> <input id="product-category" type="text" placeholder="Enter category name"/> <!></div> <div class="form-group svelte-eqo6fo"><label for="product-description" class="svelte-eqo6fo">Description</label> <textarea id="product-description" placeholder="Enter product description (optional)" rows="3" class="svelte-eqo6fo"></textarea></div> <div class="form-actions svelte-eqo6fo"><button type="button" class="btn-cancel svelte-eqo6fo">Cancel</button> <button type="submit" class="btn-save svelte-eqo6fo"><!></button></div></form></div></div>');function pl(e,t){ct(t,!1);const n=on();let i=Ie(t,"visible",8,!1),s=Ie(t,"product",8,null),a=V({name_menu:"",name_button:"",name_receipt:"",price:"",categoryName:"",description:""}),o=V({}),u=V(!1),l=V(!1),c=V({});function h(v){if(typeof v=="object"&&v!==null)return v;if(typeof v=="string")try{return JSON.parse(v)}catch{return v}return v}function p(){if(y(c,{}),r(a).name_menu.trim()||Fe(c,r(c).name_menu="Menu name is required"),r(a).name_button.trim()||Fe(c,r(c).name_button="Button name is required"),r(a).name_receipt.trim()||Fe(c,r(c).name_receipt="Receipt name is required"),!r(a).price.trim())Fe(c,r(c).price="Price is required");else{const v=parseFloat(r(a).price);(isNaN(v)||v<0)&&Fe(c,r(c).price="Price must be a valid positive number")}return r(a).categoryName.trim()||Fe(c,r(c).categoryName="Category is required"),Object.keys(r(c)).length===0}async function w(){if(p()){y(l,!0);try{const v={};r(a).name_menu!==r(o).name_menu&&(v.name_menu=r(a).name_menu.trim()),r(a).name_button!==r(o).name_button&&(v.name_button=r(a).name_button.trim()),r(a).name_receipt!==r(o).name_receipt&&(v.name_receipt=r(a).name_receipt.trim()),r(a).price!==r(o).price&&(v.price=parseFloat(r(a).price)),r(a).categoryName!==r(o).categoryName&&(v.categoryName=r(a).categoryName.trim()),r(a).description!==r(o).description&&(v.description=r(a).description.trim()),Object.keys(v).length>0&&n("save",{productId:s().id,updates:v}),m()}catch(v){console.error("Error saving product:",v)}finally{y(l,!1)}}}function m(){n("close")}function b(v){v.target===v.currentTarget&&m()}function T(v){v.key==="Escape"&&m()}Re(()=>(pe(s()),pe(i()),r(a)),()=>{if(s()&&i()){const v=s().display_names?h(s().display_names):{},R=v.menu?.de||s().name||"",S=v.button?.de||v.menu?.de||s().name||"",g=v.receipt?.de||v.menu?.de||s().name||"";let d="Unknown Category";s().category_name?d=s().category_name:s().categoryName?d=s().categoryName:d=`Category ID: ${s().associated_category_unique_identifier||"N/A"}`,y(a,{name_menu:R,name_button:S,name_receipt:g,price:(s().item_price_value||s().price||0).toString(),categoryName:d,description:s().description||R}),y(o,{...r(a)}),y(u,!1),y(c,{})}}),Re(()=>(pe(i()),r(a),r(o)),()=>{y(u,i()&&(r(a).name_menu!==r(o).name_menu||r(a).name_button!==r(o).name_button||r(a).name_receipt!==r(o).name_receipt||r(a).price!==r(o).price||r(a).categoryName!==r(o).categoryName||r(a).description!==r(o).description))}),Ht(),yt();var N=Ge();Y("keydown",Rn,T);var F=Ce(N);{var q=v=>{var R=vl(),S=f(R),g=f(S),d=_(f(g),2),C=_(g,2),z=f(C),P=_(f(z),2);let K;var L=_(P,2);{var k=A=>{var se=ll(),me=f(se);ae(()=>ee(me,(r(c),M(()=>r(c).name_menu)))),E(A,se)};J(L,A=>{r(c),M(()=>r(c).name_menu)&&A(k)})}var H=_(z,2),j=_(f(H),2);let $;var he=_(j,2);{var we=A=>{var se=cl(),me=f(se);ae(()=>ee(me,(r(c),M(()=>r(c).name_button)))),E(A,se)};J(he,A=>{r(c),M(()=>r(c).name_button)&&A(we)})}var ve=_(H,2),oe=_(f(ve),2);let D;var x=_(oe,2);{var B=A=>{var se=ul(),me=f(se);ae(()=>ee(me,(r(c),M(()=>r(c).name_receipt)))),E(A,se)};J(x,A=>{r(c),M(()=>r(c).name_receipt)&&A(B)})}var Z=_(ve,2),Q=_(f(Z),2);let ne;var ie=_(Q,2);{var te=A=>{var se=dl(),me=f(se);ae(()=>ee(me,(r(c),M(()=>r(c).price)))),E(A,se)};J(ie,A=>{r(c),M(()=>r(c).price)&&A(te)})}var le=_(Z,2),ce=_(f(le),2);let ue;var xe=_(ce,2);{var ye=A=>{var se=fl(),me=f(se);ae(()=>ee(me,(r(c),M(()=>r(c).categoryName)))),E(A,se)};J(xe,A=>{r(c),M(()=>r(c).categoryName)&&A(ye)})}var Te=_(le,2),Ee=_(f(Te),2),Me=_(Te,2),De=f(Me),ge=_(De,2),ke=f(ge);{var _e=A=>{var se=Mt("Saving...");E(A,se)},O=A=>{var se=Mt("Save Changes");E(A,se)};J(ke,A=>{r(l)?A(_e):A(O,!1)})}ae((A,se,me,je,ft,lt)=>{P.disabled=r(l),K=Ke(P,1,"svelte-eqo6fo",null,K,A),j.disabled=r(l),$=Ke(j,1,"svelte-eqo6fo",null,$,se),oe.disabled=r(l),D=Ke(oe,1,"svelte-eqo6fo",null,D,me),Q.disabled=r(l),ne=Ke(Q,1,"svelte-eqo6fo",null,ne,je),ce.disabled=r(l),ue=Ke(ce,1,"svelte-eqo6fo",null,ue,ft),Ee.disabled=r(l),De.disabled=r(l),ge.disabled=lt},[()=>({error:r(c).name_menu}),()=>({error:r(c).name_button}),()=>({error:r(c).name_receipt}),()=>({error:r(c).price}),()=>({error:r(c).categoryName}),()=>(r(u),r(l),r(c),M(()=>!r(u)||r(l)||Object.keys(r(c)).length>0))]),Y("click",d,m),Ot(P,()=>r(a).name_menu,A=>Fe(a,r(a).name_menu=A)),Ot(j,()=>r(a).name_button,A=>Fe(a,r(a).name_button=A)),Ot(oe,()=>r(a).name_receipt,A=>Fe(a,r(a).name_receipt=A)),Ot(Q,()=>r(a).price,A=>Fe(a,r(a).price=A)),Ot(ce,()=>r(a).categoryName,A=>Fe(a,r(a).categoryName=A)),Ot(Ee,()=>r(a).description,A=>Fe(a,r(a).description=A)),Y("click",De,m),Y("submit",C,er(w)),Y("click",R,b),Y("keydown",R,T),E(v,R)};J(F,v=>{i()&&s()&&v(q)})}E(e,N),ut()}var ml=U('<div class="modal-overlay svelte-3d9wpg"><div class="modal-content svelte-3d9wpg"><div class="modal-header svelte-3d9wpg"><h2 class="svelte-3d9wpg">Edit Category</h2> <button class="close-button svelte-3d9wpg">×</button></div> <form class="product-form svelte-3d9wpg"><div class="form-group svelte-3d9wpg"><label for="category-name" class="svelte-3d9wpg">Category Name</label> <input id="category-name" type="text" class="svelte-3d9wpg"/></div> <div class="form-group svelte-3d9wpg"><label for="category-type" class="svelte-3d9wpg">Category Type</label> <select id="category-type" class="svelte-3d9wpg"><option>Food</option><option>Drink</option><option>Other</option></select></div> <div class="form-actions svelte-3d9wpg"><button type="button" class="btn-cancel svelte-3d9wpg">Cancel</button> <button type="submit" class="btn-save svelte-3d9wpg"> </button></div></form></div></div>');function gl(e,t){ct(t,!1);let n=Ie(t,"visible",8,!1),i=Ie(t,"category",8,null);const s=on();let a=V({name:"",type:"food"}),o=V({}),u=V(!1);async function l(){if(!r(a).name.trim()){alert("Category name is required.");return}y(u,!0);const T={};r(a).name!==r(o).name&&(T.name=r(a).name.trim()),r(a).type!==r(o).type&&(T.type=r(a).type),Object.keys(T).length>0&&s("save",{categoryId:i().id,updates:T}),c()}function c(){y(u,!1),s("close")}function h(T){T.target===T.currentTarget&&c()}function p(T){T.key==="Escape"&&c()}Re(()=>(pe(i()),pe(n()),r(a)),()=>{if(i()&&n()){const T=JSON.parse(i().category_names||"{}");y(a,{name:T.de||"",type:i().category_type||"food"}),y(o,{...r(a)})}}),Ht(),yt();var w=Ge();Y("keydown",Rn,p);var m=Ce(w);{var b=T=>{var N=ml(),F=f(N),q=f(F),v=_(f(q),2),R=_(q,2),S=f(R),g=_(f(S),2),d=_(S,2),C=_(f(d),2);ae(()=>{r(a),Gs(()=>{r(u)})});var z=f(C);z.value=z.__value="food";var P=_(z);P.value=P.__value="drink";var K=_(P);K.value=K.__value="other";var L=_(d,2),k=f(L),H=_(k,2),j=f(H);ae(()=>{g.disabled=r(u),C.disabled=r(u),k.disabled=r(u),H.disabled=r(u),ee(j,r(u)?"Saving...":"Save Changes")}),Y("click",v,c),Ot(g,()=>r(a).name,$=>Fe(a,r(a).name=$)),Qs(C,()=>r(a).type,$=>Fe(a,r(a).type=$)),Y("click",k,c),Y("submit",R,er(l)),Y("click",N,h),E(T,N)};J(m,T=>{n()&&i()&&T(b)})}E(e,w),ut()}class hl{constructor(t,n,i=!0){this.row=t,this.col=n,this.content=null,this.isEmpty=!0,this.isUsable=i,this.priority=0,this.id=`slot-${t}-${n}`}setContent(t,n=1){this.content=t,this.isEmpty=!1,this.priority=n}clearContent(){this.content=null,this.isEmpty=!0,this.priority=0}}class _l{constructor(t,n){this.rows=t,this.cols=n,this.slots=[],this.contentSlots=[],this.initializeGrid()}initializeGrid(){for(let t=0;t<this.rows;t++){const n=[];for(let i=0;i<this.cols;i++){const s=t%2!==i%2,a=new hl(t,i,s);n.push(a),this.contentSlots.push(a)}this.slots.push(n)}}getSlot(t,n){return t>=0&&t<this.rows&&n>=0&&n<this.cols?this.slots[t][n]:null}getAllSlots(){return this.contentSlots}getUsableEmptySlots(){return this.contentSlots.filter(t=>t.isUsable&&t.isEmpty)}getUsableFilledSlots(){return this.contentSlots.filter(t=>t.isUsable&&!t.isEmpty)}getUsableSlots(){return this.contentSlots.filter(t=>t.isUsable)}placeContentAt(t,n,i,s){const a=this.getSlot(t,n);return a&&a.isUsable&&(a.isEmpty||s>a.priority)?(a.setContent(i,s),!0):!1}clearAllContent(){this.contentSlots.forEach(t=>{t.clearContent()})}getPrioritizedSlots(){return this.contentSlots.filter(t=>t.isUsable).sort((t,n)=>n.priority-t.priority)}}function yl(e,t,n){const{cellWidth:i=120,cellHeight:s=80,hexOffset:a=.5,shape:o="hex"}=n;return o==="hex"?bl(e,t,i,s):wl(e,t,i,s)}function bl(e,t,n,i,s){const a=t*(n/2),o=e*(i*.75);return{x:a,y:o}}function wl(e,t,n,i){const s=t*n,a=e*i;return{x:s,y:a}}function Sl(e){return e?`translate(${e.x}px, ${e.y}px)`:"translate(0px, 0px)"}class xl{constructor(t,n,i){this.id=t,this.type=n,this.logicalPosition=i,this.content=null,this.cssPosition=null,this.cssTransform=null,this.geometryMetadata={}}setContent(t){this.content=t}calculatePhysicalPosition(t){return this.cssPosition=yl(this.logicalPosition.row,this.logicalPosition.col,t),this.cssTransform=Sl(this.cssPosition),this.cssPosition}}class Tl{constructor(t={}){this.options={shape:"hex",cellWidth:t.cellWidth||120,cellHeight:t.cellHeight||80,buttonGap:t.buttonGap||6,...t}}renderContentGrid(t){const n=[],i=t.getUsableFilledSlots();for(const s of i){const a=new xl(`full-slot-${s.row}-${s.col}`,"full",{row:s.row,col:s.col});a.setContent(s.content),a.geometryMetadata.priority=s.priority,a.calculatePhysicalPosition(this.options),n.push(a)}return n}}function ps(e={}){return new Tl(e)}const ms={MAX_CONTENT:100,PAYMENT_BUTTON:90,TABLE_BUTTON:85,PINPAD_BUTTON:80,CATEGORY_NAVIGATION:70,DEFAULT:50,MIN:1};class kl{constructor(t={}){this.config={dimensions:{rows:4,cols:12},rendering:{shape:"hex",cellWidth:120,cellHeight:80},...t},this.contentGrid=new _l(this.config.dimensions.rows,this.config.dimensions.cols),this.geometryRenderer=ps(this.config.rendering),this.renderCache=null,this.isDirty=!0,console.log("🎯 [GridManager] Initialized ContentGrid",this.config.dimensions)}clearAndReset(){this.contentGrid.clearAllContent(),this.markDirty()}placeItems(t,n=ms.DEFAULT,i=1/0){if(!t||t.length===0)return[];const s=this.contentGrid.getUsableEmptySlots();let a=0;const o=[];t.sort((u,l)=>(u.order_index||0)-(l.order_index||0));for(const u of t){if(a>=i)break;const l=s[a];l&&(l.setContent(u,n),a++,o.push({item:u,placed:!0,slot:l}))}return this.markDirty(),o}placeSystemElements(t){const n=[];for(const i of t){const s=this.contentGrid.placeContentAt(i.row,i.col,i.content,i.priority);n.push({element:i,placed:s})}return this.markDirty(),n}getRenderStructure(){return this.renderCache&&!this.isDirty?this.renderCache:(this.contentGrid.getUsableFilledSlots(),this.renderCache=this.geometryRenderer.renderContentGrid(this.contentGrid),this.isDirty=!1,this.renderCache)}getSvelteCompatibleCells(t){return this.geometryRenderer=ps(t),this.getRenderStructure().map(i=>({...i,cssTransform:i.cssTransform,data:i.content.data||i.content,label:i.content.label||i.content.category_names?.de||i.content.display_names?.button?.de}))}getDebugInfo(){return this.contentGrid.getDebugInfo()}getUsableSlotCount(){return this.contentGrid.getUsableSlots().length}markDirty(){this.isDirty=!0}getPriorities(){return ms}}var El=U("<div><div><!></div></div>"),Cl=U('<p class="status-message svelte-lb1vpy"> </p>'),Il=U('<div class="empty-category-info svelte-lb1vpy"><p class="empty-message svelte-lb1vpy">Diese Kategorie enthält noch keine Produkte.</p> <p class="empty-hint svelte-lb1vpy">Verwenden Sie das Menü-Import Tool oder fügen Sie Produkte manuell hinzu.</p></div>'),Ml=U('<div class="quantum-button svelte-lb1vpy"><!></div>'),Al=U("<div><!> <!></div>"),Nl=U('<div class="selection-area svelte-lb1vpy"><!> <!> <!> <!> <div class="grid-container svelte-lb1vpy"><!></div></div>');function Rl(e,t){ct(t,!1);const[n,i]=Un(),s=()=>Xe(Vt,"$authStore",n),a=()=>Xe(mn,"$notificationStore",n),o=()=>Xe(Li,"$currentMinuteTime",n),u=()=>Xe(ar,"$uiConstantsStore",n),l=()=>Xe(Je,"$orderStore",n),c=()=>Xe(Be,"$pinpadStore",n),h=V();let p=V([]),w=V([]),m=V("Connecting to backend..."),b=!1,T=V("categories"),N=null,F=V("6-6-6"),q=V(!1),v=V(null),R=V(0),S=V(0),g=V(!1),d=V(null),C=V(!1),z=V(null),P=0,K=Ie(t,"isAtBottom",8,!1);Ie(t,"consoleViewComponent",8,null);let L=0,k=V(null),H=V([]),j=Ie(t,"handleSmartAction",8,()=>{}),$=V(null),he=V(null),we=null;mn.subscribe(I=>{console.log("🎨 [SelectionArea] NotificationStore changed:",{hasNotification:I.hasNotification,style:I.style,previousStyle:we}),we=I.style}),Vt.subscribe(I=>{console.log("👤 [SelectionArea] AuthStore changed:",{isAuthenticated:I.isAuthenticated,currentUser:I.currentUser?.full_name||"none"})});let ve;Nt(()=>{oe(),ve=setInterval(()=>{oe()},6e4)});function oe(){r(k)&&(console.log("🕒 [SelectionArea] Updating time button with corrected time (once per minute):",o().time),ce())}Ha(()=>{ve&&clearInterval(ve)});const D=6,x=6,B=6,Z=6;function Q(I){if(!I)return"Login";const G=I.split(" ");let X;if(G.length===1){const re=G[0];re.length<=4?X=re:X=re.substring(0,4)}else{const re=G[0],Ne=G[1]||"";X=re.substring(0,3)+(Ne?Ne.charAt(0):"")}return"✓ "+X}function ne(){if(P<=0||L<=0)return;const I=ie();y(k,new kl({dimensions:{rows:I.rows,cols:I.cols*2},rendering:{shape:r(F)==="6-6-6"?"hex":"rect",cellWidth:I.cellWidth,cellHeight:I.cellHeight,buttonGap:r(F)==="6-6-6"?D:x}})),y(te,{cellWidth:I.cellWidth,cellHeight:I.cellHeight,shape:r(F)==="6-6-6"?"hex":"rect",buttonGap:r(F)==="6-6-6"?D:x}),ce()}function ie(){const I=P,G=r(F)==="6-6-6"?B:Z,X=L-2*G,re=r(F)==="6-6-6"?D:x,Ne=Math.floor((I-re)/(r(h)+re)),et=Math.max(1,Math.min(6,Ne)),Ue=(I-(et+1)*re)/et,We=Math.floor((X-re)/(r(h)+re)),tt=Math.max(1,Math.min(4,We)),Ft=r(F)==="6-6-6"?(X-(tt-1)*re)/(1+(tt-1)*.75):(X-(tt-1)*re)/tt;return{cols:et,rows:tt,cellWidth:Ue,cellHeight:Ft}}let te=V({cellWidth:r(h),cellHeight:7.5625*16,shape:"hex",buttonGap:6});function le(){ne()}function ce(){if(!r(k))return;r(k).clearAndReset();const I=r(k).getPriorities(),G=ue();r(k).placeSystemElements(G),r(T)==="categories"&&r(p).length>0?r(k).placeItems(r(p),I.CATEGORY_NAVIGATION):r(T)==="products"&&r(w).length>0&&r(k).placeItems(r(w),I.MAX_CONTENT),y(H,r(k).getSvelteCompatibleCells(r(te)))}function ue(){const I=[];return xe().forEach((X,re)=>{I.push({row:3,col:re*2,content:X,priority:r(k).getPriorities().PAYMENT_BUTTON})}),r($)&&I.push({row:0,col:0,content:r($),priority:r(k).getPriorities().TABLE_BUTTON}),r(he)&&I.push({row:0,col:2,content:r(he),priority:r(k).getPriorities().PINPAD_BUTTON}),I}function xe(){const I=[];return l().items.length>0&&I.push({label:"Bar",data:{paymentType:"cash"},onClick:()=>se("cash")},{label:"Karte",data:{paymentType:"card"},onClick:()=>se("card")}),I}function ye(I){I.content?.onClick?I.content.onClick():I.data&&(r(T)==="categories"&&I.data.id?ke({detail:{data:I.data}}):r(T)==="products"&&I.data.id&&_e({detail:{data:I.data}}))}let Te,Ee=V(),Me,De=!1;Nt(()=>{r(Ee)&&(Te=new ResizeObserver(G=>{Me&&clearTimeout(Me),Me=setTimeout(()=>{for(let X of G){const re=X.contentRect.width,Ne=X.contentRect.height;(P!==re||L!==Ne)&&(P=re,L=Ne,le())}},150)}),Te.observe(r(Ee)),setTimeout(()=>{P=r(Ee).clientWidth,L=r(Ee).clientHeight,le()},100));const I=()=>{y(T,"categories"),N=null,nt.set("order")};return window.addEventListener("autoCollapseComplete",I),()=>{Te?.disconnect(),window.removeEventListener("autoCollapseComplete",I)}}),de.subscribe(I=>{b=I.isConnected,b&&!De&&(De=!0,y(m,"Loading categories..."),setTimeout(()=>{de.send({command:"getCategories"}).then(X=>{X.status==="success"&&Array.isArray(X.payload)?(y(p,X.payload),y(m,""),ce()):(y(m,"Error: Could not load categories from backend."),console.error("Failed to load categories:",X))}).catch(X=>{y(m,"Error: Failed to get response for categories."),console.error("Error in getCategories promise:",X)})},500)),I.lastMessage?.command==="getItemsByCategoryResponse"&&(I.lastMessage.status==="success"&&Array.isArray(I.lastMessage.payload)?(y(w,I.lastMessage.payload),y(T,"products"),y(m,"")):y(m,"Error: Could not load products from backend."))});async function ge(I){try{await I()}catch(G){if(G.message&&G.message.includes("User must be authenticated")){nt.set("agent"),fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"Aktion erfordert Anmeldung. Bitte geben Sie Ihren PIN-Code ein.",style:"error"}),Be.activate("agent",null,null,"numeric");return}throw G}}function ke(I){const G=I.detail.data;G&&G.id&&(N=G,y(m,"Loading products..."),de.send({command:"getItemsByCategory",payload:{categoryId:G.id}}))}async function _e(I){const G=I.detail.data;G&&G.id&&await ge(async()=>{await Je.addItem(G.id,1)})}async function O(){if(s().isAuthenticated){const I=s().currentUser,G=`👤 **${I.full_name}** (${I.role})

🔐 **Status:** Erfolgreich angemeldet
💡 **Tipp:** Lange drücken zum Abmelden`,{agentStore:X}=await Et(async()=>{const{agentStore:re}=await Promise.resolve().then(()=>Yt);return{agentStore:re}},void 0);X.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:G})}}async function A(){if(s().isAuthenticated){await Vt.logout();const{agentStore:I}=await Et(async()=>{const{agentStore:G}=await Promise.resolve().then(()=>Yt);return{agentStore:G}},void 0);I.clearMessages(),I.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Willkommen bei ecKasse!

👥 Verfügbare Benutzer:
• Admin (Vollzugriff)
• Kassier (Kassenfunktionen)
• Aushilfe (Grundfunktionen)

⏰ Überprüfe Systemzeit und ausstehende Transaktionen...

💡 Geben Sie einfach Ihre 4-6 stellige PIN ein - das System erkennt Sie automatisch.

🔑 Bei neuer oder Testkasse: Admin-PIN ist 1234`}),Be.activate("agent",null,null,"numeric")}}function se(I){let G;if(Je.subscribe(X=>G=X)(),!(G.total<=0)&&(I==="bar"||I==="karte")){const X={type:I==="bar"?"Bar":"Karte",amount:G.total};Je.finishOrder(X)}}function me(I){const{data:G,mouseX:X,mouseY:re}=I.detail;if(G&&G.isUserButton&&G.authenticated){A();return}G&&!G.isBackButton&&(y(v,G),y(R,X),y(S,re),y(q,!0))}function je(){y(q,!1),y(v,null)}function ft(I){const{item:G}=I.detail;if(G.category_names)y(z,G),y(C,!0);else{let X={...G};if(G.associated_category_unique_identifier&&r(p).length>0){const re=r(p).find(Ne=>Ne.source_unique_identifier===G.associated_category_unique_identifier);re&&(X.category_name=re.category_names)}y(d,X),y(g,!0)}y(q,!1)}async function lt(I){const{item:G}=I.detail;try{nt.set("agent");const X=G.category_names?"category":"item";console.log("🔍 [handleAdvancedEdit] wsStore:",de),console.log("🔍 [handleAdvancedEdit] get(wsStore):",Wt(de)),console.log("🔍 [handleAdvancedEdit] wsStore methods:",Object.keys(Wt(de)||{}));const re=await de.send({command:"getEntityJson",payload:{entityType:X,entityId:G.id}});if(re&&re.success){console.log("Entity data loaded for advanced editing:",re);const Ne=JSON.stringify(re.payload.entity,null,2);fe.addMessage({type:"agent",message:`Advanced Edit - ${X==="category"?"Category":"Item"} Data:

${Ne}`,timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})}),fe.startDraftMessage(),fe.updateDraftMessage(Ne),Be.activateAlphaInput(()=>{},()=>{},fe),setTimeout(()=>{Be.clear(fe);for(let et of Ne)Be.append(et,fe)},50)}}catch(X){console.error("Error loading entity for advanced editing:",X),fe.addMessage({type:"agent",message:`Failed to load ${G.category_names?"category":"item"} data for advanced editing: ${X.message}`,style:"error",timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})})}y(q,!1)}async function vt(I){const{productId:G,updates:X}=I.detail;try{const re=await de.send({command:"updateProduct",payload:{productId:G,updates:X,sessionId:"admin-session-placeholder"}});re&&re.success&&r(T)==="products"&&N&&await loadProductsForCategory(N.id)}catch(re){console.error("Error saving product:",re)}y(g,!1),y(d,null)}function Ve(){y(g,!1),y(d,null)}async function at(I){const{categoryId:G,updates:X}=I.detail;try{const re=await de.send({command:"updateCategory",payload:{categoryId:G,updates:X}});re&&re.success&&r(T)==="categories"&&await loadCategories()}catch(re){console.error("Error saving category:",re)}y(C,!1),y(z,null)}function st(){y(C,!1),y(z,null)}Re(()=>(s(),Be),()=>{y($,(()=>{const I=s().currentUser;return I?{label:Q(I.full_name),data:{isUserButton:!0,authenticated:!0},onClick:O,active:!0,color:"#28a745",textColor:"#666",customStyle:"font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; line-height: 1.1; white-space: pre-line; text-align: center; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);"}:{label:"Login",data:{isUserButton:!0,authenticated:!1},onClick:()=>Be.activate("agent",null,null,"numeric"),active:!0,color:"#6c757d",textColor:"#666",customStyle:"font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; line-height: 1.1; white-space: pre-line; text-align: center; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);"}})())}),Re(()=>(a(),pe(K()),pe(j())),()=>{y(he,(()=>{let I="#2c2c2e";if(a().style)switch(a().style){case"error":I="#d32f2f";break;case"warning":I="#ffc107";break;case"success":I="#28a745";break;case"print":I="#2196F3";break;default:a().style?.startsWith("print")&&(I="#2196F3");break}return K()?{icon:`<svg width="50" height="50" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="3" y="3" width="12" height="10" rx="1" stroke="#404040" stroke-width="1.5" fill="none"/>
        <rect x="9" y="11" width="12" height="10" rx="1" stroke="#404040" stroke-width="1.5" fill="none"/>
        <line x1="3" y1="7" x2="15" y2="7" stroke="#404040" stroke-width="1.5"/>
        <line x1="9" y1="15" x2="21" y2="15" stroke="#404040" stroke-width="1.5"/>
      </svg>`,onClick:j(),active:!0,showShape:"",color:I,notificationStyle:a().style}:{icon:"",onClick:j(),active:!0,showShape:"double-arrow-down",color:I,notificationStyle:a().style}})())}),Re(()=>u(),()=>{y(h,u().MIN_BUTTON_WIDTH)}),Re(()=>r(F),()=>{r(F)&&le()}),Re(()=>(r(k),r(T),r(p),r(w)),()=>{r(k)&&(r(T)==="categories"&&r(p).length>=0||r(T)==="products"&&r(w).length>=0)&&ce()}),Re(()=>(r(k),l()),()=>{r(k)&&l()&&ce()}),Re(()=>(r(k),r($),r(he)),()=>{r(k)&&(r($)||r(he))&&ce()}),Re(()=>r(H),()=>{r(H).length>0}),Ht(),yt();var Ze=Nl(),ze=f(Ze);{var Ae=I=>{var G=El();let X;var re=f(G);let Ne;var et=f(re);{let Ue=gn(()=>r(h)/4*3);zo(et,{onClose:()=>Be.deactivate(),get minButtonSize(){return r(Ue)}})}ae((Ue,We)=>{X=Ke(G,1,"pinpad-overlay svelte-lb1vpy",null,X,Ue),Ne=Ke(re,1,"pinpad-container svelte-lb1vpy",null,Ne,We)},[()=>({numeric:c().layout==="numeric",alpha:c().layout==="alpha"}),()=>({numeric:c().layout==="numeric",alpha:c().layout==="alpha"})]),E(I,G)};J(ze,I=>{c(),M(()=>c().isActive)&&I(Ae)})}var Le=_(ze,2);ol(Le,{get item(){return r(v)},get x(){return r(R)},get y(){return r(S)},get visible(){return r(q)},$$events:{close:je,edit:ft,"advanced-edit":lt}});var qe=_(Le,2);pl(qe,{get visible(){return r(g)},get product(){return r(d)},$$events:{save:vt,close:Ve}});var rt=_(qe,2);gl(rt,{get visible(){return r(C)},get category(){return r(z)},$$events:{save:at,close:st}});var pt=_(rt,2),Jt=f(pt);{var Pe=I=>{var G=Cl(),X=f(G);ae(()=>ee(X,r(m))),E(I,G)},He=I=>{var G=Al();let X;var re=f(G);{var Ne=Ue=>{var We=Il();E(Ue,We)};J(re,Ue=>{r(T),r(w),M(()=>r(T)==="products"&&r(w).length===0)&&Ue(Ne)})}var et=_(re,2);Tt(et,1,()=>r(H),Ue=>Ue.id,(Ue,We)=>{var tt=Ml(),Ft=f(tt);sr(Ft,{get shape(){return r(te),M(()=>r(te).shape)},get width(){return r(te),M(()=>r(te).cellWidth)},get height(){return r(te),M(()=>r(te).cellHeight)},get label(){return r(We),M(()=>r(We).label)},get data(){return r(We),M(()=>r(We).data)},active:!0,$$events:{click:()=>ye(r(We)),secondaryaction:me}}),ae(()=>nn(tt,`${r(We),M(()=>r(We).cssTransform)??""}; position: absolute;`)),E(Ue,tt)}),ae(Ue=>{X=Ke(G,1,"grid-container-unified svelte-lb1vpy",null,X,Ue),nn(G,`
             --cell-width: ${r(te),M(()=>r(te).cellWidth)??""}px; 
             --cell-height: ${r(te),M(()=>r(te).cellHeight)??""}px;
             --hex-vertical-padding: 6px;
             --rect-vertical-padding: 6px;
           `)},[()=>({hex:r(F)==="6-6-6",rect:r(F)==="4-4-4"})]),E(I,G)};J(Jt,I=>{r(m)?I(Pe):I(He,!1)})}Gt(Ze,I=>y(Ee,I),()=>r(Ee)),E(e,Ze),ut(),i()}var Ol=U('<input type="file" accept=".pdf,.jpg,.jpeg,.png" multiple style="display: none;" class="svelte-1wvon5f"/>'),Dl=U('<div class="importing-indicator svelte-1wvon5f"><div class="spinner svelte-1wvon5f"></div> <p class="svelte-1wvon5f">Importing menu...</p></div>'),Pl=U('<div class="loading-files svelte-1wvon5f"><div class="spinner svelte-1wvon5f"></div> <p class="svelte-1wvon5f">Loading available files...</p></div>'),$l=U('<div class="error-message svelte-1wvon5f"><p class="svelte-1wvon5f"> </p> <button class="retry-btn svelte-1wvon5f">Retry</button></div>'),Ll=U('<div class="upload-area svelte-1wvon5f"><div class="upload-prompt svelte-1wvon5f"><p class="svelte-1wvon5f">No files selected yet.</p> <button class="upload-btn svelte-1wvon5f"><svg class="upload-icon svelte-1wvon5f" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" class="svelte-1wvon5f"></path></svg> Choose Files</button> <p class="upload-hint svelte-1wvon5f">Select multiple PDF, JPG, or PNG files</p></div></div>'),Ul=U('<div class="no-files svelte-1wvon5f"><p class="svelte-1wvon5f">No menu files found in the menu_inputs directory.</p> <p class="svelte-1wvon5f">Please add PDF, JPG, or PNG files to the menu_inputs folder.</p></div>'),Fl=U('<span class="svelte-1wvon5f"> </span>'),Bl=U('<span class="svelte-1wvon5f"> </span>'),jl=U('<button class="control-btn svelte-1wvon5f">Add More Files</button>'),ql=U('<div class="size-warning svelte-1wvon5f"></div>'),Gl=U('<div><label class="file-checkbox svelte-1wvon5f"><input type="checkbox" class="svelte-1wvon5f"/> <div class="file-info svelte-1wvon5f"><div class="file-name svelte-1wvon5f"> </div> <div class="file-details svelte-1wvon5f"><span class="file-type svelte-1wvon5f"> </span> <span class="file-date svelte-1wvon5f"> </span></div> <!></div></label></div>'),Vl=U('<span class="upload-status uploaded svelte-1wvon5f">✓ Uploaded</span>'),zl=U('<span class="upload-status pending svelte-1wvon5f">Pending upload</span>'),Wl=U('<div><label class="file-checkbox svelte-1wvon5f"><input type="checkbox" class="svelte-1wvon5f"/> <div class="file-info svelte-1wvon5f"><div class="file-name svelte-1wvon5f"> </div> <div class="file-details svelte-1wvon5f"><span class="file-type svelte-1wvon5f"> </span> <!></div></div></label> <button class="remove-btn svelte-1wvon5f" title="Remove file"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="svelte-1wvon5f"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" class="svelte-1wvon5f"></path></svg></button></div>'),Hl=U('<div class="file-controls svelte-1wvon5f"><div class="selection-info svelte-1wvon5f"><!></div> <div class="control-buttons svelte-1wvon5f"><!> <button class="control-btn svelte-1wvon5f">Select All Valid</button> <button class="control-btn svelte-1wvon5f">Clear Selection</button></div></div> <div class="file-list svelte-1wvon5f"><!></div> <div class="import-controls svelte-1wvon5f"><button class="import-btn svelte-1wvon5f"> </button></div>',1),Jl=U('<div class="file-selector svelte-1wvon5f"><!></div>'),Kl=U('<div class="menu-importer svelte-1wvon5f"><h3 class="svelte-1wvon5f">Menu Import</h3> <p class="svelte-1wvon5f"><!></p> <p class="size-limit svelte-1wvon5f"></p> <!> <!></div>');function Yl(e,t){ct(t,!1);const n=on();let i=V(!1),s=V([]),a=V(new Set),o=V(!0),u=V(null),l=V([]);const c=50*1024*1024,h=typeof window<"u"&&window.electronAPI,p=!h;let w=V();Nt(async()=>{h?await m():y(o,!1)});async function m(){if(h){y(o,!0),y(u,null);try{const D=await window.electronAPI.invoke("list-menu-files");D&&D.error?(y(u,D.error),y(s,[])):Array.isArray(D)?y(s,D):(y(u,"Unexpected response format"),y(s,[]))}catch(D){console.error("Error loading files:",D),y(u,D.message),y(s,[])}finally{y(o,!1)}}}async function b(D){const x=D.target.files;if(!(!x||x.length===0)){for(const B of x){if(!["application/pdf","image/jpeg","image/png","image/jpg"].includes(B.type)){fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`File "${B.name}" has unsupported format. Please select PDF, JPG, or PNG files.`});continue}const Q=c;if(B.size>Q){const ie=Math.round(Q/1048576),te=Math.round(B.size/(1024*1024)*100)/100;fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`File "${B.name}" (${te}MB) exceeds maximum size of ${ie}MB .`});continue}const ne={file:B,name:B.name,size:Math.round(B.size/(1024*1024)*100)/100,type:B.type.split("/")[1].toUpperCase(),selected:!0,uploaded:!1};y(l,[...r(l),ne])}r(w)&&Fe(w,r(w).value="")}}function T(){r(w)&&r(w).click()}function N(D){y(l,r(l).filter((x,B)=>B!==D))}function F(D){if(h)r(a).has(D.path)?r(a).delete(D.path):r(a).add(D.path),y(a,r(a));else{const x=r(l).findIndex(B=>B.name===D.name);x!==-1&&(Fe(l,r(l)[x].selected=!r(l)[x].selected),y(l,r(l)))}}function q(){if(h){const D=r(s).filter(x=>x.sizeValid);y(a,new Set(D.map(x=>x.path)))}else y(l,r(l).map(D=>({...D,selected:!0})))}function v(){h?y(a,new Set):y(l,r(l).map(D=>({...D,selected:!1})))}function R(){return h?r(a).size:r(l).filter(D=>D.selected).length}async function S(){const D=R();if(!(r(i)||D===0))if(h){const x=Array.from(r(a));await C(x)}else{const x=r(l).filter(B=>B.selected);await z(x)}}function g(D){return`${D.type} • ${D.size}MB`}function d(D){return new Date(D).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}async function C(D){if(r(i))return;y(i,!0),n("close"),nt.set("agent");const x=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),B=Array.isArray(D)?D.length:1,Z=Array.isArray(D)?D.map(Q=>Q.split("/").pop()).join(", "):D.split("/").pop();fe.addMessage({timestamp:x,type:"agent",message:`Starting menu import from ${B} file(s): ${Z}

This process will:
1. Parse the menu(s) with AI
2. Clean existing data
3. Import new menu structure
4. Create optimized layouts

Please wait...`});try{const Q=await window.electronAPI.invoke("start-menu-import",D);if(Q&&!Q.success&&Q.message){fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Import failed: ${Q.message}`}),y(i,!1);return}}catch(Q){console.error("Error starting import:",Q),fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Import failed: ${Q.message}`}),y(i,!1)}}async function z(D){if(r(i)||D.length===0)return;y(i,!0),n("close"),nt.set("agent");const x=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),B=D.map(Z=>Z.name).join(", ");fe.addMessage({timestamp:x,type:"agent",message:`Starting menu import from ${D.length} file(s): ${B}

This process will:
1. Upload files to server
2. Parse the menu(s) with AI
3. Clean existing data
4. Import new menu structure
5. Create optimized layouts

Please wait...`});try{const Z=`${window.location.protocol}//${window.location.host}`;fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Uploading ${D.length} files...`});const Q=new FormData;D.forEach((le,ce)=>{Q.append("menuFiles",le.file)});const ne=new XMLHttpRequest,te=await new Promise((le,ce)=>{ne.upload.addEventListener("progress",ue=>{if(ue.lengthComputable){const xe=Math.round(ue.loaded/ue.total*100);fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Uploading files: ${xe}%`})}}),ne.onload=function(){if(ne.status>=200&&ne.status<300)try{const ue=JSON.parse(ne.responseText);le(ue)}catch{ce(new Error("Invalid response format"))}else try{const ue=JSON.parse(ne.responseText);ce(new Error(ue.message||`HTTP ${ne.status}`))}catch{ce(new Error(`HTTP ${ne.status}: ${ne.statusText}`))}},ne.onerror=function(){ce(new Error("Network error occurred"))},ne.open("POST",`${Z}/api/menu/upload-and-import`),ne.send(Q)});if(!te.success)throw new Error(te.message||"Upload failed");fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`All files uploaded successfully. Processing ${te.fileCount} files: ${te.filenames.join(", ")}`}),D.forEach(le=>{le.uploaded=!0}),fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`✅ Menu import completed successfully!

You can now navigate back to the selection area to see your new menu items.`}),W("INFO","Refreshing categories after successful menu import"),de.send({command:"getCategories"})}catch(Z){console.error("Error uploading and importing files:",Z),fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`Import failed: ${Z.message}`})}finally{y(i,!1)}}typeof window<"u"&&window.electronAPI&&window.electronAPI.onImportProgress&&(window.electronAPI.onImportProgress(D=>{const x=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});fe.addMessage({timestamp:x,type:"agent",message:D})}),window.electronAPI.onImportComplete((D,x)=>{const B=new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"});D&&(W("INFO","Refreshing categories after successful menu import"),de.send({command:"getCategories"})),fe.addMessage({timestamp:B,type:"agent",message:D?`✅ Import completed successfully!

${x}

You can now navigate back to the selection area to see your new menu items.`:`❌ Import failed: ${x}`}),y(i,!1)})),yt();var P=Kl(),K=_(f(P),2),L=f(K);{var k=D=>{var x=Mt("Select one or more menu files from the menu_inputs directory");E(D,x)},H=D=>{var x=Mt("Upload and import menu files (PDF, JPG, PNG)");E(D,x)};J(L,D=>{h?D(k):D(H,!1)})}var j=_(K,2);j.textContent="Max file size: 50MB";var $=_(j,2);{var he=D=>{var x=Ol();Gt(x,B=>y(w,B),()=>r(w)),Y("change",x,b),E(D,x)};J($,D=>{p&&D(he)})}var we=_($,2);{var ve=D=>{var x=Dl();E(D,x)},oe=D=>{var x=Ge(),B=Ce(x);{var Z=ne=>{var ie=Pl();E(ne,ie)},Q=ne=>{var ie=Ge(),te=Ce(ie);{var le=ue=>{var xe=$l(),ye=f(xe),Te=f(ye),Ee=_(ye,2);ae(()=>ee(Te,`Error loading files: ${r(u)??""}`)),Y("click",Ee,m),E(ue,xe)},ce=ue=>{var xe=Jl(),ye=f(xe);{var Te=Me=>{var De=Ll(),ge=f(De),ke=_(f(ge),2);Y("click",ke,T),E(Me,De)},Ee=Me=>{var De=Ge(),ge=Ce(De);{var ke=O=>{var A=Ul();E(O,A)},_e=O=>{var A=Hl(),se=Ce(A),me=f(se),je=f(me);{var ft=Pe=>{var He=Fl(),I=f(He);ae(()=>ee(I,`${r(a).size??""} of ${r(s).length??""} files selected`)),E(Pe,He)},lt=Pe=>{var He=Bl(),I=f(He);ae(G=>ee(I,`${G??""} of ${r(l).length??""} files selected`),[()=>r(l).filter(G=>G.selected).length]),E(Pe,He)};J(je,Pe=>{h?Pe(ft):Pe(lt,!1)})}var vt=_(me,2),Ve=f(vt);{var at=Pe=>{var He=jl();Y("click",He,T),E(Pe,He)};J(Ve,Pe=>{p&&Pe(at)})}var st=_(Ve,2),Ze=_(st,2),ze=_(se,2),Ae=f(ze);{var Le=Pe=>{var He=Ge(),I=Ce(He);Tt(I,1,()=>r(s),G=>G.path,(G,X)=>{var re=Gl();let Ne;var et=f(re),Ue=f(et),We=_(Ue,2),tt=f(We),Ft=f(tt),Fn=_(tt,2),Bn=f(Fn),jn=f(Bn),ua=_(Bn,2),da=f(ua),fa=_(Fn,2);{var va=Kt=>{var mt=ql();mt.textContent="File too large (max 50MB)",E(Kt,mt)};J(fa,Kt=>{r(X).sizeValid||Kt(va)})}ae((Kt,mt,kn,ir)=>{Ne=Ke(re,1,"file-item svelte-1wvon5f",null,Ne,Kt),Ue.disabled=!r(X).sizeValid,os(Ue,mt),ee(Ft,r(X).name),ee(jn,kn),ee(da,`Modified: ${ir??""}`)},[()=>({invalid:!r(X).sizeValid,selected:r(a).has(r(X).path)}),()=>r(a).has(r(X).path),()=>g(r(X)),()=>d(r(X).lastModified)]),Y("change",Ue,()=>F(r(X))),E(G,re)}),E(Pe,He)},qe=Pe=>{var He=Ge(),I=Ce(He);Tt(I,3,()=>r(l),G=>G.name,(G,X,re)=>{var Ne=Wl();let et;var Ue=f(Ne),We=f(Ue),tt=_(We,2),Ft=f(tt),Fn=f(Ft),Bn=_(Ft,2),jn=f(Bn),ua=f(jn),da=_(jn,2);{var fa=mt=>{var kn=Vl();E(mt,kn)},va=mt=>{var kn=zl();E(mt,kn)};J(da,mt=>{r(X).uploaded?mt(fa):mt(va,!1)})}var Kt=_(Ue,2);ae(mt=>{et=Ke(Ne,1,"file-item svelte-1wvon5f",null,et,mt),os(We,r(X).selected),ee(Fn,r(X).name),ee(ua,`${r(X).type??""} • ${r(X).size??""}MB`)},[()=>({selected:r(X).selected,uploaded:r(X).uploaded})]),Y("change",We,()=>F(r(X))),Y("click",Kt,()=>N(r(re))),E(G,Ne)}),E(Pe,He)};J(Ae,Pe=>{h?Pe(Le):Pe(qe,!1)})}var rt=_(ze,2),pt=f(rt),Jt=f(pt);ae((Pe,He,I,G)=>{st.disabled=Pe,Ze.disabled=He,pt.disabled=I,ee(Jt,`Import Selected Files (${G??""})`)},[()=>h?r(s).every(Pe=>!Pe.sizeValid):r(l).length===0,()=>R()===0,()=>R()===0,R]),Y("click",st,q),Y("click",Ze,v),Y("click",pt,S),E(O,A)};J(ge,O=>{h&&r(s).length===0?O(ke):O(_e,!1)},!0)}E(Me,De)};J(ye,Me=>{p&&r(l).length===0?Me(Te):Me(Ee,!1)})}E(ue,xe)};J(te,ue=>{h&&r(u)?ue(le):ue(ce,!1)},!0)}E(ne,ie)};J(B,ne=>{h&&r(o)?ne(Z):ne(Q,!1)},!0)}E(D,x)};J(we,D=>{r(i)?D(ve):D(oe,!1)})}E(e,P),ut()}var Xl=U('<button class="download-btn svelte-1dlpwa7">📥 Download Export</button> <button class="reset-btn svelte-1dlpwa7">🔄 New Export</button>',1),Ql=U('<button class="cancel-btn svelte-1dlpwa7">❌ Cancel</button>'),Zl=U('<button class="export-btn svelte-1dlpwa7" disabled><!></button> <!>',1),ec=U('<button class="export-btn svelte-1dlpwa7">🚀 Generate Export</button>'),tc=U('<div class="error-message svelte-1dlpwa7"> <button class="retry-btn svelte-1dlpwa7">Try Again</button></div>'),nc=U('<div class="job-info svelte-1dlpwa7"><small> </small></div>'),ac=U('<div class="dsfinvk-exporter svelte-1dlpwa7"><h3 class="svelte-1dlpwa7">DSFinV-K Export</h3> <div class="date-range-picker svelte-1dlpwa7"><div class="date-input svelte-1dlpwa7"><label for="dsfinvk-start" class="svelte-1dlpwa7">Start Date:</label> <input type="date" id="dsfinvk-start" class="svelte-1dlpwa7"/></div> <div class="date-input svelte-1dlpwa7"><label for="dsfinvk-end" class="svelte-1dlpwa7">End Date:</label> <input type="date" id="dsfinvk-end" class="svelte-1dlpwa7"/></div></div> <div class="export-actions svelte-1dlpwa7"><!></div> <!> <!></div>');function sc(e,t){ct(t,!1);let n=V(new Date().toISOString().split("T")[0]),i=V(new Date().toISOString().split("T")[0]),s=V(!1),a=V(null),o=V(null),u=V(null),l=null,c=V(null);const h=typeof window<"u"&&window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1";async function p(){y(s,!0),y(a,null),y(u,null),y(c,null),fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`🚀 Starting DSFinV-K export for period ${r(n)} to ${r(i)}...`,style:"info"});try{h?await m():await w()}catch(j){fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`❌ DSFinV-K export failed: ${j.message}`,style:"error"}),y(a,"failed"),y(c,j.message)}finally{h||y(s,!1)}}async function w(){try{const j=await fetch("/api/export/dsfinvk/start",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({startDate:r(n),endDate:r(i)})});if(j.ok&&j.headers.get("content-type")?.includes("application/zip")){const $=await j.blob(),he=window.URL.createObjectURL($),we=`dsfinvk-export-${r(n)}-to-${r(i)}.zip`,ve=document.createElement("a");ve.href=he,ve.download=we,document.body.appendChild(ve),ve.click(),document.body.removeChild(ve),window.URL.revokeObjectURL(he),fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`✅ DSFinV-K export complete! File downloaded as ${we}`,style:"success"}),y(a,"complete")}else{const $=await j.json();if(!$.success)throw new Error($.error||"Export failed")}}catch{const $=await de.send({command:"generateDsfinvkExport",payload:{startDate:r(n),endDate:r(i)}});if($.status==="success"&&$.payload.success)fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`✅ DSFinV-K export complete! File available at: ${$.payload.path}`,style:"success"}),y(a,"complete");else throw new Error($.payload?.message||$.error||"Unknown export error")}}async function m(){const $=await(await fetch("/api/export/dsfinvk/start",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({startDate:r(n),endDate:r(i)})})).json();if(!$.success)throw new Error($.error||"Failed to start export job");y(o,$.jobId),y(a,$.status),fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`📊 Export job started (Job ID: ${r(o)}). Generating report...`,style:"info"}),b()}function b(){l&&clearInterval(l),l=setInterval(async()=>{try{const $=await(await fetch(`/api/export/dsfinvk/status/${r(o)}`,{credentials:"include"})).json();if(!$.success)throw new Error($.error||"Failed to check job status");y(a,$.status.toLowerCase()),r(a)==="complete"?(clearInterval(l),l=null,y(u,$.downloadUrl),y(s,!1),fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"✅ DSFinV-K export complete! Ready for download.",style:"success"})):r(a)==="failed"?(clearInterval(l),l=null,y(s,!1),y(c,$.error||"Export job failed"),fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`❌ DSFinV-K export failed: ${r(c)}`,style:"error"})):r(a)==="processing"&&fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"⚙️ Export job is processing...",style:"info"})}catch(j){console.error("Error polling job status:",j),fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:`⚠️ Error checking export status: ${j.message}`,style:"warning"})}},3e3)}function T(){r(u)&&(window.open(r(u),"_blank"),fe.addMessage({timestamp:new Date().toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),type:"agent",message:"📥 Download initiated for DSFinV-K export.",style:"success"}))}function N(){l&&(clearInterval(l),l=null),y(s,!1),y(a,null),y(o,null),y(u,null),y(c,null)}Ha(()=>{l&&clearInterval(l)}),yt();var F=ac(),q=_(f(F),2),v=f(q),R=_(f(v),2),S=_(v,2),g=_(f(S),2),d=_(q,2),C=f(d);{var z=j=>{var $=Xl(),he=Ce($),we=_(he,2);Y("click",he,T),Y("click",we,N),E(j,$)},P=j=>{var $=Ge(),he=Ce($);{var we=oe=>{var D=Zl(),x=Ce(D),B=f(x);{var Z=te=>{var le=Mt("⏳ Queued...");E(te,le)},Q=te=>{var le=Ge(),ce=Ce(le);{var ue=ye=>{var Te=Mt("⚙️ Processing...");E(ye,Te)},xe=ye=>{var Te=Mt("🔄 Generating...");E(ye,Te)};J(ce,ye=>{r(a)==="processing"?ye(ue):ye(xe,!1)},!0)}E(te,le)};J(B,te=>{r(a)==="pending"?te(Z):te(Q,!1)})}var ne=_(x,2);{var ie=te=>{var le=Ql();Y("click",le,N),E(te,le)};J(ne,te=>{h&&te(ie)})}E(oe,D)},ve=oe=>{var D=ec();Y("click",D,p),E(oe,D)};J(he,oe=>{r(s)||r(a)==="pending"||r(a)==="processing"?oe(we):oe(ve,!1)},!0)}E(j,$)};J(C,j=>{r(a)==="complete"&&r(u)?j(z):j(P,!1)})}var K=_(d,2);{var L=j=>{var $=tc(),he=f($),we=_(he);ae(()=>ee(he,`❌ Export failed: ${r(c)??""} `)),Y("click",we,N),E(j,$)};J(K,j=>{r(a)==="failed"&&r(c)&&j(L)})}var k=_(K,2);{var H=j=>{var $=nc(),he=f($),we=f(he);ae(()=>ee(we,`Job ID: ${r(o)??""}`)),E(j,$)};J(k,j=>{h&&r(o)&&j(H)})}ae(()=>{R.disabled=r(s),g.disabled=r(s)}),Ot(R,()=>r(n),j=>y(n,j)),Ot(g,()=>r(i),j=>y(i,j)),E(e,F),ut()}var rc=U('<div class="control-center-overlay svelte-mpduov"><div class="control-center-panel svelte-mpduov"><div class="panel-header svelte-mpduov"><h2 class="svelte-mpduov">Control Center</h2> <button class="close-btn svelte-mpduov">×</button></div> <div class="panel-content svelte-mpduov"><div class="section svelte-mpduov"><h3 class="svelte-mpduov">System Time</h3> <div class="time-display svelte-mpduov"> </div> <p class="time-description svelte-mpduov">Current system time. Time synchronization is managed automatically.</p></div> <div class="section svelte-mpduov"><h3 class="svelte-mpduov">Language & Region</h3> <div class="locale-settings svelte-mpduov"><label for="locale-select" class="locale-label svelte-mpduov">Display Locale:</label> <select id="locale-select" class="locale-select svelte-mpduov"><option class="svelte-mpduov">Deutsch (Deutschland)</option><option class="svelte-mpduov">English (United States)</option><option class="svelte-mpduov">English (United Kingdom)</option></select></div> <p class="locale-description svelte-mpduov">Changes how numbers, currencies, and dates are displayed in the interface.</p></div> <div class="section svelte-mpduov"><!></div> <div class="section svelte-mpduov"><!></div> <div class="section svelte-mpduov"><h3 class="svelte-mpduov">System Information</h3> <div class="system-info svelte-mpduov"><div class="info-item svelte-mpduov"><span class="label svelte-mpduov">Status:</span> <span class="value connected svelte-mpduov">Connected</span></div> <div class="info-item svelte-mpduov"><span class="label svelte-mpduov">Mode:</span> <span class="value svelte-mpduov">Development</span></div></div></div></div></div></div>');function ic(e,t){ct(t,!1);const[n,i]=Un(),s=()=>Xe(rr,"$controlCenterVisible",n),a=()=>Xe(Ta,"$currentTime",n),o=()=>Xe(wn,"$localeStore",n);on();function u(){Fo()}function l(T){return T.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"})}function c(){u()}function h(T){const N=T.target.value;Qi(N)}function p(T){T.key==="Escape"&&u()}yt();var w=Ge();Y("keydown",Rn,p);var m=Ce(w);{var b=T=>{var N=rc(),F=f(N),q=f(F),v=_(f(q),2),R=_(q,2),S=f(R),g=_(f(S),2),d=f(g),C=_(S,2),z=_(f(C),2),P=_(f(z),2);ae(()=>{o(),Gs(()=>{})});var K=f(P);K.value=K.__value="de-DE";var L=_(K);L.value=L.__value="en-US";var k=_(L);k.value=k.__value="en-GB";var H=_(C,2),j=f(H);Yl(j,{$$events:{close:c}});var $=_(H,2),he=f($);sc(he,{}),ae(we=>ee(d,we),[()=>l(a())]),Y("click",v,u),Qs(P,o,we=>Mi(wn,we)),Y("change",P,h),Y("click",N,Ii(u)),E(T,N)};J(m,T=>{s()&&T(b)})}E(e,w),ut(),i()}var oc=U('<main class="pos-grid svelte-1ji6e50"><div class="grid-item-display svelte-1ji6e50"><!></div> <div class="grid-selection-area svelte-1ji6e50"><!></div></main> <!>',1);function lc(e,t){ct(t,!1);let n=V(),i=V(!1);Nt(async()=>{await Vt.checkSession();const m=de.subscribe(b=>{b.lastMessage?.command==="sessionEstablished"&&(console.log("Demo mode: Received session established message"),Vt.establishSession(b.lastMessage.payload))});return typeof window<"u"&&window.electronAPI&&window.electronAPI.onUiRefreshRequest&&window.electronAPI.onUiRefreshRequest(()=>{console.log("UI refresh requested - switching to selection view and refreshing data"),W("INFO","UI refresh requested after menu import"),nt.set("selection"),de.send({command:"getCategories"}),setTimeout(()=>{window.location.reload()},1e3)}),()=>{m()}});function s(m){y(i,m.detail)}function a(){r(n)&&typeof r(n).getIsAtBottom=="function"&&(r(n).getIsAtBottom()&&typeof r(n).cycleViews=="function"?r(n).cycleViews():typeof r(n).scrollToBottom=="function"&&r(n).scrollToBottom())}yt();var o=oc(),u=Ce(o),l=f(u),c=f(l);Gt(Uo(c,{$$events:{scrollstate:s},$$legacy:!0}),m=>y(n,m),()=>r(n));var h=_(l,2),p=f(h);Rl(p,{handleSmartAction:a,get isAtBottom(){return r(i)},get consoleViewComponent(){return r(n)}});var w=_(u,2);ic(w,{}),E(e,o),ut()}window.onerror=function(e,t,n,i,s){return W("ERROR","Unhandled Frontend Exception",{type:"window.onerror",message:e,source:t,lineno:n,colno:i,error:s?s.stack:"N/A"}),!0};window.addEventListener("unhandledrejection",e=>{W("ERROR","Unhandled Promise Rejection",{type:"unhandledrejection",reason:e.reason?e.reason.message||e.reason:"No reason provided",stack:e.reason?e.reason.stack:"N/A"})});vi(lc,{target:document.getElementById("app")});
